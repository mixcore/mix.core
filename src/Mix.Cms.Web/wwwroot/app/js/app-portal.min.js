var demo = {
    initDashboardPageCharts: function (incomes,services) {
        incomes = incomes || [50, 150, 100, 190, 130, 90, 150, 160, 120, 140, 190, 95];
        chartColor = "#eeeeee";
        // General configuration for the charts with Line gradientStroke
        gradientChartOptionsConfiguration = {
            maintainAspectRatio: false,
            legend: {
                display: false
            },
            tooltips: {
                bodySpacing: 4,
                mode: "nearest",
                intersect: 0,
                position: "nearest",
                xPadding: 10,
                yPadding: 10,
                caretPadding: 10
            },
            responsive: 1,
            scales: {
                yAxes: [{
                    display: 0,
                    
                    ticks: {
                        display: false
                    },
                    gridLines: {
                        zeroLineColor: "transparent",
                        drawTicks: false,
                        display: false,
                        drawBorder: false
                    }
                }],
                xAxes: [{
                    display: 0,
                    
                    ticks: {
                        display: false
                    },
                    gridLines: {
                        zeroLineColor: "transparent",
                        drawTicks: false,
                        display: false,
                        drawBorder: false
                    }
                }]
            },
            layout: {
                padding: { left: 0, right: 0, top: 15, bottom: 15 }
            }
        };

        gradientChartOptionsConfigurationWithNumbersAndGrid = {
            maintainAspectRatio: false,
            legend: {
                display: false
            },
            tooltips: {
                bodySpacing: 4,
                mode: "nearest",
                intersect: 0,
                position: "nearest",
                xPadding: 10,
                yPadding: 10,
                caretPadding: 10
            },
            responsive: true,
            scales: {
                yAxes: [{
                    
                    gridLines: {
                        zeroLineColor: "transparent",
                        drawBorder: false
                    }
                }],
                xAxes: [{
                    display: 0,
                    
                    ticks: {
                        display: false
                    },
                    gridLines: {
                        zeroLineColor: "transparent",
                        drawTicks: false,
                        display: false,
                        drawBorder: false
                    }
                }]
            },
            layout: {
                padding: { left: 0, right: 0, top: 15, bottom: 15 }
            }
        };

        var ctx = document.getElementById('bigDashboardChart').getContext("2d");

        var gradientStroke = ctx.createLinearGradient(500, 0, 100, 0);
        gradientStroke.addColorStop(0, '#80b6f4');
        gradientStroke.addColorStop(1, chartColor);

        var gradientFill = ctx.createLinearGradient(0, 200, 0, 50);
        gradientFill.addColorStop(0, "rgba(128, 182, 244, 0)");
        gradientFill.addColorStop(1, "rgba(255, 255, 255, 0.24)");

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"],
                datasets: [
                    {
                        type: 'line',
                        label: "Incomes",
                        borderColor: chartColor,
                        pointBorderColor: chartColor,
                        pointBackgroundColor: "red",
                        pointHoverBackgroundColor: "#1e3d60",
                        pointHoverBorderColor: chartColor,
                        pointBorderWidth: 1,
                        pointHoverRadius: 7,
                        pointHoverBorderWidth: 2,
                        pointRadius: 5,
                        fill: true,
                        backgroundColor: gradientFill,
                        borderWidth: 2,
                        data: incomes
                    },
                    {                        
                        label: "Services",
                        //borderColor: chartColor,
                        //pointBorderColor: chartColor,
                        //pointBackgroundColor: "#1e3d60",
                        //pointHoverBackgroundColor: "#1e3d60",
                        //pointHoverBorderColor: chartColor,
                        //pointBorderWidth: 1,
                        //pointHoverRadius: 7,
                        //pointHoverBorderWidth: 2,
                        //pointRadius: 5,
                        //fill: true,
                        backgroundColor: 'yellow',
                        //borderWidth: 2,
                        data: services
                    }
                ]
            },
            options: {
                layout: {
                    padding: {
                        left: 20,
                        right: 20,
                        top: 0,
                        bottom: 0
                    }
                },
                maintainAspectRatio: false,
                tooltips: {
                    backgroundColor: '#fff',
                    titleFontColor: '#333',
                    bodyFontColor: '#666',
                    bodySpacing: 4,
                    xPadding: 12,
                    mode: "nearest",
                    intersect: 0,
                    position: "nearest"
                },
                legend: {
                    position: "bottom",
                    fillStyle: "#FFF",
                    display: false
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            fontColor: "rgba(255,255,255,0.4)",
                            fontStyle: "bold",
                            beginAtZero: true,
                            maxTicksLimit: 5,
                            padding: 10
                        },
                        gridLines: {
                            drawTicks: true,
                            drawBorder: false,
                            display: true,
                            color: "rgba(255,255,255,0.1)",
                            zeroLineColor: "transparent"
                        }

                    }],
                    xAxes: [{
                        gridLines: {
                            zeroLineColor: "transparent",
                            display: false,

                        },
                        ticks: {
                            padding: 10,
                            fontColor: "rgba(255,255,255,0.4)",
                            fontStyle: "bold"
                        }
                    }]
                }
            }
        });
    },
};

'use strict';
app.controller('AppSettingsController', 
    ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', '$timeout', '$location', 
'AuthService','CommonService', 'AppSettingsServices',
    function ($scope, $rootScope, ngAppSettings, $routeParams, $timeout, $location, authService, commonService, appSettingsServices) {

        $scope.appSettings = null;
        $scope.errors = [];
        $scope.statuses = ngAppSettings.contentStatuses;
        $scope.getAppSettings = async function (id) {
            $rootScope.isBusy = true;
            var resp = await appSettingsServices.getAppSettings();
            if (resp && resp.isSucceed) {
                $scope.appSettings = resp.data;
                $rootScope.initEditor();
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };
        $scope.loadAppSettings = async function () {
            $rootScope.isBusy = true;

            var id = $routeParams.id;
            var response = await appSettingsServices.getAppSettings();
            if (response.isSucceed) {
                $scope.appSettings = response.data;
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                $rootScope.showErrors(response.errors);
                $rootScope.isBusy = false;
                $scope.$apply();
            }

            var result = await commonService.getSettings();
            if (result.isSucceed) {
                $scope.settings = result.data;
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                $rootScope.isBusy = false;
            }
        };

        $scope.saveAppSettings = async function (appSettings) {
            $rootScope.isBusy = true;
            var resp = await appSettingsServices.saveAppSettings(appSettings);
            if (resp && resp.isSucceed) {
                $scope.appSettings = resp.data;
                $rootScope.showMessage('success', 'success');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $scope.$apply();
            }
        };

    }]);

'use strict';
app.factory('AppSettingsServices', ['$http', '$rootScope', 'CommonService', function ($http, $rootScope, commonService) {

    //var serviceBase = 'http://ngauthenticationapi.azurewebsites.net/';

    var appSettingssServiceFactory = {};

    var settings = $rootScope.globalSettings;

    var _getAppSettings = async function () {
        var url = '/portal/app-settings/details';
        
        var req = {
            method: 'GET',
            url: url
        };
        return await commonService.getApiResult(req);
    };

    var _saveAppSettings = async function (appSettings) {
        var apiUrl = '/portal/app-settings/save';
        var req = {
            method: 'POST',
            url: apiUrl,
            data: JSON.stringify(appSettings)
        };
        return await commonService.getApiResult(req);
    };

    appSettingssServiceFactory.getAppSettings = _getAppSettings;
    appSettingssServiceFactory.saveAppSettings = _saveAppSettings;
    return appSettingssServiceFactory;

}]);

'use strict';
app.controller('ArticleController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', 'ArticleService',
    function ($scope, $rootScope, ngAppSettings, $routeParams, service) {
        BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);
        $scope.preview = function (item) {
            $rootScope.preview('article', item, item.title, 'modal-lg');
        };
    }]);

'use strict';
app.factory('ArticleService', ['BaseService',
    function (baseService) {
        baseService.init('article');
        var serviceFactory = baseService;
        // Define more service methods here
    return serviceFactory;
}]);

'use strict';
app.controller('ConfigurationController',
    ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', '$location', 'ConfigurationService', 'CommonService',
        function ($scope, $rootScope, ngAppSettings, $routeParams, $location, service, commonService) {
            BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);
            $scope.cates = ['Site', 'System'];
            $scope.dataTypes = ngAppSettings.dataTypes;
            $scope.saveCallback = function () {
                commonService.initAllSettings().then(function () {
                    $location.path('/portal/configuration/list');
                });
            }
            $scope.removeCallback = function () {
                commonService.initAllSettings().then(function () {
                    $location.path('/portal/configuration/list');
                });
            }
        }]);

'use strict';
app.factory('ConfigurationService', ['BaseService','CommonService', function (baseService, commonService) {

    var serviceFactory = Object.create(baseService);
    serviceFactory.init('configuration');

    var _uploadConfiguration = async function (configurationFile) {
        //var container = $(this).parents('.model-configuration').first().find('.custom-file').first();
        if (configurationFile.file !== undefined && configurationFile.file !== null) {
            // Create FormData object
            var files = new FormData();

            // Looping over all files and add it to FormData object
            files.append(configurationFile.file.name, configurationFile.file);

            // Adding one more key to FormData object
            files.append('fileFolder', configurationFile.folder); files.append('title', configurationFile.title);
            files.append('description', configurationFile.description);

            var req = {
                url: this.prefixUrl + '/upload',
                type: "POST",
                headers: {
                },
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: files,
            };

            return await commonService.getApiResult(req)
        }
    };
    serviceFactory.uploadConfiguration = _uploadConfiguration;
    return serviceFactory;

}]);

'use strict';
app.controller('CultureController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', 'CultureService', 'CommonService',
    function ($scope, $rootScope, ngAppSettings, $routeParams, service, commonService) {
        $scope.cultures = [

            { specificulture: 'en-us', fullName: 'United States - English (Default)', icon: 'flag-icon-us' },
            { specificulture: 'fr-dz', fullName: 'Algeria - Français', icon: 'flag-icon-dz' },
            { specificulture: 'es-ar', fullName: 'Argentina - Español', icon: 'flag-icon-ar' },
            { specificulture: 'en-au', fullName: 'Australia - English', icon: 'flag-icon-au' },
            { specificulture: 'nl-be', fullName: 'België - Nederlands', icon: 'flag-icon-be' },
            { specificulture: 'fr-be', fullName: 'Belgique - Français', icon: 'flag-icon-be' },
            { specificulture: 'es-bo', fullName: 'Bolivia - Español', icon: 'flag-icon-bo' },
            { specificulture: 'bs-ba', fullName: 'Bosna i Hercegovina – Bosanski', icon: 'flag-icon-ba' },
            { specificulture: 'pt-br', fullName: 'Brasil - Português', icon: 'flag-icon-br' },
            { specificulture: 'en-ca', fullName: 'Canada - English', icon: 'flag-icon-ca' },
            { specificulture: 'fr-ca', fullName: 'Canada - Français', icon: 'flag-icon-ca' },
            { specificulture: 'cs-cz', fullName: 'Česká Republika - Čeština', icon: 'flag-icon-cz' },
            { specificulture: 'es-cl', fullName: 'Chile - Español', icon: 'flag-icon-cl' },
            { specificulture: 'es-co', fullName: 'Colombia - Español', icon: 'flag-icon-co' },
            { specificulture: 'es-cr', fullName: 'Costa Rica - Español', icon: 'flag-icon-cr' },
            { specificulture: 'sr-latn-me', fullName: 'Crna Gora - Srpski', icon: 'flag-icon-me' },
            { specificulture: 'en-cy', fullName: 'Cyprus - English', icon: 'flag-icon-cy' },
            { specificulture: 'da-dk', fullName: 'Danmark - Dansk', icon: 'flag-icon-dk' },
            { specificulture: 'de-de', fullName: 'Deutschland - Deutsch', icon: 'flag-icon-de' },
            { specificulture: 'es-ec', fullName: 'Ecuador - Español', icon: 'flag-icon-ec' },
            { specificulture: 'et-ee', fullName: 'Eesti - Eesti', icon: 'flag-icon-ee' },
            { specificulture: 'en-eg', fullName: 'Egypt - English', icon: 'flag-icon-eg' },
            { specificulture: 'es-sv', fullName: 'El Salvador - Español', icon: 'flag-icon-sv' },
            { specificulture: 'es-es', fullName: 'España - Español', icon: 'flag-icon-es' },
            { specificulture: 'fr-fr', fullName: 'France - Français', icon: 'flag-icon-fr' },
            { specificulture: 'es-gt', fullName: 'Guatemala - Español', icon: 'flag-icon-gt' },
            { specificulture: 'en-gulf', fullName: 'Gulf - English', icon: 'flag-icon-lf' },
            { specificulture: 'es-hn', fullName: 'Honduras - Español', icon: 'flag-icon-hn' },
            { specificulture: 'en-hk', fullName: 'Hong Kong SAR - English', icon: 'flag-icon-hk' },
            { specificulture: 'hr-hr', fullName: 'Hrvatska - Hrvatski', icon: 'flag-icon-hr' },
            { specificulture: 'en-in', fullName: 'India - English', icon: 'flag-icon-in' },
            { specificulture: 'id-id', fullName: 'Indonesia - Bahasa Indonesia', icon: 'flag-icon-id' },
            { specificulture: 'en-ie', fullName: 'Ireland - English', icon: 'flag-icon-ie' },
            { specificulture: 'is-is', fullName: 'Ísland - Íslenska', icon: 'flag-icon-is' },
            { specificulture: 'it-it', fullName: 'Italia - Italiano', icon: 'flag-icon-it' },
            { specificulture: 'en-jo', fullName: 'Jordan - English', icon: 'flag-icon-jo' },
            { specificulture: 'lv-lv', fullName: 'Latvija - Latviešu', icon: 'flag-icon-lv' },
            { specificulture: 'en-lb', fullName: 'Lebanon - English', icon: 'flag-icon-lb' },
            { specificulture: 'lt-lt', fullName: 'Lietuva - Lietuvių', icon: 'flag-icon-lt' },
            { specificulture: 'hu-hu', fullName: 'Magyarország - Magyar', icon: 'flag-icon-hu' },
            { specificulture: 'en-my', fullName: 'Malaysia - English', icon: 'flag-icon-my' },
            { specificulture: 'en-mt', fullName: 'Malta - English', icon: 'flag-icon-mt' },
            { specificulture: 'es-mx', fullName: 'México - Español', icon: 'flag-icon-mx' },
            { specificulture: 'fr-ma', fullName: 'Morocco - Français', icon: 'flag-icon-ma' },
            { specificulture: 'nl-nl', fullName: 'Nederland - Nederlands', icon: 'flag-icon-nl' },
            { specificulture: 'en-nz', fullName: 'New Zealand - English', icon: 'flag-icon-nz' },
            { specificulture: 'es-ni', fullName: 'Nicaragua - Español', icon: 'flag-icon-ni' },
            { specificulture: 'en-ng', fullName: 'Nigeria - English', icon: 'flag-icon-ng' },
            { specificulture: 'nb-no', fullName: 'Norge - Bokmål', icon: 'flag-icon-no' },
            { specificulture: 'de-at', fullName: 'Österreich - Deutsch', icon: 'flag-icon-at' },
            { specificulture: 'en-pk', fullName: 'Pakistan - English', icon: 'flag-icon-pk' },
            { specificulture: 'es-pa', fullName: 'Panamá - Español', icon: 'flag-icon-pa' },
            { specificulture: 'es-py', fullName: 'Paraguay - Español', icon: 'flag-icon-py' },
            { specificulture: 'es-pe', fullName: 'Perú - Español', icon: 'flag-icon-pe' },
            { specificulture: 'en-ph', fullName: 'Philippines - English', icon: 'flag-icon-ph' },
            { specificulture: 'pl-pl', fullName: 'Polska - Polski', icon: 'flag-icon-pl' },
            { specificulture: 'pt-pt', fullName: 'Portugal - Português', icon: 'flag-icon-pt' },
            { specificulture: 'es-pr', fullName: 'Puerto Rico - Español', icon: 'flag-icon-pr' },
            { specificulture: 'es-do', fullName: 'República Dominicana - Español', icon: 'flag-icon-do' },
            { specificulture: 'ro-md', fullName: 'Republica Moldova - Română', icon: 'flag-icon-md' },
            { specificulture: 'ro-ro', fullName: 'România - Română', icon: 'flag-icon-ro' },
            { specificulture: 'en-sa', fullName: 'Saudi Arabia - English', icon: 'flag-icon-sa' },
            { specificulture: 'de-ch', fullName: 'Schweiz - Deutsch', icon: 'flag-icon-ch' },
            { specificulture: 'en-sg', fullName: 'Singapore - English', icon: 'flag-icon-sg' },
            { specificulture: 'sl-si', fullName: 'Slovenija - Slovenščina', icon: 'flag-icon-si' },
            { specificulture: 'sk-sk', fullName: 'Slovensko - Slovenčina', icon: 'flag-icon-sk' },
            { specificulture: 'en-za', fullName: 'South Africa - English', icon: 'flag-icon-za' },
            { specificulture: 'sr-latn-rs', fullName: 'Srbija - Srpski', icon: 'flag-icon-rs' },
            { specificulture: 'en-lk', fullName: 'Sri Lanka - English', icon: 'flag-icon-lk' },
            { specificulture: 'fr-ch', fullName: 'Suisse - Français', icon: 'flag-icon-ch' },
            { specificulture: 'fi-fi', fullName: 'Suomi - Suomi', icon: 'flag-icon-fi' },
            { specificulture: 'sv-se', fullName: 'Sverige - Svenska', icon: 'flag-icon-se' },
            { specificulture: 'fr-tn', fullName: 'Tunisia - Français', icon: 'flag-icon-tn' },
            { specificulture: 'tr-tr', fullName: 'Türkiye - Türkçe', icon: 'flag-icon-tr' },
            { specificulture: 'en-gb', fullName: 'United Kingdom - English', icon: 'flag-icon-gb' },
            { specificulture: 'en-us', fullName: 'United States - English', icon: 'flag-icon-us' },
            { specificulture: 'es-uy', fullName: 'Uruguay - Español', icon: 'flag-icon-uy' },
            { specificulture: 'es-ve', fullName: 'Venezuela - Español', icon: 'flag-icon-ve' },
            { specificulture: 'vi-vn', fullName: 'Việt Nam - Tiếng việt', icon: 'flag-icon-vn' },
            { specificulture: 'el-gr', fullName: 'Ελλάδα - Ελληνικά', icon: 'flag-icon-gr' },
            { specificulture: 'ru-by', fullName: 'Беларусь - Беларуская', icon: 'flag-icon-by' },
            { specificulture: 'bg-bg', fullName: 'България - Български', icon: 'flag-icon-bg' },
            { specificulture: 'ru-kz', fullName: 'Казахстан - Русский', icon: 'flag-icon-kz' },
            { specificulture: 'ru-ru', fullName: 'Россия - Русский', icon: 'flag-icon-ru' },
            { specificulture: 'uk-ua', fullName: 'Україна - Українська', icon: 'flag-icon-ua' },
            { specificulture: 'he-il', fullName: 'ישראל - עברית', icon: 'flag-icon-il' },
            { specificulture: 'ar-iq', fullName: 'العراق - العربية', icon: 'flag-icon-iq' },
            { specificulture: 'ar-sa', fullName: 'المملكة العربية السعودية - العربية', icon: 'flag-icon-sa' },
            { specificulture: 'ar-ly', fullName: 'ليبيا - العربية', icon: 'flag-icon-ly' },
            { specificulture: 'ar-eg', fullName: 'مصر - العربية', icon: 'flag-icon-eg' },
            { specificulture: 'ar-gulf', fullName: 'دول الخليج - العربية', icon: 'flag-icon-lf' },
            { specificulture: 'th-th', fullName: 'ไทย - ไทย', icon: 'flag-icon-th' },
            { specificulture: 'ko-kr', fullName: '대한민국 - 한국어', icon: 'flag-icon-kr' },
            { specificulture: 'zh-cn', fullName: '中国 - 简体中文', icon: 'flag-icon-cn' },
            { specificulture: 'zh-tw', fullName: '台灣 - 繁體中文', icon: 'flag-icon-tw' },
            { specificulture: 'ja-jp', fullName: '日本 - 日本語', icon: 'flag-icon-jp' },
            { specificulture: 'zh-hk', fullName: '香港特別行政區 - 繁體中文', icon: 'flag-icon-hk' }

        ];
        $scope.selected = null;
        BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);
        $scope.saveCallback = function () {
            commonService.initAllSettings();
            window.location.href = '/portal/culture/list';
        }
        $scope.removeCallback = function () {
            commonService.initAllSettings();
            window.location.href = '/portal/culture/list';
        }
        $scope.changeData = function (selected) {
            if (selected) {
                $scope.activedData.specificulture = selected.specificulture;
                $scope.activedData.fullName = selected.fullName;
                $scope.activedData.icon = selected.icon;
            }
        }
    }]);

'use strict';
app.factory('CultureService', ['BaseService', function (baseService) {

    var serviceFactory = Object.create(baseService);
    serviceFactory.init('culture');
    var _updateInfos = async function (pages) {

        var req = {
            method: 'POST',
            url: this.prefixUrl + '/update-infos',
            data: JSON.stringify(pages)
        };
        return await commonService.getApiResult(req);
    };

    var _syncTemplates = async function (id) {
        var apiUrl = '/culture/';
        var url = apiUrl + 'sync/' + id;        
        var req = {
            method: 'GET',
            url: url
        };
        return await commonService.getApiResult(req)
    };

    serviceFactory.syncTemplates = _syncTemplates;
    serviceFactory.updateInfos = _updateInfos;
    return serviceFactory;

}]);

'use strict';
app.controller('CustomerController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', '$timeout', '$location', 'CustomerServices',
    function ($scope, $rootScope, ngAppSettings, $routeParams, $timeout, $location, customerServices) {
        $scope.request = angular.copy(ngAppSettings.request);
        $scope.request.contentStatuses = [
            'Active'
        ];
        $scope.request.status = '0';
        $scope.activedCustomer = null;
        $scope.relatedCustomers = [];
        $rootScope.isBusy = false;
        $scope.data = {
            pageIndex: 0,
            pageSize: 1,
            totalItems: 0,
        };
        $scope.errors = [];
        
        $scope.range = function (max) {
            var input = [];
            for (var i = 1; i <= max; i += 1) input.push(i);
            return input;
        };
        
        $scope.loadCustomer = async function () {
            $rootScope.isBusy = true;
            var id = $routeParams.id;
            var response = await customerServices.getCustomer(id, 'portal');
            if (response.isSucceed) {
                $scope.activedCustomer = response.data;
                $rootScope.initEditor();
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                $rootScope.showErrors(response.errors);
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };
        $scope.loadCustomers = async function (pageIndex) {
            
            if (pageIndex !== undefined) {
                $scope.request.pageIndex = pageIndex;
            }
            if ($scope.request.fromDate !== null) {
                var d = new Date($scope.request.fromDate);
                $scope.request.fromDate = d.toISOString();
            }
            if ($scope.request.toDate !== null) {
                var d = new Date($scope.request.toDate);
                $scope.request.toDate = d.toISOString();
            }
            var resp = await customerServices.getCustomers($scope.request);
            if (resp && resp.isSucceed) {

                ($scope.data = resp.data);
                //$("html, body").animate({ "scrollTop": "0px" }, 500);
                $.each($scope.data.items, function (i, customer) {

                    $.each($scope.activedCustomers, function (i, e) {
                        if (e.customerId === customer.id) {
                            customer.isHidden = true;
                        }
                    })
                })
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $scope.$apply();
            }
        };

        $scope.removeCustomer = function (id) {
            $rootScope.showConfirm($scope, 'removeCustomerConfirmed', [id], null, 'Remove Customer', 'Are you sure');
        }

        $scope.removeCustomerConfirmed = async function (id) {
            var result = await customerServices.removeCustomer(id);
            if (result.isSucceed) {
                $rootScope.showMessage('success', 'success');
                $scope.loadCustomers();
            }
            else {
                $rootScope.showMessage('failed');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        }


        $scope.saveCustomer = async function (customer) {
            customer.content = $('.editor-content').val();
            var resp = await customerServices.saveCustomer(customer);
            if (resp && resp.isSucceed) {
                $scope.activedCustomer = resp.data;
                $rootScope.showMessage('Thành công', 'success');
                $rootScope.isBusy = false;
                $scope.$apply();
                //$location.path('/portal/customer/details/' + resp.data.id);
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $scope.$apply();
            }
        };

    }]);

'use strict';
app.factory('CustomerServices', ['$http', '$rootScope', 'CommonService', function ($http, $rootScope, commonService) {

    //var serviceBase = 'http://ngauthenticationapi.azurewebsites.net/';

    var customersServiceFactory = {};

    var settings = $rootScope.globalSettings

    var _getCustomer = async function (id, type) {
        var apiUrl = '/queen-beauty/customer/';
        var url = apiUrl + 'details/' + type;
        if (id) {
            url += '/' + id;
        }
        var req = {
            method: 'GET',
            url: url
        };
        return await commonService.getApiResult(req)
    };

    var _initCustomer = async function (type) {
        var apiUrl = '/queen-beauty/customer/';
        var req = {
            method: 'GET',
            url: apiUrl + 'init/' + type,
        };
        return await commonService.getApiResult(req)
    };

    var _getCustomers = async function (request) {
        var apiUrl = '/queen-beauty/customer/';
        var req = {
            method: 'POST',
            url: apiUrl + 'list',
            data: JSON.stringify(request)
        };
        
        return await commonService.getApiResult(req);
    };

    var _removeCustomer = async function (id) {
        var apiUrl = '/queen-beauty/customer/';
        var req = {
            method: 'GET',
            url: apiUrl + 'delete/' + id
        };
        return await commonService.getApiResult(req)
    };

    var _saveCustomer = async function (customer) {
        var apiUrl = '/queen-beauty/customer/';
        var req = {
            method: 'POST',
            url: apiUrl + 'save',
            data: JSON.stringify(customer)
        };
        return await commonService.getApiResult(req)
    };

    customersServiceFactory.getCustomer = _getCustomer;
    customersServiceFactory.initCustomer = _initCustomer;
    customersServiceFactory.getCustomers = _getCustomers;
    customersServiceFactory.removeCustomer = _removeCustomer;
    customersServiceFactory.saveCustomer = _saveCustomer;
    return customersServiceFactory;

}]);

'use strict';
app.controller('DashboardController', ['$scope', '$rootScope', 'ngAppSettings', '$timeout', '$location', 'DashboardServices', function ($scope, $rootScope, ngAppSettings, $timeout, $location, dashboardServices) {
    $scope.pageClass = 'page-dashboard';
    $('.side-nav li').removeClass('active');
    $('.side-nav .page-dashboard').addClass('active');
    $scope.data = {
        totalPage: 0,
        totalArticle: 0,
        totalProduct: 0,
        totalUser: 0
    }
    $scope.users = [];
    $scope.$on('$viewContentLoaded', function () {
        $rootScope.isBusy = false;

    });
    $scope.getDashboardInfo = async function () {
        $rootScope.isBusy = true;
        var response = await dashboardServices.getDashboardInfo();
        if (response.isSucceed) {
            $scope.data = response.data;
            $rootScope.isBusy = false;
            $scope.$apply();
        }
        else {
            $rootScope.showErrors(response.errors);
            $rootScope.isBusy = false;
            $scope.$apply();
        }
    }
}]);

'use strict';
app.factory('DashboardServices', ['$http', 'CommonService', function ($http, commonService) {

    //var serviceBase = 'http://ngauthenticationapi.azurewebsites.net/';

    var usersServiceFactory = {};
    var apiUrl = '/portal/';
    var _getDashboardInfo = async function () {
        var req = {
            method: 'GET',
            url: apiUrl + 'dashboard'
        };

        return await commonService.getApiResult(req);
    };

    usersServiceFactory.getDashboardInfo = _getDashboardInfo;
    return usersServiceFactory;

}]);

'use strict';
app.controller('FileController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', '$timeout', '$location', 'AuthService', 'FileServices',
    function ($scope, $rootScope, ngAppSettings, $routeParams, $timeout, $location, authService, fileServices) {
        $scope.request = {
            pageSize: '10',
            pageIndex: 0,
            status: '2',
            orderBy: 'CreatedDateTime',
            direction: '1',
            fromDate: null,
            toDate: null,
            keyword: '',
            key: ''
        };

        $scope.activedFile = null;
        $scope.relatedFiles = [];
        $rootScope.isBusy = false;
        $scope.data = {
            pageIndex: 0,
            pageSize: 1,
            totalItems: 0,
        };
        $scope.errors = [];

        $scope.range = function (max) {
            var input = [];
            for (var i = 1; i <= max; i += 1) input.push(i);
            return input;
        };

        $scope.loadFile = async function () {
            $rootScope.isBusy = true;
            $scope.listUrl = '/portal/file/list?folder=' + $routeParams.folder;
            $rootScope.isBusy = true;
            var response = await fileServices.getFile($routeParams.folder, $routeParams.filename);
            if (response.isSucceed) {
                $scope.activedFile = response.data;                
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                $rootScope.showErrors(response.errors);
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };
        $scope.loadFiles = async function (folder) {
            if (folder) {
                $scope.request.key += ($scope.request.key !== '') ? '/' : '';
                $scope.request.key += folder;
            } else {
                $scope.request.key = $routeParams.folder ? $routeParams.folder : '';
            }
            $rootScope.isBusy = true;
            var resp = await fileServices.getFiles($scope.request);
            if (resp && resp.isSucceed) {

                ($scope.data = resp.data);
                $.each($scope.data.items, function (i, file) {

                    $.each($scope.activedFiles, function (i, e) {
                        if (e.fileId === file.id) {
                            file.isHidden = true;
                        }
                    })
                })
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.removeFile = async function (id) {
            if (confirm("Are you sure!")) {
                $rootScope.isBusy = true;
                var resp = await fileServices.removeFile(id);
                if (resp && resp.isSucceed) {
                    $scope.loadFiles();
                }
                else {
                    if (resp) { $rootScope.showErrors(resp.errors); }
                    $rootScope.isBusy = false;
                    $scope.$apply();
                }
            }
        };

        $scope.saveFile = async function (file) {            
            $rootScope.isBusy = true;
            var resp = await fileServices.saveFile(file);
            if (resp && resp.isSucceed) {
                $scope.activedFile = resp.data;
                $rootScope.showMessage('Thành công', 'success');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

    }]);

'use strict';
app.factory('FileServices', ['$http', '$rootScope', 'CommonService', function ($http, $rootScope, commonService) {

    //var serviceBase = 'http://ngauthenticationapi.azurewebsites.net/';

    var filesServiceFactory = {};

    var settings = $rootScope.globalSettings

    var _getFile = async function (folder, filename) {
        var apiUrl = '/file/';
        var url = apiUrl + 'details?folder=' + folder + '&filename=' + filename;        
        var req = {
            method: 'GET',
            url: url
        };
        return await commonService.getApiResult(req)
    };

    var _initFile = async function (type) {
        var apiUrl = '/file/';
        var req = {
            method: 'GET',
            url: apiUrl + 'init/' + type,
        };
        return await commonService.getApiResult(req)
    };

    var _getFiles = async function (request) {
        var apiUrl = '/file/';
        var req = {
            method: 'POST',
            url: apiUrl + 'list',
            data: JSON.stringify(request)
        };
        
        return await commonService.getApiResult(req);
    };

    var _removeFile = async function (id) {
        var apiUrl = '/file/';
        var req = {
            method: 'GET',
            url: apiUrl + 'delete/' + id
        };
        return await commonService.getApiResult(req)
    };

    var _saveFile = async function (file) {
        var apiUrl = '/file/';
        var req = {
            method: 'POST',
            url: apiUrl + 'save',
            data: JSON.stringify(file)
        };
        return await commonService.getApiResult(req)
    };

    filesServiceFactory.getFile = _getFile;
    filesServiceFactory.initFile = _initFile;
    filesServiceFactory.getFiles = _getFiles;
    filesServiceFactory.removeFile = _removeFile;
    filesServiceFactory.saveFile = _saveFile;
    return filesServiceFactory;

}]);

'use strict';
app.controller('LanguageController',
    ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', '$location', 'LanguageService', 'CommonService',
        function ($scope, $rootScope, ngAppSettings, $routeParams, $location, service, commonService) {
            BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);
            $scope.languageFile = {
                file: null,
                fullPath: '',
                folder: 'Language',
                title: '',
                description: ''
            };
            $scope.cates = [
                {
                    title: 'Common',
                    prefix: ''
                },
                {
                    title: 'Portal',
                    prefix: 'portal_'
                },
                {
                    title: 'Frontend',
                    prefix: 'fe_'
                }
            ];
            $scope.cate = $scope.cates[0];
            $scope.dataTypes = ngAppSettings.editorConfigurations.dataTypes;
            
            $scope.saveCallback = function () {
                commonService.initAllSettings().then(function () {
                    $location.path('/portal/language/list');
                });
            }
            $scope.removeCallback = function () {
                commonService.initAllSettings().then(function () {
                    $location.path('/portal/language/list');
                });
            }
            $scope.generateDefault = function (text, cate) {
                if (!$routeParams.id) {
                    $scope.activedData.defaultValue = text;
                    $scope.activedData.keyword = cate.prefix + text.replace(/[^a-zA-Z0-9]+/g, '_')
                        .replace(/([A-Z]+)([A-Z][a-z])/g, '$1-$2')
                        .replace(/([a-z])([A-Z])/g, '$1-$2')
                        .replace(/([0-9])([^0-9])/g, '$1-$2')
                        .replace(/([^0-9])([0-9])/g, '$1-$2')
                        .replace(/-+/g, '_')
                        .toLowerCase();
                }
            };
    
        }]);

'use strict';
app.factory('LanguageService', ['BaseService','CommonService', function (baseService, commonService) {

    var serviceFactory = Object.create(baseService);
    serviceFactory.init('language');

    var _uploadLanguage = async function (languageFile) {
        //var container = $(this).parents('.model-language').first().find('.custom-file').first();
        if (languageFile.file !== undefined && languageFile.file !== null) {
            // Create FormData object
            var files = new FormData();

            // Looping over all files and add it to FormData object
            files.append(languageFile.file.name, languageFile.file);

            // Adding one more key to FormData object
            files.append('fileFolder', languageFile.folder); files.append('title', languageFile.title);
            files.append('description', languageFile.description);

            var req = {
                url: this.prefixUrl + '/upload',
                type: "POST",
                headers: {
                },
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: files,
            };

            return await commonService.getApiResult(req)
        }
    };
    serviceFactory.uploadLanguage = _uploadLanguage;
    return serviceFactory;

}]);

'use strict';
app.controller('ImportFileController',
    ['$scope', '$rootScope', 'ImportFileServices', 'TranslatorService', 'GlobalSettingsService', 
        function ($scope, $rootScope, importFileServices, translatorService, GlobalSettingsService) {

            $scope.importFile = {
                title: '',
                description: '',
                postedFile: {
                    file: null,
                    fullPath: '',
                    folderName: 'Import',
                    fileFolder: 'Import',
                    fileName: '',
                    extension: '',
                    content: '',
                    fileStream: ''
                }
            };
            $scope.importType = 'Language';
            $scope.types = [
                'Language',
                'Configuration'
            ];
            $scope.errors = [];
            $scope.saveImportFile = async function (importFile, importType) {
                $rootScope.isBusy = true;
                var resp = await importFileServices.saveImportFile(importFile.postedFile, importType);
                if (resp && resp.isSucceed) {
                    $scope.activedImportFile = resp.data;
                    $rootScope.showMessage('Success', 'success');
                    switch (importType) {
                        case 'Language':
                            translatorService.reset($rootScope.globalSettings.lang).then(function () {
                                window.location.href = '/portal/language/list';
                            });
                            return false;
                        case 'Configuration':
                            GlobalSettingsService.reset($rootScope.globalSettings.lang).then(function () {
                                window.location.href = '/portal/configuration/list';
                            });
                            return false;
                    }


                }
                else {
                    if (resp) { $rootScope.showErrors(resp.errors); }
                    $rootScope.isBusy = false;
                    $scope.$apply();
                }
            };
        }]);

'use strict';
app.factory('ImportFileServices', ['$http', '$rootScope', 'CommonService', function ($http, $rootScope, commonService) {

    //var serviceBase = 'http://ngauthenticationapi.azurewebsites.net/';

    var importFilesServiceFactory = {};

    var settings = $rootScope.globalSettings;

    var _saveImportFile = async function (importFile, type) {
        var apiUrl = '/portal/' + settings.lang + '/import/' + type;
        var req = {
            method: 'POST',
            url: apiUrl,
            data: JSON.stringify(importFile)
        };
        return await commonService.getApiResult(req);
    };

    importFilesServiceFactory.saveImportFile = _saveImportFile;
    return importFilesServiceFactory;

}]);

'use strict';
app.controller('loginController', [ '$rootScope', '$scope', 'ngAppSettings', '$location', 'AuthService', 'ngAppSettings', function ($rootScope, $scope, ngAppSettings, $location, authService, ngAuthSettings) {
    if (authService.authentication && authService.authentication.isAuth && authService.authentication.isAdmin) {
        authService.referredUrl = $location.path();
        $location.path('/portal');
    }

    $scope.pageClass = 'page-login';

    $scope.loginData = {
        username: "",
        password: "",
        rememberme: false
    };

    $scope.message = "";
    $scope.$on('$viewContentLoaded', function () {
        $rootScope.isBusy = false;
    });
    $scope.login = async function () {
        
        if (authService.referredUrl === "/init/login") {
            authService.referredUrl = "/portal";
        }
        $rootScope.isBusy = true;
        var result = await authService.login($scope.loginData);
        if (result) {
            $rootScope.isBusy = false;
            $scope.$apply();
        }
    };

$scope.authExternalProvider = function (provider) {

    var redirectUri = location.protocol + '//' + location.host + '/authcomplete.html';

    var externalProviderUrl = ngAuthSettings.apiServiceBaseUri + "api/Account/ExternalLogin?provider=" + provider
        + "&response_type=token&client_id=" + ngAuthSettings.clientId
        + "&redirect_uri=" + redirectUri;
    window.$windowScope = $scope;

    var oauthWindow = window.open(externalProviderUrl, "Authenticate Account", "location=0,status=0,width=600,height=750");
};

$scope.authCompletedCB = function (fragment) {

    $scope.$apply(function () {

        if (fragment.haslocalaccount === 'False') {

            authService.logOut();

            authService.externalAuthData = {
                provider: fragment.provider,
                userName: fragment.external_user_name,
                externalAccessToken: fragment.external_access_token
            };

            $location.path('/associate');

        }
        else {
            //Obtain access token and redirect to orders
            var externalData = { provider: fragment.provider, externalAccessToken: fragment.external_access_token };
            authService.obtainAccessToken(externalData).then(function (response) {

                $location.path('/orders');

            },
                function (err) {
                    $scope.message = err.error_description;
                });
        }

    });
}
}]);
'use strict';
app.controller('ModuleController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', 
    'ModuleService', 'ModuleDataService',
    function ($scope, $rootScope, ngAppSettings, $routeParams, moduleServices, moduleDataService) {
        BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, moduleServices, 'product');
        $scope.defaultAttr = {
            name: '',
            options: [],
            priority: 0,
            dataType: 0,
            isGroupBy: false,
            isSelect: false,
            isDisplay: true,
            width: 3
        };
        $scope.dataTypes = ngAppSettings.dataTypes;
        $scope.activedData = null;

        $scope.loadModuleDatas = async function () {
            $rootScope.isBusy = true;
            var id = $routeParams.id;
            var response = await moduleServices.getSingle([id, 'portal']);
            if (response.isSucceed) {
                $scope.activedData = response.data;
                $rootScope.initEditor();
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                $rootScope.showErrors(response.errors);
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.loadMoreModuleDatas = async function (pageIndex) {
            $scope.request.key = $scope.activedData.id;
            if (pageIndex !== undefined) {
                $scope.request.pageIndex = pageIndex;
            }
            if ($scope.request.fromDate !== null) {
                var d = new Date($scope.request.fromDate);
                $scope.request.fromDate = d.toISOString();
            }
            if ($scope.request.toDate !== null) {
                var d = new Date($scope.request.toDate);
                $scope.request.toDate = d.toISOString();
            }
            $rootScope.isBusy = true;
            var resp = await moduleDataService.getModuleDatas($scope.request);
            if (resp && resp.isSucceed) {

                $scope.activedData.data = resp.data;
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };
        $scope.addAttr = function () {
            if ($scope.activedData) {
                var t = angular.copy($scope.defaultAttr);
                $scope.activedData.columns.push(t);
            }
        };

        $scope.addOption = function (col, index) {
            var val = angular.element('#option_' + index).val();
            col.options.push(val);
            angular.element('#option_' + index).val('');
        };

        $scope.generateName = function(col){
            col.name =  $rootScope.generateKeyword(col.title, '_');
        }
        $scope.removeAttr = function (index) {
            if ($scope.activedData) {

                $scope.activedData.columns.splice(index, 1);
            }
        }

        $scope.removeData = function (id) {
            if ($scope.activedData) {
                $rootScope.showConfirm($scope, 'removeDataConfirmed', [id], null, 'Remove Data', 'Are you sure');
            }
        }

        $scope.removeDataConfirmed = async function (id) {
            $rootScope.isBusy = true;
            var result = await moduleDataService.removeModuleData(id);
            if (result.isSucceed) {
                $scope.loadModuleDatas();
            }
            else {
                $rootScope.showMessage('failed');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        }
        $scope.updateModuleDataField = async function (item, propertyName){
            var result = await moduleDataService.saveFields(item.id, propertyName, item[propertyName]);
            if (result.isSucceed) {
                $scope.loadModuleDatas();
            }
            else {
                $rootScope.showMessage('failed');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        }
    }]);

'use strict';
app.factory('ModuleService', ['BaseService',
    function (baseService) {        
        var serviceFactory = Object.create(baseService);;
        serviceFactory.init('module')
        // Define more service methods here
        return serviceFactory;
    }]);

'use strict';
app.controller('OrderController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', '$timeout', '$location', 'AuthService', 'OrderServices', 'ngAppSettings',
    function ($scope, $rootScope, ngAppSettings, $routeParams, $timeout, $location, authService, orderServices) {
        $scope.request = angular.copy(ngAppSettings.request);
        $scope.request.contentStatuses = [
            'Waiting',
            'Serving',
            'Rated',
            'Finished'
        ];
        $scope.request.status = '2';
        $scope.activedOrder = null;
        $scope.relatedOrders = [];
        $rootScope.isBusy = false;
        $scope.data = {
            pageIndex: 0,
            pageSize: 1,
            totalItems: 0,
            items: []
        };
        $scope.errors = [];

        $scope.range = function (max) {
            var input = [];
            for (var i = 1; i <= max; i += 1) input.push(i);
            return input;
        }

        $scope.loadOrder = async function () {
            $rootScope.isBusy = true;
            var id = $routeParams.id;
            var response = await orderServices.getOrder(id, 'portal');
            if (response.isSucceed) {
                $scope.activedOrder = response.data;
                $rootScope.initEditor();
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                $rootScope.showErrors(response.errors);
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };
        $scope.loadOrders = async function (pageIndex) {
            if (pageIndex !== undefined) {
                $scope.request.pageIndex = pageIndex;
            }
            if ($scope.request.fromDate !== null) {
                var d = new Date($scope.request.fromDate);
                $scope.request.fromDate = d.toISOString();
            }
            if ($scope.request.toDate !== null) {
                var d = new Date($scope.request.toDate);
                $scope.request.toDate = d.toISOString();
            }
            $rootScope.isBusy = true;
            var resp = await orderServices.getOrders($scope.request);
            if (resp && resp.isSucceed) {

                ($scope.data = resp.data);
                //$("html, body").animate({ "scrollTop": "0px" }, 500);
                $.each($scope.data.items, function (i, order) {

                    $.each($scope.activedOrders, function (i, e) {
                        if (e.orderId === order.id) {
                            order.isHidden = true;
                        }
                    })
                })
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.removeOrder = function (id) {
            $rootScope.showConfirm($scope, 'removeOrderConfirmed', [id], null, 'Remove Order', 'Are you sure');
        };

        $scope.removeOrderConfirmed = async function (id) {
            $rootScope.isBusy = true;
            var result = await orderServices.removeOrder(id);
            if (result.isSucceed) {
                $scope.loadOrders();
            }
            else {
                $rootScope.showMessage('failed');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.saveOrder = async function (order) {
            order.content = $('.editor-content.content').val();
            order.excerpt = $('.editor-content.excerpt').val();
            $rootScope.isBusy = true;
            var resp = await orderServices.saveOrder(order);
            if (resp && resp.isSucceed) {
                $scope.activedOrder = resp.data;
                $rootScope.showMessage('Thành công', 'success');
                $rootScope.isBusy = false;
                $scope.$apply();
                //$location.path('/portal/order/details/' + resp.data.id);
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.preview = function (item) {
            $rootScope.preview('order', item, item.title, 'modal-lg');
        };
    }]);

'use strict';
app.factory('OrderServices', ['$http', '$rootScope', 'CommonService', function ($http, $rootScope, commonService) {

    //var serviceBase = 'http://ngauthenticationapi.azurewebsites.net/';

    var ordersServiceFactory = {};

    var settings = $rootScope.globalSettings

    var _getOrder = async function (id, type) {
        var apiUrl = '/' + settings.lang + '/order/';
        var url = apiUrl + 'details/' + type;
        if (id) {
            url += '/' + id;
        }
        var req = {
            method: 'GET',
            url: url
        };
        return await commonService.getApiResult(req)
    };

    var _initOrder = async function (type) {
        var apiUrl = '/' + settings.lang + '/order/';
        var req = {
            method: 'GET',
            url: apiUrl + 'init/' + type,
        };
        return await commonService.getApiResult(req)
    };

    var _getOrders = async function (request) {
        var apiUrl = '/' + settings.lang + '/order/';
        var req = {
            method: 'POST',
            url: apiUrl + 'list',
            data: JSON.stringify(request)
        };
        
        return await commonService.getApiResult(req);
    };

    var _removeOrder = async function (id) {
        var apiUrl = '/' + settings.lang + '/order/';
        var req = {
            method: 'GET',
            url: apiUrl + 'delete/' + id
        };
        return await commonService.getApiResult(req)
    };

    var _saveOrder = async function (order) {
        var apiUrl = '/' + settings.lang + '/order/';
        var req = {
            method: 'POST',
            url: apiUrl + 'save',
            data: JSON.stringify(order)
        };
        return await commonService.getApiResult(req)
    };

    ordersServiceFactory.getOrder = _getOrder;
    ordersServiceFactory.initOrder = _initOrder;
    ordersServiceFactory.getOrders = _getOrders;
    ordersServiceFactory.removeOrder = _removeOrder;
    ordersServiceFactory.saveOrder = _saveOrder;
    return ordersServiceFactory;

}]);

'use strict';
app.controller('PageController', 
            ['$scope', '$rootScope', '$routeParams', 'ngAppSettings', 'PageService',
    function ($scope, $rootScope, $routeParams, ngAppSettings, service) {
        BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);        
        $scope.request.query = 'level=0';       
        
        $scope.loadPageDatas = async function () {
            $rootScope.isBusy = true;
            var id = $routeParams.id;
            var response = await service.getSingle(id, 'portal');
            if (response.isSucceed) {
                $scope.activedData = response.data;
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                $rootScope.showErrors(response.errors);
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.updateInfos = async function (items) {
            $rootScope.isBusy = true;
            var resp = await service.updateInfos(items);
            if (resp && resp.isSucceed) {
                $scope.activedData = resp.data;
                $rootScope.showMessage('success', 'success');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

    }]);

'use strict';
app.factory('PageService', ['$rootScope', 'CommonService', 'BaseService',
    function ($rootScope, commonService, baseService) {

        var serviceFactory = Object.create(baseService);
        serviceFactory.init('page');
        var _updateInfos = async function (pages) {

            var req = {
                method: 'POST',
                url: this.prefixUrl + '/update-infos',
                data: JSON.stringify(pages)
            };
            return await commonService.getApiResult(req);
        };
        serviceFactory.updateInfos = _updateInfos;
        return serviceFactory;

    }]);

'use strict';
app.controller('PermissionController',
    ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', '$location', 'PermissionService', 'CommonService',
        function ($scope, $rootScope, ngAppSettings, $routeParams, $location, service, commonService) {
            BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);
            $scope.request.query = "level=0";
            $scope.columns = [
                {
                    title: 'Keyword',
                    name: 'textKeyword',
                    filter: true,
                    type: 0 // string - ngAppSettings.dataTypes[0]
                },
                {
                    title: 'Default',
                    name: 'textDefault',
                    filter: true,
                    type: 0// string - ngAppSettings.dataTypes[0]
                },
                {
                    title: 'Url',
                    name: 'url',
                    filter: true,
                    type: 0 // string - ngAppSettings.dataTypes[0]
                },
                {
                    title: 'Created Date',
                    name: 'createdDateTime',
                    filter: true,
                    type: 0 // string - ngAppSettings.dataTypes[0]
                },
            ];

            $scope.updateInfos = async function (items) {
                $rootScope.isBusy = true;
                var resp = await service.updateInfos(items);
                if (resp && resp.isSucceed) {
                    $scope.activedPage = resp.data;
                    $rootScope.showMessage('success', 'success');
                    $rootScope.isBusy = false;
                    $scope.$apply();
                }
                else {
                    if (resp) { $rootScope.showErrors(resp.errors); }
                    $rootScope.isBusy = false;
                    $scope.$apply();
                }
            };

            $scope.updateChildInfos = async function (items) {
                $rootScope.isBusy = true;
                var resp = await service.updateChildInfos(items);
                if (resp && resp.isSucceed) {
                    $scope.activedPage = resp.data;
                    $rootScope.showMessage('success', 'success');
                    $rootScope.isBusy = false;
                    $scope.$apply();
                }
                else {
                    if (resp) { $rootScope.showErrors(resp.errors); }
                    $rootScope.isBusy = false;
                    $scope.$apply();
                }
            };
        }]);

'use strict';
app.factory('PermissionService', ['BaseService','CommonService', function (baseService, commonService) {

    var serviceFactory = Object.create(baseService);
    serviceFactory.init('permission', true);
    var _updateInfos = async function (pages) {
        var req = {
            method: 'POST',
            url: this.prefixUrl + '/update-infos',
            data: JSON.stringify(pages)
        };
        return await commonService.getApiResult(req);
    };

    var _updateChildInfos = async function (pages) {
        var req = {
            method: 'POST',
            url: this.prefixUrl + '/update-child-infos',
            data: JSON.stringify(pages)
        };
        return await commonService.getApiResult(req);
    };

    serviceFactory.updateInfos = _updateInfos;
    serviceFactory.updateChildInfos = _updateChildInfos;
    return serviceFactory;

}]);

'use strict';
app.controller('ProductController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', 'ProductService',
    function ($scope, $rootScope, ngAppSettings, $routeParams, service) {
        BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);
        $scope.preview = function (item) {
            item.editUrl = '/portal/product/details/' + item.id;
            $rootScope.preview('product', item, item.title, 'modal-lg');
        };
    }]);

'use strict';
app.factory('ProductService', ['BaseService',
    function (baseService) {
        var serviceFactory = Object.create(baseService);
        serviceFactory.init('product');
        return serviceFactory;
    }]);

'use strict';
app.controller('QueenDashboardController', ['$scope', '$rootScope', '$timeout', '$location', 'QueenDashboardServices', function ($scope, $rootScope, $timeout, $location, dashboardServices) {
    $scope.pageClass = 'page-dashboard';
    $('.side-nav li').removeClass('active');
    $('.side-nav .page-dashboard').addClass('active');
    $scope.data = {
        totalPage: 0,
        totalArticle: 0,
        totalProduct: 0,
        totalUser: 0
    };
    $scope.users = [];
    $scope.$on('$viewContentLoaded', function () {
        $rootScope.isBusy = false;

    });
    $scope.getDashboardInfo = async function () {
        var response = await dashboardServices.getDashboardInfo();
        if (response.isSucceed) {
            var incomes = [];
            var services = [];
            angular.forEach(response.data.statitics, function (value, key) {
                incomes.push(value.totalSpent);
                services.push(value.totalService);
            });
            setTimeout(function () {
                demo.initDashboardPageCharts(incomes, services);
            }, 2000)
            $scope.data = response.data;
            $scope.$apply();
        }
        else {
            $rootScope.showErrors(response.errors);
            $scope.$apply();
        }
    }
}]);
'use strict';
app.factory('QueenDashboardServices', ['$http', 'CommonService', function ($http, commonService) {

    //var serviceBase = 'http://ngauthenticationapi.azurewebsites.net/';

    var usersServiceFactory = {};
    var apiUrl = '/en-us/queen-beauty/';
    var _getDashboardInfo = async function () {
        var req = {
            method: 'GET',
            url: apiUrl + 'dashboard'
        };

        return await commonService.getApiResult(req);
    };

    usersServiceFactory.getDashboardInfo = _getDashboardInfo;
    return usersServiceFactory;

}]);

'use strict';
app.controller('RoleController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', 'RoleService',
    function ($scope, $rootScope, ngAppSettings, $routeParams, service) {
        BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);
        $scope.role = { name: '' };
        $scope.createRole = async function () {
            $rootScope.isBusy = true;
            var result = await service.createRole($scope.role.name);
            if (result.isSucceed) {
                $scope.role.name = '';
                $scope.getList();
            }
            else {
                $rootScope.showMessage(result.errors);
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

    }]);

'use strict';
app.factory('RoleService', ['BaseService','CommonService', function (baseService, commonService) {
    var serviceFactory = Object.create(baseService);
    serviceFactory.init('role', true);

    var _getPermissions = async function () {
        var req = {
            method: 'GET',
            url: this.prefixUrl + '/permissions'
        };
        return await commonService.getApiResult(req);
    };

    var _updatePermission = async function (permission) {
        var req = {
            method: 'POST',
            url: this.prefixUrl + '/update-permission',
            data: JSON.stringify(permission)
        };
        return await commonService.getApiResult(req);
    };
    var _createRole = function (name) {
        var req = {
            method: 'POST',
            url: this.prefixUrl + '/create',
            data: JSON.stringify(name)
        };

        return commonService.getApiResult(req);
    };
    serviceFactory.createRole = _createRole;
    serviceFactory.getPermissions = _getPermissions;
    serviceFactory.updatePermission = _updatePermission;
    return serviceFactory;

}]);

'use strict';
app.controller('TemplateController', ['$scope', '$rootScope', '$routeParams', 'ngAppSettings', 'TemplateService',
    function ($scope, $rootScope, $routeParams, ngAppSettings, service) {
        BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);
        $scope.folderTypes = [
            'Masters',
            'Layouts',
            'Pages',
            'Modules',
            'Products',
            'Articles',
            'Widgets',
        ];
        $scope.loadParams = async function () {
            $rootScope.isBusy = true;
            $scope.folderType = $routeParams.folderType ? $routeParams.folderType : 'Masters';
            $scope.backUrl = '/portal/template/list/' + $routeParams.themeId;
            $scope.themeId = $routeParams.themeId;
        }
        $scope.getSingle = async function () {
            $rootScope.isBusy = true;
            var id = $routeParams.id;
            var folderType = $routeParams.folderType ? $routeParams.folderType : 'Masters';
            var themeId = $routeParams.themeId;
            var resp = await service.getSingle(['portal', themeId, folderType, id]);
            if (resp && resp.isSucceed) {
                $scope.activedData = resp.data;
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };
        $scope.getList = async function (pageIndex, themeId) {
            $scope.themeId = themeId || $routeParams.themeId;
            $scope.request.key = this.folderType;
            $scope.folderType = this.folderType;
            if (pageIndex !== undefined) {
                $scope.request.pageIndex = pageIndex;
            }
            if ($scope.request.fromDate !== null) {
                var d = new Date($scope.request.fromDate);
                $scope.request.fromDate = d.toISOString();
            }
            if ($scope.request.toDate !== null) {
                var d = new Date($scope.request.toDate);
                $scope.request.toDate = d.toISOString();
            }
            var resp = await service.getList($scope.request, [$scope.themeId]);
            if (resp && resp.isSucceed) {
                $scope.data = resp.data;
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };
    }]);

'use strict';
app.factory('TemplateService', ['BaseService',
    function (baseService) {

        var serviceFactory = Object.create(baseService);
        serviceFactory.init('template');        
        return serviceFactory;

    }]);

'use strict';
app.controller('ThemeController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', 'ThemeService',
    function ($scope, $rootScope, ngAppSettings, $routeParams, service) {
        BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);  
        $scope.syncTemplates = async function (id) {
            $rootScope.isBusy = true;
            var response = await service.syncTemplates(id);
            if (response.isSucceed) {
                $scope.activedTheme = response.data;
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                $rootScope.showErrors(response.errors);
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        
    }]);

'use strict';
app.factory('ThemeService', ['CommonService', 'BaseService',
    function (commonService, baseService) {

        var serviceFactory = Object.create(baseService);
        serviceFactory.init('theme');

        var _syncTemplates = async function (id) {
            var url = this.prefixUrl + '/sync/' + id;
            var req = {
                method: 'GET',
                url: url
            };
            return await commonService.getApiResult(req, '');
        };

        serviceFactory.syncTemplates = _syncTemplates;
        return serviceFactory;

    }]);

'use strict';
app.controller('UserController', ['$scope', '$rootScope', 'ngAppSettings', '$routeParams', '$timeout', '$location', 'AuthService', 'UserServices',
    function ($scope, $rootScope, ngAppSettings, $routeParams, $timeout, $location, authService, userServices) {
        $scope.request = {
            pageSize: '10',
            pageIndex: 0,
            status: '2',
            orderBy: 'CreatedDateTime',
            direction: '1',
            fromDate: null,
            toDate: null,
            keyword: ''
        };
        
        $scope.mediaFile = {
            file: null,
            fullPath: '',
            folder: 'User',
            title: '',
            description: ''
        };
        $scope.activedUser = null;
        $scope.relatedUsers = [];
        $rootScope.isBusy = false;
        $scope.data = {
            pageIndex: 0,
            pageSize: 1,
            totalItems: 0,
        };
        $scope.errors = [];

        $scope.range = function (max) {
            var input = [];
            for (var i = 1; i <= max; i += 1) input.push(i);
            return input;
        };

        $scope.loadUser = async function () {
            $rootScope.isBusy = true;
            var id = $routeParams.id;
            var response = await userServices.getUser(id, 'portal');
            if (response.isSucceed) {
                $scope.activedUser = response.data;
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                $rootScope.showErrors(response.errors);
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.loadUsers = async function (pageIndex) {
            if (pageIndex !== undefined) {
                $scope.request.pageIndex = pageIndex;
            }
            $rootScope.isBusy = true;
            var resp = await userServices.getUsers($scope.request);
            if (resp && resp.isSucceed) {
                $scope.data = resp.data;
                $.each($scope.data.items, function (i, user) {

                    $.each($scope.data, function (i, e) {
                        if (e.userId === user.id) {
                            user.isHidden = true;
                        }
                    });
                });
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.removeUser = function (id) {
            $rootScope.showConfirm($scope, 'removeUserConfirmed', [id], null, 'Remove User', 'Are you sure');
        }

        $scope.removeUserConfirmed = async function (id) {
            $rootScope.isBusy = true;
            var result = await userServices.removeUser(id);
            if (result.isSucceed) {
                $scope.loadUsers();
            }
            else {
                $rootScope.showMessage('failed');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        }

        $scope.saveUser = async function (user) {
            //if (user.avatar !== user.avatarUrl) {
            //    user.avatar = user.avatarUrl;
            //}
            $rootScope.isBusy = true;
            var resp = await userServices.saveUser(user);
            if (resp && resp.isSucceed) {
                //$scope.activedUser = resp.data;
                $rootScope.showMessage('Thành công', 'success');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.register = async function (user) {
            $rootScope.isBusy = true;
            var resp = await userServices.register(user);
            if (resp && resp.isSucceed) {
                $scope.activedUser = resp.data;
                $rootScope.showMessage('Thành công', 'success');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };

        $scope.updateRoleStatus = async function (nav) {
            var userRole = {
                userId: nav.userId,
                roleId: nav.roleId,
                roleName: nav.description,
                isUserInRole: nav.isActived
            };
            $rootScope.isBusy = true;
            var resp = await userServices.updateRoleStatus(userRole);
            if (resp && resp.isSucceed) {
                $rootScope.showMessage('Thành công', 'success');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
            else {
                if (resp) { $rootScope.showErrors(resp.errors); }
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        };
    }]);

'use strict';
app.factory('UserServices', ['$http', 'CommonService', 'ngAppSettings'
    , function ($http, commonService, ngAuthSettings) {

    //var serviceBase = 'http://ngauthenticationapi.azurewebsites.net/';

    var usersServiceFactory = {};
    var apiUrl = '/account/';
    
    var serviceBase = ngAuthSettings.serviceBase;
    
    var _getUserDemographicInfo = function () {
        var url = '/GetUserDemographicInfo';
        var req = {
            method: 'GET',
            url: serviceBase + url
        };

        return commonService.getApiResult(req);
    };



    var _importUsers = function (strBase64) {
        var url = 'import-users';
        var req = {
            method: 'POST',
            url: apiUrl + url,
            data: JSON.stringify({ strBase64: strBase64 })
        };

        return commonService.getApiResult(req);
    };

    var _getUsers = function (request) {

        var req = {
            method: 'POST',
            url: apiUrl + 'list',
            data: request
        };

        return commonService.getApiResult(req);
    };

    var _getUser = async function (id, viewType) {
        var apiUrl = '/account/';
        var url = apiUrl + 'details/' + viewType;
        if (id) {
            url += '/' + id;
        }
        var req = {
            method: 'GET',
            url: url
        };
        return await commonService.getApiResult(req)
    };

    var _updateRoleStatus = function (userInRole) {

        var req = {
            method: 'POST',
            url: serviceBase + '/account/user-in-role',
            data: JSON.stringify(userInRole)

        };

        return commonService.getApiResult(req);
    };

    var _saveUser = async function (user) {
        var apiUrl = '/account/';
        var req = {
            method: 'POST',
            url: apiUrl + 'save',
            data: JSON.stringify(user)
        };
        return await commonService.getApiResult(req)
    };

    var _register = async function (user) {
        var apiUrl = '/account/';
        var req = {
            method: 'POST',
            url: apiUrl + 'register',
            data: JSON.stringify(user)
        };
        return await commonService.getApiResult(req)
    };

    var _removeUser = function (user) {
        var req = {
            method: 'POST',
            url: apiUrl + 'remove-user',
            data: JSON.stringify(user)
        };

        return commonService.getApiResult(req);
    };

    usersServiceFactory.importUsers = _importUsers;
    usersServiceFactory.getUsers = _getUsers;
    usersServiceFactory.getUser = _getUser;
    usersServiceFactory.saveUser = _saveUser;
    usersServiceFactory.register = _register;
    usersServiceFactory.removeUser = _removeUser;
    usersServiceFactory.updateRoleStatus = _updateRoleStatus;
    usersServiceFactory.getUserDemographicInfo = _getUserDemographicInfo;
    return usersServiceFactory;

}]);

    'use strict';
    function PageDetailsController($scope, $element, $attrs) {
        var ctrl = this;
        ctrl.activedPage = null;
        ctrl.relatedPages = [];
        ctrl.data = [];
        ctrl.errors = [];
        ctrl.range = function (max) {
            var input = [];
            for (var i = 1; i <= max; i += 1) input.push(i);
            return input;
        };
        ctrl.loadPage = function (pageId) {
            ctrl.isBusy = true;
            var url = '/' + ctrl.currentLanguage + '/page/details/be/' + pageId;//byPage/' + pageId;
            ctrl.settings.method = "GET";
            ctrl.settings.url = url;// + '/true';
            ctrl.settings.data = ctrl.request;
            $.ajax(ctrl.settings).done(function (response) {
                if (response.isSucceed) {
                    ctrl.activedPage = response.data;
                    ctrl.initEditor();
                }
                ctrl.isBusy = false;
                ctrl.$apply();
            });
        };
        ctrl.loadPages = function (pageIndex) {
            ctrl.isBusy = true;
            if (pageIndex !== undefined) {
                ctrl.request.pageIndex = pageIndex;
            }
            if (ctrl.request.fromDate !== null) {
                ctrl.request.fromDate = ctrl.request.fromDate.toISOString();
            }
            if (ctrl.request.toDate !== null) {
                ctrl.request.toDate = ctrl.request.toDate.toISOString();
            }
            var url = '/' + ctrl.currentLanguage + '/page/list';//byPage/' + pageId;
            ctrl.settings.method = "POST";
            ctrl.settings.url = url;// + '/true';
            ctrl.settings.data = ctrl.request;
            $.ajax(ctrl.settings).done(function (response) {
                (ctrl.data = response.data);

                $.each(ctrl.data.items, function (i, page) {
                    $.each(ctrl.activedPages, function (i, e) {
                        if (e.pageId === page.id) {
                            page.isHidden = true;
                        }
                    })
                })
                ctrl.isBusy = false;
                setTimeout(function () {
                    $('[data-toggle="popover"]').popover({
                        html: true,
                        content: function () {
                            var content = $(this).next('.popover-body');
                            return $(content).html();
                        },
                        title: function () {
                            var title = $(this).attr("data-popover-content");
                            return $(title).children(".popover-heading").html();
                        }
                    });
                }, 200);
                ctrl.$apply();
            });
        };

        ctrl.removePage = function (pageId) {
            if (confirm("Are you sure!")) {
                var url = '/' + ctrl.currentLanguage + '/page/delete/' + pageId;
                $.ajax({
                    method: 'GET',
                    url: url,
                    success: function (data) {
                        ctrl.loadPages();
                        ctrl.$apply();
                    },
                    error: function (a, b, c) {
                        console.log(a + " " + b + " " + c);
                    }
                });
            }
        };
        ctrl.savePage = function (page) {
            var url = '/' + ctrl.currentLanguage + '/page/save';
            $.ajax({
                method: 'POST',
                url: url,
                data: page,
                success: function (data) {
                    //ctrl.loadPages();
                    if (data.isSucceed) {
                        alert('success');
                    }
                    else {
                        alert('failed! ' + data.errors);
                    }
                },
                error: function (a, b, c) {
                    console.log(a + " " + b + " " + c);
                }
            });
        };

        ctrl.changeMedia = function (media) {
            var currentItem = null;
            if (ctrl.activedPage.mediaNavs === undefined) {
                ctrl.activedPage.mediaNavs = [];
            }
            $.each(ctrl.activedPage.mediaNavs, function (i, e) {
                if (e.mediaId === media.id) {
                    e.isActived = media.isActived;
                    currentItem = e;
                    return false;
                }
            });
            if (currentItem === null) {
                currentItem = {
                    description: media.description !== 'undefined' ? media.description : '',
                    image: media.fullPath,
                    mediaId: media.id,
                    page: ctrl.activedPage.id,
                    specificulture: media.specificulture,
                    position: 0,
                    priority: ctrl.activedMedias.length + 1,
                    isActived: true
                };
                media.isHidden = true;
                ctrl.activedPage.mediaNavs.push(currentItem);
            }
        }

        ctrl.changePage = function (page) {
            var currentItem = null;
            $.each(ctrl.activedPage.pageNavs, function (i, e) {
                if (e.relatedPageId === page.id) {
                    e.isActived = page.isActived;
                    currentItem = e;
                    return false;
                }
            });
            if (currentItem === null) {
                currentItem = {
                    relatedPageId: page.id,
                    sourcePageId: $('#page-id').val(),
                    specificulture: page.specificulture,
                    priority: ctrl.activedPage.pageNavs.length + 1,
                    page: page,
                    isActived: true
                };
                page.isHidden = true;
                ctrl.activedPage.pageNavs.push(currentItem);
            }
        }


        ctrl.addProperty = function (type) {
            var i = $(".property").length;
            $.ajax({
                method: 'GET',
                url: '/' + ctrl.currentLanguage + '/Portal/' + type + '/AddEmptyProperty/' + i,
                success: function (data) {
                    $('#tbl-properties > tbody').append(data);
                    $(data).find('.prop-data-type').trigger('change');
                },
                error: function (a, b, c) {
                    console.log(a + " " + b + " " + c);
                }
            });
            ctrl.updateHero = function (hero, prop, value) {
                hero[prop] = value;
            };

            ctrl.deleteHero = function (hero) {
                var idx = ctrl.list.indexOf(hero);
                if (idx >= 0) {
                    ctrl.list.splice(idx, 1);
                }
            };
        }

        angular.module(appName).component('pageDetails', {
            templateUrl: 'pageDetails.html',
            controller: PageDetailsController
        });
    }




    'use strict';
    function ProductDetailsController($scope, $element, $attrs) {
        var ctrl = this;
        ctrl.activedData = null;
        ctrl.relatedProducts = [];
        ctrl.data = [];
        ctrl.errors = [];
        ctrl.range = function (max) {
            var input = [];
            for (var i = 1; i <= max; i += 1) input.push(i);
            return input;
        };
        ctrl.loadProduct = function (productId) {
            ctrl.isBusy = true;
            var url = '/' + ctrl.currentLanguage + '/product/details/be/' + productId;//byProduct/' + productId;
            ctrl.settings.method = "GET";
            ctrl.settings.url = url;// + '/true';
            ctrl.settings.data = ctrl.request;
            $.ajax(ctrl.settings).done(function (response) {
                if (response.isSucceed) {
                    ctrl.activedData = response.data;
                    ctrl.initEditor();
                }
                ctrl.isBusy = false;
                ctrl.$apply();
            });
        };
        ctrl.loadProducts = function (pageIndex) {
            ctrl.isBusy = true;
            if (pageIndex !== undefined) {
                ctrl.request.pageIndex = pageIndex;
            }
            if (ctrl.request.fromDate !== null) {
                ctrl.request.fromDate = ctrl.request.fromDate.toISOString();
            }
            if (ctrl.request.toDate !== null) {
                ctrl.request.toDate = ctrl.request.toDate.toISOString();
            }
            var url = '/' + ctrl.currentLanguage + '/product/list';//byProduct/' + productId;
            ctrl.settings.method = "POST";
            ctrl.settings.url = url;// + '/true';
            ctrl.settings.data = ctrl.request;
            $.ajax(ctrl.settings).done(function (response) {
                (ctrl.data = response.data);

                $.each(ctrl.data.items, function (i, product) {
                    $.each(ctrl.activedDatas, function (i, e) {
                        if (e.productId === product.id) {
                            product.isHidden = true;
                        }
                    })
                })
                ctrl.isBusy = false;
                setTimeout(function () {
                    $('[data-toggle="popover"]').popover({
                        html: true,
                        content: function () {
                            var content = $(this).next('.popover-body');
                            return $(content).html();
                        },
                        title: function () {
                            var title = $(this).attr("data-popover-content");
                            return $(title).children(".popover-heading").html();
                        }
                    });
                }, 200);
                ctrl.$apply();
            });
        };

        ctrl.removeProduct = function (productId) {
            if (confirm("Are you sure!")) {
                var url = '/' + ctrl.currentLanguage + '/product/delete/' + productId;
                $.ajax({
                    method: 'GET',
                    url: url,
                    success: function (data) {
                        ctrl.loadProducts();
                        ctrl.$apply();
                    },
                    error: function (a, b, c) {
                        console.log(a + " " + b + " " + c);
                    }
                });
            }
        };
        ctrl.saveProduct = function (product) {
            var url = '/' + ctrl.currentLanguage + '/product/save';
            $.ajax({
                method: 'POST',
                url: url,
                data: product,
                success: function (data) {
                    //ctrl.loadProducts();
                    if (data.isSucceed) {
                        alert('success');
                    }
                    else {
                        alert('failed! ' + data.errors);
                    }
                },
                error: function (a, b, c) {
                    console.log(a + " " + b + " " + c);
                }
            });
        };

        ctrl.changeMedia = function (media) {
            var currentItem = null;
            if (ctrl.activedData.mediaNavs === undefined) {
                ctrl.activedData.mediaNavs = [];
            }
            $.each(ctrl.activedData.mediaNavs, function (i, e) {
                if (e.mediaId === media.id) {
                    e.isActived = media.isActived;
                    currentItem = e;
                    return false;
                }
            });
            if (currentItem === null) {
                currentItem = {
                    description: media.description !== 'undefined' ? media.description : '',
                    image: media.fullPath,
                    mediaId: media.id,
                    product: ctrl.activedData.id,
                    specificulture: media.specificulture,
                    position: 0,
                    priority: ctrl.activedMedias.length + 1,
                    isActived: true
                };
                media.isHidden = true;
                ctrl.activedData.mediaNavs.push(currentItem);
            }
        }

        ctrl.changeProduct = function (product) {
            var currentItem = null;
            $.each(ctrl.activedData.productNavs, function (i, e) {
                if (e.relatedProductId === product.id) {
                    e.isActived = product.isActived;
                    currentItem = e;
                    return false;
                }
            });
            if (currentItem === null) {
                currentItem = {
                    relatedProductId: product.id,
                    sourceProductId: $('#product-id').val(),
                    specificulture: product.specificulture,
                    priority: ctrl.activedData.productNavs.length + 1,
                    product: product,
                    isActived: true
                };
                product.isHidden = true;
                ctrl.activedData.productNavs.push(currentItem);
            }
        }


        ctrl.addProperty = function (type) {
            var i = $(".property").length;
            $.ajax({
                method: 'GET',
                url: '/' + ctrl.currentLanguage + '/Portal/' + type + '/AddEmptyProperty/' + i,
                success: function (data) {
                    $('#tbl-properties > tbody').append(data);
                    $(data).find('.prop-data-type').trigger('change');
                },
                error: function (a, b, c) {
                    console.log(a + " " + b + " " + c);
                }
            });
            ctrl.updateHero = function (hero, prop, value) {
                hero[prop] = value;
            };

            ctrl.deleteHero = function (hero) {
                var idx = ctrl.list.indexOf(hero);
                if (idx >= 0) {
                    ctrl.list.splice(idx, 1);
                }
            };
        }

        angular.module(appName).component('productDetails', {
            templateUrl: 'productDetails.html',
            controller: ProductDetailsController
        });
    }



app.component('articleGeneral', {
    templateUrl: '/app/app-portal/pages/article/components/general/articleGeneral.html',
    controller: function ($scope) {
        var ctrl = this;
        ctrl.dataTypes = [
            {
                title: 'String',
                value:0
            },
            {
                title: 'Int',
                value: 1
            },
            {
                title: 'Image',
                value: 2
            },
            {
                title: 'Boolean',
                value: 7
            }
        ];
        ctrl.configurations = {
            core: {},
            plugins: {
                btnsDef: {
                    // Customizables dropdowns
                    image: {
                        dropdown: ['insertImage', 'upload', 'base64', 'noembed'],
                        ico: 'insertImage'
                    }
                },
                btns: [
                    ['viewHTML'],
                    ['undo', 'redo'],
                    ['formatting'],
                    ['strong', 'em', 'del', 'underline'],
                    ['link'],
                    ['image'],
                    ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
                    ['unorderedList', 'orderedList'],
                    ['foreColor', 'backColor'],
                    ['preformatted'],
                    ['horizontalRule'],
                    ['fullscreen']
                ],
                plugins: {
                    // Add imagur parameters to upload plugin
                    upload: {
                        serverPath: 'https://api.imgur.com/3/image',
                        fileFieldName: 'image',
                        headers: {
                            'Authorization': 'Client-ID 9e57cb1c4791cea'
                        },
                        urlPropertyName: 'data.link'
                    }
                }
            }
        };
        ctrl.addProperty = function (type) {
            var i = $(".property").length;
            ctrl.article.properties.push({
                priority: 0,
                name: '',
                value: null,
                dataType: 0
            });
        };
        ctrl.initEditor = function() {
            setTimeout(function () {
                // Init Code editor
                $.each($('.code-editor'), function (i, e) {
                    var container = $(this);
                    var editor = ace.edit(e);
                    if (container.hasClass('json')) {
                        editor.session.setMode("ace/mode/json");
                    }
                    else {
                        editor.session.setMode("ace/mode/razor");
                    }
                    editor.setTheme("ace/theme/chrome");
                    //editor.setReadOnly(true);

                    editor.session.setUseWrapMode(true);
                    editor.setOptions({
                        maxLines: Infinity
                    });
                    editor.getSession().on('change', function (e) {
                        // e.type, etc
                        $(container).parent().find('.code-content').val(editor.getValue());
                    });
                })
                $.each($('.editor-content'), function (i, e) {
                    var $demoTextarea = $(e);
                    $demoTextarea.trumbowyg(ctrl.configurations.plugins);
                });
            }, 200)
        }
    },
    bindings: {
        article: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('articleMain', {
    templateUrl: '/app/app-portal/pages/article/components/main/articleMain.html',
    controller: ['$rootScope', '$scope',
        function ($rootScope, $scope) {
            var ctrl = this;
            ctrl.generateSeo = function () {
                if (ctrl.article) {
                    if (ctrl.article.seoName === null || ctrl.article.seoName === '') {
                        ctrl.article.seoName = $rootScope.generateKeyword(ctrl.article.title, '-');
                    }
                    if (ctrl.article.seoTitle === null || ctrl.article.seoTitle === '') {
                        ctrl.article.seoTitle = $rootScope.generateKeyword(ctrl.article.title, '-');
                    }
                    if (ctrl.article.seoDescription === null || ctrl.article.seoDescription === '') {
                        ctrl.article.seoDescription = $rootScope.generateKeyword(ctrl.article.title, '-');
                    }
                    if (ctrl.article.seoKeywords === null || ctrl.article.seoKeywords === '') {
                        ctrl.article.seoKeywords = $rootScope.generateKeyword(ctrl.article.title, '-');
                    }
                }
            }
        }
    ],
    bindings: {
        article: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('articleMedias', {
    templateUrl: '/app/app-portal/pages/article/components/medias/articleMedias.html',
    controller: function () {
        var ctrl = this;
        ctrl.activeMedia = function (media) {
            var currentItem = null;
            if (ctrl.article.mediaNavs === null) {
                ctrl.article.mediaNavs = [];
            }
            $.each(ctrl.article.mediaNavs, function (i, e) {
                if (e.mediaId === media.id) {
                    e.isActived = media.isActived;
                    currentItem = e;
                    return false;
                }
            });
            if (currentItem === null) {
                currentItem = {
                    description: media.description !== 'undefined' ? media.description : '',
                    image: media.fullPath,
                    mediaId: media.id,
                    article: ctrl.article.id,
                    specificulture: media.specificulture,
                    position: 0,
                    priority: ctrl.article.mediaNavs.length + 1,
                    isActived: true
                };
                media.isHidden = true;
                ctrl.article.mediaNavs.push(currentItem);
            }
        }
    },
    bindings: {
        article: '=',
        medias: '=',
        loadMedia: '&',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('articleModules', {
    templateUrl: '/app/app-portal/pages/article/components/modules/articleModules.html',
    bindings: {
        article: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('articleParents', {
    templateUrl: '/app/app-portal/pages/article/components/parents/articleParents.html',
    bindings: {
        article: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('articleRelated', {
    templateUrl: '/app/app-portal/pages/article/components/related/articleRelated.html',
    controller: function () {
        var ctrl = this;
        ctrl.activeArticle = function (model) {
            var currentItem = null;
            $.each(ctrl.article.articleNavs, function (i, e) {
                if (e.relatedArticleId === model.id) {
                    e.isActived = model.isActived;
                    currentItem = e;
                    return false;
                }
            });
            if (currentItem === null) {
                currentItem = {
                    relatedArticleId: model.id,
                    sourceArticleId: ctrl.article.id,
                    specificulture: ctrl.article.specificulture,
                    priority: ctrl.article.articleNavs.length + 1,
                    relatedArticle: pr,
                    isActived: true
                };
                model.isHidden = true;
                ctrl.article.articleNavs.push(currentItem);
            }
        }
    },
    bindings: {
        article: '=',
        list: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('articleSeo', {
    templateUrl: '/app/app-portal/pages/article/components/seo/articleSeo.html',
    bindings: {
        article: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('customerMain', {
    templateUrl: '/app/app-portal/pages/customer/components/main/customer-main.html',
    bindings: {
        customer: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('customerOrders', {
    templateUrl: '/app/app-portal/pages/customer/components/orders/customer-orders.html',
    controller: ['$rootScope', 'OrderServices', function($rootScope, orderServices){
        var ctrl = this;
        ctrl.removeOrder = function (id) {
            $rootScope.showConfirm(ctrl, 'removeOrderConfirmed', [id], null, 'Remove Order', 'Are you sure');
        }

        ctrl.removeOrderConfirmed = async function (id) {
            var result = await orderServices.removeOrder(id);
            if (result.isSucceed) {
                $rootScope.showMessage('success', 'success');
                window.top.location = window.top.location.href;
            }
            else {
                $rootScope.showMessage('failed');
                $rootScope.isBusy = false;
                $scope.$apply();
            }
        }
    }],
    bindings: {
        customer: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('moduleMain', {
    templateUrl: '/app/app-portal/pages/module/components/main/main.html',
    controller: ['$rootScope', function ($rootScope) {
        var ctrl = this;
        ctrl.gennerateName = function () {
            if (!ctrl.module.id || ctrl.module.name === null || ctrl.module.name === '') {
                ctrl.module.name = $rootScope.generateKeyword(ctrl.module.title, '_');
            }
        };
    }],
    bindings: {
        module: '=',
    }
});

app.component('pageGeneral', {
    templateUrl: '/app/app-portal/pages/page/components/general/general.html',
    controller: function ($scope) {
        var ctrl = this;
        ctrl.dataTypes = [
            {
                title: 'String',
                value:0
            },
            {
                title: 'Int',
                value: 1
            },
            {
                title: 'Image',
                value: 2
            },
            {
                title: 'Boolean',
                value: 7
            }
        ];
        ctrl.configurations = {
            core: {},
            plugins: {
                btnsDef: {
                    // Customizables dropdowns
                    image: {
                        dropdown: ['insertImage', 'upload', 'base64', 'noembed'],
                        ico: 'insertImage'
                    }
                },
                btns: [
                    ['viewHTML'],
                    ['undo', 'redo'],
                    ['formatting'],
                    ['strong', 'em', 'del', 'underline'],
                    ['link'],
                    ['image'],
                    ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
                    ['unorderedList', 'orderedList'],
                    ['foreColor', 'backColor'],
                    ['preformatted'],
                    ['horizontalRule'],
                    ['fullscreen']
                ],
                plugins: {
                    // Add imagur parameters to upload plugin
                    upload: {
                        serverPath: 'https://api.imgur.com/3/image',
                        fileFieldName: 'image',
                        headers: {
                            'Authorization': 'Client-ID 9e57cb1c4791cea'
                        },
                        urlPropertyName: 'data.link'
                    }
                }
            }
        };
        ctrl.addProperty = function (type) {
            var i = $(".property").length;
            ctrl.page.properties.push({
                priority: 0,
                name: '',
                value: null,
                dataType: 0
            });
        };
        ctrl.initEditor = function() {
            setTimeout(function () {
                // Init Code editor
                $.each($('.code-editor'), function (i, e) {
                    var container = $(this);
                    var editor = ace.edit(e);
                    if (container.hasClass('json')) {
                        editor.session.setMode("ace/mode/json");
                    }
                    else {
                        editor.session.setMode("ace/mode/razor");
                    }
                    editor.setTheme("ace/theme/chrome");
                    //editor.setReadOnly(true);

                    editor.session.setUseWrapMode(true);
                    editor.setOptions({
                        maxLines: Infinity
                    });
                    editor.getSession().on('change', function (e) {
                        // e.type, etc
                        $(container).parent().find('.code-content').val(editor.getValue());
                    });
                })
                $.each($('.editor-content'), function (i, e) {
                    var $demoTextarea = $(e);
                    $demoTextarea.trumbowyg(ctrl.configurations.plugins);
                });
            }, 200)
        }
    },
    bindings: {
        page: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('pageMain', {
    templateUrl: '/app/app-portal/pages/page/components/main/main.html',
    controller: ['$rootScope', '$scope', 'ngAppSettings', function ($rootScope, $scope) {
        var ctrl = this;
        ctrl.settings = $rootScope.globalSettings;
        ctrl.setPageType = function (type) {
            ctrl.page.type = $index;
        }
        ctrl.generateSeo = function () {
            if (ctrl.page) {
                if (ctrl.page.seoName === null || ctrl.page.seoName === '') {
                    ctrl.page.seoName = $rootScope.generateKeyword(ctrl.page.title, '-');
                }
                if (ctrl.page.seoTitle === null || ctrl.page.seoTitle === '') {
                    ctrl.page.seoTitle = $rootScope.generateKeyword(ctrl.page.title, '-');
                }
                if (ctrl.page.seoDescription === null || ctrl.page.seoDescription === '') {
                    ctrl.page.seoDescription = $rootScope.generateKeyword(ctrl.page.title, '-');
                }
                if (ctrl.page.seoKeywords === null || ctrl.page.seoKeywords === '') {
                    ctrl.page.seoKeywords = $rootScope.generateKeyword(ctrl.page.title, '-');
                }
            }
        }
    }],
    bindings: {
        page: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('pageModules', {
    templateUrl: '/app/app-portal/pages/page/components/modules/modules.html',
    bindings: {
        page: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('pageParents', {
    templateUrl: '/app/app-portal/pages/page/components/parents/parents.html',
    bindings: {
        page: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('pagePlugPlay', {
    templateUrl: '/app/app-portal/pages/page/components/plug-play/plug-play.html',
    bindings: {
        page: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('productRelated', {
    templateUrl: '/app/app-portal/pages/product/components/related/productRelated.html',
    controller: function () {
        var ctrl = this;
        ctrl.activeProduct = function (pr) {
            var currentItem = null;
            $.each(ctrl.product.productNavs, function (i, e) {
                if (e.relatedProductId === pr.id) {
                    e.isActived = pr.isActived;
                    currentItem = e;
                    return false;
                }
            });
            if (currentItem === null) {
                currentItem = {
                    relatedProductId: pr.id,
                    sourceProductId: ctrl.product.id,
                    specificulture: ctrl.product.specificulture,
                    priority: ctrl.product.productNavs.length + 1,
                    relatedProduct: pr,
                    isActived: true
                };
                pr.isHidden = true;
                ctrl.product.productNavs.push(currentItem);
            }
        }
    },
    bindings: {
        product: '=',
        list: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('pageSeo', {
    templateUrl: '/app/app-portal/pages/page/components/seo/seo.html',
    bindings: {
        page: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('permissionMain', {
    templateUrl: '/app/app-portal/pages/permission/components/main/main.html',
    controller: ['$rootScope', '$scope', 'ngAppSettings', '$routeParams',function ($rootScope, $scope, ngAppSettings, $routeParams) {
        var ctrl = this;
        ctrl.settings = $rootScope.globalSettings;
        ctrl.setPageType = function (type) {
            ctrl.page.type = $index;
        };
        ctrl.generateKeyword = function (text) {
            if (!$routeParams.id) {
                ctrl.page.textKeyword = 'portal_' + text.replace(/[^a-zA-Z0-9]+/g, '_')
                    .replace(/([A-Z]+)([A-Z][a-z])/g, '$1-$2')
                    .replace(/([a-z])([A-Z])/g, '$1-$2')
                    .replace(/([0-9])([^0-9])/g, '$1-$2')
                    .replace(/([^0-9])([0-9])/g, '$1-$2')
                    .replace(/-+/g, '_')
                    .toLowerCase();
            }
        };
    }],
    bindings: {
        page: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('permissionParents', {
    templateUrl: '/app/app-portal/pages/permission/components/parents/parents.html',    
    bindings: {
        page: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('permissionPlugPlay', {
    templateUrl: '/app/app-portal/pages/permission/components/plug-play/plug-play.html',
    bindings: {
        page: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('productGeneral', {
    templateUrl: '/app/app-portal/pages/product/components/general/productGeneral.html',
    controller: ['$rootScope', '$scope', 'ngAppSettings', function ($rootScope, $scope, ngAppSettings) {
        var ctrl = this;
        //ctrl.tags = ctrl.product.tags;
        ctrl.dataTypes = ngAppSettings.dataTypes;
        ctrl.configurations = ngAppSettings.editorConfigurations;
        ctrl.addProperty = function (type) {
            var i = $(".property").length;
            ctrl.product.properties.push({
                priority: 0,
                name: '',
                value: null,
                dataType: 0
            });
        };
        ctrl.initEditor = $rootScope.initEditor;
        ctrl.loadTags = function (query) {
            return [];
        };
    }],
    bindings: {
        product: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('productMain', {
    templateUrl: '/app/app-portal/pages/product/components/main/productMain.html',
    controller: ['$rootScope', '$scope', 'ngAppSettings',
        function ($rootScope, $scope, ngAppSettings) {
            var ctrl = this;
            ctrl.translate = $rootScope.translate;
            ctrl.privacies = ngAppSettings.privacies;
            ctrl.formatPrice = function (price) {
                return price.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            };
            ctrl.generateSeo = function () {
                if (ctrl.product) {
                    if (ctrl.product.seoName === null || ctrl.product.seoName === '') {
                        ctrl.product.seoName = $rootScope.generateKeyword(ctrl.product.title, '-');
                    }
                    if (ctrl.product.seoTitle === null || ctrl.product.seoTitle === '') {
                        ctrl.product.seoTitle = $rootScope.generateKeyword(ctrl.product.title, '-');
                    }
                    if (ctrl.product.seoDescription === null || ctrl.product.seoDescription === '') {
                        ctrl.product.seoDescription = $rootScope.generateKeyword(ctrl.product.title, '-');
                    }
                    if (ctrl.product.seoKeywords === null || ctrl.product.seoKeywords === '') {
                        ctrl.product.seoKeywords = $rootScope.generateKeyword(ctrl.product.title, '-');
                    }
                }
            }
        }
    ],
    bindings: {
        product: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('productMedias', {
    templateUrl: '/app/app-portal/pages/product/components/medias/productMedias.html',
    controller: ['$rootScope', function ($rootScope) {
        var ctrl = this;
        ctrl.medias = $rootScope.medias;
        ctrl.init = function () {
            if ($rootScope.medias) {
                angular.forEach(ctrl.medias, function (value, key) {
                    value.isActived = ctrl.checkActived(value) !== undefined;
                });
                
            }
        };
        ctrl.checkActived = function (item) {
            if (ctrl.product.mediaNavs) {
                return ctrl.product.mediaNavs.find(function (nav) {
                    return nav.mediaId === item.id;
                });
            }
        };
        ctrl.activeMedia = function (media) {
            var currentItem = null;
            if (ctrl.product.mediaNavs === null) {
                ctrl.product.mediaNavs = [];
            }
            $.each(ctrl.product.mediaNavs, function (i, e) {
                if (e.mediaId === media.id) {
                    e.isActived = media.isActived;
                    currentItem = e;
                    return false;
                }
            });
            if (currentItem === null) {
                currentItem = {
                    description: media.description !== 'undefined' ? media.description : '',
                    image: media.fullPath,
                    mediaId: media.id,
                    product: ctrl.product.id,
                    specificulture: media.specificulture,
                    position: 0,
                    priority: ctrl.product.mediaNavs.length + 1,
                    isActived: true
                };
                media.isHidden = true;
                ctrl.product.mediaNavs.push(currentItem);
            }
        };
    }],
    bindings: {
        product: '=',
        medias: '=',
        loadMedia: '&',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('productModules', {
    templateUrl: '/app/app-portal/pages/product/components/modules/productModules.html',
    bindings: {
        product: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('productParents', {
    templateUrl: '/app/app-portal/pages/product/components/parents/productParents.html',
    bindings: {
        product: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('productRelated', {
    templateUrl: '/app/app-portal/pages/product/components/related/productRelated.html',
    controller: function () {
        var ctrl = this;
        ctrl.activeProduct = function (pr) {
            var currentItem = null;
            $.each(ctrl.product.productNavs, function (i, e) {
                if (e.relatedProductId === pr.id) {
                    e.isActived = pr.isActived;
                    currentItem = e;
                    return false;
                }
            });
            if (currentItem === null) {
                currentItem = {
                    relatedProductId: pr.id,
                    sourceProductId: ctrl.product.id,
                    specificulture: ctrl.product.specificulture,
                    priority: ctrl.product.productNavs.length + 1,
                    relatedProduct: pr,
                    isActived: true
                };
                pr.isHidden = true;
                ctrl.product.productNavs.push(currentItem);
            }
        }
    },
    bindings: {
        product: '=',
        list: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

app.component('productSeo', {
    templateUrl: '/app/app-portal/pages/product/components/seo/productSeo.html',
    bindings: {
        product: '=',
        onDelete: '&',
        onUpdate: '&'
    }
});

modules.component('rolePageNav', {
    templateUrl: '/app/app-portal/pages/role/components/role-page-navigation/role-page-navigations.html',
    controller: ['$rootScope', '$scope', 'ngAppSettings', 'RoleService', function ($rootScope, $scope, ngAppSettings, roleServices) {
        var ctrl = this;
        ctrl.selected = null;
        ctrl.updateOrders = function (index) {
            ctrl.data.splice(index, 1);
            for (var i = 0; i < ctrl.data.length; i++) {
                ctrl.data[i].priority = i + 1;
            }
        };
        //ctrl.change = async function () {
        //    //var permission = ctrl.page.navPermission;
        //    //$rootScope.isBusy = true;
        //    //var resp = await roleServices.updatePermission(permission);
        //    //if (resp && resp.isSucceed) {
        //    //    $rootScope.showMessage('Thành công', 'success');
        //    //    $rootScope.isBusy = false;
        //    //    $scope.$apply();
        //    //}
        //    //else {
        //    //    if (resp) { $rootScope.showErrors(resp.errors); }
        //    //    $rootScope.isBusy = false;
        //    //    $scope.$apply();
        //    //}
        //};
    }],
    bindings: {
        prefix: '=',
        page: '=',
        callback: '&'
    }
});

modules.component('actions', {
    templateUrl: '/app/app-portal/components/actions/actions.html',
    controller: ['$rootScope', '$scope', '$location', function ($rootScope, $scope, $location) {
        var ctrl = this;
        ctrl.translate = function (keyword) {
            return $rootScope.translate(keyword);
        };
        ctrl.back = function () {
            ctrl.backUrl = ctrl.backUrl || '/admin';
            $location.path(ctrl.backUrl);
        };
    }],
    bindings: {
        previewUrl: '=',
        backUrl: '='
    }
});

modules.component('filterList', {
    templateUrl: '/app/app-portal/components/filter-list/filter-list.html',
    controller: ['$scope', '$rootScope', 'ngAppSettings', function ($scope, $rootScope, ngAppSettings) {
        var ctrl = this;
        ctrl.dateRange = {
            fromDate: null,
            toDate: null
        };
        ctrl.init = function(){
            ctrl.orders = ngAppSettings.orders;
            ctrl.directions = ngAppSettings.directions;
            ctrl.pageSizes = ngAppSettings.pageSizes;
            ctrl.statuses = [];
            var statuses = ctrl.request.contentStatuses || ngAppSettings.contentStatuses;
            angular.forEach(statuses, function(val,i){
                ctrl.statuses.push({
                    value:i,
                    title:val
                });
            });
            
        };
        ctrl.updateDate = function () {
            if (Date.parse(ctrl.dateRange.fromDate)) {
                ctrl.request.fromDate = new Date(ctrl.dateRange.fromDate).toISOString();
            }
            else {
                $scope.request.fromDate = null;
            }
            if (Date.parse(ctrl.dateRange.toDate)) {
                ctrl.request.toDate = new Date(ctrl.dateRange.toDate).toISOString();
            }
            else {
                ctrl.request.toDate = null;
            }
            ctrl.callback({ pageIndex: 0 });
        };
    }],
    bindings: {
        request: '=',
        callback: '&'
    }
});
(function (angular) {
    app.component('headerNav', {
        templateUrl: '/app/app-portal/components/header-nav/headerNav.html',
        controller: ['$rootScope', 'CommonService', 'AuthService', 'TranslatorService', 'GlobalSettingsService',
            function ($rootScope, commonService, authService, translatorService, GlobalSettingsService) {
                var ctrl = this;
                if(authService.authentication)
                {
                    ctrl.avatar = authService.authentication.avatar;
                }
                GlobalSettingsService.fillGlobalSettings().then(function (response) {
                    ctrl.settings = response;
                });
                ctrl.translate = $rootScope.translate;
                ctrl.getConfiguration = $rootScope.getConfiguration;
                ctrl.changeLang = function (lang, langIcon) {
                    ctrl.settings.lang = lang;
                    ctrl.settings.langIcon = langIcon;
                    commonService.fillSettings(lang).then(function () {
                        translatorService.reset(lang).then(function () {
                            GlobalSettingsService.reset(lang).then(function () {
                                window.top.location = location.href;
                            });
                        });
                    });
                };
                ctrl.logOut = function () {
                    $rootScope.logOut();
                };
            }],
        bindings: {
            breadCrumbs: '=',
            settings: '='
        }
    });
})(window.angular);
modules.component('mainSideBar', {
    templateUrl: '/app/app-portal/components/main-side-bar/main-side-bar.html',
    controller: ['$rootScope', '$scope', 'ngAppSettings', 'TranslatorService', function ($rootScope, $scope, ngAppSettings, translatorService) {
        var ctrl = this;
        ctrl.init = async function () {
            ctrl.items = [
                {
                    title: 'portal_dashboard',
                    shortTitle: 'portal_short_dashboard',
                    icon: 'mi mi-Tiles',
                    href: '/portal',
                    subMenus: []
                },
                {
                    title: 'portal_articles',
                    shortTitle: ('portal_articles'),
                    icon: 'mi mi-ReadingList',
                    href: '#',
                    subMenus: [
                        {
                            title: ('portal_create'),
                            href: '/portal/article/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/article/list',
                            icon: 'mi mi-List'
                        }
                    ]
                },
                // {
                //     title: 'portal_products',
                //     shortTitle: 'portal_products',
                //     icon: 'mi mi-Package',
                //     href: '#',
                //     subMenus: [
                //         {
                //             title: ('portal_create'),
                //             href: '/portal/product/create',
                //             icon: 'mi mi-Add'
                //         },
                //         {
                //             title: 'portal_list',
                //             href: '/portal/product/list',
                //             icon: 'mi mi-List'
                //         }
                //     ]
                // },
                // {
                //     title: 'portal_orders',
                //     shortTitle: 'portal_orders',
                //     icon: 'mi mi-CashDrawer',
                //     href: '#',
                //     subMenus: [
                //         {
                //             title: ('portal_create'),
                //             href: '/portal/order/create',
                //             icon: 'mi mi-Add'
                //         },
                //         {
                //             title: 'portal_list',
                //             href: '/portal/order/list',
                //             icon: 'mi mi-List'
                //         }
                //     ]
                // },
                {
                    title: 'portal_pages',
                    shortTitle: 'portal_pages',
                    icon: 'mi mi-Page',
                    href: '#',
                    subMenus: [
                        {
                            title: ('portal_create'),
                            href: '/portal/page/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/page/list',
                            icon: 'mi mi-List'
                        }
                    ]
                },
                {
                    title: 'portal_modules',
                    shortTitle: 'portal_modules',
                    icon: 'mi mi-ResolutionLegacy',
                    href: '#',
                    subMenus: [
                        {
                            title: ('portal_create'),
                            href: '/portal/module/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/module/list',
                            icon: 'mi mi-List'
                        }
                    ]
                },
                {
                    title: 'portal_themes',
                    shortTitle: 'portal_themes',
                    icon: 'mi mi-Personalize',
                    href: '#',
                    subMenus: [
                        {
                            title: ('portal_create'),
                            href: '/portal/theme/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/theme/list',
                            icon: 'mi mi-List'
                        }
                    ]
                },
                {
                    title: 'portal_media',
                    shortTitle: 'Media',
                    icon: 'mi mi-Photo2',
                    href: '#',
                    subMenus: [
                        {
                            title: ('portal_create'),
                            href: '/portal/media/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/media/list',
                            icon: 'mi mi-List'
                        }
                    ]
                },
                {
                    title: 'portal_file',
                    shortTitle: 'File',
                    icon: 'mi mi-FileExplorer',
                    href: '#',
                    subMenus: [
                        {
                            title: ('portal_create'),
                            href: '/portal/file/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/file/list',
                            icon: 'mi mi-List'
                        }
                    ]
                },
                {
                    title: 'portal_users',
                    shortTitle: 'Users',
                    icon: 'mi mi-Contact',
                    href: '#',
                    subMenus: [
                        {
                            title: ('portal_create'),
                            href: '/portal/user/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/user/list',
                            icon: 'mi mi-List'
                        },
                        {
                            title: 'Roles',
                            href: '/portal/role/list',
                            icon: 'mi mi-Permissions'
                        }
                    ]
                },
                {
                    title: 'portal_settings',
                    shortTitle: 'Settings',
                    icon: 'mi mi-Settings mi-spin',
                    href: '#',
                    subMenus: [
                        {
                            title: 'portal_app_settings',
                            href: '/portal/app-settings/details',
                            icon: 'mi mi-ViewAll'
                        },
                        {
                            title: ('portal_create'),
                            href: '/portal/configuration/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/configuration/list',
                            icon: 'mi mi-List'
                        }
                    ]
                },
                {
                    title: 'portal_import',
                    shortTitle: 'portal_short_import',
                    icon: 'mi mi-Upload',
                    href: '/portal/import',
                    subMenus: []
                },
                {
                    title: 'language',
                    shortTitle: 'Language',
                    icon: 'mi mi-TimeLanguage',
                    href: '#',
                    subMenus: [
                        {
                            title: 'portal_create',
                            href: '/portal/language/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'List',
                            href: '/portal/language/list',
                            icon: 'mi mi-List'
                        }
                    ]
                },
                {
                    title: 'portal_cultures',
                    shortTitle: 'portal_short_cultures',
                    icon: 'mi mi-Globe mi-spin',
                    href: '#',
                    subMenus: [
                        {
                            title: ('portal_create'),
                            href: '/portal/culture/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/culture/list',
                            icon: 'mi mi-List'
                        }
                    ]
                },
                {
                    title: 'portal_permissions',
                    shortTitle: 'portal_short_portal_permissions',
                    icon: 'mi mi-LockscreenDesktop',
                    href: '#',
                    subMenus: [
                        {
                            title: ('portal_create'),
                            href: '/portal/permission/create',
                            icon: 'mi mi-Add'
                        },
                        {
                            title: 'portal_list',
                            href: '/portal/permission/list',
                            icon: 'mi mi-List'
                        }
                    ]
                }
            ];
        };
    }],
    bindings: {
    }
});
modules.component('mainSideBarDynamic', {
    templateUrl: '/app/app-portal/components/main-side-bar-dynamic/main-side-bar-dynamic.html',
    controller: ['$rootScope', '$scope', 'ngAppSettings', 'RoleService', 'TranslatorService', function ($rootScope, $scope, ngAppSettings, roleServices, translatorService) {
        var ctrl = this;
        ctrl.init = function () {
            if (ctrl.roles) {
                ctrl.role = ctrl.roles[0];
            }    
        };
    }],
    bindings: {
        roles: '=',
        activedRole: '=',
        translate: '&'
    }
});

modules.component('mainSideBarItem', {
    templateUrl: '/app/app-portal/components/main-side-bar-item/main-side-bar-item.html',
    controller: ['$rootScope', function ($rootScope) {
        var ctrl = this;
        ctrl.translate = $rootScope.translate;
    }],
    bindings: {
        item: '=',
    }
});

modules.component('mainSideBarItemDynamic', {
    templateUrl: '/app/app-portal/components/main-side-bar-item-dynamic/main-side-bar-item-dynamic.html',
    controller: ['$rootScope', function ($rootScope) {
        var ctrl = this;
        ctrl.translate = $rootScope.translate;
    }],
    bindings: {
        iconSize: '=',
        linkStyle: '=',
        itemStyle:'=',
        item: '='
    }
});
modules.component('templateEditor', {
    templateUrl: '/app/app-portal/components/template-editor/templateEditor.html',
    controller: ['$scope', '$rootScope', '$routeParams', 'ngAppSettings', 'GlobalSettingsService', 'TemplateService',
        function ($scope, $rootScope, $routeParams, ngAppSettings, globalSettingsService, service) {
            BaseCtrl.call(this, $scope, $rootScope, $routeParams, ngAppSettings, service);
            var ctrl = this;
            
            ctrl.selectTemplate = function (template) {
                ctrl.template = template;
                $scope.$broadcast('updateContentCodeEditors', []);
            };
            ctrl.init = async function(){
                if(ctrl.folderType && !ctrl.folderType){
                    var themeId = globalSettingsService.get('themeId');
                    var resp = await service.getSingle(['portal', themeId, ctrl.folderType]);
                    if (resp && resp.isSucceed) {
                        resp.data.fileName = 'new';
                        ctrl.templates.splice(0,0,resp.data);
                        $rootScope.isBusy = false;
                        $scope.$apply();
                    }
                    else {
                        if (resp) { $rootScope.showErrors(resp.errors);$rootScope.isBusy = false;$scope.$apply(); }
                    }
                    
                }
            }
        }],
    bindings: {
        template: '=',
        templates: '=',
        folderType: '='
    }
});


modules.component('urlAlias', {
    templateUrl: '/app/app-portal/components/url-alias/url-alias.html',
    controller: ['$scope', function ($scope) {
        var ctrl = this;        
    }],
    bindings: {
        urlAlias: '=',
        callback: '&'
    }
});