єН
RC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Common\Helper\CommonHelper.cs
	namespace 	
Mix
 
. 
Common 
. 
Helper 
{ 
public 

static 
class 
CommonHelper $
{ 
private 
static 
readonly 
char  $
[$ %
]% &
Base62Chars' 2
=3 4
$str L
. 
ToCharArray 
( 
) 
; 
private 
static 
readonly 
Random  &
Random' -
=. /
new0 3
Random4 :
(: ;
); <
;< =
public$$ 
static$$ 
RSAParameters$$ #
GenerateKey$$$ /
($$/ 0
)$$0 1
{%% 	
using&& 
(&& 
var&& 
key&& 
=&& 
new&&  $
RSACryptoServiceProvider&&! 9
(&&9 :
$num&&: >
)&&> ?
)&&? @
{'' 
return(( 
key(( 
.(( 
ExportParameters(( +
(((+ ,
true((, 0
)((0 1
;((1 2
})) 
}** 	
public11 
static11 
string11 
	GetBase6211 &
(11& '
int11' *
length11+ 1
)111 2
{22 	
var33 
sb33 
=33 
new33 
StringBuilder33 &
(33& '
length33' -
)33- .
;33. /
for55 
(55 
int55 
i55 
=55 
$num55 
;55 
i55 
<55 
length55  &
;55& '
i55( )
++55) +
)55+ ,
{66 
sb77 
.77 
Append77 
(77 
Base62Chars77 %
[77% &
Random77& ,
.77, -
Next77- 1
(771 2
$num772 4
)774 5
]775 6
)776 7
;777 8
}88 
return:: 
sb:: 
.:: 
ToString:: 
(:: 
)::  
;::  !
};; 	
publicBB 
staticBB 
stringBB 
GetFullPathBB (
(BB( )
stringBB) /
[BB/ 0
]BB0 1
subPathsBB2 :
)BB: ;
{CC 	
stringDD 
	strFormatDD 
=DD 
stringDD %
.DD% &
EmptyDD& +
;DD+ ,
forEE 
(EE 
intEE 
iEE 
=EE 
$numEE 
;EE 
iEE 
<EE 
subPathsEE  (
.EE( )
LengthEE) /
;EE/ 0
iEE1 2
++EE2 4
)EE4 5
{FF 
	strFormatHH 
+=HH 
$strHH !
+HH" #
iHH$ %
+HH& '
$strHH( +
+HH, -
(HH. /
iHH/ 0
<HH1 2
subPathsHH3 ;
.HH; <
LengthHH< B
-HHC D
$numHHE F
?HHG H
$strHHI L
:HHM N
stringHHO U
.HHU V
EmptyHHV [
)HH[ \
;HH\ ]
}II 
returnJJ 
stringJJ 
.JJ 
FormatJJ  
(JJ  !
	strFormatJJ! *
,JJ* +
subPathsJJ, 4
)JJ4 5
.JJ5 6
ReplaceJJ6 =
(JJ= >
$strJJ> B
,JJB C
$strJJD G
)JJG H
;JJH I
}KK 	
publicRR 
staticRR 
stringRR 
GetRandomNameRR *
(RR* +
stringRR+ 1
filenameRR2 :
)RR: ;
{SS 	
stringTT 
extTT 
=TT 
filenameTT !
.TT! "
SplitTT" '
(TT' (
$charTT( +
)TT+ ,
[TT, -
$numTT- .
]TT. /
;TT/ 0
returnUU 
stringUU 
.UU 
FormatUU  
(UU  !
$strUU! *
,UU* +
GuidUU, 0
.UU0 1
NewGuidUU1 8
(UU8 9
)UU9 :
.UU: ;
ToStringUU; C
(UUC D
$strUUD G
)UUG H
,UUH I
extUUJ M
)UUM N
;UUN O
}VV 	
public]] 
static]] 
async]] 
System]] "
.]]" #
	Threading]]# ,
.]], -
Tasks]]- 2
.]]2 3
Task]]3 7
<]]7 8
string]]8 >
>]]> ?
GetWebResponseAsync]]@ S
(]]S T
string]]T Z
url]][ ^
)]]^ _
{^^ 	
HttpWebRequest__ 

webRequest__ %
=__& '
(__( )
HttpWebRequest__) 7
)__7 8

WebRequest__8 B
.__B C
Create__C I
(__I J
url__J M
)__M N
;__N O
using`` 
(`` 
WebResponse`` 
response`` '
=``( )
await``* /

webRequest``0 :
.``: ;
GetResponseAsync``; K
(``K L
)``L M
.``M N
ConfigureAwait``N \
(``\ ]
false``] b
)``b c
)``c d
{aa 
usingbb 
(bb 
Streambb 
	resStreambb '
=bb( )
responsebb* 2
.bb2 3
GetResponseStreambb3 D
(bbD E
)bbE F
)bbF G
{cc 
StreamReaderdd  
readerdd! '
=dd( )
newdd* -
StreamReaderdd. :
(dd: ;
	resStreamdd; D
,ddD E
EncodingddF N
.ddN O
UTF8ddO S
)ddS T
;ddT U
returnee 
readeree !
.ee! "
	ReadToEndee" +
(ee+ ,
)ee, -
;ee- .
}ff 
}gg 
}hh 	
publicoo 
staticoo 
Streamoo 
	LoadImageoo &
(oo& '
stringoo' -

strImage64oo. 8
)oo8 9
{pp 	
tryss 
{tt 
stringuu 
imgDatauu 
=uu  

strImage64uu! +
.uu+ ,
	Substringuu, 5
(uu5 6

strImage64uu6 @
.uu@ A
IndexOfuuA H
(uuH I
$charuuI L
)uuL M
+uuN O
$numuuP Q
)uuQ R
;uuR S
bytevv 
[vv 
]vv 

imageBytesvv !
=vv" #
Convertvv$ +
.vv+ ,
FromBase64Stringvv, <
(vv< =
imgDatavv= D
)vvD E
;vvE F
returnww 
newww 
MemoryStreamww '
(ww' (

imageBytesww( 2
,ww2 3
$numww4 5
,ww5 6

imageBytesww7 A
.wwA B
LengthwwB H
)wwH I
;wwI J
}xx 
catchyy 
{zz 
return{{ 
null{{ 
;{{ 
}|| 
}}} 	
public
ДД 
static
ДД 
string
ДД #
ParseJsonPropertyName
ДД 2
(
ДД2 3
string
ДД3 9
input
ДД: ?
)
ДД? @
{
ЕЕ 	
if
ЖЖ 
(
ЖЖ 
!
ЖЖ 
string
ЖЖ 
.
ЖЖ 
IsNullOrEmpty
ЖЖ %
(
ЖЖ% &
input
ЖЖ& +
)
ЖЖ+ ,
)
ЖЖ, -
{
ЗЗ 
return
ИИ 
Char
ИИ 
.
ИИ 
ToLower
ИИ #
(
ИИ# $
input
ИИ$ )
[
ИИ) *
$num
ИИ* +
]
ИИ+ ,
)
ИИ, -
+
ИИ. /
input
ИИ0 5
.
ИИ5 6
	Substring
ИИ6 ?
(
ИИ? @
$num
ИИ@ A
)
ИИA B
;
ИИB C
}
ЙЙ 
else
КК 
{
ЛЛ 
return
ММ 
string
ММ 
.
ММ 
Empty
ММ #
;
ММ# $
}
НН 
}
ОО 	
public
ХХ 
static
ХХ 
string
ХХ 
ReadFromFile
ХХ )
(
ХХ) *
string
ХХ* 0
filename
ХХ1 9
)
ХХ9 :
{
ЦЦ 	
string
ЧЧ 
s
ЧЧ 
=
ЧЧ 
$str
ЧЧ 
;
ЧЧ 
try
ШШ 
{
ЩЩ 

FileStream
ЪЪ 
file
ЪЪ 
=
ЪЪ  !
new
ЪЪ" %

FileStream
ЪЪ& 0
(
ЪЪ0 1
filename
ЪЪ1 9
,
ЪЪ9 :
FileMode
ЪЪ; C
.
ЪЪC D
Open
ЪЪD H
,
ЪЪH I

FileAccess
ЪЪJ T
.
ЪЪT U
Read
ЪЪU Y
)
ЪЪY Z
;
ЪЪZ [
StreamReader
ЫЫ 
sr
ЫЫ 
=
ЫЫ  !
new
ЫЫ" %
StreamReader
ЫЫ& 2
(
ЫЫ2 3
file
ЫЫ3 7
)
ЫЫ7 8
;
ЫЫ8 9
s
ЬЬ 
=
ЬЬ 
sr
ЬЬ 
.
ЬЬ 
	ReadToEnd
ЬЬ  
(
ЬЬ  !
)
ЬЬ! "
;
ЬЬ" #
sr
ЭЭ 
.
ЭЭ 
Dispose
ЭЭ 
(
ЭЭ 
)
ЭЭ 
;
ЭЭ 
file
ЮЮ 
.
ЮЮ 
Dispose
ЮЮ 
(
ЮЮ 
)
ЮЮ 
;
ЮЮ 
}
ЯЯ 
catch
аа 
{
бб 
s
вв 
=
вв 
$str
вв 
;
вв 
}
гг 
return
дд 
s
дд 
;
дд 
}
ее 	
public
мм 
static
мм 
bool
мм 

RemoveFile
мм %
(
мм% &
string
мм& ,
filePath
мм- 5
)
мм5 6
{
нн 	
bool
оо 
result
оо 
=
оо 
false
оо 
;
оо  
if
пп 
(
пп 
File
пп 
.
пп 
Exists
пп 
(
пп 
filePath
пп $
)
пп$ %
)
пп% &
{
░░ 
File
▒▒ 
.
▒▒ 
Delete
▒▒ 
(
▒▒ 
filePath
▒▒ $
)
▒▒$ %
;
▒▒% &
result
▓▓ 
=
▓▓ 
true
▓▓ 
;
▓▓ 
}
││ 
return
┤┤ 
result
┤┤ 
;
┤┤ 
}
╡╡ 	
public
╛╛ 
static
╛╛ 
bool
╛╛ 
SaveFileBase64
╛╛ )
(
╛╛) *
string
╛╛* 0
folder
╛╛1 7
,
╛╛7 8
string
╛╛9 ?
filename
╛╛@ H
,
╛╛H I
string
╛╛J P
	strBase64
╛╛Q Z
)
╛╛Z [
{
┐┐ 	
try
┬┬ 
{
├├ 
string
── 
fullPath
── 
=
──  !
GetFullPath
──" -
(
──- .
new
──. 1
string
──2 8
[
──8 9
]
──9 :
{
┼┼ 
folder
╞╞ 
,
╞╞ 
filename
╟╟ 
}
╚╚ 
)
╚╚ 
;
╚╚ 
string
╔╔ 
fileData
╔╔ 
=
╔╔  !
	strBase64
╔╔" +
.
╔╔+ ,
	Substring
╔╔, 5
(
╔╔5 6
	strBase64
╔╔6 ?
.
╔╔? @
IndexOf
╔╔@ G
(
╔╔G H
$char
╔╔H K
)
╔╔K L
+
╔╔M N
$num
╔╔O P
)
╔╔P Q
;
╔╔Q R
byte
╩╩ 
[
╩╩ 
]
╩╩ 
bytes
╩╩ 
=
╩╩ 
Convert
╩╩ &
.
╩╩& '
FromBase64String
╩╩' 7
(
╩╩7 8
fileData
╩╩8 @
)
╩╩@ A
;
╩╩A B
if
╠╠ 
(
╠╠ 
!
╠╠ 
	Directory
╠╠ 
.
╠╠ 
Exists
╠╠ %
(
╠╠% &
folder
╠╠& ,
)
╠╠, -
)
╠╠- .
{
══ 
	Directory
╬╬ 
.
╬╬ 
CreateDirectory
╬╬ -
(
╬╬- .
folder
╬╬. 4
)
╬╬4 5
;
╬╬5 6
}
╧╧ 
if
╤╤ 
(
╤╤ 
File
╤╤ 
.
╤╤ 
Exists
╤╤ 
(
╤╤  
fullPath
╤╤  (
)
╤╤( )
)
╤╤) *
{
╥╥ 
File
╙╙ 
.
╙╙ 
Delete
╙╙ 
(
╙╙  
fullPath
╙╙  (
)
╙╙( )
;
╙╙) *
}
╘╘ 

FileStream
╓╓ 
fs
╓╓ 
=
╓╓ 
new
╓╓  #

FileStream
╓╓$ .
(
╓╓. /
fullPath
╓╓/ 7
,
╓╓7 8
FileMode
╓╓9 A
.
╓╓A B
Create
╓╓B H
)
╓╓H I
;
╓╓I J
BinaryWriter
╫╫ 
w
╫╫ 
=
╫╫  
new
╫╫! $
BinaryWriter
╫╫% 1
(
╫╫1 2
fs
╫╫2 4
)
╫╫4 5
;
╫╫5 6
try
╪╪ 
{
┘┘ 
w
┌┌ 
.
┌┌ 
Write
┌┌ 
(
┌┌ 
bytes
┌┌ !
)
┌┌! "
;
┌┌" #
}
██ 
finally
▄▄ 
{
▌▌ 
fs
▐▐ 
.
▐▐ 
Close
▐▐ 
(
▐▐ 
)
▐▐ 
;
▐▐ 
w
▀▀ 
.
▀▀ 
Close
▀▀ 
(
▀▀ 
)
▀▀ 
;
▀▀ 
}
рр 
return
сс 
true
сс 
;
сс 
}
тт 
catch
уу 
{
фф 
return
хх 
false
хх 
;
хх 
}
цц 
}
чч 	
public
яя 
static
яя 
async
яя 
System
яя "
.
яя" #
	Threading
яя# ,
.
яя, -
Tasks
яя- 2
.
яя2 3
Task
яя3 7
<
яя7 8
string
яя8 >
>
яя> ?
UploadFileAsync
яя@ O
(
яяO P
string
яяP V
fullPath
яяW _
,
яя_ `
	IFormFile
яяa j
file
яяk o
)
яяo p
{
ЁЁ 	
try
ёё 
{
ЄЄ 
if
єє 
(
єє 
!
єє 
	Directory
єє 
.
єє 
Exists
єє %
(
єє% &
fullPath
єє& .
)
єє. /
)
єє/ 0
{
ЇЇ 
	Directory
її 
.
її 
CreateDirectory
її -
(
її- .
fullPath
її. 6
)
її6 7
;
її7 8
}
ЎЎ 
if
°° 
(
°° 
file
°° 
!=
°° 
null
°°  
)
°°  !
{
∙∙ 
string
№№ 
fileName
№№ #
=
№№$ %
string
№№& ,
.
№№, -
Format
№№- 3
(
№№3 4
$str
№№4 =
,
№№= >
Guid
¤¤ 
.
¤¤ 
NewGuid
¤¤ $
(
¤¤$ %
)
¤¤% &
.
¤¤& '
ToString
¤¤' /
(
¤¤/ 0
$str
¤¤0 3
)
¤¤3 4
,
¤¤4 5
file
■■ 
.
■■ 
FileName
■■ %
.
■■% &
Split
■■& +
(
■■+ ,
$char
■■, /
)
■■/ 0
.
■■0 1
Last
■■1 5
(
■■5 6
)
■■6 7
)
■■7 8
;
■■8 9
using
   
(
   
var
   

fileStream
   )
=
  * +
new
  , /

FileStream
  0 :
(
  : ;
Path
  ; ?
.
  ? @
Combine
  @ G
(
  G H
fullPath
  H P
,
  P Q
fileName
  R Z
)
  Z [
,
  [ \
FileMode
  ] e
.
  e f
Create
  f l
,
  l m

FileAccess
  n x
.
  x y
	ReadWrite  y В
)  В Г
)  Г Д
{
АА 
await
ББ 
file
ББ "
.
ББ" #
CopyToAsync
ББ# .
(
ББ. /

fileStream
ББ/ 9
)
ББ9 :
.
ББ: ;
ConfigureAwait
ББ; I
(
ББI J
false
ББJ O
)
ББO P
;
ББP Q
return
ВВ 
fileName
ВВ '
;
ВВ' (
}
ГГ 
}
ДД 
else
ЕЕ 
{
ЖЖ 
return
ЗЗ 
string
ЗЗ !
.
ЗЗ! "
Empty
ЗЗ" '
;
ЗЗ' (
}
ИИ 
}
ЙЙ 
catch
КК 
{
ЛЛ 
return
ММ 
string
ММ 
.
ММ 
Empty
ММ #
;
ММ# $
}
НН 
}
ОО 	
public
ХХ 
static
ХХ 
void
ХХ 
WriteBytesToFile
ХХ +
(
ХХ+ ,
string
ХХ, 2
fullPath
ХХ3 ;
,
ХХ; <
string
ХХ= C
	strBase64
ХХD M
)
ХХM N
{
ЦЦ 	
string
ЧЧ 
fileData
ЧЧ 
=
ЧЧ 
	strBase64
ЧЧ '
.
ЧЧ' (
	Substring
ЧЧ( 1
(
ЧЧ1 2
	strBase64
ЧЧ2 ;
.
ЧЧ; <
IndexOf
ЧЧ< C
(
ЧЧC D
$char
ЧЧD G
)
ЧЧG H
+
ЧЧI J
$num
ЧЧK L
)
ЧЧL M
;
ЧЧM N
byte
ШШ 
[
ШШ 
]
ШШ 
bytes
ШШ 
=
ШШ 
Convert
ШШ "
.
ШШ" #
FromBase64String
ШШ# 3
(
ШШ3 4
fileData
ШШ4 <
)
ШШ< =
;
ШШ= >
if
ЩЩ 
(
ЩЩ 
File
ЩЩ 
.
ЩЩ 
Exists
ЩЩ 
(
ЩЩ 
fullPath
ЩЩ $
)
ЩЩ$ %
)
ЩЩ% &
{
ЪЪ 
File
ЫЫ 
.
ЫЫ 
Delete
ЫЫ 
(
ЫЫ 
fullPath
ЫЫ $
)
ЫЫ$ %
;
ЫЫ% &
}
ЬЬ 

FileStream
ЮЮ 
fs
ЮЮ 
=
ЮЮ 
new
ЮЮ 

FileStream
ЮЮ  *
(
ЮЮ* +
fullPath
ЮЮ+ 3
,
ЮЮ3 4
FileMode
ЮЮ5 =
.
ЮЮ= >
Create
ЮЮ> D
)
ЮЮD E
;
ЮЮE F
BinaryWriter
ЯЯ 
w
ЯЯ 
=
ЯЯ 
new
ЯЯ  
BinaryWriter
ЯЯ! -
(
ЯЯ- .
fs
ЯЯ. 0
)
ЯЯ0 1
;
ЯЯ1 2
try
аа 
{
бб 
w
вв 
.
вв 
Write
вв 
(
вв 
bytes
вв 
)
вв 
;
вв 
}
гг 
finally
дд 
{
ее 
fs
жж 
.
жж 
Close
жж 
(
жж 
)
жж 
;
жж 
w
зз 
.
зз 
Close
зз 
(
зз 
)
зз 
;
зз 
}
ии 
}
йй 	
}
кк 
}лл Щ
LC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Common\Helper\Helper.cs
	namespace 	
Mix
 
. 
UI 
. 
Base 
{		 
public 

static 
class 
	ApiHelper !
<! "
T" #
># $
{ 
public 
static 
RepositoryResponse (
<( )
T) *
>* +
	GetResult, 5
(5 6
int6 9
status: @
,@ A
TB C
dataD H
,H I
stringJ P
responseKeyQ \
,\ ]
List^ b
<b c
stringc i
>i j
errorsk q
)q r
{ 	
RepositoryResponse 
< 
T  
>  !
result" (
=) *
new+ .
RepositoryResponse/ A
<A B
TB C
>C D
(D E
)E F
{ 
Status 
= 
status 
,  
ResponseKey 
= 
responseKey )
,) *
Data 
= 
data 
, 
Errors 
= 
errors 
,  
}   
;   
return"" 
result"" 
;"" 
}## 	
}$$ 
}%% Л=
OC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Common\Helper\SEOHelper.cs
	namespace 	
Mix
 
. 
Common 
. 
Helper 
{		 
public 

static 
class 
	SeoHelper !
{ 
public 
static 
string "
DeleteSpecialCharaters 3
(3 4
string4 :
str; >
)> ?
{ 	
const 
string 
replaceChar $
=% &
$str' )
;) *
string 
[ 
] 
pattern 
= 
{  
$str! $
,$ %
$str& )
,) *
$str+ /
,/ 0
$str1 4
,4 5
$str6 9
,9 :
$str; >
}? @
;@ A
foreach 
( 
string 
item  
in! #
pattern$ +
)+ ,
{ 
str 
= 
str 
. 
Replace !
(! "
item" &
,& '
replaceChar( 3
)3 4
;4 5
} 
return 
str 
; 
} 	
public&& 
static&& 
string&& 
GetSEOString&& )
(&&) *
string&&* 0
s&&1 2
)&&2 3
{'' 	
return(( 
!(( 
string(( 
.(( 
IsNullOrEmpty(( (
(((( )
s(() *
)((* +
?((, -
WhiteSpaceToHyphen((. @
(((@ A
ConvertToUnSign((A P
(((P Q"
DeleteSpecialCharaters((Q g
(((g h
s((h i
)((i j
)((j k
)((k l
:((m n
s((o p
;((p q
})) 	
public44 
static44 
string44 
ConvertToUnSign44 ,
(44, -
string44- 3
text444 8
)448 9
{55 	
if66 
(66 
text66 
!=66 
null66 
)66 
{77 
for88 
(88 
int88 
i88 
=88 
$num88 
;88  
i88! "
<88# $
$num88% '
;88' (
i88) *
++88* ,
)88, -
{99 
text:: 
=:: 
text:: 
.::  
Replace::  '
(::' (
(::( )
(::) *
char::* .
)::. /
i::/ 0
)::0 1
.::1 2
ToString::2 :
(::: ;
)::; <
,::< =
$str::> @
)::@ A
;::A B
};; 
for== 
(== 
int== 
i== 
=== 
$num== 
;==  
i==! "
<==# $
$num==% '
;==' (
i==) *
++==* ,
)==, -
{>> 
text?? 
=?? 
text?? 
.??  
Replace??  '
(??' (
(??( )
(??) *
char??* .
)??. /
i??/ 0
)??0 1
.??1 2
ToString??2 :
(??: ;
)??; <
,??< =
$str??> @
)??@ A
;??A B
}@@ 
forBB 
(BB 
intBB 
iBB 
=BB 
$numBB 
;BB  
iBB! "
<BB# $
$numBB% '
;BB' (
iBB) *
++BB* ,
)BB, -
{CC 
textDD 
=DD 
textDD 
.DD  
ReplaceDD  '
(DD' (
(DD( )
(DD) *
charDD* .
)DD. /
iDD/ 0
)DD0 1
.DD1 2
ToStringDD2 :
(DD: ;
)DD; <
,DD< =
$strDD> @
)DD@ A
;DDA B
}EE 
forGG 
(GG 
intGG 
iGG 
=GG 
$numGG  
;GG  !
iGG" #
<GG$ %
$numGG& )
;GG) *
iGG+ ,
++GG, .
)GG. /
{HH 
textII 
=II 
textII 
.II  
ReplaceII  '
(II' (
(II( )
(II) *
charII* .
)II. /
iII/ 0
)II0 1
.II1 2
ToStringII2 :
(II: ;
)II; <
,II< =
$strII> @
)II@ A
;IIA B
}JJ 
}KK 
elseLL 
{MM 
textNN 
=NN 
$strNN 
;NN 
}OO 
SystemQQ 
.QQ 
TextQQ 
.QQ 
RegularExpressionsQQ *
.QQ* +
RegexQQ+ 0
regexQQ1 6
=QQ7 8
newQQ9 <
SystemQQ= C
.QQC D
TextQQD H
.QQH I
RegularExpressionsQQI [
.QQ[ \
RegexQQ\ a
(QQa b
$str	QQb Е
)
QQЕ Ж
;
QQЖ З
stringSS 
strFormDSS 
=SS 
textSS "
.SS" #
	NormalizeSS# ,
(SS, -
SystemSS- 3
.SS3 4
TextSS4 8
.SS8 9
NormalizationFormSS9 J
.SSJ K
FormDSSK P
)SSP Q
;SSQ R
returnUU 
regexUU 
.UU 
ReplaceUU  
(UU  !
strFormDUU! )
,UU) *
StringUU+ 1
.UU1 2
EmptyUU2 7
)UU7 8
.UU8 9
ReplaceUU9 @
(UU@ A
$charUUA I
,UUI J
$charUUK N
)UUN O
.UUO P
ReplaceUUP W
(UUW X
$charUUX `
,UU` a
$charUUb e
)UUe f
;UUf g
}VV 	
public`` 
static`` 
string`` 
WhiteSpaceToHyphen`` /
(``/ 0
string``0 6
str``7 :
)``: ;
{aa 	
charbb 
replaceCharbb 
=bb 
$charbb "
;bb" #
stringcc 
patterncc 
=cc 
$strcc "
;cc" #
MatchCollectiondd 
matchsdd "
=dd# $
Regexdd% *
.dd* +
Matchesdd+ 2
(dd2 3
strdd3 6
,dd6 7
patterndd8 ?
,dd? @
RegexOptionsddA M
.ddM N

IgnoreCaseddN X
)ddX Y
;ddY Z
foreachee 
(ee 
Matchee 
mee 
inee 
matchsee  &
)ee& '
{ff 
strgg 
=gg 
strgg 
.gg 
Replacegg !
(gg! "
mgg" #
.gg# $
Valuegg$ )
[gg) *
$numgg* +
]gg+ ,
,gg, -
replaceChargg. 9
)gg9 :
;gg: ;
}hh 
replaceCharii 
=ii 
$charii 
;ii 
patternjj 
=jj 
$strjj 
;jj 
matchskk 
=kk 
Regexkk 
.kk 
Matcheskk "
(kk" #
strkk# &
,kk& '
patternkk( /
,kk/ 0
RegexOptionskk1 =
.kk= >

IgnoreCasekk> H
)kkH I
;kkI J
foreachll 
(ll 
Matchll 
mll 
inll 
matchsll  &
)ll& '
{mm 
strnn 
=nn 
strnn 
.nn 
Replacenn !
(nn! "
mnn" #
.nn# $
Valuenn$ )
[nn) *
$numnn* +
]nn+ ,
,nn, -
replaceCharnn. 9
)nn9 :
;nn: ;
}oo 
returnpp 
strpp 
.pp 
ToLowerpp 
(pp 
)pp  
;pp  !
}qq 	
}rr 
}ss ЗT
VC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Common\Helper\UnitOfWorkHelper.cs
	namespace

 	
Mix


 
.

 
Common

 
.

 
Helper

 
{ 
public 

class 
UnitOfWorkHelper !
<! "

TDbContext" ,
>, -
where. 3

TDbContext4 >
:? @
	DbContextA J
{ 
public 
static 

TDbContext  
InitContext! ,
(, -
)- .
{ 	
Type 
	classType 
= 
typeof #
(# $

TDbContext$ .
). /
;/ 0
ConstructorInfo 
classConstructor ,
=- .
	classType/ 8
.8 9
GetConstructor9 G
(G H
newH K
TypeL P
[P Q
]Q R
{S T
}U V
)V W
;W X

TDbContext 
context 
=  
(! "

TDbContext" ,
), -
classConstructor- =
.= >
Invoke> D
(D E
newE H
objectI O
[O P
]P Q
{R S
}T U
)U V
;V W
return 
context 
; 
} 	
public 
static 
void 
HandleTransaction ,
(, -
bool- 1
	isSucceed2 ;
,; <
bool= A
isRootB H
,H I!
IDbContextTransactionJ _
transaction` k
)k l
{ 	
if 
( 
	isSucceed 
) 
{ 
if 
( 
isRoot 
) 
{ 
transaction!! 
.!!  
Commit!!  &
(!!& '
)!!' (
;!!( )
}"" 
}## 
else$$ 
{%% 
if&& 
(&& 
isRoot&& 
)&& 
{'' 
transaction)) 
.))  
Rollback))  (
())( )
)))) *
;))* +
}** 
}++ 
},, 	
public.. 
static.. 
RepositoryResponse.. (
<..( )
TResult..) 0
>..0 1
HandleException..2 A
<..A B
TResult..B I
>..I J
(..J K
	Exception..K T
ex..U W
,..W X
bool..Y ]
isRoot..^ d
,..d e!
IDbContextTransaction..f {
transaction	..| З
)
..З И
where// 
TResult// 
:// 
class// !
{00 	
if11 
(11 
isRoot11 
)11 
{22 
transaction44 
.44 
Rollback44 $
(44$ %
)44% &
;44& '
}55 
List66 
<66 
string66 
>66 
errors66 
=66  !
new66" %
List66& *
<66* +
string66+ 1
>661 2
(662 3
)663 4
;664 5
LogException77 
(77 
ex77 
)77 
;77 
errors88 
.88 
Add88 
(88 
ex88 
.88 
InnerException88 (
!=88) +
null88, 0
?881 2
ex883 5
.885 6
InnerException886 D
.88D E
Message88E L
:88M N
ex88O Q
.88Q R
Message88R Y
)88Y Z
;88Z [
return99 
new99 
RepositoryResponse99 )
<99) *
TResult99* 1
>991 2
(992 3
)993 4
{:: 
	IsSucceed;; 
=;; 
false;; !
,;;! "
Data<< 
=<< 
null<< 
,<< 
	Exception== 
=== 
(== 
ex== 
.==  
InnerException==  .
??==/ 1
ex==2 4
)==4 5
,==5 6
Errors>> 
=>> 
errors>> 
}?? 
;?? 
}@@ 	
publicBB 
staticBB 
RepositoryResponseBB (
<BB( )
TResultBB) 0
>BB0 1!
HandleObjectExceptionBB2 G
<BBG H
TResultBBH O
>BBO P
(BBP Q
	ExceptionBBQ Z
exBB[ ]
,BB] ^
boolBB_ c
isRootBBd j
,BBj k"
IDbContextTransaction	BBl Б
transaction
BBВ Н
)
BBН О
whereCC 
TResultCC 
:CC 
IConvertibleCC (
{DD 	
ifEE 
(EE 
isRootEE 
)EE 
{FF 
transactionHH 
.HH 
RollbackHH $
(HH$ %
)HH% &
;HH& '
}II 
ListJJ 
<JJ 
stringJJ 
>JJ 
errorsJJ 
=JJ  !
newJJ" %
ListJJ& *
<JJ* +
stringJJ+ 1
>JJ1 2
(JJ2 3
)JJ3 4
;JJ4 5
LogExceptionKK 
(KK 
exKK 
)KK 
;KK 
errorsLL 
.LL 
AddLL 
(LL 
exLL 
.LL 
InnerExceptionLL (
!=LL) +
nullLL, 0
?LL1 2
exLL3 5
.LL5 6
InnerExceptionLL6 D
.LLD E
MessageLLE L
:LLM N
exLLO Q
.LLQ R
MessageLLR Y
)LLY Z
;LLZ [
returnMM 
newMM 
RepositoryResponseMM )
<MM) *
TResultMM* 1
>MM1 2
(MM2 3
)MM3 4
{NN 
	IsSucceedOO 
=OO 
falseOO !
,OO! "
DataPP 
=PP 
defaultPP 
,PP 
	ExceptionQQ 
=QQ 
(QQ 
exQQ 
.QQ  
InnerExceptionQQ  .
??QQ/ 1
exQQ2 4
)QQ4 5
,QQ5 6
ErrorsRR 
=RR 
errorsRR 
}SS 
;SS 
}TT 	
publicVV 
staticVV 
voidVV 
LogExceptionVV '
(VV' (
	ExceptionVV( 1
exVV2 4
)VV4 5
{WW 	
stringXX 
fullPathXX 
=XX 
stringXX $
.XX$ %
FormatXX% +
(XX+ ,
$"XX, .
{XX. /
EnvironmentXX/ :
.XX: ;
CurrentDirectoryXX; K
}XXK L
/logsXXL Q
"XXQ R
)XXR S
;XXS T
ifYY 
(YY 
!YY 
stringYY 
.YY 
IsNullOrEmptyYY %
(YY% &
fullPathYY& .
)YY. /
&&YY0 2
!YY3 4
	DirectoryYY4 =
.YY= >
ExistsYY> D
(YYD E
fullPathYYE M
)YYM N
)YYN O
{ZZ 
	Directory[[ 
.[[ 
CreateDirectory[[ )
([[) *
fullPath[[* 2
)[[2 3
;[[3 4
}\\ 
string]] 
filePath]] 
=]] 
$"]]  
{]]  !
fullPath]]! )
}]]) *
/log_exceptions.txt]]* =
"]]= >
;]]> ?
try__ 
{`` 
FileInfoaa 
fileaa 
=aa 
newaa  #
FileInfoaa$ ,
(aa, -
filePathaa- 5
)aa5 6
;aa6 7
stringbb 
contentbb 
=bb  
$strbb! %
;bb% &
ifcc 
(cc 
filecc 
.cc 
Existscc 
)cc  
{dd 
usingee 
(ee 
StreamReaderee '
see( )
=ee* +
fileee, 0
.ee0 1
OpenTextee1 9
(ee9 :
)ee: ;
)ee; <
{ff 
contentgg 
=gg  !
sgg" #
.gg# $
	ReadToEndgg$ -
(gg- .
)gg. /
;gg/ 0
}hh 
Fileii 
.ii 
Deleteii 
(ii  
filePathii  (
)ii( )
;ii) *
}jj 
JArrayll 
arrExceptionsll $
=ll% &
JArrayll' -
.ll- .
Parsell. 3
(ll3 4
contentll4 ;
)ll; <
;ll< =
JObjectmm 
jexmm 
=mm 
newmm !
JObjectmm" )
{nn 
newoo 
	JPropertyoo !
(oo! "
$stroo" 3
,oo3 4
DateTimeoo5 =
.oo= >
UtcNowoo> D
)ooD E
,ooE F
newpp 
	JPropertypp !
(pp! "
$strpp" +
,pp+ ,
JObjectpp- 4
.pp4 5

FromObjectpp5 ?
(pp? @
expp@ B
)ppB C
)ppC D
}qq 
;qq 
arrExceptionsrr 
.rr 
Addrr !
(rr! "
jexrr" %
)rr% &
;rr& '
contentss 
=ss 
arrExceptionsss '
.ss' (
ToStringss( 0
(ss0 1
)ss1 2
;ss2 3
usinguu 
(uu 
varuu 
writeruu !
=uu" #
Fileuu$ (
.uu( )

CreateTextuu) 3
(uu3 4
filePathuu4 <
)uu< =
)uu= >
{vv 
writerww 
.ww 
	WriteLineww $
(ww$ %
contentww% ,
)ww, -
;ww- .
}xx 
}yy 
catchzz 
{{{ 
}}} 
}~~ 	
public
АА 
static
АА 
void
АА 
InitTransaction
АА *
(
АА* +

TDbContext
АА+ 5
_context
АА6 >
,
АА> ?#
IDbContextTransaction
АА@ U
_transaction
ААV b
,
ААb c
out
ААd g

TDbContext
ААh r
context
ААs z
,
ААz {
out
АА| %
IDbContextTransactionААА Х
transactionААЦ б
,ААб в
outААг ж
boolААз л
isRootААм ▓
)АА▓ │
{
ББ 	
isRoot
ВВ 
=
ВВ 
_context
ВВ 
==
ВВ  
null
ВВ! %
;
ВВ% &
context
ГГ 
=
ГГ 
_context
ГГ 
??
ГГ !
InitContext
ГГ" -
(
ГГ- .
)
ГГ. /
;
ГГ/ 0
transaction
ДД 
=
ДД 
_transaction
ДД &
??
ДД' )
context
ДД* 1
.
ДД1 2
Database
ДД2 :
.
ДД: ;
BeginTransaction
ДД; K
(
ДДK L
)
ДДL M
;
ДДM N
}
ЕЕ 	
}
ЖЖ 
}ЗЗ ┐
LC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Common\Utility\Const.cs
	namespace 	
Mix
 
. 
Common 
. 
Utility 
{ 
public 

static 
class 
Const 
{ 
public 
const 
string $
CONST_DEFAULT_CONNECTION 4
=5 6
$str7 J
;J K
public 
const 
string !
CONST_CHAT_CONNECTION 1
=2 3
$str4 D
;D E
public 
const 
string !
CONST_FILE_APPSETTING 1
=2 3
$str4 F
;F G
public 
const 
string )
CONST_PATH_HOME_ACCESS_DENIED 9
=: ;
$str< Q
;Q R
public   
const   
string   !
CONST_PATH_HOME_ERROR   1
=  2 3
$str  4 A
;  A B
public%% 
const%% 
string%% !
CONST_SECTION_LOGGING%% 1
=%%2 3
$str%%4 =
;%%= >
public** 
const** 
string** 
CONST_ROUTE_DEFAULT** /
=**0 1
$str**2 ;
;**; <
public// 
const// 
string// 
CONST_APPID// '
=//( )
$str//* ;
;//; <
public44 
const44 
string44 
CONST_APPSECRET44 +
=44, -
$str44. ?
;44? @
public99 
const99 
string99 0
$CONST_DOMAIN_NOTIFICATION_KEY_COMMIT99 @
=99A B
$str99C K
;99K L
public>> 
const>> 
string>> 6
*CONST_DOMAIN_NOTIFICATION_KEY_COMMIT_VALUE>> F
=>>G H
$str>>I t
;>>t u
publicCC 
constCC 
stringCC %
CONST_DOMAIN_NOTIFICATIONCC 5
=CC6 7
$strCC8 L
;CCL M
publicHH 
constHH 
stringHH .
"CONST_DEFAULT_EXTENSIONS_FILE_PATHHH >
=HH? @
$strHHA [
;HH[ \
publicMM 
constMM 
stringMM -
!CONST_DEFAULT_EXTENSION_FILE_NAMEMM =
=MM> ?
$strMM@ Q
;MMQ R
}NN 
}OO К
KC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Common\Utility\Enum.cs
	namespace 	
Mix
 
. 
Common 
. 
Utility 
{ 
public 

class 
Enums 
{ 
public		 
enum		 
SWStatus		 
{

 	
Deleted 
= 
$num 
, 
Preview 
= 
$num 
, 
	Published 
= 
$num 
, 
Draft 
= 
$num 
, 
Schedule 
= 
$num 
} 	
public 
enum 
ResponseKey 
{ 	
NotFound 
, 
OK 
, 

BadRequest 
} 	
} 
} ╫
XC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Domain\Core\Models\SignalRModels.cs
	namespace 	
Mix
 
. 
Domain 
. 
Core 
. 
Models  
{ 
public 

class 
SignalRClient 
{ 
public 
string 
UserId 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
NickName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public$$ 
string$$ 
ConnectionId$$ "
{$$# $
get$$% (
;$$( )
set$$* -
;$$- .
}$$/ 0
public,, 
DateTime,, 

JoinedDate,, "
{,,# $
get,,% (
;,,( )
set,,* -
;,,- .
},,/ 0
}-- 
}.. ¤
[C:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Domain\Core\Models\SupportedCulture.cs
	namespace 	
Mix
 
. 
Domain 
. 
Core 
. 
Models  
{ 
public 

class 
SupportedCulture !
{ 
[ 	
JsonProperty	 
( 
$str 
) 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
JsonProperty	 
( 
$str &
)& '
]' (
public 
string 
Specificulture $
{% &
get' *
;* +
set, /
;/ 0
}1 2
[&& 	
JsonProperty&&	 
(&& 
$str&& 
)&& 
]&& 
public'' 
string'' 
Lcid'' 
{'' 
get''  
;''  !
set''" %
;''% &
}''' (
[// 	
JsonProperty//	 
(// 
$str// 
)// 
]// 
public00 
string00 
Alias00 
{00 
get00 !
;00! "
set00# &
;00& '
}00( )
[88 	
JsonProperty88	 
(88 
$str88  
)88  !
]88! "
public99 
string99 
FullName99 
{99  
get99! $
;99$ %
set99& )
;99) *
}99+ ,
[AA 	
JsonPropertyAA	 
(AA 
$strAA #
)AA# $
]AA$ %
publicBB 
stringBB 
DescriptionBB !
{BB" #
getBB$ '
;BB' (
setBB) ,
;BB, -
}BB. /
[JJ 	
JsonPropertyJJ	 
(JJ 
$strJJ 
)JJ 
]JJ 
publicKK 
stringKK 
IconKK 
{KK 
getKK  
;KK  !
setKK" %
;KK% &
}KK' (
[SS 	
JsonPropertySS	 
(SS 
$strSS #
)SS# $
]SS$ %
publicTT 
boolTT 
IsSupportedTT 
{TT  !
getTT" %
;TT% &
setTT' *
;TT* +
}TT, -
}UU 
}VV Ї
bC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Domain\Core\Repository\DefaultRepositories.cs
	namespace 	
Mix
 
. 
Domain 
. 
Data 
. 

Repository $
{		 
public 

class 
DefaultRepository "
<" #

TDbContext# -
,- .
TModel/ 5
,5 6
TView7 <
>< =
:> ?
Mix 
. 
Domain 
. 
Data 
. 

Repository "
." #
ViewRepositoryBase# 5
<5 6

TDbContext6 @
,@ A
TModelB H
,H I
TViewJ O
>O P
where 

TDbContext 
: 
	DbContext $
where 
TModel 
: 
class 
where 
TView 
: 
Mix 
. 
Domain  
.  !
Data! %
.% &

ViewModels& 0
.0 1
ViewModelBase1 >
<> ?

TDbContext? I
,I J
TModelK Q
,Q R
TViewS X
>X Y
{ 
private 
static 
volatile 
DefaultRepository  1
<1 2

TDbContext2 <
,< =
TModel> D
,D E
TViewF K
>K L
instanceM U
;U V
private 
static 
readonly 
object  &
syncRoot' /
=0 1
new2 5
Object6 <
(< =
)= >
;> ?
private$$ 
DefaultRepository$$ !
($$! "
)$$" #
{%% 	
}&& 	
public.. 
static.. 
DefaultRepository.. '
<..' (

TDbContext..( 2
,..2 3
TModel..4 :
,..: ;
TView..< A
>..A B
Instance..C K
{..L M
get// 
{// 
if00 
(00 
instance00 
==00 
null00  $
)00$ %
{11 
lock22 
(22 
syncRoot22 "
)22" #
{33 
if44 
(44 
instance44 $
==44% '
null44( ,
)44, -
instance55 $
=55% &
new55' *
DefaultRepository55+ <
<55< =

TDbContext55= G
,55G H
TModel55I O
,55O P
TView55Q V
>55V W
(55W X
)55X Y
;55Y Z
}66 
}77 
return99 
instance99 
;99  
}:: 
};; 	
}<< 
}== ца
aC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Domain\Core\Repository\ViewRepositoryBase.cs
	namespace 	
Mix
 
. 
Domain 
. 
Data 
. 

Repository $
{ 
public 

abstract 
class 
ViewRepositoryBase ,
<, -

TDbContext- 7
,7 8
TModel9 ?
,? @
TViewA F
>F G
where 

TDbContext 
: 
	DbContext $
where 
TModel 
: 
class 
where 
TView 
: 

ViewModels  
.  !
ViewModelBase! .
<. /

TDbContext/ 9
,9 :
TModel; A
,A B
TViewC H
>H I
{ 
	protected!! 
ViewRepositoryBase!! $
(!!$ %
)!!% &
{"" 	
}$$ 	
public-- 
virtual-- 
bool-- 
CheckIsExists-- )
(--) *
TModel--* 0
entity--1 7
,--7 8

TDbContext--9 C
_context--D L
=--M N
null--O S
,--S T!
IDbContextTransaction--U j
_transaction--k w
=--x y
null--z ~
)--~ 
{.. 	
UnitOfWorkHelper// 
<// 

TDbContext// '
>//' (
.//( )
InitTransaction//) 8
(//8 9
_context//9 A
,//A B
_transaction//C O
,//O P
out//Q T

TDbContext//U _
context//` g
,//g h
out//i l"
IDbContextTransaction	//m В
transaction
//Г О
,
//О П
out
//Р У
bool
//Ф Ш
isRoot
//Щ Я
)
//Я а
;
//а б
try00 
{11 
return33 
context33 
.33 
Set33 "
<33" #
TModel33# )
>33) *
(33* +
)33+ ,
.33, -
Any33- 0
(330 1
e331 2
=>333 5
e336 7
==338 :
entity33; A
)33A B
;33B C
}77 
catch88 
(88 
	Exception88 
ex88 
)88  
{99 
LogErrorMessage:: 
(::  
ex::  "
)::" #
;::# $
if;; 
(;; 
isRoot;; 
);; 
{<< 
transaction== 
.==  
Rollback==  (
(==( )
)==) *
;==* +
}>> 
return?? 
false?? 
;?? 
}@@ 
finallyAA 
{BB 
ifCC 
(CC 
isRootCC 
)CC 
{DD 
transactionFF 
.FF  
DisposeFF  '
(FF' (
)FF( )
;FF) *
contextGG 
.GG 
DisposeGG #
(GG# $
)GG$ %
;GG% &
}HH 
}II 
}JJ 	
publicSS 
boolSS 
CheckIsExistsSS !
(SS! "
SystemSS" (
.SS( )
FuncSS) -
<SS- .
TModelSS. 4
,SS4 5
boolSS6 :
>SS: ;
	predicateSS< E
,SSE F

TDbContextSSG Q
_contextSSR Z
=SS[ \
nullSS] a
,SSa b!
IDbContextTransactionSSc x
_transaction	SSy Е
=
SSЖ З
null
SSИ М
)
SSМ Н
{TT 	
UnitOfWorkHelperUU 
<UU 

TDbContextUU '
>UU' (
.UU( )
InitTransactionUU) 8
(UU8 9
_contextUU9 A
,UUA B
_transactionUUC O
,UUO P
outUUQ T

TDbContextUUU _
contextUU` g
,UUg h
outUUi l"
IDbContextTransaction	UUm В
transaction
UUГ О
,
UUО П
out
UUР У
bool
UUФ Ш
isRoot
UUЩ Я
)
UUЯ а
;
UUа б
tryVV 
{WW 
returnYY 
contextYY 
.YY 
SetYY "
<YY" #
TModelYY# )
>YY) *
(YY* +
)YY+ ,
.YY, -
AnyYY- 0
(YY0 1
	predicateYY1 :
)YY: ;
;YY; <
}]] 
catch^^ 
(^^ 
	Exception^^ 
ex^^ 
)^^  
{__ 
LogErrorMessage`` 
(``  
ex``  "
)``" #
;``# $
ifaa 
(aa 
isRootaa 
)aa 
{bb 
transactioncc 
.cc  
Rollbackcc  (
(cc( )
)cc) *
;cc* +
}dd 
returnee 
falseee 
;ee 
}ff 
finallygg 
{hh 
ifii 
(ii 
isRootii 
)ii 
{jj 
transactionll 
.ll  
Disposell  '
(ll' (
)ll( )
;ll) *
contextmm 
.mm 
Disposemm #
(mm# $
)mm$ %
;mm% &
}nn 
}oo 
}pp 	
publicyy 
virtualyy 
RepositoryResponseyy )
<yy) *
TViewyy* /
>yy/ 0
CreateModelyy1 <
(yy< =
TViewyy= B
viewyyC G
,zz 	

TDbContextzz
 
_contextzz 
=zz 
nullzz  $
,zz$ %!
IDbContextTransactionzz& ;
_transactionzz< H
=zzI J
nullzzK O
)zzO P
{{{ 	
bool|| 
isRoot|| 
=|| 
_context|| "
==||# %
null||& *
;||* +

TDbContext}} 
context}} 
=}}  
_context}}! )
??}}* ,
InitContext}}- 8
(}}8 9
)}}9 :
;}}: ;
var~~ 
transaction~~ 
=~~ 
_transaction~~ *
??~~+ -
context~~. 5
.~~5 6
Database~~6 >
.~~> ?
BeginTransaction~~? O
(~~O P
)~~P Q
;~~Q R
RepositoryResponse 
< 
TView $
>$ %
result& ,
=- .
new/ 2
RepositoryResponse3 E
<E F
TViewF K
>K L
(L M
)M N
{O P
	IsSucceedQ Z
=[ \
true] a
}b c
;c d
try
АА 
{
ББ 
context
ВВ 
.
ВВ 
Entry
ВВ 
(
ВВ 
view
ВВ "
.
ВВ" #
Model
ВВ# (
)
ВВ( )
.
ВВ) *
State
ВВ* /
=
ВВ0 1
EntityState
ВВ2 =
.
ВВ= >
Added
ВВ> C
;
ВВC D
result
ГГ 
.
ГГ 
	IsSucceed
ГГ  
=
ГГ! "
context
ГГ# *
.
ГГ* +
SaveChanges
ГГ+ 6
(
ГГ6 7
)
ГГ7 8
>
ГГ9 :
$num
ГГ; <
;
ГГ< =
result
ДД 
.
ДД 
Data
ДД 
=
ДД 
view
ДД "
;
ДД" #
UnitOfWorkHelper
ЕЕ  
<
ЕЕ  !

TDbContext
ЕЕ! +
>
ЕЕ+ ,
.
ЕЕ, -
HandleTransaction
ЕЕ- >
(
ЕЕ> ?
result
ЕЕ? E
.
ЕЕE F
	IsSucceed
ЕЕF O
,
ЕЕO P
isRoot
ЕЕQ W
,
ЕЕW X
transaction
ЕЕY d
)
ЕЕd e
;
ЕЕe f
return
ЖЖ 
result
ЖЖ 
;
ЖЖ 
}
ЗЗ 
catch
ИИ 
(
ИИ 
	Exception
ИИ 
ex
ИИ 
)
ИИ  
{
ЙЙ 
LogErrorMessage
КК 
(
КК  
ex
КК  "
)
КК" #
;
КК# $
result
ЛЛ 
.
ЛЛ 
	IsSucceed
ЛЛ  
=
ЛЛ! "
false
ЛЛ# (
;
ЛЛ( )
result
ММ 
.
ММ 
	Exception
ММ  
=
ММ! "
ex
ММ# %
;
ММ% &
if
НН 
(
НН 
isRoot
НН 
)
НН 
{
ОО 
transaction
ПП 
.
ПП  
Rollback
ПП  (
(
ПП( )
)
ПП) *
;
ПП* +
}
РР 
return
СС 
result
СС 
;
СС 
}
ТТ 
finally
УУ 
{
ФФ 
if
ХХ 
(
ХХ 
isRoot
ХХ 
)
ХХ 
{
ЦЦ 
transaction
ШШ 
.
ШШ  
Dispose
ШШ  '
(
ШШ' (
)
ШШ( )
;
ШШ) *
context
ЩЩ 
.
ЩЩ 
Dispose
ЩЩ #
(
ЩЩ# $
)
ЩЩ$ %
;
ЩЩ% &
}
ЪЪ 
}
ЫЫ 
}
ЬЬ 	
public
ее 
virtual
ее 
async
ее 
Task
ее !
<
ее! " 
RepositoryResponse
ее" 4
<
ее4 5
TView
ее5 :
>
ее: ;
>
ее; <
CreateModelAsync
ее= M
(
ееM N
TView
ееN S
view
ееT X
,
жж 	

TDbContext
жж
 
_context
жж 
=
жж 
null
жж  $
,
жж$ %#
IDbContextTransaction
жж& ;
_transaction
жж< H
=
жжI J
null
жжK O
)
жжO P
{
зз 	
UnitOfWorkHelper
ии 
<
ии 

TDbContext
ии '
>
ии' (
.
ии( )
InitTransaction
ии) 8
(
ии8 9
_context
ии9 A
,
ииA B
_transaction
ииC O
,
ииO P
out
ииQ T

TDbContext
ииU _
context
ии` g
,
ииg h
out
ииi l$
IDbContextTransactionииm В
transactionииГ О
,ииО П
outииР У
boolииФ Ш
isRootииЩ Я
)ииЯ а
;ииа б 
RepositoryResponse
йй 
<
йй 
TView
йй $
>
йй$ %
result
йй& ,
=
йй- .
new
йй/ 2 
RepositoryResponse
йй3 E
<
ййE F
TView
ййF K
>
ййK L
(
ййL M
)
ййM N
{
ййO P
	IsSucceed
ййQ Z
=
йй[ \
true
йй] a
}
ййb c
;
ййc d
try
кк 
{
лл 
context
мм 
.
мм 
Entry
мм 
(
мм 
view
мм "
.
мм" #
Model
мм# (
)
мм( )
.
мм) *
State
мм* /
=
мм0 1
EntityState
мм2 =
.
мм= >
Added
мм> C
;
ммC D
result
нн 
.
нн 
	IsSucceed
нн  
=
нн! "
await
нн# (
context
нн) 0
.
нн0 1
SaveChangesAsync
нн1 A
(
ннA B
)
ннB C
.
ннC D
ConfigureAwait
ннD R
(
ннR S
false
ннS X
)
ннX Y
>
ннZ [
$num
нн\ ]
;
нн] ^
result
оо 
.
оо 
Data
оо 
=
оо 
view
оо "
;
оо" #
UnitOfWorkHelper
пп  
<
пп  !

TDbContext
пп! +
>
пп+ ,
.
пп, -
HandleTransaction
пп- >
(
пп> ?
result
пп? E
.
ппE F
	IsSucceed
ппF O
,
ппO P
isRoot
ппQ W
,
ппW X
transaction
ппY d
)
ппd e
;
ппe f
return
░░ 
result
░░ 
;
░░ 
}
▒▒ 
catch
▓▓ 
(
▓▓ 
	Exception
▓▓ 
ex
▓▓ 
)
▓▓  
{
││ 
return
┤┤ 
UnitOfWorkHelper
┤┤ '
<
┤┤' (

TDbContext
┤┤( 2
>
┤┤2 3
.
┤┤3 4
HandleException
┤┤4 C
<
┤┤C D
TView
┤┤D I
>
┤┤I J
(
┤┤J K
ex
┤┤K M
,
┤┤M N
isRoot
┤┤O U
,
┤┤U V
transaction
┤┤W b
)
┤┤b c
;
┤┤c d
}
╡╡ 
finally
╢╢ 
{
╖╖ 
if
╕╕ 
(
╕╕ 
isRoot
╕╕ 
)
╕╕ 
{
╣╣ 
transaction
╗╗ 
.
╗╗  
Dispose
╗╗  '
(
╗╗' (
)
╗╗( )
;
╗╗) *
context
╝╝ 
.
╝╝ 
Dispose
╝╝ #
(
╝╝# $
)
╝╝$ %
;
╝╝% &
}
╜╜ 
}
╛╛ 
}
┐┐ 	
public
╚╚ 
virtual
╚╚  
RepositoryResponse
╚╚ )
<
╚╚) *
TView
╚╚* /
>
╚╚/ 0
	EditModel
╚╚1 :
(
╚╚: ;
TView
╚╚; @
view
╚╚A E
,
╔╔ 	

TDbContext
╔╔
 
_context
╔╔ 
=
╔╔ 
null
╔╔  $
,
╔╔$ %#
IDbContextTransaction
╔╔& ;
_transaction
╔╔< H
=
╔╔I J
null
╔╔K O
)
╔╔O P
{
╩╩ 	
UnitOfWorkHelper
╦╦ 
<
╦╦ 

TDbContext
╦╦ '
>
╦╦' (
.
╦╦( )
InitTransaction
╦╦) 8
(
╦╦8 9
_context
╦╦9 A
,
╦╦A B
_transaction
╦╦C O
,
╦╦O P
out
╦╦Q T

TDbContext
╦╦U _
context
╦╦` g
,
╦╦g h
out
╦╦i l$
IDbContextTransaction╦╦m В
transaction╦╦Г О
,╦╦О П
out╦╦Р У
bool╦╦Ф Ш
isRoot╦╦Щ Я
)╦╦Я а
;╦╦а б 
RepositoryResponse
╠╠ 
<
╠╠ 
TView
╠╠ $
>
╠╠$ %
result
╠╠& ,
=
╠╠- .
new
╠╠/ 2 
RepositoryResponse
╠╠3 E
<
╠╠E F
TView
╠╠F K
>
╠╠K L
(
╠╠L M
)
╠╠M N
{
╠╠O P
	IsSucceed
╠╠Q Z
=
╠╠[ \
true
╠╠] a
}
╠╠b c
;
╠╠c d
try
══ 
{
╬╬ 
context
╨╨ 
.
╨╨ 
Set
╨╨ 
<
╨╨ 
TModel
╨╨ "
>
╨╨" #
(
╨╨# $
)
╨╨$ %
.
╨╨% &
Update
╨╨& ,
(
╨╨, -
view
╨╨- 1
.
╨╨1 2
Model
╨╨2 7
)
╨╨7 8
;
╨╨8 9
result
╤╤ 
.
╤╤ 
	IsSucceed
╤╤  
=
╤╤! "
context
╤╤# *
.
╤╤* +
SaveChanges
╤╤+ 6
(
╤╤6 7
)
╤╤7 8
>
╤╤9 :
$num
╤╤; <
;
╤╤< =
result
╥╥ 
.
╥╥ 
Data
╥╥ 
=
╥╥ 
view
╥╥ "
;
╥╥" #
UnitOfWorkHelper
╙╙  
<
╙╙  !

TDbContext
╙╙! +
>
╙╙+ ,
.
╙╙, -
HandleTransaction
╙╙- >
(
╙╙> ?
result
╙╙? E
.
╙╙E F
	IsSucceed
╙╙F O
,
╙╙O P
isRoot
╙╙Q W
,
╙╙W X
transaction
╙╙Y d
)
╙╙d e
;
╙╙e f
return
╒╒ 
result
╒╒ 
;
╒╒ 
}
╓╓ 
catch
╫╫ 
(
╫╫ 
	Exception
╫╫ 
ex
╫╫ 
)
╫╫  
{
╪╪ 
return
┘┘ 
UnitOfWorkHelper
┘┘ '
<
┘┘' (

TDbContext
┘┘( 2
>
┘┘2 3
.
┘┘3 4
HandleException
┘┘4 C
<
┘┘C D
TView
┘┘D I
>
┘┘I J
(
┘┘J K
ex
┘┘K M
,
┘┘M N
isRoot
┘┘O U
,
┘┘U V
transaction
┘┘W b
)
┘┘b c
;
┘┘c d
}
┌┌ 
finally
██ 
{
▄▄ 
if
▌▌ 
(
▌▌ 
isRoot
▌▌ 
)
▌▌ 
{
▐▐ 
transaction
рр 
.
рр  
Dispose
рр  '
(
рр' (
)
рр( )
;
рр) *
context
сс 
.
сс 
Dispose
сс #
(
сс# $
)
сс$ %
;
сс% &
}
тт 
}
уу 
}
фф 	
public
ээ 
virtual
ээ 
async
ээ 
Task
ээ !
<
ээ! " 
RepositoryResponse
ээ" 4
<
ээ4 5
TView
ээ5 :
>
ээ: ;
>
ээ; <
EditModelAsync
ээ= K
(
ээK L
TView
ээL Q
view
ээR V
,
ээV W

TDbContext
ээX b
_context
ээc k
=
ээl m
null
ээn r
,
ээr s$
IDbContextTransactionээt Й
_transactionээК Ц
=ээЧ Ш
nullээЩ Э
)ээЭ Ю
{
юю 	
UnitOfWorkHelper
яя 
<
яя 

TDbContext
яя '
>
яя' (
.
яя( )
InitTransaction
яя) 8
(
яя8 9
_context
яя9 A
,
яяA B
_transaction
яяC O
,
яяO P
out
яяQ T

TDbContext
яяU _
context
яя` g
,
яяg h
out
яяi l$
IDbContextTransactionяяm В
transactionяяГ О
,яяО П
outяяР У
boolяяФ Ш
isRootяяЩ Я
)яяЯ а
;яяа б 
RepositoryResponse
ЁЁ 
<
ЁЁ 
TView
ЁЁ $
>
ЁЁ$ %
result
ЁЁ& ,
=
ЁЁ- .
new
ЁЁ/ 2 
RepositoryResponse
ЁЁ3 E
<
ЁЁE F
TView
ЁЁF K
>
ЁЁK L
(
ЁЁL M
)
ЁЁM N
{
ЁЁO P
	IsSucceed
ЁЁQ Z
=
ЁЁ[ \
true
ЁЁ] a
}
ЁЁb c
;
ЁЁc d
try
ёё 
{
ЄЄ 
context
ЇЇ 
.
ЇЇ 
Set
ЇЇ 
<
ЇЇ 
TModel
ЇЇ "
>
ЇЇ" #
(
ЇЇ# $
)
ЇЇ$ %
.
ЇЇ% &
Update
ЇЇ& ,
(
ЇЇ, -
view
ЇЇ- 1
.
ЇЇ1 2
Model
ЇЇ2 7
)
ЇЇ7 8
;
ЇЇ8 9
result
її 
.
її 
	IsSucceed
її  
=
її! "
await
її# (
context
її) 0
.
її0 1
SaveChangesAsync
її1 A
(
їїA B
)
їїB C
.
їїC D
ConfigureAwait
їїD R
(
їїR S
false
їїS X
)
їїX Y
>
їїZ [
$num
її\ ]
;
її] ^
result
ЎЎ 
.
ЎЎ 
Data
ЎЎ 
=
ЎЎ 
view
ЎЎ "
;
ЎЎ" #
UnitOfWorkHelper
ўў  
<
ўў  !

TDbContext
ўў! +
>
ўў+ ,
.
ўў, -
HandleTransaction
ўў- >
(
ўў> ?
result
ўў? E
.
ўўE F
	IsSucceed
ўўF O
,
ўўO P
isRoot
ўўQ W
,
ўўW X
transaction
ўўY d
)
ўўd e
;
ўўe f
return
°° 
result
°° 
;
°° 
}
∙∙ 
catch
·· 
(
·· 
	Exception
·· 
ex
·· 
)
··  
{
√√ 
return
№№ 
UnitOfWorkHelper
№№ '
<
№№' (

TDbContext
№№( 2
>
№№2 3
.
№№3 4
HandleException
№№4 C
<
№№C D
TView
№№D I
>
№№I J
(
№№J K
ex
№№K M
,
№№M N
isRoot
№№O U
,
№№U V
transaction
№№W b
)
№№b c
;
№№c d
}
¤¤ 
finally
■■ 
{
   
if
АА 
(
АА 
isRoot
АА 
)
АА 
{
ББ 
context
ГГ 
.
ГГ 
Dispose
ГГ #
(
ГГ# $
)
ГГ$ %
;
ГГ% &
}
ДД 
}
ЕЕ 
}
ЖЖ 	
public
ПП 
virtual
ПП  
RepositoryResponse
ПП )
<
ПП) *
TView
ПП* /
>
ПП/ 0
GetSingleModel
ПП1 ?
(
ПП? @

Expression
РР 
<
РР 
Func
РР 
<
РР 
TModel
РР 
,
РР 
bool
РР  $
>
РР$ %
>
РР% &
	predicate
РР' 0
,
СС 	

TDbContext
СС
 
_context
СС 
=
СС 
null
СС  $
,
СС$ %#
IDbContextTransaction
СС& ;
_transaction
СС< H
=
ССI J
null
ССK O
)
ССO P
{
ТТ 	
UnitOfWorkHelper
УУ 
<
УУ 

TDbContext
УУ '
>
УУ' (
.
УУ( )
InitTransaction
УУ) 8
(
УУ8 9
_context
УУ9 A
,
УУA B
_transaction
УУC O
,
УУO P
out
УУQ T

TDbContext
УУU _
context
УУ` g
,
УУg h
out
УУi l$
IDbContextTransactionУУm В
transactionУУГ О
,УУО П
outУУР У
boolУУФ Ш
isRootУУЩ Я
)УУЯ а
;УУа б
try
ФФ 
{
ХХ 
context
ЦЦ 
=
ЦЦ 
_context
ЦЦ "
??
ЦЦ# %
InitContext
ЦЦ& 1
(
ЦЦ1 2
)
ЦЦ2 3
;
ЦЦ3 4
transaction
ЧЧ 
=
ЧЧ 
_transaction
ЧЧ *
??
ЧЧ+ -
context
ЧЧ. 5
.
ЧЧ5 6
Database
ЧЧ6 >
.
ЧЧ> ?
BeginTransaction
ЧЧ? O
(
ЧЧO P
)
ЧЧP Q
;
ЧЧQ R
TModel
ЩЩ 
model
ЩЩ 
=
ЩЩ 
context
ЩЩ &
.
ЩЩ& '
Set
ЩЩ' *
<
ЩЩ* +
TModel
ЩЩ+ 1
>
ЩЩ1 2
(
ЩЩ2 3
)
ЩЩ3 4
.
ЩЩ4 5
SingleOrDefault
ЩЩ5 D
(
ЩЩD E
	predicate
ЩЩE N
)
ЩЩN O
;
ЩЩO P
if
ЪЪ 
(
ЪЪ 
model
ЪЪ 
!=
ЪЪ 
null
ЪЪ !
)
ЪЪ! "
{
ЫЫ 
context
ЬЬ 
.
ЬЬ 
Entry
ЬЬ !
(
ЬЬ! "
model
ЬЬ" '
)
ЬЬ' (
.
ЬЬ( )
State
ЬЬ) .
=
ЬЬ/ 0
EntityState
ЬЬ1 <
.
ЬЬ< =
Detached
ЬЬ= E
;
ЬЬE F
var
ЭЭ 

viewResult
ЭЭ "
=
ЭЭ# $
	ParseView
ЭЭ% .
(
ЭЭ. /
model
ЭЭ/ 4
,
ЭЭ4 5
context
ЭЭ6 =
,
ЭЭ= >
transaction
ЭЭ? J
)
ЭЭJ K
;
ЭЭK L
return
ЮЮ 
new
ЮЮ  
RepositoryResponse
ЮЮ 1
<
ЮЮ1 2
TView
ЮЮ2 7
>
ЮЮ7 8
(
ЮЮ8 9
)
ЮЮ9 :
{
ЯЯ 
	IsSucceed
аа !
=
аа" #
true
аа$ (
,
аа( )
Data
бб 
=
бб 

viewResult
бб )
}
вв 
;
вв 
}
гг 
else
дд 
{
ее 
return
жж 
new
жж  
RepositoryResponse
жж 1
<
жж1 2
TView
жж2 7
>
жж7 8
(
жж8 9
)
жж9 :
{
зз 
	IsSucceed
ии !
=
ии" #
false
ии$ )
,
ии) *
Data
йй 
=
йй 
default
йй &
}
кк 
;
кк 
}
лл 
}
мм 
catch
нн 
(
нн 
	Exception
нн 
ex
нн 
)
нн  
{
оо 
return
пп 
UnitOfWorkHelper
пп '
<
пп' (

TDbContext
пп( 2
>
пп2 3
.
пп3 4
HandleException
пп4 C
<
ппC D
TView
ппD I
>
ппI J
(
ппJ K
ex
ппK M
,
ппM N
isRoot
ппO U
,
ппU V
transaction
ппW b
)
ппb c
;
ппc d
}
░░ 
finally
▒▒ 
{
▓▓ 
if
││ 
(
││ 
isRoot
││ 
)
││ 
{
┤┤ 
context
╢╢ 
?
╢╢ 
.
╢╢ 
Dispose
╢╢ $
(
╢╢$ %
)
╢╢% &
;
╢╢& '
}
╖╖ 
}
╕╕ 
}
╣╣ 	
public
┬┬ 
virtual
┬┬ 
async
┬┬ 
Task
┬┬ !
<
┬┬! " 
RepositoryResponse
┬┬" 4
<
┬┬4 5
TView
┬┬5 :
>
┬┬: ;
>
┬┬; <!
GetSingleModelAsync
┬┬= P
(
┬┬P Q

Expression
├├ 
<
├├ 
Func
├├ 
<
├├ 
TModel
├├ 
,
├├ 
bool
├├  $
>
├├$ %
>
├├% &
	predicate
├├' 0
,
── 	

TDbContext
──
 
_context
── 
=
── 
null
──  $
,
──$ %#
IDbContextTransaction
──& ;
_transaction
──< H
=
──I J
null
──K O
)
──O P
{
┼┼ 	
UnitOfWorkHelper
╞╞ 
<
╞╞ 

TDbContext
╞╞ '
>
╞╞' (
.
╞╞( )
InitTransaction
╞╞) 8
(
╞╞8 9
_context
╞╞9 A
,
╞╞A B
_transaction
╞╞C O
,
╞╞O P
out
╞╞Q T

TDbContext
╞╞U _
context
╞╞` g
,
╞╞g h
out
╞╞i l$
IDbContextTransaction╞╞m В
transaction╞╞Г О
,╞╞О П
out╞╞Р У
bool╞╞Ф Ш
isRoot╞╞Щ Я
)╞╞Я а
;╞╞а б
try
╟╟ 
{
╚╚ 
TModel
╔╔ 
model
╔╔ 
=
╔╔ 
await
╔╔ $
context
╔╔% ,
.
╔╔, -
Set
╔╔- 0
<
╔╔0 1
TModel
╔╔1 7
>
╔╔7 8
(
╔╔8 9
)
╔╔9 :
.
╔╔: ;"
SingleOrDefaultAsync
╔╔; O
(
╔╔O P
	predicate
╔╔P Y
)
╔╔Y Z
.
╔╔Z [
ConfigureAwait
╔╔[ i
(
╔╔i j
false
╔╔j o
)
╔╔o p
;
╔╔p q
if
╩╩ 
(
╩╩ 
model
╩╩ 
!=
╩╩ 
null
╩╩ !
)
╩╩! "
{
╦╦ 
context
╠╠ 
.
╠╠ 
Entry
╠╠ !
(
╠╠! "
model
╠╠" '
)
╠╠' (
.
╠╠( )
State
╠╠) .
=
╠╠/ 0
EntityState
╠╠1 <
.
╠╠< =
Detached
╠╠= E
;
╠╠E F
var
╬╬ 

viewResult
╬╬ "
=
╬╬# $
	ParseView
╬╬% .
(
╬╬. /
model
╬╬/ 4
,
╬╬4 5
context
╬╬6 =
,
╬╬= >
transaction
╬╬? J
)
╬╬J K
;
╬╬K L
return
╧╧ 
new
╧╧  
RepositoryResponse
╧╧ 1
<
╧╧1 2
TView
╧╧2 7
>
╧╧7 8
(
╧╧8 9
)
╧╧9 :
{
╨╨ 
	IsSucceed
╤╤ !
=
╤╤" #
true
╤╤$ (
,
╤╤( )
Data
╥╥ 
=
╥╥ 

viewResult
╥╥ )
}
╙╙ 
;
╙╙ 
}
╘╘ 
else
╒╒ 
{
╓╓ 
return
╫╫ 
new
╫╫  
RepositoryResponse
╫╫ 1
<
╫╫1 2
TView
╫╫2 7
>
╫╫7 8
(
╫╫8 9
)
╫╫9 :
{
╪╪ 
	IsSucceed
┘┘ !
=
┘┘" #
false
┘┘$ )
,
┘┘) *
Data
┌┌ 
=
┌┌ 
default
┌┌ &
}
██ 
;
██ 
}
▄▄ 
}
▌▌ 
catch
▐▐ 
(
▐▐ 
	Exception
▐▐ 
ex
▐▐ 
)
▐▐  
{
▀▀ 
return
рр 
UnitOfWorkHelper
рр '
<
рр' (

TDbContext
рр( 2
>
рр2 3
.
рр3 4
HandleException
рр4 C
<
ррC D
TView
ррD I
>
ррI J
(
ррJ K
ex
ррK M
,
ррM N
isRoot
ррO U
,
ррU V
transaction
ррW b
)
ррb c
;
ррc d
}
сс 
finally
тт 
{
уу 
if
фф 
(
фф 
isRoot
фф 
)
фф 
{
хх 
context
чч 
.
чч 
Dispose
чч #
(
чч# $
)
чч$ %
;
чч% &
}
шш 
}
щщ 
}
ъъ 	
public
ЁЁ 
virtual
ЁЁ 

TDbContext
ЁЁ !
InitContext
ЁЁ" -
(
ЁЁ- .
)
ЁЁ. /
{
ёё 	
Type
ЄЄ 
	classType
ЄЄ 
=
ЄЄ 
typeof
ЄЄ #
(
ЄЄ# $

TDbContext
ЄЄ$ .
)
ЄЄ. /
;
ЄЄ/ 0
ConstructorInfo
єє 
classConstructor
єє ,
=
єє- .
	classType
єє/ 8
.
єє8 9
GetConstructor
єє9 G
(
єєG H
new
єєH K
Type
єєL P
[
єєP Q
]
єєQ R
{
єєS T
}
єєU V
)
єєV W
;
єєW X

TDbContext
ЇЇ 
context
ЇЇ 
=
ЇЇ  
(
ЇЇ! "

TDbContext
ЇЇ" ,
)
ЇЇ, -
classConstructor
ЇЇ- =
.
ЇЇ= >
Invoke
ЇЇ> D
(
ЇЇD E
new
ЇЇE H
object
ЇЇI O
[
ЇЇO P
]
ЇЇP Q
{
ЇЇR S
}
ЇЇT U
)
ЇЇU V
;
ЇЇV W
return
ЎЎ 
context
ЎЎ 
;
ЎЎ 
}
ўў 	
public
¤¤ 
virtual
¤¤ 
void
¤¤ 
LogErrorMessage
¤¤ +
(
¤¤+ ,
	Exception
¤¤, 5
ex
¤¤6 8
)
¤¤8 9
{
■■ 	
}
   	
public
ММ 
virtual
ММ 
PaginationModel
ММ &
<
ММ& '
TView
ММ' ,
>
ММ, -
ParsePagingQuery
ММ. >
(
ММ> ?

IQueryable
ММ? I
<
ММI J
TModel
ММJ P
>
ММP Q
query
ММR W
,
НН 	
string
НН
 !
orderByPropertyName
НН $
,
НН$ %
int
НН& )
	direction
НН* 3
,
ОО 	
int
ОО
 
?
ОО 
pageSize
ОО 
,
ОО 
int
ОО 
?
ОО 
	pageIndex
ОО '
,
ПП 	

TDbContext
ПП
 
context
ПП 
,
ПП #
IDbContextTransaction
ПП 3
transaction
ПП4 ?
)
ПП? @
{
РР 	
List
СС 
<
СС 
TModel
СС 
>
СС 
lstModel
СС !
=
СС" #
new
СС$ '
List
СС( ,
<
СС, -
TModel
СС- 3
>
СС3 4
(
СС4 5
)
СС5 6
;
СС6 7
PaginationModel
УУ 
<
УУ 
TView
УУ !
>
УУ! "
result
УУ# )
=
УУ* +
new
УУ, /
PaginationModel
УУ0 ?
<
УУ? @
TView
УУ@ E
>
УУE F
(
УУF G
)
УУG H
{
ФФ 

TotalItems
ХХ 
=
ХХ 
query
ХХ "
.
ХХ" #
Count
ХХ# (
(
ХХ( )
)
ХХ) *
,
ХХ* +
	PageIndex
ЦЦ 
=
ЦЦ 
	pageIndex
ЦЦ %
??
ЦЦ& (
$num
ЦЦ) *
}
ЧЧ 
;
ЧЧ 
dynamic
ШШ 
orderBy
ШШ 
=
ШШ 
	GetLambda
ШШ '
(
ШШ' (!
orderByPropertyName
ШШ( ;
)
ШШ; <
;
ШШ< =

IQueryable
ЩЩ 
<
ЩЩ 
TModel
ЩЩ 
>
ЩЩ 
sorted
ЩЩ %
=
ЩЩ& '
null
ЩЩ( ,
;
ЩЩ, -
try
ЪЪ 
{
ЫЫ 
result
ЬЬ 
.
ЬЬ 
PageSize
ЬЬ 
=
ЬЬ  !
pageSize
ЬЬ" *
??
ЬЬ+ -
result
ЬЬ. 4
.
ЬЬ4 5

TotalItems
ЬЬ5 ?
;
ЬЬ? @
if
ЮЮ 
(
ЮЮ 
pageSize
ЮЮ 
.
ЮЮ 
HasValue
ЮЮ %
)
ЮЮ% &
{
ЯЯ 
result
аа 
.
аа 
	TotalPage
аа $
=
аа% &
(
аа' (
result
аа( .
.
аа. /

TotalItems
аа/ 9
/
аа: ;
pageSize
аа< D
.
ааD E
Value
ааE J
)
ааJ K
+
ааL M
(
ааN O
result
ааO U
.
ааU V

TotalItems
ааV `
%
ааa b
pageSize
ааc k
.
ааk l
Value
ааl q
>
ааr s
$num
ааt u
?
ааv w
$num
ааx y
:
ааz {
$num
аа| }
)
аа} ~
;
аа~ 
}
бб 
switch
гг 
(
гг 
	direction
гг !
)
гг! "
{
дд 
case
ее 
$num
ее 
:
ее 
sorted
жж 
=
жж  
	Queryable
жж! *
.
жж* +
OrderByDescending
жж+ <
(
жж< =
query
жж= B
,
жжB C
orderBy
жжD K
)
жжK L
;
жжL M
if
зз 
(
зз 
pageSize
зз $
.
зз$ %
HasValue
зз% -
)
зз- .
{
ии 
lstModel
йй $
=
йй% &
sorted
йй' -
.
йй- .
Skip
йй. 2
(
йй2 3
	pageIndex
йй3 <
.
йй< =
Value
йй= B
*
ййC D
pageSize
ййE M
.
ййM N
Value
ййN S
)
ййS T
.
кк 
Take
кк !
(
кк! "
pageSize
кк" *
.
кк* +
Value
кк+ 0
)
кк0 1
.
лл 
ToList
лл #
(
лл# $
)
лл$ %
;
лл% &
}
мм 
else
нн 
{
оо 
lstModel
пп $
=
пп% &
sorted
пп' -
.
пп- .
ToList
пп. 4
(
пп4 5
)
пп5 6
;
пп6 7
}
░░ 
break
▒▒ 
;
▒▒ 
default
││ 
:
││ 
sorted
┤┤ 
=
┤┤  
	Queryable
┤┤! *
.
┤┤* +
OrderBy
┤┤+ 2
(
┤┤2 3
query
┤┤3 8
,
┤┤8 9
orderBy
┤┤: A
)
┤┤A B
;
┤┤B C
if
╡╡ 
(
╡╡ 
pageSize
╡╡ $
.
╡╡$ %
HasValue
╡╡% -
)
╡╡- .
{
╢╢ 
lstModel
╖╖ $
=
╖╖% &
sorted
╖╖' -
.
╕╕ 
Skip
╕╕ !
(
╕╕! "
	pageIndex
╕╕" +
.
╕╕+ ,
Value
╕╕, 1
*
╕╕2 3
pageSize
╕╕4 <
.
╕╕< =
Value
╕╕= B
)
╕╕B C
.
╣╣ 
Take
╣╣ !
(
╣╣! "
pageSize
╣╣" *
.
╣╣* +
Value
╣╣+ 0
)
╣╣0 1
.
║║ 
ToList
║║ #
(
║║# $
)
║║$ %
;
║║% &
}
╗╗ 
else
╝╝ 
{
╜╜ 
lstModel
╛╛ $
=
╛╛% &
sorted
╛╛' -
.
╛╛- .
ToList
╛╛. 4
(
╛╛4 5
)
╛╛5 6
;
╛╛6 7
}
┐┐ 
break
└└ 
;
└└ 
}
┴┴ 
lstModel
┬┬ 
.
┬┬ 
ForEach
┬┬  
(
┬┬  !
model
┬┬! &
=>
┬┬' )
context
┬┬* 1
.
┬┬1 2
Entry
┬┬2 7
(
┬┬7 8
model
┬┬8 =
)
┬┬= >
.
┬┬> ?
State
┬┬? D
=
┬┬E F
EntityState
┬┬G R
.
┬┬R S
Detached
┬┬S [
)
┬┬[ \
;
┬┬\ ]
var
├├ 
lstView
├├ 
=
├├ 
	ParseView
├├ '
(
├├' (
lstModel
├├( 0
,
├├0 1
context
├├2 9
,
├├9 :
transaction
├├; F
)
├├F G
;
├├G H
result
── 
.
── 
Items
── 
=
── 
lstView
── &
;
──& '
return
┼┼ 
result
┼┼ 
;
┼┼ 
}
╞╞ 
catch
╟╟ 
(
╟╟ 
	Exception
╟╟ 
ex
╟╟ 
)
╟╟  
{
╚╚ 
LogErrorMessage
╔╔ 
(
╔╔  
ex
╔╔  "
)
╔╔" #
;
╔╔# $
return
╩╩ 
null
╩╩ 
;
╩╩ 
}
╦╦ 
}
╠╠ 	
public
┘┘ 
virtual
┘┘ 
async
┘┘ 
Task
┘┘ !
<
┘┘! "
PaginationModel
┘┘" 1
<
┘┘1 2
TView
┘┘2 7
>
┘┘7 8
>
┘┘8 9#
ParsePagingQueryAsync
┘┘: O
(
┘┘O P

IQueryable
┘┘P Z
<
┘┘Z [
TModel
┘┘[ a
>
┘┘a b
query
┘┘c h
,
┌┌ 	
string
┌┌
 !
orderByPropertyName
┌┌ $
,
┌┌$ %
int
┌┌& )
	direction
┌┌* 3
,
██ 	
int
██
 
?
██ 
pageSize
██ 
,
██ 
int
██ 
?
██ 
	pageIndex
██ '
,
▄▄ 	

TDbContext
▄▄
 
context
▄▄ 
,
▄▄ #
IDbContextTransaction
▄▄ 3
transaction
▄▄4 ?
)
▄▄? @
{
▌▌ 	
List
▐▐ 
<
▐▐ 
TModel
▐▐ 
>
▐▐ 
lstModel
▐▐ !
=
▐▐" #
new
▐▐$ '
List
▐▐( ,
<
▐▐, -
TModel
▐▐- 3
>
▐▐3 4
(
▐▐4 5
)
▐▐5 6
;
▐▐6 7
PaginationModel
рр 
<
рр 
TView
рр !
>
рр! "
result
рр# )
=
рр* +
new
рр, /
PaginationModel
рр0 ?
<
рр? @
TView
рр@ E
>
ррE F
(
ррF G
)
ррG H
{
сс 

TotalItems
тт 
=
тт 
query
тт "
.
тт" #
Count
тт# (
(
тт( )
)
тт) *
,
тт* +
	PageIndex
уу 
=
уу 
	pageIndex
уу %
??
уу& (
$num
уу) *
}
фф 
;
фф 
dynamic
хх 
orderBy
хх 
=
хх 
	GetLambda
хх '
(
хх' (!
orderByPropertyName
хх( ;
)
хх; <
;
хх< =

IQueryable
цц 
<
цц 
TModel
цц 
>
цц 
sorted
цц %
=
цц& '
null
цц( ,
;
цц, -
try
чч 
{
шш 
result
щщ 
.
щщ 
PageSize
щщ 
=
щщ  !
pageSize
щщ" *
??
щщ+ -
result
щщ. 4
.
щщ4 5

TotalItems
щщ5 ?
;
щщ? @
if
ыы 
(
ыы 
pageSize
ыы 
.
ыы 
HasValue
ыы %
)
ыы% &
{
ьь 
result
ээ 
.
ээ 
	TotalPage
ээ $
=
ээ% &
(
ээ' (
result
ээ( .
.
ээ. /

TotalItems
ээ/ 9
/
ээ: ;
pageSize
ээ< D
.
ээD E
Value
ээE J
)
ээJ K
+
ээL M
(
ээN O
result
ээO U
.
ээU V

TotalItems
ээV `
%
ээa b
pageSize
ээc k
.
ээk l
Value
ээl q
>
ээr s
$num
ээt u
?
ээv w
$num
ээx y
:
ээz {
$num
ээ| }
)
ээ} ~
;
ээ~ 
}
юю 
switch
ЁЁ 
(
ЁЁ 
	direction
ЁЁ !
)
ЁЁ! "
{
ёё 
case
ЄЄ 
$num
ЄЄ 
:
ЄЄ 
sorted
єє 
=
єє  
	Queryable
єє! *
.
єє* +
OrderByDescending
єє+ <
(
єє< =
query
єє= B
,
єєB C
orderBy
єєD K
)
єєK L
;
єєL M
if
ЇЇ 
(
ЇЇ 
pageSize
ЇЇ $
.
ЇЇ$ %
HasValue
ЇЇ% -
)
ЇЇ- .
{
її 
lstModel
ЎЎ $
=
ЎЎ% &
await
ЎЎ' ,
sorted
ЎЎ- 3
.
ЎЎ3 4
Skip
ЎЎ4 8
(
ЎЎ8 9
	pageIndex
ЎЎ9 B
.
ЎЎB C
Value
ЎЎC H
*
ЎЎI J
pageSize
ЎЎK S
.
ЎЎS T
Value
ЎЎT Y
)
ЎЎY Z
.
ўў 
Take
ўў !
(
ўў! "
pageSize
ўў" *
.
ўў* +
Value
ўў+ 0
)
ўў0 1
.
°° 
ToListAsync
°° (
(
°°( )
)
°°) *
.
°°* +
ConfigureAwait
°°+ 9
(
°°9 :
false
°°: ?
)
°°? @
;
°°@ A
}
∙∙ 
else
·· 
{
√√ 
lstModel
№№ $
=
№№% &
sorted
№№' -
.
№№- .
ToList
№№. 4
(
№№4 5
)
№№5 6
;
№№6 7
}
¤¤ 
break
■■ 
;
■■ 
default
АА 
:
АА 
sorted
ББ 
=
ББ  
	Queryable
ББ! *
.
ББ* +
OrderBy
ББ+ 2
(
ББ2 3
query
ББ3 8
,
ББ8 9
orderBy
ББ: A
)
ББA B
;
ББB C
if
ВВ 
(
ВВ 
pageSize
ВВ $
.
ВВ$ %
HasValue
ВВ% -
)
ВВ- .
{
ГГ 
lstModel
ДД $
=
ДД% &
await
ДД' ,
sorted
ДД- 3
.
ЕЕ 
Skip
ЕЕ !
(
ЕЕ! "
	pageIndex
ЕЕ" +
.
ЕЕ+ ,
Value
ЕЕ, 1
*
ЕЕ2 3
pageSize
ЕЕ4 <
.
ЕЕ< =
Value
ЕЕ= B
)
ЕЕB C
.
ЖЖ 
Take
ЖЖ !
(
ЖЖ! "
pageSize
ЖЖ" *
.
ЖЖ* +
Value
ЖЖ+ 0
)
ЖЖ0 1
.
ЗЗ 
ToListAsync
ЗЗ (
(
ЗЗ( )
)
ЗЗ) *
.
ЗЗ* +
ConfigureAwait
ЗЗ+ 9
(
ЗЗ9 :
false
ЗЗ: ?
)
ЗЗ? @
;
ЗЗ@ A
}
ИИ 
else
ЙЙ 
{
КК 
lstModel
ЛЛ $
=
ЛЛ% &
await
ЛЛ' ,
sorted
ЛЛ- 3
.
ЛЛ3 4
ToListAsync
ЛЛ4 ?
(
ЛЛ? @
)
ЛЛ@ A
.
ЛЛA B
ConfigureAwait
ЛЛB P
(
ЛЛP Q
false
ЛЛQ V
)
ЛЛV W
;
ЛЛW X
}
ММ 
break
НН 
;
НН 
}
ОО 
lstModel
ПП 
.
ПП 
ForEach
ПП  
(
ПП  !
model
ПП! &
=>
ПП' )
context
ПП* 1
.
ПП1 2
Entry
ПП2 7
(
ПП7 8
model
ПП8 =
)
ПП= >
.
ПП> ?
State
ПП? D
=
ППE F
EntityState
ППG R
.
ППR S
Detached
ППS [
)
ПП[ \
;
ПП\ ]
var
РР 
lstView
РР 
=
РР 
	ParseView
РР '
(
РР' (
lstModel
РР( 0
,
РР0 1
context
РР2 9
,
РР9 :
transaction
РР; F
)
РРF G
;
РРG H
result
СС 
.
СС 
Items
СС 
=
СС 
lstView
СС &
;
СС& '
return
ТТ 
result
ТТ 
;
ТТ 
}
УУ 
catch
ФФ 
(
ФФ 
	Exception
ФФ 
ex
ФФ 
)
ФФ  
{
ХХ 
LogErrorMessage
ЦЦ 
(
ЦЦ  
ex
ЦЦ  "
)
ЦЦ" #
;
ЦЦ# $
return
ЧЧ 
null
ЧЧ 
;
ЧЧ 
}
ШШ 
}
ЩЩ 	
public
вв 
virtual
вв 
List
вв 
<
вв 
TView
вв !
>
вв! "
	ParseView
вв# ,
(
вв, -
List
вв- 1
<
вв1 2
TModel
вв2 8
>
вв8 9
	lstModels
вв: C
,
ввC D

TDbContext
ввE O
_context
ввP X
=
ввY Z
null
вв[ _
,
вв_ `#
IDbContextTransaction
ввa v
_transactionввw Г
=ввД Е
nullввЖ К
)ввК Л
{
гг 	
List
дд 
<
дд 
TView
дд 
>
дд 
lstView
дд 
=
дд  !
new
дд" %
List
дд& *
<
дд* +
TView
дд+ 0
>
дд0 1
(
дд1 2
)
дд2 3
;
дд3 4
foreach
ее 
(
ее 
var
ее 
model
ее 
in
ее !
	lstModels
ее" +
)
ее+ ,
{
жж 
lstView
зз 
.
зз 
Add
зз 
(
зз 
	ParseView
зз %
(
зз% &
model
зз& +
,
зз+ ,
_context
зз- 5
,
зз5 6
_transaction
зз7 C
)
ззC D
)
ззD E
;
ззE F
}
ии 
return
кк 
lstView
кк 
;
кк 
}
лл 	
public
┤┤ 
virtual
┤┤ 
TView
┤┤ 
	ParseView
┤┤ &
(
┤┤& '
TModel
┤┤' -
model
┤┤. 3
,
┤┤3 4

TDbContext
┤┤5 ?
_context
┤┤@ H
=
┤┤I J
null
┤┤K O
,
┤┤O P#
IDbContextTransaction
┤┤Q f
_transaction
┤┤g s
=
┤┤t u
null
┤┤v z
)
┤┤z {
{
╡╡ 	
Type
╢╢ 
	classType
╢╢ 
=
╢╢ 
typeof
╢╢ #
(
╢╢# $
TView
╢╢$ )
)
╢╢) *
;
╢╢* +
ConstructorInfo
╖╖ 
classConstructor
╖╖ ,
=
╖╖- .
	classType
╖╖/ 8
.
╖╖8 9
GetConstructor
╖╖9 G
(
╖╖G H
new
╖╖H K
Type
╖╖L P
[
╖╖P Q
]
╖╖Q R
{
╖╖S T
model
╖╖U Z
.
╖╖Z [
GetType
╖╖[ b
(
╖╖b c
)
╖╖c d
,
╖╖d e
typeof
╖╖f l
(
╖╖l m

TDbContext
╖╖m w
)
╖╖w x
,
╖╖x y
typeof╖╖z А
(╖╖А Б%
IDbContextTransaction╖╖Б Ц
)╖╖Ц Ч
}╖╖Ш Щ
)╖╖Щ Ъ
;╖╖Ъ Ы
if
╕╕ 
(
╕╕ 
classConstructor
╕╕  
!=
╕╕! #
null
╕╕$ (
)
╕╕( )
{
╣╣ 
return
║║ 
(
║║ 
TView
║║ 
)
║║ 
classConstructor
║║ .
.
║║. /
Invoke
║║/ 5
(
║║5 6
new
║║6 9
object
║║: @
[
║║@ A
]
║║A B
{
║║C D
model
║║E J
,
║║J K
_context
║║L T
,
║║T U
_transaction
║║V b
}
║║c d
)
║║d e
;
║║e f
}
╗╗ 
else
╝╝ 
{
╜╜ 
classConstructor
╛╛  
=
╛╛! "
	classType
╛╛# ,
.
╛╛, -
GetConstructor
╛╛- ;
(
╛╛; <
new
╛╛< ?
Type
╛╛@ D
[
╛╛D E
]
╛╛E F
{
╛╛G H
model
╛╛I N
.
╛╛N O
GetType
╛╛O V
(
╛╛V W
)
╛╛W X
}
╛╛Y Z
)
╛╛Z [
;
╛╛[ \
return
┐┐ 
(
┐┐ 
TView
┐┐ 
)
┐┐ 
classConstructor
┐┐ .
.
┐┐. /
Invoke
┐┐/ 5
(
┐┐5 6
new
┐┐6 9
object
┐┐: @
[
┐┐@ A
]
┐┐A B
{
┐┐C D
model
┐┐E J
}
┐┐K L
)
┐┐L M
;
┐┐M N
}
└└ 
}
┴┴ 	
public
╞╞ 
virtual
╞╞ 
void
╞╞  
RegisterAutoMapper
╞╞ .
(
╞╞. /
)
╞╞/ 0
{
╟╟ 	
Mapper
╚╚ 
.
╚╚ 

Initialize
╚╚ 
(
╚╚ 
cfg
╚╚ !
=>
╚╚" $
{
╔╔ 
cfg
╩╩ 
.
╩╩ 
	CreateMap
╩╩ 
<
╩╩ 
TModel
╩╩ $
,
╩╩$ %
TView
╩╩& +
>
╩╩+ ,
(
╩╩, -
)
╩╩- .
;
╩╩. /
cfg
╦╦ 
.
╦╦ 
	CreateMap
╦╦ 
<
╦╦ 
TView
╦╦ #
,
╦╦# $
TModel
╦╦% +
>
╦╦+ ,
(
╦╦, -
)
╦╦- .
;
╦╦. /
}
╠╠ 
)
╠╠ 
;
╠╠ 
}
══ 	
public
╫╫ 
virtual
╫╫  
RepositoryResponse
╫╫ )
<
╫╫) *
List
╫╫* .
<
╫╫. /
TView
╫╫/ 4
>
╫╫4 5
>
╫╫5 6
GetModelList
╫╫7 C
(
╫╫C D

TDbContext
╫╫D N
_context
╫╫O W
=
╫╫X Y
null
╫╫Z ^
,
╫╫^ _#
IDbContextTransaction
╫╫` u
_transaction╫╫v В
=╫╫Г Д
null╫╫Е Й
)╫╫Й К
{
╪╪ 	
bool
┘┘ 
isRoot
┘┘ 
=
┘┘ 
_context
┘┘ "
==
┘┘# %
null
┘┘& *
;
┘┘* +
var
┌┌ 
context
┌┌ 
=
┌┌ 
_context
┌┌ "
??
┌┌# %
InitContext
┌┌& 1
(
┌┌1 2
)
┌┌2 3
;
┌┌3 4
var
██ 
transaction
██ 
=
██ 
_transaction
██ *
??
██+ -
context
██. 5
.
██5 6
Database
██6 >
.
██> ?
BeginTransaction
██? O
(
██O P
)
██P Q
;
██Q R
List
▄▄ 
<
▄▄ 
TView
▄▄ 
>
▄▄ 
result
▄▄ 
=
▄▄  
new
▄▄! $
List
▄▄% )
<
▄▄) *
TView
▄▄* /
>
▄▄/ 0
(
▄▄0 1
)
▄▄1 2
;
▄▄2 3
try
▌▌ 
{
▐▐ 
var
▀▀ 
lstModel
▀▀ 
=
▀▀ 
context
▀▀ &
.
▀▀& '
Set
▀▀' *
<
▀▀* +
TModel
▀▀+ 1
>
▀▀1 2
(
▀▀2 3
)
▀▀3 4
.
▀▀4 5
ToList
▀▀5 ;
(
▀▀; <
)
▀▀< =
;
▀▀= >
lstModel
сс 
.
сс 
ForEach
сс  
(
сс  !
model
сс! &
=>
сс' )
context
сс* 1
.
сс1 2
Entry
сс2 7
(
сс7 8
model
сс8 =
)
сс= >
.
сс> ?
State
сс? D
=
ссE F
EntityState
ссG R
.
ссR S
Detached
ссS [
)
сс[ \
;
сс\ ]
result
тт 
=
тт 
	ParseView
тт "
(
тт" #
lstModel
тт# +
,
тт+ ,
context
тт- 4
,
тт4 5
transaction
тт6 A
)
ттA B
;
ттB C
return
уу 
new
уу  
RepositoryResponse
уу -
<
уу- .
List
уу. 2
<
уу2 3
TView
уу3 8
>
уу8 9
>
уу9 :
(
уу: ;
)
уу; <
{
фф 
	IsSucceed
хх 
=
хх 
true
хх  $
,
хх$ %
Data
цц 
=
цц 
result
цц !
}
чч 
;
чч 
}
шш 
catch
щщ 
(
щщ 
	Exception
щщ 
ex
щщ 
)
щщ  
{
ъъ 
return
ыы 
UnitOfWorkHelper
ыы '
<
ыы' (

TDbContext
ыы( 2
>
ыы2 3
.
ыы3 4
HandleException
ыы4 C
<
ыыC D
List
ыыD H
<
ыыH I
TView
ыыI N
>
ыыN O
>
ыыO P
(
ыыP Q
ex
ыыQ S
,
ыыS T
isRoot
ыыU [
,
ыы[ \
transaction
ыы] h
)
ыыh i
;
ыыi j
}
ьь 
finally
ээ 
{
юю 
if
яя 
(
яя 
isRoot
яя 
)
яя 
{
ЁЁ 
context
ЄЄ 
.
ЄЄ 
Dispose
ЄЄ #
(
ЄЄ# $
)
ЄЄ$ %
;
ЄЄ% &
}
єє 
}
ЇЇ 
}
її 	
public
ББ 
virtual
ББ  
RepositoryResponse
ББ )
<
ББ) *
PaginationModel
ББ* 9
<
ББ9 :
TView
ББ: ?
>
ББ? @
>
ББ@ A
GetModelList
ББB N
(
ББN O
string
ВВ !
orderByPropertyName
ВВ "
,
ВВ" #
int
ВВ$ '
	direction
ВВ( 1
,
ВВ1 2
int
ВВ3 6
?
ВВ6 7
pageSize
ВВ8 @
,
ВВ@ A
int
ВВB E
?
ВВE F
	pageIndex
ВВG P
,
ГГ 	

TDbContext
ГГ
 
_context
ГГ 
=
ГГ 
null
ГГ  $
,
ГГ$ %#
IDbContextTransaction
ГГ& ;
_transaction
ГГ< H
=
ГГI J
null
ГГK O
)
ГГO P
{
ДД 	
bool
ЕЕ 
isRoot
ЕЕ 
=
ЕЕ 
_context
ЕЕ "
==
ЕЕ# %
null
ЕЕ& *
;
ЕЕ* +
var
ЖЖ 
context
ЖЖ 
=
ЖЖ 
_context
ЖЖ "
??
ЖЖ# %
InitContext
ЖЖ& 1
(
ЖЖ1 2
)
ЖЖ2 3
;
ЖЖ3 4
var
ЗЗ 
transaction
ЗЗ 
=
ЗЗ 
_transaction
ЗЗ *
??
ЗЗ+ -
context
ЗЗ. 5
.
ЗЗ5 6
Database
ЗЗ6 >
.
ЗЗ> ?
BeginTransaction
ЗЗ? O
(
ЗЗO P
)
ЗЗP Q
;
ЗЗQ R
try
ЙЙ 
{
КК 
var
ЛЛ 
query
ЛЛ 
=
ЛЛ 
context
ЛЛ #
.
ЛЛ# $
Set
ЛЛ$ '
<
ЛЛ' (
TModel
ЛЛ( .
>
ЛЛ. /
(
ЛЛ/ 0
)
ЛЛ0 1
;
ЛЛ1 2
var
НН 
result
НН 
=
НН 
ParsePagingQuery
НН -
(
НН- .
query
НН. 3
,
НН3 4!
orderByPropertyName
НН5 H
,
ННH I
	direction
ННJ S
,
ННS T
pageSize
ННU ]
,
НН] ^
	pageIndex
НН_ h
,
ОО 
context
ОО 
,
ОО 
transaction
ОО &
)
ОО& '
;
ОО' (
return
РР 
new
РР  
RepositoryResponse
РР -
<
РР- .
PaginationModel
РР. =
<
РР= >
TView
РР> C
>
РРC D
>
РРD E
(
РРE F
)
РРF G
{
СС 
	IsSucceed
ТТ 
=
ТТ 
true
ТТ  $
,
ТТ$ %
Data
УУ 
=
УУ 
result
УУ !
}
ФФ 
;
ФФ 
}
ХХ 
catch
ЦЦ 
(
ЦЦ 
	Exception
ЦЦ 
ex
ЦЦ 
)
ЦЦ  
{
ЧЧ 
return
ШШ 
UnitOfWorkHelper
ШШ '
<
ШШ' (

TDbContext
ШШ( 2
>
ШШ2 3
.
ШШ3 4
HandleException
ШШ4 C
<
ШШC D
PaginationModel
ШШD S
<
ШШS T
TView
ШШT Y
>
ШШY Z
>
ШШZ [
(
ШШ[ \
ex
ШШ\ ^
,
ШШ^ _
isRoot
ШШ` f
,
ШШf g
transaction
ШШh s
)
ШШs t
;
ШШt u
}
ЩЩ 
finally
ЪЪ 
{
ЫЫ 
if
ЬЬ 
(
ЬЬ 
isRoot
ЬЬ 
)
ЬЬ 
{
ЭЭ 
context
ЯЯ 
.
ЯЯ 
Dispose
ЯЯ #
(
ЯЯ# $
)
ЯЯ$ %
;
ЯЯ% &
}
аа 
}
бб 
}
вв 	
public
кк 
virtual
кк 
async
кк 
Task
кк !
<
кк! " 
RepositoryResponse
кк" 4
<
кк4 5
List
кк5 9
<
кк9 :
TView
кк: ?
>
кк? @
>
кк@ A
>
ккA B
GetModelListAsync
ккC T
(
ккT U

TDbContext
ккU _
_context
кк` h
=
ккi j
null
ккk o
,
ккo p$
IDbContextTransactionккq Ж
_transactionккЗ У
=ккФ Х
nullккЦ Ъ
)ккЪ Ы
{
лл 	
bool
мм 
isRoot
мм 
=
мм 
_context
мм "
==
мм# %
null
мм& *
;
мм* +
var
нн 
context
нн 
=
нн 
_context
нн "
??
нн# %
InitContext
нн& 1
(
нн1 2
)
нн2 3
;
нн3 4
var
оо 
transaction
оо 
=
оо 
_transaction
оо *
??
оо+ -
context
оо. 5
.
оо5 6
Database
оо6 >
.
оо> ?
BeginTransaction
оо? O
(
ооO P
)
ооP Q
;
ооQ R
List
пп 
<
пп 
TView
пп 
>
пп 
result
пп 
=
пп  
new
пп! $
List
пп% )
<
пп) *
TView
пп* /
>
пп/ 0
(
пп0 1
)
пп1 2
;
пп2 3
try
░░ 
{
▒▒ 
var
▓▓ 
lstModel
▓▓ 
=
▓▓ 
await
▓▓ $
context
▓▓% ,
.
▓▓, -
Set
▓▓- 0
<
▓▓0 1
TModel
▓▓1 7
>
▓▓7 8
(
▓▓8 9
)
▓▓9 :
.
▓▓: ;
ToListAsync
▓▓; F
(
▓▓F G
)
▓▓G H
.
▓▓H I
ConfigureAwait
▓▓I W
(
▓▓W X
false
▓▓X ]
)
▓▓] ^
;
▓▓^ _
lstModel
┤┤ 
.
┤┤ 
ForEach
┤┤  
(
┤┤  !
model
┤┤! &
=>
┤┤' )
context
┤┤* 1
.
┤┤1 2
Entry
┤┤2 7
(
┤┤7 8
model
┤┤8 =
)
┤┤= >
.
┤┤> ?
State
┤┤? D
=
┤┤E F
EntityState
┤┤G R
.
┤┤R S
Detached
┤┤S [
)
┤┤[ \
;
┤┤\ ]
result
╡╡ 
=
╡╡ 
	ParseView
╡╡ "
(
╡╡" #
lstModel
╡╡# +
,
╡╡+ ,
_context
╡╡- 5
,
╡╡5 6
_transaction
╡╡7 C
)
╡╡C D
;
╡╡D E
return
╢╢ 
new
╢╢  
RepositoryResponse
╢╢ -
<
╢╢- .
List
╢╢. 2
<
╢╢2 3
TView
╢╢3 8
>
╢╢8 9
>
╢╢9 :
(
╢╢: ;
)
╢╢; <
{
╖╖ 
	IsSucceed
╕╕ 
=
╕╕ 
true
╕╕  $
,
╕╕$ %
Data
╣╣ 
=
╣╣ 
result
╣╣ !
}
║║ 
;
║║ 
}
╗╗ 
catch
╝╝ 
(
╝╝ 
	Exception
╝╝ 
ex
╝╝ 
)
╝╝  
{
╜╜ 
return
╛╛ 
UnitOfWorkHelper
╛╛ '
<
╛╛' (

TDbContext
╛╛( 2
>
╛╛2 3
.
╛╛3 4
HandleException
╛╛4 C
<
╛╛C D
List
╛╛D H
<
╛╛H I
TView
╛╛I N
>
╛╛N O
>
╛╛O P
(
╛╛P Q
ex
╛╛Q S
,
╛╛S T
isRoot
╛╛U [
,
╛╛[ \
transaction
╛╛] h
)
╛╛h i
;
╛╛i j
}
┐┐ 
finally
└└ 
{
┴┴ 
if
┬┬ 
(
┬┬ 
isRoot
┬┬ 
)
┬┬ 
{
├├ 
context
┼┼ 
.
┼┼ 
Dispose
┼┼ #
(
┼┼# $
)
┼┼$ %
;
┼┼% &
}
╞╞ 
}
╟╟ 
}
╚╚ 	
public
╘╘ 
virtual
╘╘ 
async
╘╘ 
Task
╘╘ !
<
╘╘! " 
RepositoryResponse
╘╘" 4
<
╘╘4 5
PaginationModel
╘╘5 D
<
╘╘D E
TView
╘╘E J
>
╘╘J K
>
╘╘K L
>
╘╘L M
GetModelListAsync
╘╘N _
(
╘╘_ `
string
╒╒ !
orderByPropertyName
╒╒ "
,
╒╒" #
int
╒╒$ '
	direction
╒╒( 1
,
╒╒1 2
int
╒╒3 6
?
╒╒6 7
pageSize
╒╒8 @
,
╒╒@ A
int
╒╒B E
?
╒╒E F
	pageIndex
╒╒G P
,
╓╓ 	

TDbContext
╓╓
 
_context
╓╓ 
=
╓╓ 
null
╓╓  $
,
╓╓$ %#
IDbContextTransaction
╓╓& ;
_transaction
╓╓< H
=
╓╓I J
null
╓╓K O
)
╓╓O P
{
╫╫ 	
bool
╪╪ 
isRoot
╪╪ 
=
╪╪ 
_context
╪╪ "
==
╪╪# %
null
╪╪& *
;
╪╪* +
var
┘┘ 
context
┘┘ 
=
┘┘ 
_context
┘┘ "
??
┘┘# %
InitContext
┘┘& 1
(
┘┘1 2
)
┘┘2 3
;
┘┘3 4
var
┌┌ 
transaction
┌┌ 
=
┌┌ 
_transaction
┌┌ *
??
┌┌+ -
context
┌┌. 5
.
┌┌5 6
Database
┌┌6 >
.
┌┌> ?
BeginTransaction
┌┌? O
(
┌┌O P
)
┌┌P Q
;
┌┌Q R
try
▄▄ 
{
▌▌ 
var
▐▐ 
query
▐▐ 
=
▐▐ 
context
▐▐ #
.
▐▐# $
Set
▐▐$ '
<
▐▐' (
TModel
▐▐( .
>
▐▐. /
(
▐▐/ 0
)
▐▐0 1
;
▐▐1 2
var
рр 
result
рр 
=
рр 
await
рр "#
ParsePagingQueryAsync
рр# 8
(
рр8 9
query
рр9 >
,
рр> ?!
orderByPropertyName
рр@ S
,
ррS T
	direction
ррU ^
,
рр^ _
pageSize
рр` h
,
ррh i
	pageIndex
ррj s
,
ррs t
context
ррu |
,
рр| }
transactionрр~ Й
)ррЙ К
.ррК Л
ConfigureAwaitррЛ Щ
(ррЩ Ъ
falseррЪ Я
)ррЯ а
;рра б
return
сс 
new
сс  
RepositoryResponse
сс -
<
сс- .
PaginationModel
сс. =
<
сс= >
TView
сс> C
>
ссC D
>
ссD E
(
ссE F
)
ссF G
{
тт 
	IsSucceed
уу 
=
уу 
true
уу  $
,
уу$ %
Data
фф 
=
фф 
result
фф !
}
хх 
;
хх 
}
цц 
catch
чч 
(
чч 
	Exception
чч 
ex
чч 
)
чч  
{
шш 
return
щщ 
UnitOfWorkHelper
щщ '
<
щщ' (

TDbContext
щщ( 2
>
щщ2 3
.
щщ3 4
HandleException
щщ4 C
<
щщC D
PaginationModel
щщD S
<
щщS T
TView
щщT Y
>
щщY Z
>
щщZ [
(
щщ[ \
ex
щщ\ ^
,
щщ^ _
isRoot
щщ` f
,
щщf g
transaction
щщh s
)
щщs t
;
щщt u
}
ъъ 
finally
ыы 
{
ьь 
if
ээ 
(
ээ 
isRoot
ээ 
)
ээ 
{
юю 
context
ЁЁ 
.
ЁЁ 
Dispose
ЁЁ #
(
ЁЁ# $
)
ЁЁ$ %
;
ЁЁ% &
}
ёё 
}
ЄЄ 
}
єє 	
public
АА 
virtual
АА  
RepositoryResponse
АА )
<
АА) *
List
АА* .
<
АА. /
TView
АА/ 4
>
АА4 5
>
АА5 6
GetModelListBy
АА7 E
(
ААE F

Expression
ААF P
<
ААP Q
Func
ААQ U
<
ААU V
TModel
ААV \
,
АА\ ]
bool
АА^ b
>
ААb c
>
ААc d
	predicate
ААe n
,
ББ 	

TDbContext
ББ
 
_context
ББ 
=
ББ 
null
ББ  $
,
ББ$ %#
IDbContextTransaction
ББ& ;
_transaction
ББ< H
=
ББI J
null
ББK O
)
ББO P
{
ВВ 	
UnitOfWorkHelper
ГГ 
<
ГГ 

TDbContext
ГГ '
>
ГГ' (
.
ГГ( )
InitTransaction
ГГ) 8
(
ГГ8 9
_context
ГГ9 A
,
ГГA B
_transaction
ГГC O
,
ГГO P
out
ГГQ T

TDbContext
ГГU _
context
ГГ` g
,
ГГg h
out
ГГi l$
IDbContextTransactionГГm В
transactionГГГ О
,ГГО П
outГГР У
boolГГФ Ш
isRootГГЩ Я
)ГГЯ а
;ГГа б
try
ДД 
{
ЕЕ 
var
ЖЖ 
lstModel
ЖЖ 
=
ЖЖ 
context
ЖЖ &
.
ЖЖ& '
Set
ЖЖ' *
<
ЖЖ* +
TModel
ЖЖ+ 1
>
ЖЖ1 2
(
ЖЖ2 3
)
ЖЖ3 4
.
ЖЖ4 5
Where
ЖЖ5 :
(
ЖЖ: ;
	predicate
ЖЖ; D
)
ЖЖD E
.
ЖЖE F
ToList
ЖЖF L
(
ЖЖL M
)
ЖЖM N
;
ЖЖN O
lstModel
ЗЗ 
.
ЗЗ 
ForEach
ЗЗ  
(
ЗЗ  !
model
ЗЗ! &
=>
ЗЗ' )
context
ЗЗ* 1
.
ЗЗ1 2
Entry
ЗЗ2 7
(
ЗЗ7 8
model
ЗЗ8 =
)
ЗЗ= >
.
ЗЗ> ?
State
ЗЗ? D
=
ЗЗE F
EntityState
ЗЗG R
.
ЗЗR S
Detached
ЗЗS [
)
ЗЗ[ \
;
ЗЗ\ ]
var
ИИ 
lstViewResult
ИИ !
=
ИИ" #
	ParseView
ИИ$ -
(
ИИ- .
lstModel
ИИ. 6
,
ИИ6 7
_context
ИИ8 @
,
ИИ@ A
_transaction
ИИB N
)
ИИN O
;
ИИO P
return
ЙЙ 
new
ЙЙ  
RepositoryResponse
ЙЙ -
<
ЙЙ- .
List
ЙЙ. 2
<
ЙЙ2 3
TView
ЙЙ3 8
>
ЙЙ8 9
>
ЙЙ9 :
(
ЙЙ: ;
)
ЙЙ; <
{
КК 
	IsSucceed
ЛЛ 
=
ЛЛ 
true
ЛЛ  $
,
ЛЛ$ %
Data
ММ 
=
ММ 
lstViewResult
ММ (
}
НН 
;
НН 
}
ОО 
catch
ПП 
(
ПП 
	Exception
ПП 
ex
ПП 
)
ПП  
{
РР 
return
СС 
UnitOfWorkHelper
СС '
<
СС' (

TDbContext
СС( 2
>
СС2 3
.
СС3 4
HandleException
СС4 C
<
ССC D
List
ССD H
<
ССH I
TView
ССI N
>
ССN O
>
ССO P
(
ССP Q
ex
ССQ S
,
ССS T
isRoot
ССU [
,
СС[ \
transaction
СС] h
)
ССh i
;
ССi j
}
ТТ 
finally
УУ 
{
ФФ 
if
ХХ 
(
ХХ 
isRoot
ХХ 
)
ХХ 
{
ЦЦ 
context
ШШ 
.
ШШ 
Dispose
ШШ #
(
ШШ# $
)
ШШ$ %
;
ШШ% &
}
ЩЩ 
}
ЪЪ 
}
ЫЫ 	
public
ии 
virtual
ии  
RepositoryResponse
ии )
<
ии) *
PaginationModel
ии* 9
<
ии9 :
TView
ии: ?
>
ии? @
>
ии@ A
GetModelListBy
ииB P
(
ииP Q

Expression
йй 
<
йй 
Func
йй 
<
йй 
TModel
йй 
,
йй 
bool
йй  $
>
йй$ %
>
йй% &
	predicate
йй' 0
,
йй0 1
string
йй2 8!
orderByPropertyName
йй9 L
,
ййL M
int
ййN Q
	direction
ййR [
,
йй[ \
int
йй] `
?
йй` a
pageSize
ййb j
,
ййj k
int
ййl o
?
ййo p
	pageIndex
ййq z
,
кк 	

TDbContext
кк
 
_context
кк 
=
кк 
null
кк  $
,
кк$ %#
IDbContextTransaction
кк& ;
_transaction
кк< H
=
ккI J
null
ккK O
)
ккO P
{
лл 	
UnitOfWorkHelper
мм 
<
мм 

TDbContext
мм '
>
мм' (
.
мм( )
InitTransaction
мм) 8
(
мм8 9
_context
мм9 A
,
ммA B
_transaction
ммC O
,
ммO P
out
ммQ T

TDbContext
ммU _
context
мм` g
,
ммg h
out
ммi l$
IDbContextTransactionммm В
transactionммГ О
,ммО П
outммР У
boolммФ Ш
isRootммЩ Я
)ммЯ а
;мма б
try
нн 
{
оо 
var
пп 
query
пп 
=
пп 
context
пп #
.
пп# $
Set
пп$ '
<
пп' (
TModel
пп( .
>
пп. /
(
пп/ 0
)
пп0 1
.
пп1 2
Where
пп2 7
(
пп7 8
	predicate
пп8 A
)
ппA B
;
ппB C
var
░░ 
result
░░ 
=
░░ 
ParsePagingQuery
░░ -
(
░░- .
query
░░. 3
,
▒▒ !
orderByPropertyName
▒▒ %
,
▒▒% &
	direction
▒▒' 0
,
▓▓ 
pageSize
▓▓ 
,
▓▓ 
	pageIndex
▓▓ %
,
││ 
context
││ 
,
││ 
transaction
││ &
)
││& '
;
││' (
return
┤┤ 
new
┤┤  
RepositoryResponse
┤┤ -
<
┤┤- .
PaginationModel
┤┤. =
<
┤┤= >
TView
┤┤> C
>
┤┤C D
>
┤┤D E
(
┤┤E F
)
┤┤F G
{
╡╡ 
	IsSucceed
╢╢ 
=
╢╢ 
true
╢╢  $
,
╢╢$ %
Data
╖╖ 
=
╖╖ 
result
╖╖ !
}
╕╕ 
;
╕╕ 
}
╣╣ 
catch
║║ 
(
║║ 
	Exception
║║ 
ex
║║ 
)
║║  
{
╗╗ 
return
╝╝ 
UnitOfWorkHelper
╝╝ '
<
╝╝' (

TDbContext
╝╝( 2
>
╝╝2 3
.
╝╝3 4
HandleException
╝╝4 C
<
╝╝C D
PaginationModel
╝╝D S
<
╝╝S T
TView
╝╝T Y
>
╝╝Y Z
>
╝╝Z [
(
╝╝[ \
ex
╝╝\ ^
,
╝╝^ _
isRoot
╝╝` f
,
╝╝f g
transaction
╝╝h s
)
╝╝s t
;
╝╝t u
}
╜╜ 
finally
╛╛ 
{
┐┐ 
if
└└ 
(
└└ 
isRoot
└└ 
)
└└ 
{
┴┴ 
context
├├ 
.
├├ 
Dispose
├├ #
(
├├# $
)
├├$ %
;
├├% &
}
── 
}
┼┼ 
}
╞╞ 	
public
╧╧ 
virtual
╧╧ 
async
╧╧ 
Task
╧╧ !
<
╧╧! " 
RepositoryResponse
╧╧" 4
<
╧╧4 5
List
╧╧5 9
<
╧╧9 :
TView
╧╧: ?
>
╧╧? @
>
╧╧@ A
>
╧╧A B!
GetModelListByAsync
╧╧C V
(
╧╧V W

Expression
╧╧W a
<
╧╧a b
Func
╧╧b f
<
╧╧f g
TModel
╧╧g m
,
╧╧m n
bool
╧╧o s
>
╧╧s t
>
╧╧t u
	predicate
╧╧v 
,
╨╨ 	

TDbContext
╨╨
 
_context
╨╨ 
=
╨╨ 
null
╨╨  $
,
╨╨$ %#
IDbContextTransaction
╨╨& ;
_transaction
╨╨< H
=
╨╨I J
null
╨╨K O
)
╨╨O P
{
╤╤ 	
UnitOfWorkHelper
╥╥ 
<
╥╥ 

TDbContext
╥╥ '
>
╥╥' (
.
╥╥( )
InitTransaction
╥╥) 8
(
╥╥8 9
_context
╥╥9 A
,
╥╥A B
_transaction
╥╥C O
,
╥╥O P
out
╥╥Q T

TDbContext
╥╥U _
context
╥╥` g
,
╥╥g h
out
╥╥i l$
IDbContextTransaction╥╥m В
transaction╥╥Г О
,╥╥О П
out╥╥Р У
bool╥╥Ф Ш
isRoot╥╥Щ Я
)╥╥Я а
;╥╥а б
try
╘╘ 
{
╒╒ 
var
╓╓ 
query
╓╓ 
=
╓╓ 
context
╓╓ #
.
╓╓# $
Set
╓╓$ '
<
╓╓' (
TModel
╓╓( .
>
╓╓. /
(
╓╓/ 0
)
╓╓0 1
.
╓╓1 2
Where
╓╓2 7
(
╓╓7 8
	predicate
╓╓8 A
)
╓╓A B
;
╓╓B C
var
╫╫ 
lstModel
╫╫ 
=
╫╫ 
await
╫╫ $
query
╫╫% *
.
╫╫* +
ToListAsync
╫╫+ 6
(
╫╫6 7
)
╫╫7 8
.
╫╫8 9
ConfigureAwait
╫╫9 G
(
╫╫G H
false
╫╫H M
)
╫╫M N
;
╫╫N O
lstModel
╪╪ 
.
╪╪ 
ForEach
╪╪  
(
╪╪  !
model
╪╪! &
=>
╪╪' )
context
╪╪* 1
.
╪╪1 2
Entry
╪╪2 7
(
╪╪7 8
model
╪╪8 =
)
╪╪= >
.
╪╪> ?
State
╪╪? D
=
╪╪E F
EntityState
╪╪G R
.
╪╪R S
Detached
╪╪S [
)
╪╪[ \
;
╪╪\ ]
var
┘┘ 
result
┘┘ 
=
┘┘ 
	ParseView
┘┘ &
(
┘┘& '
lstModel
┘┘' /
,
┘┘/ 0
_context
┘┘1 9
,
┘┘9 :
_transaction
┘┘; G
)
┘┘G H
;
┘┘H I
return
┌┌ 
new
┌┌  
RepositoryResponse
┌┌ -
<
┌┌- .
List
┌┌. 2
<
┌┌2 3
TView
┌┌3 8
>
┌┌8 9
>
┌┌9 :
(
┌┌: ;
)
┌┌; <
{
██ 
	IsSucceed
▄▄ 
=
▄▄ 
true
▄▄  $
,
▄▄$ %
Data
▌▌ 
=
▌▌ 
result
▌▌ !
}
▐▐ 
;
▐▐ 
}
▀▀ 
catch
рр 
(
рр 
	Exception
рр 
ex
рр 
)
рр  
{
сс 
return
тт 
UnitOfWorkHelper
тт '
<
тт' (

TDbContext
тт( 2
>
тт2 3
.
тт3 4
HandleException
тт4 C
<
ттC D
List
ттD H
<
ттH I
TView
ттI N
>
ттN O
>
ттO P
(
ттP Q
ex
ттQ S
,
ттS T
isRoot
ттU [
,
тт[ \
transaction
тт] h
)
ттh i
;
ттi j
}
уу 
finally
фф 
{
хх 
if
цц 
(
цц 
isRoot
цц 
)
цц 
{
чч 
context
щщ 
.
щщ 
Dispose
щщ #
(
щщ# $
)
щщ$ %
;
щщ% &
}
ъъ 
}
ыы 
}
ьь 	
public
∙∙ 
virtual
∙∙ 
async
∙∙ 
Task
∙∙ !
<
∙∙! " 
RepositoryResponse
∙∙" 4
<
∙∙4 5
PaginationModel
∙∙5 D
<
∙∙D E
TView
∙∙E J
>
∙∙J K
>
∙∙K L
>
∙∙L M!
GetModelListByAsync
∙∙N a
(
∙∙a b

Expression
·· 
<
·· 
Func
·· 
<
·· 
TModel
·· 
,
·· 
bool
··  $
>
··$ %
>
··% &
	predicate
··' 0
,
··0 1
string
··2 8!
orderByPropertyName
··9 L
,
√√ 	
int
√√
 
	direction
√√ 
,
√√ 
int
√√ 
?
√√ 
pageSize
√√ &
,
√√& '
int
√√( +
?
√√+ ,
	pageIndex
√√- 6
,
№№ 	

TDbContext
№№
 
_context
№№ 
=
№№ 
null
№№  $
,
№№$ %#
IDbContextTransaction
№№& ;
_transaction
№№< H
=
№№I J
null
№№K O
)
№№O P
{
¤¤ 	
UnitOfWorkHelper
■■ 
<
■■ 

TDbContext
■■ '
>
■■' (
.
■■( )
InitTransaction
■■) 8
(
■■8 9
_context
■■9 A
,
■■A B
_transaction
■■C O
,
■■O P
out
■■Q T

TDbContext
■■U _
context
■■` g
,
■■g h
out
■■i l$
IDbContextTransaction■■m В
transaction■■Г О
,■■О П
out■■Р У
bool■■Ф Ш
isRoot■■Щ Я
)■■Я а
;■■а б
try
   
{
АА 
var
ББ 
query
ББ 
=
ББ 
context
ББ #
.
ББ# $
Set
ББ$ '
<
ББ' (
TModel
ББ( .
>
ББ. /
(
ББ/ 0
)
ББ0 1
.
ББ1 2
Where
ББ2 7
(
ББ7 8
	predicate
ББ8 A
)
ББA B
;
ББB C
var
ГГ 
result
ГГ 
=
ГГ 
await
ГГ "#
ParsePagingQueryAsync
ГГ# 8
(
ГГ8 9
query
ГГ9 >
,
ДД !
orderByPropertyName
ДД %
,
ДД% &
	direction
ДД' 0
,
ЕЕ 
pageSize
ЕЕ 
,
ЕЕ 
	pageIndex
ЕЕ %
,
ЖЖ 
context
ЖЖ 
,
ЖЖ 
transaction
ЖЖ &
)
ЖЖ& '
.
ЖЖ' (
ConfigureAwait
ЖЖ( 6
(
ЖЖ6 7
false
ЖЖ7 <
)
ЖЖ< =
;
ЖЖ= >
return
ЗЗ 
new
ЗЗ  
RepositoryResponse
ЗЗ -
<
ЗЗ- .
PaginationModel
ЗЗ. =
<
ЗЗ= >
TView
ЗЗ> C
>
ЗЗC D
>
ЗЗD E
(
ЗЗE F
)
ЗЗF G
{
ИИ 
	IsSucceed
ЙЙ 
=
ЙЙ 
true
ЙЙ  $
,
ЙЙ$ %
Data
КК 
=
КК 
result
КК !
}
ЛЛ 
;
ЛЛ 
}
ММ 
catch
НН 
(
НН 
	Exception
НН 
ex
НН 
)
НН  
{
ОО 
return
ПП 
UnitOfWorkHelper
ПП '
<
ПП' (

TDbContext
ПП( 2
>
ПП2 3
.
ПП3 4
HandleException
ПП4 C
<
ППC D
PaginationModel
ППD S
<
ППS T
TView
ППT Y
>
ППY Z
>
ППZ [
(
ПП[ \
ex
ПП\ ^
,
ПП^ _
isRoot
ПП` f
,
ППf g
transaction
ППh s
)
ППs t
;
ППt u
}
РР 
finally
СС 
{
ТТ 
if
УУ 
(
УУ 
isRoot
УУ 
)
УУ 
{
ФФ 
context
ЦЦ 
.
ЦЦ 
Dispose
ЦЦ #
(
ЦЦ# $
)
ЦЦ$ %
;
ЦЦ% &
}
ЧЧ 
}
ШШ 
}
ЩЩ 	
public
ее 
virtual
ее  
RepositoryResponse
ее )
<
ее) *
List
ее* .
<
ее. /
TModel
ее/ 5
>
ее5 6
>
ее6 7
RemoveListModel
ее8 G
(
ееG H

Expression
ееH R
<
ееR S
Func
ееS W
<
ееW X
TModel
ееX ^
,
ее^ _
bool
ее` d
>
ееd e
>
ееe f
	predicate
ееg p
,
жж 	

TDbContext
жж
 
_context
жж 
=
жж 
null
жж  $
,
жж$ %#
IDbContextTransaction
жж& ;
_transaction
жж< H
=
жжI J
null
жжK O
)
жжO P
{
зз 	
UnitOfWorkHelper
ии 
<
ии 

TDbContext
ии '
>
ии' (
.
ии( )
InitTransaction
ии) 8
(
ии8 9
_context
ии9 A
,
ииA B
_transaction
ииC O
,
ииO P
out
ииQ T

TDbContext
ииU _
context
ии` g
,
ииg h
out
ииi l$
IDbContextTransactionииm В
transactionииГ О
,ииО П
outииР У
boolииФ Ш
isRootииЩ Я
)ииЯ а
;ииа б
try
йй 
{
кк 
var
лл 
Items
лл 
=
лл 
context
лл #
.
лл# $
Set
лл$ '
<
лл' (
TModel
лл( .
>
лл. /
(
лл/ 0
)
лл0 1
.
лл1 2
Where
лл2 7
(
лл7 8
	predicate
лл8 A
)
ллA B
.
ллB C
ToList
ллC I
(
ллI J
)
ллJ K
;
ллK L
bool
мм 
result
мм 
=
мм 
true
мм "
;
мм" #
if
нн 
(
нн 
Items
нн 
!=
нн 
null
нн !
)
нн! "
{
оо 
foreach
пп 
(
пп 
var
пп  
model
пп! &
in
пп' )
Items
пп* /
)
пп/ 0
{
░░ 
if
▒▒ 
(
▒▒ 
result
▒▒ "
)
▒▒" #
{
▓▓ 
var
││ 
r
││  !
=
││" #
RemoveModel
││$ /
(
││/ 0
model
││0 5
,
││5 6
context
││7 >
,
││> ?
transaction
││@ K
)
││K L
;
││L M
result
┤┤ "
=
┤┤# $
result
┤┤% +
&&
┤┤, .
r
┤┤/ 0
.
┤┤0 1
	IsSucceed
┤┤1 :
;
┤┤: ;
}
╡╡ 
else
╢╢ 
{
╖╖ 
break
╕╕ !
;
╕╕! "
}
╣╣ 
}
║║ 
UnitOfWorkHelper
╝╝ $
<
╝╝$ %

TDbContext
╝╝% /
>
╝╝/ 0
.
╝╝0 1
HandleTransaction
╝╝1 B
(
╝╝B C
result
╝╝C I
,
╝╝I J
isRoot
╝╝K Q
,
╝╝Q R
transaction
╝╝S ^
)
╝╝^ _
;
╝╝_ `
return
╛╛ 
new
╛╛  
RepositoryResponse
╛╛ 1
<
╛╛1 2
List
╛╛2 6
<
╛╛6 7
TModel
╛╛7 =
>
╛╛= >
>
╛╛> ?
(
╛╛? @
)
╛╛@ A
{
┐┐ 
	IsSucceed
└└ !
=
└└" #
result
└└$ *
,
└└* +
Data
┴┴ 
=
┴┴ 
Items
┴┴ $
}
┬┬ 
;
┬┬ 
}
├├ 
else
── 
{
┼┼ 
return
╞╞ 
new
╞╞  
RepositoryResponse
╞╞ 1
<
╞╞1 2
List
╞╞2 6
<
╞╞6 7
TModel
╞╞7 =
>
╞╞= >
>
╞╞> ?
(
╞╞? @
)
╞╞@ A
{
╟╟ 
	IsSucceed
╚╚ !
=
╚╚" #
result
╚╚$ *
,
╚╚* +
Data
╔╔ 
=
╔╔ 
Items
╔╔ $
}
╩╩ 
;
╩╩ 
}
╦╦ 
}
╠╠ 
catch
══ 
(
══ 
	Exception
══ 
ex
══ 
)
══  
{
╬╬ 
return
╧╧ 
UnitOfWorkHelper
╧╧ '
<
╧╧' (

TDbContext
╧╧( 2
>
╧╧2 3
.
╧╧3 4
HandleException
╧╧4 C
<
╧╧C D
List
╧╧D H
<
╧╧H I
TModel
╧╧I O
>
╧╧O P
>
╧╧P Q
(
╧╧Q R
ex
╧╧R T
,
╧╧T U
isRoot
╧╧V \
,
╧╧\ ]
transaction
╧╧^ i
)
╧╧i j
;
╧╧j k
}
╨╨ 
finally
╤╤ 
{
╥╥ 
if
╙╙ 
(
╙╙ 
isRoot
╙╙ 
)
╙╙ 
{
╘╘ 
context
╓╓ 
.
╓╓ 
Dispose
╓╓ #
(
╓╓# $
)
╓╓$ %
;
╓╓% &
}
╫╫ 
}
╪╪ 
}
┘┘ 	
public
уу 
virtual
уу 
async
уу 
Task
уу !
<
уу! " 
RepositoryResponse
уу" 4
<
уу4 5
List
уу5 9
<
уу9 :
TModel
уу: @
>
уу@ A
>
ууA B
>
ууB C"
RemoveListModelAsync
ууD X
(
ууX Y

Expression
ууY c
<
ууc d
Func
ууd h
<
ууh i
TModel
ууi o
,
ууo p
bool
ууq u
>
ууu v
>
ууv w
	predicateууx Б
,
фф 	

TDbContext
фф
 
_context
фф 
=
фф 
null
фф  $
,
фф$ %#
IDbContextTransaction
фф& ;
_transaction
фф< H
=
ффI J
null
ффK O
)
ффO P
{
хх 	
UnitOfWorkHelper
цц 
<
цц 

TDbContext
цц '
>
цц' (
.
цц( )
InitTransaction
цц) 8
(
цц8 9
_context
цц9 A
,
ццA B
_transaction
ццC O
,
ццO P
out
ццQ T

TDbContext
ццU _
context
цц` g
,
ццg h
out
ццi l$
IDbContextTransactionццm В
transactionццГ О
,ццО П
outццР У
boolццФ Ш
isRootццЩ Я
)ццЯ а
;цца б
try
чч 
{
шш 
var
щщ 
Items
щщ 
=
щщ 
await
щщ !
context
щщ" )
.
щщ) *
Set
щщ* -
<
щщ- .
TModel
щщ. 4
>
щщ4 5
(
щщ5 6
)
щщ6 7
.
щщ7 8
Where
щщ8 =
(
щщ= >
	predicate
щщ> G
)
щщG H
.
щщH I
ToListAsync
щщI T
(
щщT U
)
щщU V
.
щщV W
ConfigureAwait
щщW e
(
щщe f
false
щщf k
)
щщk l
;
щщl m
bool
ъъ 
result
ъъ 
=
ъъ 
true
ъъ "
;
ъъ" #
if
ыы 
(
ыы 
Items
ыы 
!=
ыы 
null
ыы !
)
ыы! "
{
ьь 
foreach
ээ 
(
ээ 
var
ээ  
model
ээ! &
in
ээ' )
Items
ээ* /
)
ээ/ 0
{
юю 
if
яя 
(
яя 
result
яя "
)
яя" #
{
ЁЁ 
var
ёё 
r
ёё  !
=
ёё" #
await
ёё$ )
RemoveModelAsync
ёё* :
(
ёё: ;
model
ёё; @
,
ёё@ A
context
ёёB I
,
ёёI J
transaction
ёёK V
)
ёёV W
.
ёёW X
ConfigureAwait
ёёX f
(
ёёf g
false
ёёg l
)
ёёl m
;
ёёm n
result
ЄЄ "
=
ЄЄ# $
result
ЄЄ% +
&&
ЄЄ, .
r
ЄЄ/ 0
.
ЄЄ0 1
	IsSucceed
ЄЄ1 :
;
ЄЄ: ;
}
єє 
else
ЇЇ 
{
її 
break
ЎЎ !
;
ЎЎ! "
}
ўў 
}
°° 
UnitOfWorkHelper
·· $
<
··$ %

TDbContext
··% /
>
··/ 0
.
··0 1
HandleTransaction
··1 B
(
··B C
result
··C I
,
··I J
isRoot
··K Q
,
··Q R
transaction
··S ^
)
··^ _
;
··_ `
return
№№ 
new
№№  
RepositoryResponse
№№ 1
<
№№1 2
List
№№2 6
<
№№6 7
TModel
№№7 =
>
№№= >
>
№№> ?
(
№№? @
)
№№@ A
{
¤¤ 
	IsSucceed
■■ !
=
■■" #
result
■■$ *
,
■■* +
Data
   
=
   
Items
   $
}
АА 
;
АА 
}
ББ 
else
ВВ 
{
ГГ 
return
ДД 
new
ДД  
RepositoryResponse
ДД 1
<
ДД1 2
List
ДД2 6
<
ДД6 7
TModel
ДД7 =
>
ДД= >
>
ДД> ?
(
ДД? @
)
ДД@ A
{
ЕЕ 
	IsSucceed
ЖЖ !
=
ЖЖ" #
true
ЖЖ$ (
,
ЖЖ( )
Data
ЗЗ 
=
ЗЗ 
Items
ЗЗ $
}
ИИ 
;
ИИ 
}
ЙЙ 
}
КК 
catch
ЛЛ 
(
ЛЛ 
	Exception
ЛЛ 
ex
ЛЛ 
)
ЛЛ  
{
ММ 
return
НН 
UnitOfWorkHelper
НН '
<
НН' (

TDbContext
НН( 2
>
НН2 3
.
НН3 4
HandleException
НН4 C
<
ННC D
List
ННD H
<
ННH I
TModel
ННI O
>
ННO P
>
ННP Q
(
ННQ R
ex
ННR T
,
ННT U
isRoot
ННV \
,
НН\ ]
transaction
НН^ i
)
ННi j
;
ННj k
}
ОО 
finally
ПП 
{
РР 
if
СС 
(
СС 
isRoot
СС 
)
СС 
{
ТТ 
context
ФФ 
.
ФФ 
Dispose
ФФ #
(
ФФ# $
)
ФФ$ %
;
ФФ% &
}
ХХ 
}
ЦЦ 
}
ЧЧ 	
public
бб 
virtual
бб  
RepositoryResponse
бб )
<
бб) *
TModel
бб* 0
>
бб0 1
RemoveModel
бб2 =
(
бб= >

Expression
бб> H
<
ббH I
Func
ббI M
<
ббM N
TModel
ббN T
,
ббT U
bool
ббV Z
>
ббZ [
>
бб[ \
	predicate
бб] f
,
ббf g

TDbContext
ббh r
_context
ббs {
=
бб| }
nullбб~ В
,ббВ Г%
IDbContextTransactionббД Щ
_transactionббЪ ж
=ббз и
nullббй н
)ббн о
{
вв 	
UnitOfWorkHelper
гг 
<
гг 

TDbContext
гг '
>
гг' (
.
гг( )
InitTransaction
гг) 8
(
гг8 9
_context
гг9 A
,
ггA B
_transaction
ггC O
,
ггO P
out
ггQ T

TDbContext
ггU _
context
гг` g
,
ггg h
out
ггi l$
IDbContextTransactionггm В
transactionггГ О
,ггО П
outггР У
boolггФ Ш
isRootггЩ Я
)ггЯ а
;гга б
try
дд 
{
ее 
TModel
жж 
model
жж 
=
жж 
context
жж &
.
жж& '
Set
жж' *
<
жж* +
TModel
жж+ 1
>
жж1 2
(
жж2 3
)
жж3 4
.
жж4 5
FirstOrDefault
жж5 C
(
жжC D
	predicate
жжD M
)
жжM N
;
жжN O
bool
зз 
result
зз 
=
зз 
true
зз "
;
зз" #
if
ии 
(
ии 
model
ии 
!=
ии 
null
ии !
&&
ии" $
CheckIsExists
ии% 2
(
ии2 3
model
ии3 8
,
ии8 9
context
ии: A
,
ииA B
transaction
ииC N
)
ииN O
)
ииO P
{
йй 
context
кк 
.
кк 
Entry
кк !
(
кк! "
model
кк" '
)
кк' (
.
кк( )
State
кк) .
=
кк/ 0
EntityState
кк1 <
.
кк< =
Deleted
кк= D
;
ккD E
result
лл 
=
лл 
context
лл $
.
лл$ %
SaveChanges
лл% 0
(
лл0 1
)
лл1 2
>
лл3 4
$num
лл5 6
;
лл6 7
}
мм 
UnitOfWorkHelper
оо  
<
оо  !

TDbContext
оо! +
>
оо+ ,
.
оо, -
HandleTransaction
оо- >
(
оо> ?
result
оо? E
,
ооE F
isRoot
ооG M
,
ооM N
transaction
ооO Z
)
ооZ [
;
оо[ \
return
░░ 
new
░░  
RepositoryResponse
░░ -
<
░░- .
TModel
░░. 4
>
░░4 5
(
░░5 6
)
░░6 7
{
▒▒ 
	IsSucceed
▓▓ 
=
▓▓ 
result
▓▓  &
,
▓▓& '
Data
││ 
=
││ 
model
││  
}
┤┤ 
;
┤┤ 
}
╡╡ 
catch
╢╢ 
(
╢╢ 
	Exception
╢╢ 
ex
╢╢ 
)
╢╢  
{
╖╖ 
return
╕╕ 
UnitOfWorkHelper
╕╕ '
<
╕╕' (

TDbContext
╕╕( 2
>
╕╕2 3
.
╕╕3 4
HandleException
╕╕4 C
<
╕╕C D
TModel
╕╕D J
>
╕╕J K
(
╕╕K L
ex
╕╕L N
,
╕╕N O
isRoot
╕╕P V
,
╕╕V W
transaction
╕╕X c
)
╕╕c d
;
╕╕d e
}
╣╣ 
finally
║║ 
{
╗╗ 
if
╝╝ 
(
╝╝ 
isRoot
╝╝ 
)
╝╝ 
{
╜╜ 
context
┐┐ 
.
┐┐ 
Dispose
┐┐ #
(
┐┐# $
)
┐┐$ %
;
┐┐% &
}
└└ 
}
┴┴ 
}
┬┬ 	
public
╠╠ 
virtual
╠╠  
RepositoryResponse
╠╠ )
<
╠╠) *
TModel
╠╠* 0
>
╠╠0 1
RemoveModel
╠╠2 =
(
╠╠= >
TModel
╠╠> D
model
╠╠E J
,
╠╠J K

TDbContext
╠╠L V
_context
╠╠W _
=
╠╠` a
null
╠╠b f
,
╠╠f g#
IDbContextTransaction
╠╠h }
_transaction╠╠~ К
=╠╠Л М
null╠╠Н С
)╠╠С Т
{
══ 	
UnitOfWorkHelper
╬╬ 
<
╬╬ 

TDbContext
╬╬ '
>
╬╬' (
.
╬╬( )
InitTransaction
╬╬) 8
(
╬╬8 9
_context
╬╬9 A
,
╬╬A B
_transaction
╬╬C O
,
╬╬O P
out
╬╬Q T

TDbContext
╬╬U _
context
╬╬` g
,
╬╬g h
out
╬╬i l$
IDbContextTransaction╬╬m В
transaction╬╬Г О
,╬╬О П
out╬╬Р У
bool╬╬Ф Ш
isRoot╬╬Щ Я
)╬╬Я а
;╬╬а б
try
╧╧ 
{
╨╨ 
bool
╤╤ 
result
╤╤ 
=
╤╤ 
true
╤╤ "
;
╤╤" #
if
╥╥ 
(
╥╥ 
model
╥╥ 
!=
╥╥ 
null
╥╥ !
&&
╥╥" $
CheckIsExists
╥╥% 2
(
╥╥2 3
model
╥╥3 8
,
╥╥8 9
context
╥╥: A
,
╥╥A B
transaction
╥╥C N
)
╥╥N O
)
╥╥O P
{
╙╙ 
context
╘╘ 
.
╘╘ 
Entry
╘╘ !
(
╘╘! "
model
╘╘" '
)
╘╘' (
.
╘╘( )
State
╘╘) .
=
╘╘/ 0
EntityState
╘╘1 <
.
╘╘< =
Deleted
╘╘= D
;
╘╘D E
result
╒╒ 
=
╒╒ 
context
╒╒ $
.
╒╒$ %
SaveChanges
╒╒% 0
(
╒╒0 1
)
╒╒1 2
>
╒╒3 4
$num
╒╒5 6
;
╒╒6 7
}
╓╓ 
UnitOfWorkHelper
╪╪  
<
╪╪  !

TDbContext
╪╪! +
>
╪╪+ ,
.
╪╪, -
HandleTransaction
╪╪- >
(
╪╪> ?
result
╪╪? E
,
╪╪E F
isRoot
╪╪G M
,
╪╪M N
transaction
╪╪O Z
)
╪╪Z [
;
╪╪[ \
return
┌┌ 
new
┌┌  
RepositoryResponse
┌┌ -
<
┌┌- .
TModel
┌┌. 4
>
┌┌4 5
(
┌┌5 6
)
┌┌6 7
{
██ 
	IsSucceed
▄▄ 
=
▄▄ 
result
▄▄  &
,
▄▄& '
Data
▌▌ 
=
▌▌ 
model
▌▌  
}
▐▐ 
;
▐▐ 
}
▀▀ 
catch
рр 
(
рр 
	Exception
рр 
ex
рр 
)
рр  
{
сс 
return
тт 
UnitOfWorkHelper
тт '
<
тт' (

TDbContext
тт( 2
>
тт2 3
.
тт3 4
HandleException
тт4 C
<
ттC D
TModel
ттD J
>
ттJ K
(
ттK L
ex
ттL N
,
ттN O
isRoot
ттP V
,
ттV W
transaction
ттX c
)
ттc d
;
ттd e
}
уу 
finally
фф 
{
хх 
if
цц 
(
цц 
isRoot
цц 
)
цц 
{
чч 
context
щщ 
.
щщ 
Dispose
щщ #
(
щщ# $
)
щщ$ %
;
щщ% &
}
ъъ 
}
ыы 
}
ьь 	
public
ЎЎ 
virtual
ЎЎ 
async
ЎЎ 
Task
ЎЎ !
<
ЎЎ! " 
RepositoryResponse
ЎЎ" 4
<
ЎЎ4 5
TModel
ЎЎ5 ;
>
ЎЎ; <
>
ЎЎ< =
RemoveModelAsync
ЎЎ> N
(
ЎЎN O

Expression
ЎЎO Y
<
ЎЎY Z
Func
ЎЎZ ^
<
ЎЎ^ _
TModel
ЎЎ_ e
,
ЎЎe f
bool
ЎЎg k
>
ЎЎk l
>
ЎЎl m
	predicate
ЎЎn w
,
ЎЎw x

TDbContextЎЎy Г
_contextЎЎД М
=ЎЎН О
nullЎЎП У
,ЎЎУ Ф%
IDbContextTransactionЎЎХ к
_transactionЎЎл ╖
=ЎЎ╕ ╣
nullЎЎ║ ╛
)ЎЎ╛ ┐
{
ўў 	
UnitOfWorkHelper
°° 
<
°° 

TDbContext
°° '
>
°°' (
.
°°( )
InitTransaction
°°) 8
(
°°8 9
_context
°°9 A
,
°°A B
_transaction
°°C O
,
°°O P
out
°°Q T

TDbContext
°°U _
context
°°` g
,
°°g h
out
°°i l$
IDbContextTransaction°°m В
transaction°°Г О
,°°О П
out°°Р У
bool°°Ф Ш
isRoot°°Щ Я
)°°Я а
;°°а б
try
∙∙ 
{
·· 
TModel
√√ 
model
√√ 
=
√√ 
await
√√ $
context
√√% ,
.
√√, -
Set
√√- 0
<
√√0 1
TModel
√√1 7
>
√√7 8
(
√√8 9
)
√√9 :
.
√√: ;!
FirstOrDefaultAsync
√√; N
(
√√N O
	predicate
√√O X
)
√√X Y
.
√√Y Z
ConfigureAwait
√√Z h
(
√√h i
false
√√i n
)
√√n o
;
√√o p
bool
№№ 
result
№№ 
=
№№ 
true
№№ "
;
№№" #
if
¤¤ 
(
¤¤ 
model
¤¤ 
!=
¤¤ 
null
¤¤ !
&&
¤¤" $
CheckIsExists
¤¤% 2
(
¤¤2 3
model
¤¤3 8
,
¤¤8 9
context
¤¤: A
,
¤¤A B
transaction
¤¤C N
)
¤¤N O
)
¤¤O P
{
■■ 
context
   
.
   
Entry
   !
(
  ! "
model
  " '
)
  ' (
.
  ( )
State
  ) .
=
  / 0
EntityState
  1 <
.
  < =
Deleted
  = D
;
  D E
result
А	А	 
=
А	А	 
await
А	А	 "
context
А	А	# *
.
А	А	* +
SaveChangesAsync
А	А	+ ;
(
А	А	; <
)
А	А	< =
.
А	А	= >
ConfigureAwait
А	А	> L
(
А	А	L M
false
А	А	M R
)
А	А	R S
>
А	А	T U
$num
А	А	V W
;
А	А	W X
}
Б	Б	 
UnitOfWorkHelper
Г	Г	  
<
Г	Г	  !

TDbContext
Г	Г	! +
>
Г	Г	+ ,
.
Г	Г	, -
HandleTransaction
Г	Г	- >
(
Г	Г	> ?
result
Г	Г	? E
,
Г	Г	E F
isRoot
Г	Г	G M
,
Г	Г	M N
transaction
Г	Г	O Z
)
Г	Г	Z [
;
Г	Г	[ \
return
Е	Е	 
new
Е	Е	  
RepositoryResponse
Е	Е	 -
<
Е	Е	- .
TModel
Е	Е	. 4
>
Е	Е	4 5
(
Е	Е	5 6
)
Е	Е	6 7
{
Ж	Ж	 
	IsSucceed
З	З	 
=
З	З	 
result
З	З	  &
,
З	З	& '
Data
И	И	 
=
И	И	 
model
И	И	  
}
Й	Й	 
;
Й	Й	 
}
К	К	 
catch
Л	Л	 
(
Л	Л	 
	Exception
Л	Л	 
ex
Л	Л	 
)
Л	Л	  
{
М	М	 
return
Н	Н	 
UnitOfWorkHelper
Н	Н	 '
<
Н	Н	' (

TDbContext
Н	Н	( 2
>
Н	Н	2 3
.
Н	Н	3 4
HandleException
Н	Н	4 C
<
Н	Н	C D
TModel
Н	Н	D J
>
Н	Н	J K
(
Н	Н	K L
ex
Н	Н	L N
,
Н	Н	N O
isRoot
Н	Н	P V
,
Н	Н	V W
transaction
Н	Н	X c
)
Н	Н	c d
;
Н	Н	d e
}
О	О	 
finally
П	П	 
{
Р	Р	 
if
С	С	 
(
С	С	 
isRoot
С	С	 
)
С	С	 
{
Т	Т	 
context
Ф	Ф	 
.
Ф	Ф	 
Dispose
Ф	Ф	 #
(
Ф	Ф	# $
)
Ф	Ф	$ %
;
Ф	Ф	% &
}
Х	Х	 
}
Ц	Ц	 
}
Ч	Ч	 	
public
б	б	 
virtual
б	б	 
async
б	б	 
Task
б	б	 !
<
б	б	! " 
RepositoryResponse
б	б	" 4
<
б	б	4 5
TModel
б	б	5 ;
>
б	б	; <
>
б	б	< =
RemoveModelAsync
б	б	> N
(
б	б	N O
TModel
б	б	O U
model
б	б	V [
,
б	б	[ \

TDbContext
б	б	] g
_context
б	б	h p
=
б	б	q r
null
б	б	s w
,
б	б	w x$
IDbContextTransactionб	б	y О
_transactionб	б	П Ы
=б	б	Ь Э
nullб	б	Ю в
)б	б	в г
{
в	в	 	
UnitOfWorkHelper
г	г	 
<
г	г	 

TDbContext
г	г	 '
>
г	г	' (
.
г	г	( )
InitTransaction
г	г	) 8
(
г	г	8 9
_context
г	г	9 A
,
г	г	A B
_transaction
г	г	C O
,
г	г	O P
out
г	г	Q T

TDbContext
г	г	U _
context
г	г	` g
,
г	г	g h
out
г	г	i l$
IDbContextTransactionг	г	m В
transactionг	г	Г О
,г	г	О П
outг	г	Р У
boolг	г	Ф Ш
isRootг	г	Щ Я
)г	г	Я а
;г	г	а б
try
д	д	 
{
е	е	 
bool
ж	ж	 
result
ж	ж	 
=
ж	ж	 
true
ж	ж	 "
;
ж	ж	" #
if
з	з	 
(
з	з	 
model
з	з	 
!=
з	з	 
null
з	з	 !
&&
з	з	" $
CheckIsExists
з	з	% 2
(
з	з	2 3
model
з	з	3 8
,
з	з	8 9
context
з	з	: A
,
з	з	A B
transaction
з	з	C N
)
з	з	N O
)
з	з	O P
{
и	и	 
context
й	й	 
.
й	й	 
Entry
й	й	 !
(
й	й	! "
model
й	й	" '
)
й	й	' (
.
й	й	( )
State
й	й	) .
=
й	й	/ 0
EntityState
й	й	1 <
.
й	й	< =
Deleted
й	й	= D
;
й	й	D E
result
к	к	 
=
к	к	 
await
к	к	 "
context
к	к	# *
.
к	к	* +
SaveChangesAsync
к	к	+ ;
(
к	к	; <
)
к	к	< =
.
к	к	= >
ConfigureAwait
к	к	> L
(
к	к	L M
false
к	к	M R
)
к	к	R S
>
к	к	T U
$num
к	к	V W
;
к	к	W X
}
л	л	 
UnitOfWorkHelper
н	н	  
<
н	н	  !

TDbContext
н	н	! +
>
н	н	+ ,
.
н	н	, -
HandleTransaction
н	н	- >
(
н	н	> ?
result
н	н	? E
,
н	н	E F
isRoot
н	н	G M
,
н	н	M N
transaction
н	н	O Z
)
н	н	Z [
;
н	н	[ \
return
п	п	 
new
п	п	  
RepositoryResponse
п	п	 -
<
п	п	- .
TModel
п	п	. 4
>
п	п	4 5
(
п	п	5 6
)
п	п	6 7
{
░	░	 
	IsSucceed
▒	▒	 
=
▒	▒	 
result
▒	▒	  &
,
▒	▒	& '
Data
▓	▓	 
=
▓	▓	 
model
▓	▓	  
}
│	│	 
;
│	│	 
}
┤	┤	 
catch
╡	╡	 
(
╡	╡	 
	Exception
╡	╡	 
ex
╡	╡	 
)
╡	╡	  
{
╢	╢	 
return
╖	╖	 
UnitOfWorkHelper
╖	╖	 '
<
╖	╖	' (

TDbContext
╖	╖	( 2
>
╖	╖	2 3
.
╖	╖	3 4
HandleException
╖	╖	4 C
<
╖	╖	C D
TModel
╖	╖	D J
>
╖	╖	J K
(
╖	╖	K L
ex
╖	╖	L N
,
╖	╖	N O
isRoot
╖	╖	P V
,
╖	╖	V W
transaction
╖	╖	X c
)
╖	╖	c d
;
╖	╖	d e
}
╕	╕	 
finally
╣	╣	 
{
║	║	 
if
╗	╗	 
(
╗	╗	 
isRoot
╗	╗	 
)
╗	╗	 
{
╝	╝	 
context
╛	╛	 
.
╛	╛	 
Dispose
╛	╛	 #
(
╛	╛	# $
)
╛	╛	$ %
;
╛	╛	% &
}
┐	┐	 
}
└	└	 
}
┴	┴	 	
public
╦	╦	 
virtual
╦	╦	  
RepositoryResponse
╦	╦	 )
<
╦	╦	) *
TView
╦	╦	* /
>
╦	╦	/ 0
	SaveModel
╦	╦	1 :
(
╦	╦	: ;
TView
╦	╦	; @
view
╦	╦	A E
,
╦	╦	E F
bool
╦	╦	G K
isSaveSubModels
╦	╦	L [
=
╦	╦	\ ]
false
╦	╦	^ c
,
╠	╠	 	

TDbContext
╠	╠	
 
_context
╠	╠	 
=
╠	╠	 
null
╠	╠	  $
,
╠	╠	$ %#
IDbContextTransaction
╠	╠	& ;
_transaction
╠	╠	< H
=
╠	╠	I J
null
╠	╠	K O
)
╠	╠	O P
{
═	═	 	
if
╬	╬	 
(
╬	╬	 
CheckIsExists
╬	╬	 
(
╬	╬	 
view
╬	╬	 "
.
╬	╬	" #
Model
╬	╬	# (
,
╬	╬	( )
_context
╬	╬	* 2
,
╬	╬	2 3
_transaction
╬	╬	4 @
)
╬	╬	@ A
)
╬	╬	A B
{
╧	╧	 
return
╨	╨	 
	EditModel
╨	╨	  
(
╨	╨	  !
view
╨	╨	! %
,
╨	╨	% &
_context
╨	╨	' /
,
╨	╨	/ 0
_transaction
╨	╨	1 =
)
╨	╨	= >
;
╨	╨	> ?
}
╤	╤	 
else
╥	╥	 
{
╙	╙	 
return
╘	╘	 
CreateModel
╘	╘	 "
(
╘	╘	" #
view
╘	╘	# '
,
╘	╘	' (
_context
╘	╘	) 1
,
╘	╘	1 2
_transaction
╘	╘	3 ?
)
╘	╘	? @
;
╘	╘	@ A
}
╒	╒	 
}
╓	╓	 	
public
р	р	 
virtual
р	р	 
Task
р	р	 
<
р	р	  
RepositoryResponse
р	р	 .
<
р	р	. /
TView
р	р	/ 4
>
р	р	4 5
>
р	р	5 6
SaveModelAsync
р	р	7 E
(
р	р	E F
TView
р	р	F K
view
р	р	L P
,
р	р	P Q
bool
р	р	R V
isSaveSubModels
р	р	W f
=
р	р	g h
false
р	р	i n
,
с	с	 	

TDbContext
с	с	
 
_context
с	с	 
=
с	с	 
null
с	с	  $
,
с	с	$ %#
IDbContextTransaction
с	с	& ;
_transaction
с	с	< H
=
с	с	I J
null
с	с	K O
)
с	с	O P
{
т	т	 	
if
у	у	 
(
у	у	 
CheckIsExists
у	у	 
(
у	у	 
view
у	у	 "
.
у	у	" #
Model
у	у	# (
,
у	у	( )
_context
у	у	* 2
,
у	у	2 3
_transaction
у	у	4 @
)
у	у	@ A
)
у	у	A B
{
ф	ф	 
return
х	х	 
EditModelAsync
х	х	 %
(
х	х	% &
view
х	х	& *
,
х	х	* +
_context
х	х	, 4
,
х	х	4 5
_transaction
х	х	6 B
)
х	х	B C
;
х	х	C D
}
ц	ц	 
else
ч	ч	 
{
ш	ш	 
return
щ	щ	 
CreateModelAsync
щ	щ	 '
(
щ	щ	' (
view
щ	щ	( ,
,
щ	щ	, -
_context
щ	щ	. 6
,
щ	щ	6 7
_transaction
щ	щ	8 D
)
щ	щ	D E
;
щ	щ	E F
}
ъ	ъ	 
}
ы	ы	 	
public
ї	ї	 
virtual
ї	ї	 
Task
ї	ї	 
<
ї	ї	 
bool
ї	ї	  
>
ї	ї	  !
SaveSubModelAsync
ї	ї	" 3
(
ї	ї	3 4
TModel
ї	ї	4 :
model
ї	ї	; @
,
ї	ї	@ A

TDbContext
ї	ї	B L
context
ї	ї	M T
,
ї	ї	T U#
IDbContextTransaction
ї	ї	V k
_transaction
ї	ї	l x
)
ї	ї	x y
{
Ў	Ў	 	
throw
ў	ў	 
new
ў	ў	 %
NotImplementedException
ў	ў	 -
(
ў	ў	- .
)
ў	ў	. /
;
ў	ў	/ 0
}
°	°	 	
public
Г
Г
 
virtual
Г
Г
  
RepositoryResponse
Г
Г
 )
<
Г
Г
) *
int
Г
Г
* -
>
Г
Г
- .
Max
Г
Г
/ 2
(
Г
Г
2 3

Expression
Г
Г
3 =
<
Г
Г
= >
Func
Г
Г
> B
<
Г
Г
B C
TModel
Г
Г
C I
,
Г
Г
I J
int
Г
Г
K N
>
Г
Г
N O
>
Г
Г
O P
	predicate
Г
Г
Q Z
,
Д
Д
 	

TDbContext
Д
Д

 
_context
Д
Д
 
=
Д
Д
 
null
Д
Д
  $
,
Д
Д
$ %#
IDbContextTransaction
Д
Д
& ;
_transaction
Д
Д
< H
=
Д
Д
I J
null
Д
Д
K O
)
Д
Д
O P
{
Е
Е
 	
UnitOfWorkHelper
Ж
Ж
 
<
Ж
Ж
 

TDbContext
Ж
Ж
 '
>
Ж
Ж
' (
.
Ж
Ж
( )
InitTransaction
Ж
Ж
) 8
(
Ж
Ж
8 9
_context
Ж
Ж
9 A
,
Ж
Ж
A B
_transaction
Ж
Ж
C O
,
Ж
Ж
O P
out
Ж
Ж
Q T

TDbContext
Ж
Ж
U _
context
Ж
Ж
` g
,
Ж
Ж
g h
out
Ж
Ж
i l$
IDbContextTransactionЖ
Ж
m В
transactionЖ
Ж
Г О
,Ж
Ж
О П
outЖ
Ж
Р У
boolЖ
Ж
Ф Ш
isRootЖ
Ж
Щ Я
)Ж
Ж
Я а
;Ж
Ж
а б
int
З
З
 
total
З
З
 
=
З
З
 
$num
З
З
 
;
З
З
 
var
И
И
 
result
И
И
 
=
И
И
 
new
И
И
  
RepositoryResponse
И
И
 /
<
И
И
/ 0
int
И
И
0 3
>
И
И
3 4
(
И
И
4 5
)
И
И
5 6
{
Й
Й
 
	IsSucceed
К
К
 
=
К
К
 
true
К
К
  
,
К
К
  !
Data
Л
Л
 
=
Л
Л
 
total
Л
Л
 
}
М
М
 
;
М
М
 
try
Н
Н
 
{
О
О
 
total
П
П
 
=
П
П
 
context
П
П
 
.
П
П
  
Set
П
П
  #
<
П
П
# $
TModel
П
П
$ *
>
П
П
* +
(
П
П
+ ,
)
П
П
, -
.
П
П
- .
Max
П
П
. 1
(
П
П
1 2
	predicate
П
П
2 ;
)
П
П
; <
;
П
П
< =
result
Р
Р
 
.
Р
Р
 
Data
Р
Р
 
=
Р
Р
 
total
Р
Р
 #
;
Р
Р
# $
return
С
С
 
result
С
С
 
;
С
С
 
}
Т
Т
 
catch
У
У
 
(
У
У
 
	Exception
У
У
 
ex
У
У
 
)
У
У
  
{
Ф
Ф
 
return
Х
Х
 
UnitOfWorkHelper
Х
Х
 '
<
Х
Х
' (

TDbContext
Х
Х
( 2
>
Х
Х
2 3
.
Х
Х
3 4#
HandleObjectException
Х
Х
4 I
<
Х
Х
I J
int
Х
Х
J M
>
Х
Х
M N
(
Х
Х
N O
ex
Х
Х
O Q
,
Х
Х
Q R
isRoot
Х
Х
S Y
,
Х
Х
Y Z
transaction
Х
Х
[ f
)
Х
Х
f g
;
Х
Х
g h
}
Ц
Ц
 
finally
Ч
Ч
 
{
Ш
Ш
 
if
Щ
Щ
 
(
Щ
Щ
 
isRoot
Щ
Щ
 
)
Щ
Щ
 
{
Ъ
Ъ
 
context
Ь
Ь
 
.
Ь
Ь
 
Dispose
Ь
Ь
 #
(
Ь
Ь
# $
)
Ь
Ь
$ %
;
Ь
Ь
% &
}
Э
Э
 
}
Ю
Ю
 
}
Я
Я
 	
public
и
и
 
virtual
и
и
 
async
и
и
 
Task
и
и
 !
<
и
и
! " 
RepositoryResponse
и
и
" 4
<
и
и
4 5
int
и
и
5 8
>
и
и
8 9
>
и
и
9 :
MaxAsync
и
и
; C
(
и
и
C D

Expression
и
и
D N
<
и
и
N O
Func
и
и
O S
<
и
и
S T
TModel
и
и
T Z
,
и
и
Z [
int
и
и
\ _
>
и
и
_ `
>
и
и
` a
	predicate
и
и
b k
,
й
й
 	

TDbContext
й
й

 
_context
й
й
 
=
й
й
 
null
й
й
  $
,
й
й
$ %#
IDbContextTransaction
й
й
& ;
_transaction
й
й
< H
=
й
й
I J
null
й
й
K O
)
й
й
O P
{
к
к
 	
UnitOfWorkHelper
л
л
 
<
л
л
 

TDbContext
л
л
 '
>
л
л
' (
.
л
л
( )
InitTransaction
л
л
) 8
(
л
л
8 9
_context
л
л
9 A
,
л
л
A B
_transaction
л
л
C O
,
л
л
O P
out
л
л
Q T

TDbContext
л
л
U _
context
л
л
` g
,
л
л
g h
out
л
л
i l$
IDbContextTransactionл
л
m В
transactionл
л
Г О
,л
л
О П
outл
л
Р У
boolл
л
Ф Ш
isRootл
л
Щ Я
)л
л
Я а
;л
л
а б
int
м
м
 
total
м
м
 
=
м
м
 
$num
м
м
 
;
м
м
 
try
н
н
 
{
о
о
 
total
п
п
 
=
п
п
 
await
п
п
 
context
п
п
 %
.
п
п
% &
Set
п
п
& )
<
п
п
) *
TModel
п
п
* 0
>
п
п
0 1
(
п
п
1 2
)
п
п
2 3
.
п
п
3 4
MaxAsync
п
п
4 <
(
п
п
< =
	predicate
п
п
= F
)
п
п
F G
.
п
п
G H
ConfigureAwait
п
п
H V
(
п
п
V W
false
п
п
W \
)
п
п
\ ]
;
п
п
] ^
return
░
░
 
new
░
░
  
RepositoryResponse
░
░
 -
<
░
░
- .
int
░
░
. 1
>
░
░
1 2
(
░
░
2 3
)
░
░
3 4
{
▒
▒
 
	IsSucceed
▓
▓
 
=
▓
▓
 
true
▓
▓
  $
,
▓
▓
$ %
Data
│
│
 
=
│
│
 
total
│
│
  
}
┤
┤
 
;
┤
┤
 
}
╡
╡
 
catch
╢
╢
 
(
╢
╢
 
	Exception
╢
╢
 
ex
╢
╢
 
)
╢
╢
  
{
╖
╖
 
return
╕
╕
 
UnitOfWorkHelper
╕
╕
 '
<
╕
╕
' (

TDbContext
╕
╕
( 2
>
╕
╕
2 3
.
╕
╕
3 4#
HandleObjectException
╕
╕
4 I
<
╕
╕
I J
int
╕
╕
J M
>
╕
╕
M N
(
╕
╕
N O
ex
╕
╕
O Q
,
╕
╕
Q R
isRoot
╕
╕
S Y
,
╕
╕
Y Z
transaction
╕
╕
[ f
)
╕
╕
f g
;
╕
╕
g h
}
╣
╣
 
finally
║
║
 
{
╗
╗
 
if
╝
╝
 
(
╝
╝
 
isRoot
╝
╝
 
)
╝
╝
 
{
╜
╜
 
context
┐
┐
 
.
┐
┐
 
Dispose
┐
┐
 #
(
┐
┐
# $
)
┐
┐
$ %
;
┐
┐
% &
}
└
└
 
}
┴
┴
 
}
┬
┬
 	
public
╧
╧
 
virtual
╧
╧
  
RepositoryResponse
╧
╧
 )
<
╧
╧
) *
int
╧
╧
* -
>
╧
╧
- .
Count
╧
╧
/ 4
(
╧
╧
4 5

Expression
╧
╧
5 ?
<
╧
╧
? @
Func
╧
╧
@ D
<
╧
╧
D E
TModel
╧
╧
E K
,
╧
╧
K L
bool
╧
╧
M Q
>
╧
╧
Q R
>
╧
╧
R S
	predicate
╧
╧
T ]
,
╨
╨
 	

TDbContext
╨
╨

 
_context
╨
╨
 
=
╨
╨
 
null
╨
╨
  $
,
╨
╨
$ %#
IDbContextTransaction
╨
╨
& ;
_transaction
╨
╨
< H
=
╨
╨
I J
null
╨
╨
K O
)
╨
╨
O P
{
╤
╤
 	
UnitOfWorkHelper
╥
╥
 
<
╥
╥
 

TDbContext
╥
╥
 '
>
╥
╥
' (
.
╥
╥
( )
InitTransaction
╥
╥
) 8
(
╥
╥
8 9
_context
╥
╥
9 A
,
╥
╥
A B
_transaction
╥
╥
C O
,
╥
╥
O P
out
╥
╥
Q T

TDbContext
╥
╥
U _
context
╥
╥
` g
,
╥
╥
g h
out
╥
╥
i l$
IDbContextTransaction╥
╥
m В
transaction╥
╥
Г О
,╥
╥
О П
out╥
╥
Р У
bool╥
╥
Ф Ш
isRoot╥
╥
Щ Я
)╥
╥
Я а
;╥
╥
а б
int
╙
╙
 
total
╙
╙
 
=
╙
╙
 
$num
╙
╙
 
;
╙
╙
 
try
╘
╘
 
{
╒
╒
 
total
╓
╓
 
=
╓
╓
 
context
╓
╓
 
.
╓
╓
  
Set
╓
╓
  #
<
╓
╓
# $
TModel
╓
╓
$ *
>
╓
╓
* +
(
╓
╓
+ ,
)
╓
╓
, -
.
╓
╓
- .
Count
╓
╓
. 3
(
╓
╓
3 4
	predicate
╓
╓
4 =
)
╓
╓
= >
;
╓
╓
> ?
return
╫
╫
 
new
╫
╫
  
RepositoryResponse
╫
╫
 -
<
╫
╫
- .
int
╫
╫
. 1
>
╫
╫
1 2
(
╫
╫
2 3
)
╫
╫
3 4
{
╪
╪
 
	IsSucceed
┘
┘
 
=
┘
┘
 
true
┘
┘
  $
,
┘
┘
$ %
Data
┌
┌
 
=
┌
┌
 
total
┌
┌
  
}
█
█
 
;
█
█
 
}
▄
▄
 
catch
▌
▌
 
(
▌
▌
 
	Exception
▌
▌
 
ex
▌
▌
 
)
▌
▌
  
{
▐
▐
 
return
▀
▀
 
UnitOfWorkHelper
▀
▀
 '
<
▀
▀
' (

TDbContext
▀
▀
( 2
>
▀
▀
2 3
.
▀
▀
3 4#
HandleObjectException
▀
▀
4 I
<
▀
▀
I J
int
▀
▀
J M
>
▀
▀
M N
(
▀
▀
N O
ex
▀
▀
O Q
,
▀
▀
Q R
isRoot
▀
▀
S Y
,
▀
▀
Y Z
transaction
▀
▀
[ f
)
▀
▀
f g
;
▀
▀
g h
}
р
р
 
finally
с
с
 
{
т
т
 
if
у
у
 
(
у
у
 
isRoot
у
у
 
)
у
у
 
{
ф
ф
 
context
ц
ц
 
.
ц
ц
 
Dispose
ц
ц
 #
(
ц
ц
# $
)
ц
ц
$ %
;
ц
ц
% &
}
ч
ч
 
}
ш
ш
 
}
щ
щ
 	
public
Є
Є
 
virtual
Є
Є
 
async
Є
Є
 
Task
Є
Є
 !
<
Є
Є
! " 
RepositoryResponse
Є
Є
" 4
<
Є
Є
4 5
int
Є
Є
5 8
>
Є
Є
8 9
>
Є
Є
9 :

CountAsync
Є
Є
; E
(
Є
Є
E F

Expression
Є
Є
F P
<
Є
Є
P Q
Func
Є
Є
Q U
<
Є
Є
U V
TModel
Є
Є
V \
,
Є
Є
\ ]
bool
Є
Є
^ b
>
Є
Є
b c
>
Є
Є
c d
	predicate
Є
Є
e n
,
є
є
 	

TDbContext
є
є

 
_context
є
є
 
=
є
є
 
null
є
є
  $
,
є
є
$ %#
IDbContextTransaction
є
є
& ;
_transaction
є
є
< H
=
є
є
I J
null
є
є
K O
)
є
є
O P
{
Ї
Ї
 	
UnitOfWorkHelper
ї
ї
 
<
ї
ї
 

TDbContext
ї
ї
 '
>
ї
ї
' (
.
ї
ї
( )
InitTransaction
ї
ї
) 8
(
ї
ї
8 9
_context
ї
ї
9 A
,
ї
ї
A B
_transaction
ї
ї
C O
,
ї
ї
O P
out
ї
ї
Q T

TDbContext
ї
ї
U _
context
ї
ї
` g
,
ї
ї
g h
out
ї
ї
i l$
IDbContextTransactionї
ї
m В
transactionї
ї
Г О
,ї
ї
О П
outї
ї
Р У
boolї
ї
Ф Ш
isRootї
ї
Щ Я
)ї
ї
Я а
;ї
ї
а б
int
Ў
Ў
 
total
Ў
Ў
 
=
Ў
Ў
 
$num
Ў
Ў
 
;
Ў
Ў
 
try
ў
ў
 
{
°
°
 
total
∙
∙
 
=
∙
∙
 
await
∙
∙
 
context
∙
∙
 %
.
∙
∙
% &
Set
∙
∙
& )
<
∙
∙
) *
TModel
∙
∙
* 0
>
∙
∙
0 1
(
∙
∙
1 2
)
∙
∙
2 3
.
∙
∙
3 4

CountAsync
∙
∙
4 >
(
∙
∙
> ?
	predicate
∙
∙
? H
)
∙
∙
H I
.
∙
∙
I J
ConfigureAwait
∙
∙
J X
(
∙
∙
X Y
false
∙
∙
Y ^
)
∙
∙
^ _
;
∙
∙
_ `
return
·
·
 
new
·
·
  
RepositoryResponse
·
·
 -
<
·
·
- .
int
·
·
. 1
>
·
·
1 2
(
·
·
2 3
)
·
·
3 4
{
√
√
 
	IsSucceed
№
№
 
=
№
№
 
true
№
№
  $
,
№
№
$ %
Data
¤
¤
 
=
¤
¤
 
total
¤
¤
  
}
■
■
 
;
■
■
 
}
 
 
 
catch
АА 
(
АА 
	Exception
АА 
ex
АА 
)
АА  
{
ББ 
UnitOfWorkHelper
ВВ  
<
ВВ  !

TDbContext
ВВ! +
>
ВВ+ ,
.
ВВ, -
HandleException
ВВ- <
<
ВВ< =
List
ВВ= A
<
ВВA B
TModel
ВВB H
>
ВВH I
>
ВВI J
(
ВВJ K
ex
ВВK M
,
ВВM N
isRoot
ВВO U
,
ВВU V
transaction
ВВW b
)
ВВb c
;
ВВc d
return
ГГ 
new
ГГ  
RepositoryResponse
ГГ -
<
ГГ- .
int
ГГ. 1
>
ГГ1 2
(
ГГ2 3
)
ГГ3 4
{
ДД 
	IsSucceed
ЕЕ 
=
ЕЕ 
true
ЕЕ  $
,
ЕЕ$ %
Data
ЖЖ 
=
ЖЖ 
total
ЖЖ  
}
ЗЗ 
;
ЗЗ 
}
ИИ 
finally
ЙЙ 
{
КК 
if
ЛЛ 
(
ЛЛ 
isRoot
ЛЛ 
)
ЛЛ 
{
ММ 
context
ОО 
.
ОО 
Dispose
ОО #
(
ОО# $
)
ОО$ %
;
ОО% &
}
ПП 
}
РР 
}
СС 	
public
ЭЭ 
virtual
ЭЭ  
RepositoryResponse
ЭЭ )
<
ЭЭ) *
int
ЭЭ* -
>
ЭЭ- .
Count
ЭЭ/ 4
(
ЭЭ4 5

TDbContext
ЭЭ5 ?
_context
ЭЭ@ H
=
ЭЭI J
null
ЭЭK O
,
ЭЭO P#
IDbContextTransaction
ЭЭQ f
_transaction
ЭЭg s
=
ЭЭt u
null
ЭЭv z
)
ЭЭz {
{
ЮЮ 	
UnitOfWorkHelper
ЯЯ 
<
ЯЯ 

TDbContext
ЯЯ '
>
ЯЯ' (
.
ЯЯ( )
InitTransaction
ЯЯ) 8
(
ЯЯ8 9
_context
ЯЯ9 A
,
ЯЯA B
_transaction
ЯЯC O
,
ЯЯO P
out
ЯЯQ T

TDbContext
ЯЯU _
context
ЯЯ` g
,
ЯЯg h
out
ЯЯi l$
IDbContextTransactionЯЯm В
transactionЯЯГ О
,ЯЯО П
outЯЯР У
boolЯЯФ Ш
isRootЯЯЩ Я
)ЯЯЯ а
;ЯЯа б
int
аа 
total
аа 
=
аа 
$num
аа 
;
аа 
try
бб 
{
вв 
total
гг 
=
гг 
context
гг 
.
гг  
Set
гг  #
<
гг# $
TModel
гг$ *
>
гг* +
(
гг+ ,
)
гг, -
.
гг- .
Count
гг. 3
(
гг3 4
)
гг4 5
;
гг5 6
return
дд 
new
дд  
RepositoryResponse
дд -
<
дд- .
int
дд. 1
>
дд1 2
(
дд2 3
)
дд3 4
{
ее 
	IsSucceed
жж 
=
жж 
true
жж  $
,
жж$ %
Data
зз 
=
зз 
total
зз  
}
ии 
;
ии 
}
йй 
catch
кк 
(
кк 
	Exception
кк 
ex
кк 
)
кк  
{
лл 
return
мм 
UnitOfWorkHelper
мм '
<
мм' (

TDbContext
мм( 2
>
мм2 3
.
мм3 4#
HandleObjectException
мм4 I
<
ммI J
int
ммJ M
>
ммM N
(
ммN O
ex
ммO Q
,
ммQ R
isRoot
ммS Y
,
ммY Z
transaction
мм[ f
)
ммf g
;
ммg h
}
нн 
finally
оо 
{
пп 
if
░░ 
(
░░ 
isRoot
░░ 
)
░░ 
{
▒▒ 
context
││ 
.
││ 
Dispose
││ #
(
││# $
)
││$ %
;
││% &
}
┤┤ 
}
╡╡ 
}
╢╢ 	
public
╛╛ 
virtual
╛╛ 
async
╛╛ 
Task
╛╛ !
<
╛╛! " 
RepositoryResponse
╛╛" 4
<
╛╛4 5
int
╛╛5 8
>
╛╛8 9
>
╛╛9 :

CountAsync
╛╛; E
(
╛╛E F

TDbContext
╛╛F P
_context
╛╛Q Y
=
╛╛Z [
null
╛╛\ `
,
╛╛` a#
IDbContextTransaction
╛╛b w
_transaction╛╛x Д
=╛╛Е Ж
null╛╛З Л
)╛╛Л М
{
┐┐ 	
UnitOfWorkHelper
└└ 
<
└└ 

TDbContext
└└ '
>
└└' (
.
└└( )
InitTransaction
└└) 8
(
└└8 9
_context
└└9 A
,
└└A B
_transaction
└└C O
,
└└O P
out
└└Q T

TDbContext
└└U _
context
└└` g
,
└└g h
out
└└i l$
IDbContextTransaction└└m В
transaction└└Г О
,└└О П
out└└Р У
bool└└Ф Ш
isRoot└└Щ Я
)└└Я а
;└└а б
int
┴┴ 
total
┴┴ 
=
┴┴ 
$num
┴┴ 
;
┴┴ 
try
┬┬ 
{
├├ 
total
── 
=
── 
await
── 
context
── %
.
──% &
Set
──& )
<
──) *
TModel
──* 0
>
──0 1
(
──1 2
)
──2 3
.
──3 4

CountAsync
──4 >
(
──> ?
)
──? @
.
──@ A
ConfigureAwait
──A O
(
──O P
false
──P U
)
──U V
;
──V W
return
┼┼ 
new
┼┼  
RepositoryResponse
┼┼ -
<
┼┼- .
int
┼┼. 1
>
┼┼1 2
(
┼┼2 3
)
┼┼3 4
{
╞╞ 
	IsSucceed
╟╟ 
=
╟╟ 
true
╟╟  $
,
╟╟$ %
Data
╚╚ 
=
╚╚ 
total
╚╚  
}
╔╔ 
;
╔╔ 
}
╩╩ 
catch
╦╦ 
(
╦╦ 
	Exception
╦╦ 
ex
╦╦ 
)
╦╦  
{
╠╠ 
return
══ 
UnitOfWorkHelper
══ '
<
══' (

TDbContext
══( 2
>
══2 3
.
══3 4#
HandleObjectException
══4 I
<
══I J
int
══J M
>
══M N
(
══N O
ex
══O Q
,
══Q R
isRoot
══S Y
,
══Y Z
transaction
══[ f
)
══f g
;
══g h
}
╬╬ 
finally
╧╧ 
{
╨╨ 
if
╤╤ 
(
╤╤ 
isRoot
╤╤ 
)
╤╤ 
{
╥╥ 
context
╘╘ 
.
╘╘ 
Dispose
╘╘ #
(
╘╘# $
)
╘╘$ %
;
╘╘% &
}
╒╒ 
}
╓╓ 
}
╫╫ 	
public
хх  
RepositoryResponse
хх !
<
хх! "
TModel
хх" (
>
хх( )
UpdateFields
хх* 6
(
хх6 7

Expression
хх7 A
<
ххA B
Func
ххB F
<
ххF G
TModel
ххG M
,
ххM N
bool
ххO S
>
ххS T
>
ххT U
	predicate
ххV _
,
цц 	
List
цц
 
<
цц 
EntityField
цц 
>
цц 
fields
цц "
,
чч 	

TDbContext
чч
 
_context
чч 
=
чч 
null
чч  $
,
чч$ %#
IDbContextTransaction
чч& ;
_transaction
чч< H
=
ччI J
null
ччK O
)
ччO P
{
шш 	
UnitOfWorkHelper
щщ 
<
щщ 

TDbContext
щщ '
>
щщ' (
.
щщ( )
InitTransaction
щщ) 8
(
щщ8 9
_context
щщ9 A
,
щщA B
_transaction
щщC O
,
щщO P
out
щщQ T

TDbContext
щщU _
context
щщ` g
,
щщg h
out
щщi l$
IDbContextTransactionщщm В
transactionщщГ О
,щщО П
outщщР У
boolщщФ Ш
isRootщщЩ Я
)щщЯ а
;щща б
try
ъъ 
{
ыы 
bool
ьь 
result
ьь 
=
ьь 
false
ьь #
;
ьь# $
TModel
ээ 
model
ээ 
=
ээ 
context
ээ &
.
ээ& '
Set
ээ' *
<
ээ* +
TModel
ээ+ 1
>
ээ1 2
(
ээ2 3
)
ээ3 4
.
ээ4 5
FirstOrDefault
ээ5 C
(
ээC D
	predicate
ээD M
)
ээM N
;
ээN O
if
юю 
(
юю 
model
юю 
!=
юю 
null
юю !
)
юю! "
{
яя 
foreach
ЁЁ 
(
ЁЁ 
var
ЁЁ  
field
ЁЁ! &
in
ЁЁ' )
fields
ЁЁ* 0
)
ЁЁ0 1
{
ёё 
var
ЄЄ 
lamda
ЄЄ !
=
ЄЄ" #
	GetLambda
ЄЄ$ -
(
ЄЄ- .
field
ЄЄ. 3
.
ЄЄ3 4
PropertyName
ЄЄ4 @
,
ЄЄ@ A
false
ЄЄB G
)
ЄЄG H
;
ЄЄH I
if
єє 
(
єє 
lamda
єє !
!=
єє" $
null
єє% )
)
єє) *
{
ЇЇ 
var
її 
prop
її  $
=
її% &
context
її' .
.
її. /
Entry
її/ 4
(
її4 5
model
її5 :
)
її: ;
.
її; <
Property
її< D
(
їїD E
field
їїE J
.
їїJ K
PropertyName
їїK W
)
їїW X
;
їїX Y
if
ЎЎ 
(
ЎЎ  
DateTime
ЎЎ  (
.
ЎЎ( )
TryParse
ЎЎ) 1
(
ЎЎ1 2
field
ЎЎ2 7
.
ЎЎ7 8
PropertyValue
ЎЎ8 E
,
ЎЎE F
out
ЎЎG J
DateTime
ЎЎK S
	dateValue
ЎЎT ]
)
ЎЎ] ^
)
ЎЎ^ _
{
ўў 
prop
°°  $
.
°°$ %
CurrentValue
°°% 1
=
°°2 3
	dateValue
°°4 =
;
°°= >
}
∙∙ 
else
··  
if
··! #
(
··$ %
int
··% (
.
··( )
TryParse
··) 1
(
··1 2
field
··2 7
.
··7 8
PropertyValue
··8 E
,
··E F
out
··G J
int
··K N
integerValue
··O [
)
··[ \
)
··\ ]
{
√√ 
prop
№№  $
.
№№$ %
CurrentValue
№№% 1
=
№№2 3
integerValue
№№4 @
;
№№@ A
}
¤¤ 
else
■■  
{
   
prop
АА  $
.
АА$ %
CurrentValue
АА% 1
=
АА2 3
field
АА4 9
.
АА9 :
PropertyValue
АА: G
;
ААG H
}
ББ 
context
ГГ #
.
ГГ# $
SaveChanges
ГГ$ /
(
ГГ/ 0
)
ГГ0 1
;
ГГ1 2
result
ДД "
=
ДД# $
true
ДД% )
;
ДД) *
}
ЕЕ 
else
ЖЖ 
{
ЗЗ 
result
ИИ "
=
ИИ# $
false
ИИ% *
;
ИИ* +
break
ЙЙ !
;
ЙЙ! "
}
КК 
}
ЛЛ 
}
ММ 
UnitOfWorkHelper
ОО  
<
ОО  !

TDbContext
ОО! +
>
ОО+ ,
.
ОО, -
HandleTransaction
ОО- >
(
ОО> ?
result
ОО? E
,
ООE F
isRoot
ООG M
,
ООM N
transaction
ООO Z
)
ООZ [
;
ОО[ \
return
РР 
new
РР  
RepositoryResponse
РР -
<
РР- .
TModel
РР. 4
>
РР4 5
(
РР5 6
)
РР6 7
{
СС 
	IsSucceed
ТТ 
=
ТТ 
result
ТТ  &
,
ТТ& '
Data
УУ 
=
УУ 
model
УУ  
}
ФФ 
;
ФФ 
}
ХХ 
catch
ЦЦ 
(
ЦЦ 
	Exception
ЦЦ 
ex
ЦЦ 
)
ЦЦ  
{
ЧЧ 
return
ШШ 
UnitOfWorkHelper
ШШ '
<
ШШ' (

TDbContext
ШШ( 2
>
ШШ2 3
.
ШШ3 4
HandleException
ШШ4 C
<
ШШC D
TModel
ШШD J
>
ШШJ K
(
ШШK L
ex
ШШL N
,
ШШN O
isRoot
ШШP V
,
ШШV W
transaction
ШШX c
)
ШШc d
;
ШШd e
}
ЩЩ 
finally
ЪЪ 
{
ЫЫ 
if
ЬЬ 
(
ЬЬ 
isRoot
ЬЬ 
)
ЬЬ 
{
ЭЭ 
context
ЯЯ 
.
ЯЯ 
Dispose
ЯЯ #
(
ЯЯ# $
)
ЯЯ$ %
;
ЯЯ% &
}
аа 
}
бб 
}
вв 	
public
мм 
async
мм 
Task
мм 
<
мм  
RepositoryResponse
мм ,
<
мм, -
TModel
мм- 3
>
мм3 4
>
мм4 5
UpdateFieldsAsync
мм6 G
(
ммG H

Expression
ммH R
<
ммR S
Func
ммS W
<
ммW X
TModel
ммX ^
,
мм^ _
bool
мм` d
>
ммd e
>
ммe f
	predicate
ммg p
,
нн 	
List
нн
 
<
нн 
EntityField
нн 
>
нн 
fields
нн "
,
оо 	

TDbContext
оо
 
_context
оо 
=
оо 
null
оо  $
,
оо$ %#
IDbContextTransaction
оо& ;
_transaction
оо< H
=
ооI J
null
ооK O
)
ооO P
{
пп 	
UnitOfWorkHelper
░░ 
<
░░ 

TDbContext
░░ '
>
░░' (
.
░░( )
InitTransaction
░░) 8
(
░░8 9
_context
░░9 A
,
░░A B
_transaction
░░C O
,
░░O P
out
░░Q T

TDbContext
░░U _
context
░░` g
,
░░g h
out
░░i l$
IDbContextTransaction░░m В
transaction░░Г О
,░░О П
out░░Р У
bool░░Ф Ш
isRoot░░Щ Я
)░░Я а
;░░а б
try
▒▒ 
{
▓▓ 
bool
││ 
result
││ 
=
││ 
false
││ #
;
││# $
TModel
┤┤ 
model
┤┤ 
=
┤┤ 
await
┤┤ $
context
┤┤% ,
.
┤┤, -
Set
┤┤- 0
<
┤┤0 1
TModel
┤┤1 7
>
┤┤7 8
(
┤┤8 9
)
┤┤9 :
.
┤┤: ;!
FirstOrDefaultAsync
┤┤; N
(
┤┤N O
	predicate
┤┤O X
)
┤┤X Y
.
┤┤Y Z
ConfigureAwait
┤┤Z h
(
┤┤h i
false
┤┤i n
)
┤┤n o
;
┤┤o p
if
╡╡ 
(
╡╡ 
model
╡╡ 
!=
╡╡ 
null
╡╡ !
)
╡╡! "
{
╢╢ 
foreach
╖╖ 
(
╖╖ 
var
╖╖  
field
╖╖! &
in
╖╖' )
fields
╖╖* 0
)
╖╖0 1
{
╕╕ 
var
╣╣ 
lamda
╣╣ !
=
╣╣" #
	GetLambda
╣╣$ -
(
╣╣- .
field
╣╣. 3
.
╣╣3 4
PropertyName
╣╣4 @
,
╣╣@ A
false
╣╣B G
)
╣╣G H
;
╣╣H I
if
║║ 
(
║║ 
lamda
║║ !
!=
║║" $
null
║║% )
)
║║) *
{
╗╗ 
var
╝╝ 
prop
╝╝  $
=
╝╝% &
context
╝╝' .
.
╝╝. /
Entry
╝╝/ 4
(
╝╝4 5
model
╝╝5 :
)
╝╝: ;
.
╝╝; <
Property
╝╝< D
(
╝╝D E
field
╝╝E J
.
╝╝J K
PropertyName
╝╝K W
)
╝╝W X
;
╝╝X Y
if
╜╜ 
(
╜╜  
DateTime
╜╜  (
.
╜╜( )
TryParse
╜╜) 1
(
╜╜1 2
field
╜╜2 7
.
╜╜7 8
PropertyValue
╜╜8 E
,
╜╜E F
out
╜╜G J
DateTime
╜╜K S
	dateValue
╜╜T ]
)
╜╜] ^
)
╜╜^ _
{
╛╛ 
prop
┐┐  $
.
┐┐$ %
CurrentValue
┐┐% 1
=
┐┐2 3
	dateValue
┐┐4 =
;
┐┐= >
}
└└ 
else
┴┴  
if
┴┴! #
(
┴┴$ %
int
┴┴% (
.
┴┴( )
TryParse
┴┴) 1
(
┴┴1 2
field
┴┴2 7
.
┴┴7 8
PropertyValue
┴┴8 E
,
┴┴E F
out
┴┴G J
int
┴┴K N
integerValue
┴┴O [
)
┴┴[ \
)
┴┴\ ]
{
┬┬ 
prop
├├  $
.
├├$ %
CurrentValue
├├% 1
=
├├2 3
integerValue
├├4 @
;
├├@ A
}
── 
else
┼┼  
{
╞╞ 
prop
╟╟  $
.
╟╟$ %
CurrentValue
╟╟% 1
=
╟╟2 3
field
╟╟4 9
.
╟╟9 :
PropertyValue
╟╟: G
;
╟╟G H
}
╚╚ 
await
╩╩ !
context
╩╩" )
.
╩╩) *
SaveChangesAsync
╩╩* :
(
╩╩: ;
)
╩╩; <
.
╩╩< =
ConfigureAwait
╩╩= K
(
╩╩K L
false
╩╩L Q
)
╩╩Q R
;
╩╩R S
result
╦╦ "
=
╦╦# $
true
╦╦% )
;
╦╦) *
}
╠╠ 
else
══ 
{
╬╬ 
result
╧╧ "
=
╧╧# $
false
╧╧% *
;
╧╧* +
break
╨╨ !
;
╨╨! "
}
╤╤ 
}
╥╥ 
}
╙╙ 
UnitOfWorkHelper
╒╒  
<
╒╒  !

TDbContext
╒╒! +
>
╒╒+ ,
.
╒╒, -
HandleTransaction
╒╒- >
(
╒╒> ?
result
╒╒? E
,
╒╒E F
isRoot
╒╒G M
,
╒╒M N
transaction
╒╒O Z
)
╒╒Z [
;
╒╒[ \
return
╫╫ 
new
╫╫  
RepositoryResponse
╫╫ -
<
╫╫- .
TModel
╫╫. 4
>
╫╫4 5
{
╪╪ 
	IsSucceed
┘┘ 
=
┘┘ 
result
┘┘  &
,
┘┘& '
Data
┌┌ 
=
┌┌ 
model
┌┌  
}
██ 
;
██ 
}
▄▄ 
catch
▌▌ 
(
▌▌ 
	Exception
▌▌ 
ex
▌▌ 
)
▌▌  
{
▐▐ 
return
▀▀ 
UnitOfWorkHelper
▀▀ '
<
▀▀' (

TDbContext
▀▀( 2
>
▀▀2 3
.
▀▀3 4
HandleException
▀▀4 C
<
▀▀C D
TModel
▀▀D J
>
▀▀J K
(
▀▀K L
ex
▀▀L N
,
▀▀N O
isRoot
▀▀P V
,
▀▀V W
transaction
▀▀X c
)
▀▀c d
;
▀▀d e
}
рр 
finally
сс 
{
тт 
if
уу 
(
уу 
isRoot
уу 
)
уу 
{
фф 
context
цц 
.
цц 
Dispose
цц #
(
цц# $
)
цц$ %
;
цц% &
}
чч 
}
шш 
}
щщ 	
	protected
єє 
LambdaExpression
єє "
	GetLambda
єє# ,
(
єє, -
string
єє- 3
propName
єє4 <
,
єє< =
bool
єє> B
isGetDefault
єєC O
=
єєP Q
true
єєR V
)
єєV W
{
ЇЇ 	
var
її 
	parameter
її 
=
її 

Expression
її &
.
її& '
	Parameter
її' 0
(
її0 1
typeof
її1 7
(
її7 8
TModel
її8 >
)
її> ?
)
її? @
;
її@ A
var
ЎЎ 
type
ЎЎ 
=
ЎЎ 
typeof
ЎЎ 
(
ЎЎ 
TModel
ЎЎ $
)
ЎЎ$ %
;
ЎЎ% &
var
ўў 
prop
ўў 
=
ўў 
Array
ўў 
.
ўў 
Find
ўў !
(
ўў! "
type
ўў" &
.
ўў& '
GetProperties
ўў' 4
(
ўў4 5
)
ўў5 6
,
ўў6 7
p
ўў8 9
=>
ўў: <
p
ўў= >
.
ўў> ?
Name
ўў? C
==
ўўD F
propName
ўўG O
)
ўўO P
;
ўўP Q
if
°° 
(
°° 
prop
°° 
==
°° 
null
°° 
&&
°° 
isGetDefault
°°  ,
)
°°, -
{
∙∙ 
propName
·· 
=
·· 
type
·· 
.
··  
GetProperties
··  -
(
··- .
)
··. /
.
··/ 0
FirstOrDefault
··0 >
(
··> ?
)
··? @
?
··@ A
.
··A B
Name
··B F
;
··F G
}
√√ 
var
№№ 
memberExpression
№№  
=
№№! "

Expression
№№# -
.
№№- .
Property
№№. 6
(
№№6 7
	parameter
№№7 @
,
№№@ A
propName
№№B J
)
№№J K
;
№№K L
return
¤¤ 

Expression
¤¤ 
.
¤¤ 
Lambda
¤¤ $
(
¤¤$ %
memberExpression
¤¤% 5
,
¤¤5 6
	parameter
¤¤7 @
)
¤¤@ A
;
¤¤A B
}
■■ 	
}
   
}АА │u
_C:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Domain\Core\ViewModels\CommonViewModels.cs
	namespace

 	
Mix


 
.

 
Domain

 
.

 
Core

 
.

 

ViewModels

 $
{ 
public 

class 
	ApiResult 
< 
T 
> 
{ 
[ 	
JsonProperty	 
( 
$str 
) 
] 
public 
T 
Data 
{ 
get 
; 
set  
;  !
}" #
[!! 	
JsonProperty!!	 
(!! 
$str!! 
)!! 
]!!  
public"" 
List"" 
<"" 
string"" 
>"" 
Errors"" "
{""# $
get""% (
;""( )
set""* -
;""- .
}""/ 0
=""1 2
new""3 6
List""7 ;
<""; <
string""< B
>""B C
(""C D
)""D E
;""E F
[** 	
JsonProperty**	 
(** 
$str** !
)**! "
]**" #
public++ 
	Exception++ 
	Exception++ "
{++# $
get++% (
;++( )
set++* -
;++- .
}++/ 0
[33 	
JsonProperty33	 
(33 
$str33 #
)33# $
]33$ %
public44 
string44 
ResponseKey44 !
{44" #
get44$ '
;44' (
set44) ,
;44, -
}44. /
[<< 	
JsonProperty<<	 
(<< 
$str<< 
)<< 
]<<  
public== 
int== 
Status== 
{== 
get== 
;==  
set==! $
;==$ %
}==& '
}>> 
publicCC 

classCC 
EntityFieldCC 
{DD 
[KK 	
JsonPropertyKK	 
(KK 
$strKK $
)KK$ %
]KK% &
publicLL 
stringLL 
PropertyNameLL "
{LL# $
getLL% (
;LL( )
setLL* -
;LL- .
}LL/ 0
[TT 	
JsonPropertyTT	 
(TT 
$strTT %
)TT% &
]TT& '
publicUU 
stringUU 
PropertyValueUU #
{UU$ %
getUU& )
;UU) *
setUU+ .
;UU. /
}UU0 1
}VV 
public[[ 

class[[ 
FileStreamViewModel[[ $
{\\ 
[cc 	
JsonPropertycc	 
(cc 
$strcc 
)cc 
]cc  
publicdd 
stringdd 
Base64dd 
{dd 
getdd "
;dd" #
setdd$ '
;dd' (
}dd) *
[ll 	
JsonPropertyll	 
(ll 
$strll 
)ll 
]ll 
publicmm 
stringmm 
Namemm 
{mm 
getmm  
;mm  !
setmm" %
;mm% &
}mm' (
[uu 	
JsonPropertyuu	 
(uu 
$struu 
)uu 
]uu 
publicvv 
intvv 
Sizevv 
{vv 
getvv 
;vv 
setvv "
;vv" #
}vv$ %
[~~ 	
JsonProperty~~	 
(~~ 
$str~~ 
)~~ 
]~~ 
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
}
АА 
public
ЖЖ 

class
ЖЖ 
PaginationModel
ЖЖ  
<
ЖЖ  !
T
ЖЖ! "
>
ЖЖ" #
{
ЗЗ 
public
ЛЛ 
PaginationModel
ЛЛ 
(
ЛЛ 
)
ЛЛ  
{
ММ 	
	PageIndex
НН 
=
НН 
$num
НН 
;
НН 
PageSize
ОО 
=
ОО 
$num
ОО 
;
ОО 

TotalItems
ПП 
=
ПП 
$num
ПП 
;
ПП 
	TotalPage
РР 
=
РР 
$num
РР 
;
РР 
Items
СС 
=
СС 
new
СС 
List
СС 
<
СС 
T
СС 
>
СС 
(
СС  
)
СС  !
;
СС! "
}
ТТ 	
[
ЪЪ 	
JsonProperty
ЪЪ	 
(
ЪЪ 
$str
ЪЪ 
)
ЪЪ 
]
ЪЪ 
public
ЫЫ 
List
ЫЫ 
<
ЫЫ 
T
ЫЫ 
>
ЫЫ 
Items
ЫЫ 
{
ЫЫ 
get
ЫЫ "
;
ЫЫ" #
set
ЫЫ$ '
;
ЫЫ' (
}
ЫЫ) *
[
гг 	
JsonProperty
гг	 
(
гг 
$str
гг !
)
гг! "
]
гг" #
public
дд 
List
дд 
<
дд 
JObject
дд 
>
дд 
	JsonItems
дд &
{
дд' (
get
дд) ,
;
дд, -
set
дд. 1
;
дд1 2
}
дд3 4
=
дд5 6
new
дд7 :
List
дд; ?
<
дд? @
JObject
дд@ G
>
ддG H
(
ддH I
)
ддI J
;
ддJ K
[
мм 	
JsonProperty
мм	 
(
мм 
$str
мм !
)
мм! "
]
мм" #
public
нн 
int
нн 
	PageIndex
нн 
{
нн 
get
нн "
;
нн" #
set
нн$ '
;
нн' (
}
нн) *
[
╡╡ 	
JsonProperty
╡╡	 
(
╡╡ 
$str
╡╡ 
)
╡╡ 
]
╡╡ 
public
╢╢ 
int
╢╢ 
Page
╢╢ 
{
╢╢ 
get
╢╢ 
{
╢╢ 
return
╢╢  &
	PageIndex
╢╢' 0
+
╢╢1 2
$num
╢╢3 4
;
╢╢4 5
}
╢╢6 7
}
╢╢8 9
[
╛╛ 	
JsonProperty
╛╛	 
(
╛╛ 
$str
╛╛  
)
╛╛  !
]
╛╛! "
public
┐┐ 
int
┐┐ 
?
┐┐ 
PageSize
┐┐ 
{
┐┐ 
get
┐┐ "
;
┐┐" #
set
┐┐$ '
;
┐┐' (
}
┐┐) *
[
╟╟ 	
JsonProperty
╟╟	 
(
╟╟ 
$str
╟╟ "
)
╟╟" #
]
╟╟# $
public
╚╚ 
int
╚╚ 

TotalItems
╚╚ 
{
╚╚ 
get
╚╚  #
;
╚╚# $
set
╚╚% (
;
╚╚( )
}
╚╚* +
[
╨╨ 	
JsonProperty
╨╨	 
(
╨╨ 
$str
╨╨ !
)
╨╨! "
]
╨╨" #
public
╤╤ 
int
╤╤ 
	TotalPage
╤╤ 
{
╤╤ 
get
╤╤ "
;
╤╤" #
set
╤╤$ '
;
╤╤' (
}
╤╤) *
}
╥╥ 
public
╪╪ 

class
╪╪  
RepositoryResponse
╪╪ #
<
╪╪# $
TResult
╪╪$ +
>
╪╪+ ,
{
┘┘ 
[
рр 	
JsonProperty
рр	 
(
рр 
$str
рр !
)
рр! "
]
рр" #
public
сс 
bool
сс 
	IsSucceed
сс 
{
сс 
get
сс  #
;
сс# $
set
сс% (
;
сс( )
}
сс* +
[
щщ 	
JsonProperty
щщ	 
(
щщ 
$str
щщ #
)
щщ# $
]
щщ$ %
public
ъъ 
string
ъъ 
ResponseKey
ъъ !
{
ъъ" #
get
ъъ$ '
;
ъъ' (
set
ъъ) ,
;
ъъ, -
}
ъъ. /
[
ЄЄ 	
JsonProperty
ЄЄ	 
(
ЄЄ 
$str
ЄЄ 
)
ЄЄ 
]
ЄЄ  
public
єє 
int
єє 
Status
єє 
{
єє 
get
єє 
;
єє  
set
єє! $
;
єє$ %
}
єє& '
[
√√ 	
JsonProperty
√√	 
(
√√ 
$str
√√ 
)
√√ 
]
√√  
public
№№ 
List
№№ 
<
№№ 
string
№№ 
>
№№ 
Errors
№№ "
{
№№# $
get
№№% (
;
№№( )
set
№№* -
;
№№- .
}
№№/ 0
=
№№1 2
new
№№3 6
List
№№7 ;
<
№№; <
string
№№< B
>
№№B C
(
№№C D
)
№№D E
;
№№E F
[
ДД 	
JsonProperty
ДД	 
(
ДД 
$str
ДД !
)
ДД! "
]
ДД" #
public
ЕЕ 
	Exception
ЕЕ 
	Exception
ЕЕ "
{
ЕЕ# $
get
ЕЕ% (
;
ЕЕ( )
set
ЕЕ* -
;
ЕЕ- .
}
ЕЕ/ 0
[
НН 	
JsonProperty
НН	 
(
НН 
$str
НН 
)
НН 
]
НН 
public
ОО 
TResult
ОО 
Data
ОО 
{
ОО 
get
ОО !
;
ОО! "
set
ОО# &
;
ОО& '
}
ОО( )
}
ПП 
public
ФФ 

class
ФФ 
RequestObject
ФФ 
{
ХХ 
[
ЬЬ 	
JsonProperty
ЬЬ	 
(
ЬЬ 
$str
ЬЬ  
)
ЬЬ  !
]
ЬЬ! "
public
ЭЭ 
string
ЭЭ 
ViewType
ЭЭ 
{
ЭЭ  
get
ЭЭ! $
;
ЭЭ$ %
set
ЭЭ& )
;
ЭЭ) *
}
ЭЭ+ ,
[
ее 	
JsonProperty
ее	 
(
ее 
$str
ее 
)
ее 
]
ее 
public
жж 
string
жж 
Key
жж 
{
жж 
get
жж 
;
жж  
set
жж! $
;
жж$ %
}
жж& '
[
оо 	
JsonProperty
оо	 
(
оо 
$str
оо 
)
оо  
]
оо  !
public
пп 
string
пп 
Keyword
пп 
{
пп 
get
пп  #
;
пп# $
set
пп% (
;
пп( )
}
пп* +
[
╖╖ 	
JsonProperty
╖╖	 
(
╖╖ 
$str
╖╖ 
)
╖╖ 
]
╖╖  
public
╕╕ 
Common
╕╕ 
.
╕╕ 
Utility
╕╕ 
.
╕╕ 
Enums
╕╕ #
.
╕╕# $
SWStatus
╕╕$ ,
?
╕╕, -
Status
╕╕. 4
{
╕╕5 6
get
╕╕7 :
;
╕╕: ;
set
╕╕< ?
;
╕╕? @
}
╕╕A B
}
╣╣ 
public
╛╛ 

class
╛╛ 
RequestPaging
╛╛ 
{
┐┐ 
[
╞╞ 	
JsonProperty
╞╞	 
(
╞╞ 
$str
╞╞  
)
╞╞  !
]
╞╞! "
public
╟╟ 
string
╟╟ 
ViewType
╟╟ 
{
╟╟  
get
╟╟! $
;
╟╟$ %
set
╟╟& )
;
╟╟) *
}
╟╟+ ,
[
╧╧ 	
JsonProperty
╧╧	 
(
╧╧ 
$str
╧╧ !
)
╧╧! "
]
╧╧" #
public
╨╨ 
int
╨╨ 
	CountryId
╨╨ 
{
╨╨ 
get
╨╨ "
;
╨╨" #
set
╨╨$ '
;
╨╨' (
}
╨╨) *
[
╪╪ 	
JsonProperty
╪╪	 
(
╪╪ 
$str
╪╪ 
)
╪╪  
]
╪╪  !
public
┘┘ 
string
┘┘ 
Culture
┘┘ 
{
┘┘ 
get
┘┘  #
;
┘┘# $
set
┘┘% (
;
┘┘( )
}
┘┘* +
[
сс 	
JsonProperty
сс	 
(
сс 
$str
сс !
)
сс! "
]
сс" #
public
тт 
int
тт 
	Direction
тт 
{
тт 
get
тт "
;
тт" #
set
тт$ '
;
тт' (
}
тт) *
=
тт+ ,
$num
тт- .
;
тт. /
[
ъъ 	
JsonProperty
ъъ	 
(
ъъ 
$str
ъъ 
)
ъъ 
]
ъъ 
public
ыы 
string
ыы 
Key
ыы 
{
ыы 
get
ыы 
;
ыы  
set
ыы! $
;
ыы$ %
}
ыы& '
[
єє 	
JsonProperty
єє	 
(
єє 
$str
єє 
)
єє  
]
єє  !
public
ЇЇ 
string
ЇЇ 
Keyword
ЇЇ 
{
ЇЇ 
get
ЇЇ  #
;
ЇЇ# $
set
ЇЇ% (
;
ЇЇ( )
}
ЇЇ* +
[
№№ 	
JsonProperty
№№	 
(
№№ 
$str
№№ 
)
№№ 
]
№№ 
public
¤¤ 
string
¤¤ 
Query
¤¤ 
{
¤¤ 
get
¤¤ !
;
¤¤! "
set
¤¤# &
;
¤¤& '
}
¤¤( )
[
ЕЕ 	
JsonProperty
ЕЕ	 
(
ЕЕ 
$str
ЕЕ 
)
ЕЕ 
]
ЕЕ  
public
ЖЖ 
int
ЖЖ 
?
ЖЖ 
Status
ЖЖ 
{
ЖЖ 
get
ЖЖ  
;
ЖЖ  !
set
ЖЖ" %
;
ЖЖ% &
}
ЖЖ' (
[
ОО 	
JsonProperty
ОО	 
(
ОО 
$str
ОО 
)
ОО  
]
ОО  !
public
ПП 
string
ПП 
OrderBy
ПП 
{
ПП 
get
ПП  #
;
ПП# $
set
ПП% (
;
ПП( )
}
ПП* +
=
ПП, -
$str
ПП. 2
;
ПП2 3
[
ЧЧ 	
JsonProperty
ЧЧ	 
(
ЧЧ 
$str
ЧЧ !
)
ЧЧ! "
]
ЧЧ" #
public
ШШ 
int
ШШ 
	PageIndex
ШШ 
{
ШШ 
get
ШШ "
;
ШШ" #
set
ШШ$ '
;
ШШ' (
}
ШШ) *
=
ШШ+ ,
$num
ШШ- .
;
ШШ. /
[
аа 	
JsonProperty
аа	 
(
аа 
$str
аа  
)
аа  !
]
аа! "
public
бб 
int
бб 
?
бб 
PageSize
бб 
{
бб 
get
бб "
;
бб" #
set
бб$ '
;
бб' (
}
бб) *
=
бб+ ,
$num
бб- /
;
бб/ 0
[
йй 	
JsonProperty
йй	 
(
йй 
$str
йй !
)
йй! "
]
йй" #
public
кк 
string
кк 
	UserAgent
кк 
{
кк  !
get
кк" %
;
кк% &
set
кк' *
;
кк* +
}
кк, -
[
▓▓ 	
JsonProperty
▓▓	 
(
▓▓ 
$str
▓▓ 
)
▓▓ 
]
▓▓  
public
││ 
string
││ 
UserId
││ 
{
││ 
get
││ "
;
││" #
set
││$ '
;
││' (
}
││) *
[
╡╡ 	
JsonProperty
╡╡	 
(
╡╡ 
$str
╡╡  
)
╡╡  !
]
╡╡! "
public
╢╢ 
DateTime
╢╢ 
?
╢╢ 
FromDate
╢╢ !
{
╢╢" #
get
╢╢$ '
;
╢╢' (
set
╢╢) ,
;
╢╢, -
}
╢╢. /
[
╕╕ 	
JsonProperty
╕╕	 
(
╕╕ 
$str
╕╕ 
)
╕╕ 
]
╕╕  
public
╣╣ 
DateTime
╣╣ 
?
╣╣ 
ToDate
╣╣ 
{
╣╣  !
get
╣╣" %
;
╣╣% &
set
╣╣' *
;
╣╣* +
}
╣╣, -
}
║║ 
}╗╗ є▀
\C:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\Domain\Core\ViewModels\ViewModelBase.cs
	namespace 	
Mix
 
. 
Domain 
. 
Data 
. 

ViewModels $
{ 
public 

abstract 
class 
ViewModelBase '
<' (

TDbContext( 2
,2 3
TModel4 :
,: ;
TView< A
>A B
where 

TDbContext 
: 
	DbContext $
where 
TModel 
: 
class 
where 
TView 
: 
ViewModelBase #
<# $

TDbContext$ .
,. /
TModel0 6
,6 7
TView8 =
>= >
{   
private&& 
bool&& 
isValid&& 
=&& 
true&& #
;&&# $
private++ 
IMapper++ 
_mapper++ 
;++  
private00 
TModel00 
_model00 
;00 
private55 
IMapper55 
_modelMapper55 $
;55$ %
[77 	

JsonIgnore77	 
]77 
public88 
static88 
readonly88 
DefaultRepository88 0
<880 1

TDbContext881 ;
,88; <
TModel88= C
,88C D
TView88E J
>88J K

Repository88L V
;88V W
static:: 
ViewModelBase:: 
(:: 
):: 
{;; 	

Repository<< 
=<< 
DefaultRepository<< *
<<<* +

TDbContext<<+ 5
,<<5 6
TModel<<7 =
,<<= >
TView<<? D
><<D E
.<<E F
Instance<<F N
;<<N O
}== 	
[EE 	

JsonIgnoreEE	 
]EE 
publicFF 
	ExceptionFF 
	ExceptionFF "
{FF# $
getFF% (
;FF( )
setFF* -
;FF- .
}FF/ 0
[NN 	
JsonPropertyNN	 
(NN 
$strNN 
)NN  
]NN  !
publicOO 
boolOO 
IsCloneOO 
{OO 
getOO !
;OO! "
setOO# &
;OO& '
}OO( )
[WW 	

JsonIgnoreWW	 
]WW 
publicXX 
boolXX 

IsLazyLoadXX 
{XX  
getXX! $
;XX$ %
setXX& )
;XX) *
}XX+ ,
=XX- .
trueXX/ 3
;XX3 4
[`` 	
JsonProperty``	 
(`` 
$str``  
)``  !
]``! "
publicaa 
Listaa 
<aa 
SupportedCultureaa $
>aa$ %
Culturesaa& .
{aa/ 0
getaa1 4
;aa4 5
setaa6 9
;aa9 :
}aa; <
[ii 	

JsonIgnoreii	 
]ii 
publicjj 
IMapperjj 
Mapperjj 
{jj 
getkk 
{kk 
returnkk 
_mapperkk  
??kk! #
(kk$ %
_mapperkk% ,
=kk- .
thiskk/ 3
.kk3 4
CreateMapperkk4 @
(kk@ A
)kkA B
)kkB C
;kkC D
}kkE F
setll 
=>ll 
_mapperll 
=ll 
valuell "
;ll" #
}mm 	
[uu 	

JsonIgnoreuu	 
]uu 
publicvv 
TModelvv 
Modelvv 
{vv 
getww 
{ww 
ifxx 
(xx 
_modelxx 
==xx 
nullxx "
)xx" #
{yy 
Typezz 
	classTypezz "
=zz# $
typeofzz% +
(zz+ ,
TModelzz, 2
)zz2 3
;zz3 4
ConstructorInfo{{ #
classConstructor{{$ 4
={{5 6
	classType{{7 @
.{{@ A
GetConstructor{{A O
({{O P
new{{P S
Type{{T X
[{{X Y
]{{Y Z
{{{[ \
}{{] ^
){{^ _
;{{_ `
_model|| 
=|| 
(|| 
TModel|| $
)||$ %
classConstructor||% 5
.||5 6
Invoke||6 <
(||< =
new||= @
object||A G
[||G H
]||H I
{||J K
}||L M
)||M N
;||N O
}}} 
return~~ 
_model~~ 
;~~ 
} 
set
АА 
=>
АА 
_model
АА 
=
АА 
value
АА !
;
АА! "
}
ББ 	
[
ЙЙ 	

JsonIgnore
ЙЙ	 
]
ЙЙ 
public
КК 
IMapper
КК 
ModelMapper
КК "
{
КК# $
get
ЛЛ 
{
ЛЛ 
return
ЛЛ 
_modelMapper
ЛЛ %
??
ЛЛ& (
(
ЛЛ) *
_modelMapper
ЛЛ* 6
=
ЛЛ7 8
this
ЛЛ9 =
.
ЛЛ= >
CreateModelMapper
ЛЛ> O
(
ЛЛO P
)
ЛЛP Q
)
ЛЛQ R
;
ЛЛR S
}
ЛЛT U
set
ММ 
=>
ММ 
_modelMapper
ММ 
=
ММ  !
value
ММ" '
;
ММ' (
}
НН 	
[
ХХ 	
JsonProperty
ХХ	 
(
ХХ 
$str
ХХ  
)
ХХ  !
]
ХХ! "
public
ЦЦ 
int
ЦЦ 
Priority
ЦЦ 
{
ЦЦ 
get
ЦЦ !
;
ЦЦ! "
set
ЦЦ# &
;
ЦЦ& '
}
ЦЦ( )
=
ЦЦ* +
$num
ЦЦ, -
;
ЦЦ- .
[
ЮЮ 	
JsonProperty
ЮЮ	 
(
ЮЮ 
$str
ЮЮ &
)
ЮЮ& '
]
ЮЮ' (
public
ЯЯ 
string
ЯЯ 
Specificulture
ЯЯ $
{
ЯЯ% &
get
ЯЯ' *
;
ЯЯ* +
set
ЯЯ, /
;
ЯЯ/ 0
}
ЯЯ1 2
private
ее 
IMapper
ее 
CreateMapper
ее $
(
ее$ %
)
ее% &
{
жж 	
var
зз 
config
зз 
=
зз 
new
зз !
MapperConfiguration
зз 0
(
зз0 1
cfg
зз1 4
=>
зз5 7
cfg
зз8 ;
.
зз; <
	CreateMap
зз< E
<
ззE F
TModel
ззF L
,
ззL M
TView
ззN S
>
ззS T
(
ззT U
)
ззU V
.
ззV W

ReverseMap
ззW a
(
ззa b
)
ззb c
)
ззc d
;
ззd e
var
ии 
mapper
ии 
=
ии 
new
ии 
Mapper
ии #
(
ии# $
config
ии$ *
)
ии* +
;
ии+ ,
return
йй 
mapper
йй 
;
йй 
}
кк 	
private
░░ 
IMapper
░░ 
CreateModelMapper
░░ )
(
░░) *
)
░░* +
{
▒▒ 	
var
▓▓ 
config
▓▓ 
=
▓▓ 
new
▓▓ !
MapperConfiguration
▓▓ 0
(
▓▓0 1
cfg
▓▓1 4
=>
▓▓5 7
cfg
▓▓8 ;
.
▓▓; <
	CreateMap
▓▓< E
<
▓▓E F
TModel
▓▓F L
,
▓▓L M
TModel
▓▓N T
>
▓▓T U
(
▓▓U V
)
▓▓V W
.
▓▓W X

ReverseMap
▓▓X b
(
▓▓b c
)
▓▓c d
)
▓▓d e
;
▓▓e f
var
││ 
mapper
││ 
=
││ 
new
││ 
Mapper
││ #
(
││# $
config
││$ *
)
││* +
;
││+ ,
return
┤┤ 
mapper
┤┤ 
;
┤┤ 
}
╡╡ 	
[
╖╖ 	

JsonIgnore
╖╖	 
]
╖╖ 
public
╕╕ 
List
╕╕ 
<
╕╕ 
string
╕╕ 
>
╕╕ 
Errors
╕╕ "
{
╕╕# $
get
╕╕% (
;
╕╕( )
set
╕╕* -
;
╕╕- .
}
╕╕/ 0
=
╕╕1 2
new
╕╕3 6
List
╕╕7 ;
<
╕╕; <
string
╕╕< B
>
╕╕B C
(
╕╕C D
)
╕╕D E
;
╕╕E F
[
║║ 	

JsonIgnore
║║	 
]
║║ 
[
╗╗ 	
JsonProperty
╗╗	 
(
╗╗ 
$str
╗╗ 
)
╗╗  
]
╗╗  !
public
╝╝ 
bool
╝╝ 
IsValid
╝╝ 
{
╝╝ 
get
╝╝ !
=>
╝╝" $
isValid
╝╝% ,
;
╝╝, -
set
╝╝. 1
=>
╝╝2 4
isValid
╝╝5 <
=
╝╝= >
value
╝╝? D
;
╝╝D E
}
╝╝F G
public
╞╞ 
virtual
╞╞ 
TModel
╞╞ 
	InitModel
╞╞ '
(
╞╞' (
)
╞╞( )
{
╟╟ 	
Type
╚╚ 
	classType
╚╚ 
=
╚╚ 
typeof
╚╚ #
(
╚╚# $
TModel
╚╚$ *
)
╚╚* +
;
╚╚+ ,
ConstructorInfo
╔╔ 
classConstructor
╔╔ ,
=
╔╔- .
	classType
╔╔/ 8
.
╔╔8 9
GetConstructor
╔╔9 G
(
╔╔G H
new
╔╔H K
Type
╔╔L P
[
╔╔P Q
]
╔╔Q R
{
╔╔S T
}
╔╔U V
)
╔╔V W
;
╔╔W X
TModel
╩╩ 
context
╩╩ 
=
╩╩ 
(
╩╩ 
TModel
╩╩ $
)
╩╩$ %
classConstructor
╩╩% 5
.
╩╩5 6
Invoke
╩╩6 <
(
╩╩< =
new
╩╩= @
object
╩╩A G
[
╩╩G H
]
╩╩H I
{
╩╩J K
}
╩╩L M
)
╩╩M N
;
╩╩N O
return
╠╠ 
context
╠╠ 
;
╠╠ 
}
══ 	
public
╙╙ 
virtual
╙╙ 
TModel
╙╙ 

ParseModel
╙╙ (
(
╙╙( )

TDbContext
╙╙) 3
_context
╙╙4 <
=
╙╙= >
null
╙╙? C
,
╙╙C D#
IDbContextTransaction
╙╙E Z
_transaction
╙╙[ g
=
╙╙h i
null
╙╙j n
)
╙╙n o
{
╘╘ 	
this
╓╓ 
.
╓╓ 
Model
╓╓ 
=
╓╓ 
	InitModel
╓╓ "
(
╓╓" #
)
╓╓# $
;
╓╓$ %
Mapper
╫╫ 
.
╫╫ 
Map
╫╫ 
<
╫╫ 
TView
╫╫ 
,
╫╫ 
TModel
╫╫ $
>
╫╫$ %
(
╫╫% &
(
╫╫& '
TView
╫╫' ,
)
╫╫, -
this
╫╫- 1
,
╫╫1 2
Model
╫╫3 8
)
╫╫8 9
;
╫╫9 :
return
╪╪ 
this
╪╪ 
.
╪╪ 
Model
╪╪ 
;
╪╪ 
}
┘┘ 	
public
рр 
virtual
рр 
void
рр 
Validate
рр $
(
рр$ %

TDbContext
рр% /
_context
рр0 8
,
рр8 9#
IDbContextTransaction
рр: O
_transaction
ррP \
)
рр\ ]
{
сс 	
var
тт 
validateContext
тт 
=
тт  !
new
тт" %
System
тт& ,
.
тт, -
ComponentModel
тт- ;
.
тт; <
DataAnnotations
тт< K
.
ттK L
ValidationContext
ттL ]
(
тт] ^
this
тт^ b
,
ттb c
serviceProvider
ттd s
:
ттs t
null
ттu y
,
ттy z
itemsтт{ А
:ттА Б
nullттВ Ж
)ттЖ З
;ттЗ И
var
уу 
results
уу 
=
уу 
new
уу 
List
уу "
<
уу" #
ValidationResult
уу# 3
>
уу3 4
(
уу4 5
)
уу5 6
;
уу6 7
IsValid
хх 
=
хх 
	Validator
хх 
.
хх  
TryValidateObject
хх  1
(
хх1 2
this
хх2 6
,
хх6 7
validateContext
хх8 G
,
ххG H
results
ххI P
)
ххP Q
;
ххQ R
if
цц 
(
цц 
!
цц 
IsValid
цц 
)
цц 
{
чч 
Errors
шш 
.
шш 
AddRange
шш 
(
шш  
results
шш  '
.
шш' (
Select
шш( .
(
шш. /
e
шш/ 0
=>
шш1 3
e
шш4 5
.
шш5 6
ErrorMessage
шш6 B
)
шшB C
)
шшC D
;
шшD E
}
щщ 
}
ъъ 	
public
її 
virtual
її 
Task
її 
<
її 
bool
її  
>
її  !
ExpandViewAsync
її" 1
(
її1 2

TDbContext
її2 <
_context
її= E
=
їїF G
null
їїH L
,
їїL M#
IDbContextTransaction
їїN c
_transaction
їїd p
=
їїq r
null
їїs w
)
їїw x
{
ЎЎ 	
var
ўў 

taskSource
ўў 
=
ўў 
new
ўў  "
TaskCompletionSource
ўў! 5
<
ўў5 6
bool
ўў6 :
>
ўў: ;
(
ўў; <
)
ўў< =
;
ўў= >

taskSource
°° 
.
°° 
	SetResult
°°  
(
°°  !
true
°°! %
)
°°% &
;
°°& '
return
∙∙ 

taskSource
∙∙ 
.
∙∙ 
Task
∙∙ "
;
∙∙" #
}
·· 	
public
ДД 
static
ДД 
async
ДД 
Task
ДД  
<
ДД  !
TView
ДД! &
>
ДД& '
InitViewAsync
ДД( 5
(
ДД5 6
TModel
ДД6 <
model
ДД= B
=
ДДC D
null
ДДE I
,
ДДI J
bool
ДДK O

isLazyLoad
ДДP Z
=
ДД[ \
true
ДД] a
,
ДДa b

TDbContext
ДДc m
_context
ДДn v
=
ДДw x
null
ДДy }
,
ДД} ~$
IDbContextTransactionДД Ф
_transactionДДХ б
=ДДв г
nullДДд и
)ДДи й
{
ЕЕ 	
Type
ЖЖ 
	classType
ЖЖ 
=
ЖЖ 
typeof
ЖЖ #
(
ЖЖ# $
TView
ЖЖ$ )
)
ЖЖ) *
;
ЖЖ* +
ConstructorInfo
ИИ 
classConstructor
ИИ ,
=
ИИ- .
	classType
ИИ/ 8
.
ИИ8 9
GetConstructor
ИИ9 G
(
ИИG H
new
ИИH K
Type
ИИL P
[
ИИP Q
]
ИИQ R
{
ИИS T
}
ИИU V
)
ИИV W
;
ИИW X
if
ЙЙ 
(
ЙЙ 
model
ЙЙ 
==
ЙЙ 
null
ЙЙ 
&&
ЙЙ  
classConstructor
ЙЙ! 1
!=
ЙЙ2 4
null
ЙЙ5 9
)
ЙЙ9 :
{
КК 
var
ЛЛ 
view
ЛЛ 
=
ЛЛ 
(
ЛЛ 
TView
ЛЛ !
)
ЛЛ! "
classConstructor
ЛЛ" 2
.
ЛЛ2 3
Invoke
ЛЛ3 9
(
ЛЛ9 :
new
ЛЛ: =
object
ЛЛ> D
[
ЛЛD E
]
ЛЛE F
{
ЛЛG H
}
ЛЛI J
)
ЛЛJ K
;
ЛЛK L
await
ММ 
view
ММ 
.
ММ 
ParseViewAsync
ММ )
(
ММ) *
true
ММ* .
,
ММ. /
_context
ММ0 8
,
ММ8 9
_transaction
ММ: F
)
ММF G
;
ММG H
return
НН 
view
НН 
;
НН 
}
ОО 
else
ПП 
{
РР 
classConstructor
СС  
=
СС! "
	classType
СС# ,
.
СС, -
GetConstructor
СС- ;
(
СС; <
new
СС< ?
Type
СС@ D
[
ССD E
]
ССE F
{
ССG H
typeof
ССI O
(
ССO P
TModel
ССP V
)
ССV W
,
ССW X
typeof
ССY _
(
СС_ `
bool
СС` d
)
ССd e
,
ССe f
typeof
ССg m
(
ССm n

TDbContext
ССn x
)
ССx y
,
ССy z
typeofСС{ Б
(ССБ В%
IDbContextTransactionССВ Ч
)ССЧ Ш
}ССЩ Ъ
)ССЪ Ы
;ССЫ Ь
if
ТТ 
(
ТТ 
classConstructor
ТТ $
!=
ТТ% '
null
ТТ( ,
)
ТТ, -
{
УУ 
var
ФФ 
view
ФФ 
=
ФФ 
(
ФФ  
TView
ФФ  %
)
ФФ% &
classConstructor
ФФ& 6
.
ФФ6 7
Invoke
ФФ7 =
(
ФФ= >
new
ФФ> A
object
ФФB H
[
ФФH I
]
ФФI J
{
ФФK L
model
ФФM R
,
ФФR S

isLazyLoad
ФФT ^
,
ФФ^ _
_context
ФФ` h
,
ФФh i
_transaction
ФФj v
}
ФФw x
)
ФФx y
;
ФФy z
await
ХХ 
view
ХХ 
.
ХХ 
ParseViewAsync
ХХ -
(
ХХ- .

isLazyLoad
ХХ. 8
,
ХХ8 9
_context
ХХ: B
,
ХХB C
_transaction
ХХD P
)
ХХP Q
;
ХХQ R
return
ЦЦ 
view
ЦЦ 
;
ЦЦ  
}
ЧЧ 
else
ШШ 
{
ЩЩ 
classConstructor
ЪЪ $
=
ЪЪ% &
	classType
ЪЪ' 0
.
ЪЪ0 1
GetConstructor
ЪЪ1 ?
(
ЪЪ? @
new
ЪЪ@ C
Type
ЪЪD H
[
ЪЪH I
]
ЪЪI J
{
ЪЪK L
typeof
ЪЪM S
(
ЪЪS T
TModel
ЪЪT Z
)
ЪЪZ [
,
ЪЪ[ \
typeof
ЪЪ] c
(
ЪЪc d

TDbContext
ЪЪd n
)
ЪЪn o
,
ЪЪo p
typeof
ЪЪq w
(
ЪЪw x$
IDbContextTransactionЪЪx Н
)ЪЪН О
}ЪЪП Р
)ЪЪР С
;ЪЪС Т
var
ЫЫ 
view
ЫЫ 
=
ЫЫ 
(
ЫЫ  
TView
ЫЫ  %
)
ЫЫ% &
classConstructor
ЫЫ& 6
.
ЫЫ6 7
Invoke
ЫЫ7 =
(
ЫЫ= >
new
ЫЫ> A
object
ЫЫB H
[
ЫЫH I
]
ЫЫI J
{
ЫЫK L
model
ЫЫM R
,
ЫЫR S
_context
ЫЫT \
,
ЫЫ\ ]
_transaction
ЫЫ^ j
}
ЫЫk l
)
ЫЫl m
;
ЫЫm n
await
ЬЬ 
view
ЬЬ 
.
ЬЬ 
ParseViewAsync
ЬЬ -
(
ЬЬ- .

isLazyLoad
ЬЬ. 8
,
ЬЬ8 9
_context
ЬЬ: B
,
ЬЬB C
_transaction
ЬЬD P
)
ЬЬP Q
;
ЬЬQ R
return
ЭЭ 
view
ЭЭ 
;
ЭЭ  
}
ЮЮ 
}
ЯЯ 
}
аа 	
public
йй 
virtual
йй 
async
йй 
Task
йй !
<
йй! "
TView
йй" '
>
йй' (
ParseViewAsync
йй) 7
(
йй7 8
bool
йй8 <
isExpand
йй= E
=
ййF G
true
ййH L
,
ййL M

TDbContext
ййN X
_context
ййY a
=
ййb c
null
ййd h
,
ййh i#
IDbContextTransaction
ййj 
_transactionййА М
=ййН О
nullййП У
)
кк4 5
{
лл 	
Mapper
мм 
.
мм 
Map
мм 
<
мм 
TModel
мм 
,
мм 
TView
мм $
>
мм$ %
(
мм% &
Model
мм& +
,
мм+ ,
(
мм- .
TView
мм. 3
)
мм3 4
this
мм4 8
)
мм8 9
;
мм9 :
if
нн 
(
нн 
isExpand
нн 
)
нн 
{
оо 
UnitOfWorkHelper
пп  
<
пп  !

TDbContext
пп! +
>
пп+ ,
.
пп, -
InitTransaction
пп- <
(
пп< =
_context
пп= E
,
ппE F
_transaction
ппG S
,
ппS T
out
ппU X

TDbContext
ппY c
context
ппd k
,
ппk l
out
ппm p$
IDbContextTransactionппq Ж
transactionппЗ Т
,ппТ У
outппФ Ч
boolппШ Ь
isRootппЭ г
)ппг д
;ппд е
try
░░ 
{
▒▒ 
var
▓▓ 
expandResult
▓▓ $
=
▓▓% &
await
▓▓' ,
ExpandViewAsync
▓▓- <
(
▓▓< =
context
▓▓= D
,
▓▓D E
transaction
▓▓F Q
)
▓▓Q R
;
▓▓R S
if
││ 
(
││ 
expandResult
││ $
)
││$ %
{
┤┤ 
return
╡╡ 
this
╡╡ #
as
╡╡$ &
TView
╡╡' ,
;
╡╡, -
}
╢╢ 
else
╖╖ 
{
╕╕ 
return
╣╣ 
null
╣╣ #
;
╣╣# $
}
║║ 
}
╗╗ 
catch
╝╝ 
(
╝╝ 
	Exception
╝╝  
ex
╝╝! #
)
╝╝# $
{
╜╜ 

Repository
╛╛ 
.
╛╛ 
LogErrorMessage
╛╛ .
(
╛╛. /
ex
╛╛/ 1
)
╛╛1 2
;
╛╛2 3
if
┐┐ 
(
┐┐ 
isRoot
┐┐ 
)
┐┐ 
{
└└ 
transaction
┬┬ #
.
┬┬# $
Rollback
┬┬$ ,
(
┬┬, -
)
┬┬- .
;
┬┬. /
}
├├ 
}
── 
finally
┼┼ 
{
╞╞ 
if
╟╟ 
(
╟╟ 
isRoot
╟╟ 
)
╟╟ 
{
╚╚ 
context
╩╩ 
.
╩╩  
Dispose
╩╩  '
(
╩╩' (
)
╩╩( )
;
╩╩) *
}
╦╦ 
}
╠╠ 
}
══ 
return
╬╬ 
(
╬╬ 
TView
╬╬ 
)
╬╬ 
this
╬╬ 
;
╬╬ 
}
╧╧ 	
public
┘┘ 
virtual
┘┘ 
async
┘┘ 
Task
┘┘ !
<
┘┘! " 
RepositoryResponse
┘┘" 4
<
┘┘4 5
List
┘┘5 9
<
┘┘9 :
TView
┘┘: ?
>
┘┘? @
>
┘┘@ A
>
┘┘A B

CloneAsync
┘┘C M
(
┘┘M N
TModel
┘┘N T
model
┘┘U Z
,
┘┘Z [
List
┘┘\ `
<
┘┘` a
SupportedCulture
┘┘a q
>
┘┘q r
cloneCultures┘┘s А
,
┌┌ 

TDbContext
┌┌ 
_context
┌┌ !
=
┌┌" #
null
┌┌$ (
,
┌┌( )#
IDbContextTransaction
┌┌* ?
_transaction
┌┌@ L
=
┌┌M N
null
┌┌O S
)
┌┌S T
{
██ 	
UnitOfWorkHelper
▄▄ 
<
▄▄ 

TDbContext
▄▄ '
>
▄▄' (
.
▄▄( )
InitTransaction
▄▄) 8
(
▄▄8 9
_context
▄▄9 A
,
▄▄A B
_transaction
▄▄C O
,
▄▄O P
out
▄▄Q T

TDbContext
▄▄U _
context
▄▄` g
,
▄▄g h
out
▄▄i l$
IDbContextTransaction▄▄m В
transaction▄▄Г О
,▄▄О П
out▄▄Р У
bool▄▄Ф Ш
isRoot▄▄Щ Я
)▄▄Я а
;▄▄а б 
RepositoryResponse
▌▌ 
<
▌▌ 
List
▌▌ #
<
▌▌# $
TView
▌▌$ )
>
▌▌) *
>
▌▌* +
result
▌▌, 2
=
▌▌3 4
new
▌▌5 8 
RepositoryResponse
▌▌9 K
<
▌▌K L
List
▌▌L P
<
▌▌P Q
TView
▌▌Q V
>
▌▌V W
>
▌▌W X
(
▌▌X Y
)
▌▌Y Z
{
▐▐ 
	IsSucceed
▀▀ 
=
▀▀ 
true
▀▀  
,
▀▀  !
Data
рр 
=
рр 
new
рр 
List
рр 
<
рр  
TView
рр  %
>
рр% &
(
рр& '
)
рр' (
}
сс 
;
сс 
try
уу 
{
фф 
if
хх 
(
хх 
cloneCultures
хх !
!=
хх" $
null
хх% )
)
хх) *
{
цц 
foreach
чч 
(
чч 
var
чч  
culture
чч! (
in
чч) +
cloneCultures
чч, 9
)
чч9 :
{
шш 
string
щщ 
desSpecificulture
щщ 0
=
щщ1 2
culture
щщ3 :
.
щщ: ;
Specificulture
щщ; I
;
щщI J
TView
ыы 
view
ыы "
=
ыы# $
InitView
ыы% -
(
ыы- .
)
ыы. /
;
ыы/ 0
view
ьь 
.
ьь 
Model
ьь "
=
ьь# $
model
ьь% *
;
ьь* +
view
ээ 
.
ээ 
	ParseView
ээ &
(
ээ& '
isExpand
ээ' /
:
ээ/ 0
false
ээ1 6
,
ээ6 7
_context
ээ8 @
:
ээ@ A
context
ээB I
,
ээI J
_transaction
ээK W
:
ээW X
transaction
ээY d
)
ээd e
;
ээe f
view
юю 
.
юю 
Specificulture
юю +
=
юю, -
desSpecificulture
юю. ?
;
юю? @
bool
ЁЁ 
isExist
ЁЁ $
=
ЁЁ% &

Repository
ЁЁ' 1
.
ЁЁ1 2
CheckIsExists
ЁЁ2 ?
(
ЁЁ? @
view
ЁЁ@ D
.
ЁЁD E

ParseModel
ЁЁE O
(
ЁЁO P
context
ЁЁP W
,
ЁЁW X
transaction
ЁЁY d
)
ЁЁd e
,
ЁЁe f
_context
ЁЁg o
:
ЁЁo p
context
ЁЁq x
,
ЁЁx y
_transactionЁЁz Ж
:ЁЁЖ З
transactionЁЁИ У
)ЁЁУ Ф
;ЁЁФ Х
if
ЄЄ 
(
ЄЄ 
isExist
ЄЄ #
)
ЄЄ# $
{
єє 
result
ЇЇ "
.
ЇЇ" #
	IsSucceed
ЇЇ# ,
=
ЇЇ- .
true
ЇЇ/ 3
;
ЇЇ3 4
result
її "
.
її" #
Data
її# '
.
її' (
Add
її( +
(
її+ ,
view
її, 0
)
її0 1
;
її1 2
}
ЎЎ 
else
ўў 
{
°° 
var
∙∙ 
cloneResult
∙∙  +
=
∙∙, -
await
∙∙. 3
view
∙∙4 8
.
∙∙8 9
SaveModelAsync
∙∙9 G
(
∙∙G H
false
∙∙H M
,
∙∙M N
context
∙∙O V
,
∙∙V W
transaction
∙∙X c
)
∙∙c d
.
∙∙d e
ConfigureAwait
∙∙e s
(
∙∙s t
false
∙∙t y
)
∙∙y z
;
∙∙z {
if
·· 
(
··  
cloneResult
··  +
.
··+ ,
	IsSucceed
··, 5
)
··5 6
{
√√ 
var
№№  #
cloneSubResult
№№$ 2
=
№№3 4
await
№№5 :!
CloneSubModelsAsync
№№; N
(
№№N O
cloneResult
№№O Z
.
№№Z [
Data
№№[ _
,
№№_ `
cloneCultures
№№a n
,
№№n o
context
№№p w
,
№№w x
transaction№№y Д
)№№Д Е
.№№Е Ж
ConfigureAwait№№Ж Ф
(№№Ф Х
false№№Х Ъ
)№№Ъ Ы
;№№Ы Ь
if
¤¤  "
(
¤¤# $
!
¤¤$ %
cloneSubResult
¤¤% 3
.
¤¤3 4
	IsSucceed
¤¤4 =
)
¤¤= >
{
■■  !
cloneResult
  $ /
.
  / 0
Errors
  0 6
.
  6 7
AddRange
  7 ?
(
  ? @
cloneSubResult
  @ N
.
  N O
Errors
  O U
)
  U V
;
  V W
cloneResult
АА$ /
.
АА/ 0
	Exception
АА0 9
=
АА: ;
cloneSubResult
АА< J
.
ААJ K
	Exception
ААK T
;
ААT U
}
ББ  !
result
ГГ  &
.
ГГ& '
	IsSucceed
ГГ' 0
=
ГГ1 2
result
ГГ3 9
.
ГГ9 :
	IsSucceed
ГГ: C
&&
ГГD F
cloneResult
ГГG R
.
ГГR S
	IsSucceed
ГГS \
&&
ГГ] _
cloneSubResult
ГГ` n
.
ГГn o
	IsSucceed
ГГo x
;
ГГx y
}
ЕЕ 
else
ЖЖ  
{
ЗЗ 
result
ИИ  &
.
ИИ& '
	IsSucceed
ИИ' 0
=
ИИ1 2
result
ИИ3 9
.
ИИ9 :
	IsSucceed
ИИ: C
&&
ИИD F
cloneResult
ИИG R
.
ИИR S
	IsSucceed
ИИS \
;
ИИ\ ]
result
ЙЙ  &
.
ЙЙ& '
Errors
ЙЙ' -
.
ЙЙ- .
AddRange
ЙЙ. 6
(
ЙЙ6 7
cloneResult
ЙЙ7 B
.
ЙЙB C
Errors
ЙЙC I
)
ЙЙI J
;
ЙЙJ K
result
КК  &
.
КК& '
	Exception
КК' 0
=
КК1 2
cloneResult
КК3 >
.
КК> ?
	Exception
КК? H
;
ККH I
}
ЛЛ 
}
ММ 
UnitOfWorkHelper
НН (
<
НН( )

TDbContext
НН) 3
>
НН3 4
.
НН4 5
HandleTransaction
НН5 F
(
ННF G
result
ННG M
.
ННM N
	IsSucceed
ННN W
,
ННW X
isRoot
ННY _
,
НН_ `
transaction
ННa l
)
ННl m
;
ННm n
}
ОО 
return
ПП 
result
ПП !
;
ПП! "
}
РР 
else
СС 
{
ТТ 
return
УУ 
result
УУ !
;
УУ! "
}
ФФ 
}
ХХ 
catch
ЦЦ 
(
ЦЦ 
	Exception
ЦЦ 
ex
ЦЦ 
)
ЦЦ  
{
ЧЧ 
return
ШШ 
UnitOfWorkHelper
ШШ '
<
ШШ' (

TDbContext
ШШ( 2
>
ШШ2 3
.
ШШ3 4
HandleException
ШШ4 C
<
ШШC D
List
ШШD H
<
ШШH I
TView
ШШI N
>
ШШN O
>
ШШO P
(
ШШP Q
ex
ШШQ S
,
ШШS T
isRoot
ШШU [
,
ШШ[ \
transaction
ШШ] h
)
ШШh i
;
ШШi j
}
ЩЩ 
finally
ЪЪ 
{
ЫЫ 
if
ЬЬ 
(
ЬЬ 
isRoot
ЬЬ 
)
ЬЬ 
{
ЭЭ 
context
ЮЮ 
.
ЮЮ 
Dispose
ЮЮ #
(
ЮЮ# $
)
ЮЮ$ %
;
ЮЮ% &
}
ЯЯ 
}
аа 
}
бб 	
public
лл 
virtual
лл 
async
лл 
Task
лл !
<
лл! " 
RepositoryResponse
лл" 4
<
лл4 5
bool
лл5 9
>
лл9 :
>
лл: ;!
CloneSubModelsAsync
лл< O
(
ллO P
TView
ллP U
parent
ллV \
,
лл\ ]
List
лл^ b
<
ллb c
SupportedCulture
ллc s
>
ллs t
cloneCulturesллu В
,ллВ Г

TDbContextллД О
_contextллП Ч
=ллШ Щ
nullллЪ Ю
,ллЮ Я%
IDbContextTransactionлла ╡
_transactionлл╢ ┬
=лл├ ─
nullлл┼ ╔
)лл╔ ╩
{
мм 	
var
нн 

taskSource
нн 
=
нн 
new
нн  "
TaskCompletionSource
нн! 5
<
нн5 6 
RepositoryResponse
нн6 H
<
ннH I
bool
ннI M
>
ннM N
>
ннN O
(
ннO P
)
ннP Q
;
ннQ R

taskSource
оо 
.
оо 
	SetResult
оо  
(
оо  !
new
оо! $ 
RepositoryResponse
оо% 7
<
оо7 8
bool
оо8 <
>
оо< =
(
оо= >
)
оо> ?
{
оо@ A
	IsSucceed
ооB K
=
ооL M
true
ооN R
,
ооR S
Data
ооT X
=
ооY Z
true
оо[ _
}
оо` a
)
ооa b
;
ооb c
return
пп 
await
пп 

taskSource
пп #
.
пп# $
Task
пп$ (
;
пп( )
}
░░ 	
public
╣╣ 
virtual
╣╣ 
async
╣╣ 
Task
╣╣ !
<
╣╣! " 
RepositoryResponse
╣╣" 4
<
╣╣4 5
TModel
╣╣5 ;
>
╣╣; <
>
╣╣< =
RemoveModelAsync
╣╣> N
(
╣╣N O
bool
╣╣O S#
isRemoveRelatedModels
╣╣T i
=
╣╣j k
false
╣╣l q
,
╣╣q r

TDbContext
╣╣s }
_context╣╣~ Ж
=╣╣З И
null╣╣Й Н
,╣╣Н О%
IDbContextTransaction╣╣П д
_transaction╣╣е ▒
=╣╣▓ │
null╣╣┤ ╕
)╣╣╕ ╣
{
║║ 	
UnitOfWorkHelper
╗╗ 
<
╗╗ 

TDbContext
╗╗ '
>
╗╗' (
.
╗╗( )
InitTransaction
╗╗) 8
(
╗╗8 9
_context
╗╗9 A
,
╗╗A B
_transaction
╗╗C O
,
╗╗O P
out
╗╗Q T

TDbContext
╗╗U _
context
╗╗` g
,
╗╗g h
out
╗╗i l$
IDbContextTransaction╗╗m В
transaction╗╗Г О
,╗╗О П
out╗╗Р У
bool╗╗Ф Ш
isRoot╗╗Щ Я
)╗╗Я а
;╗╗а б 
RepositoryResponse
╜╜ 
<
╜╜ 
TModel
╜╜ %
>
╜╜% &
result
╜╜' -
=
╜╜. /
new
╜╜0 3 
RepositoryResponse
╜╜4 F
<
╜╜F G
TModel
╜╜G M
>
╜╜M N
(
╜╜N O
)
╜╜O P
{
╜╜Q R
	IsSucceed
╜╜S \
=
╜╜] ^
true
╜╜_ c
}
╜╜d e
;
╜╜e f
try
╛╛ 
{
┐┐ 

ParseModel
└└ 
(
└└ 
_context
└└ #
,
└└# $
_transaction
└└% 1
)
└└1 2
;
└└2 3
if
┴┴ 
(
┴┴ #
isRemoveRelatedModels
┴┴ )
)
┴┴) *
{
┬┬ 
var
├├ !
removeRelatedResult
├├ +
=
├├, -
await
├├. 3&
RemoveRelatedModelsAsync
├├4 L
(
├├L M
(
├├M N
TView
├├N S
)
├├S T
this
├├T X
,
├├X Y
context
├├Z a
,
├├a b
transaction
├├c n
)
├├n o
.
├├o p
ConfigureAwait
├├p ~
(
├├~ 
false├├ Д
)├├Д Е
;├├Е Ж
if
── 
(
── !
removeRelatedResult
── +
.
──+ ,
	IsSucceed
──, 5
)
──5 6
{
┼┼ 
result
╞╞ 
=
╞╞  
await
╞╞! &

Repository
╞╞' 1
.
╞╞1 2
RemoveModelAsync
╞╞2 B
(
╞╞B C
Model
╞╞C H
,
╞╞H I
context
╞╞J Q
,
╞╞Q R
transaction
╞╞S ^
)
╞╞^ _
.
╞╞_ `
ConfigureAwait
╞╞` n
(
╞╞n o
false
╞╞o t
)
╞╞t u
;
╞╞u v
}
╟╟ 
else
╚╚ 
{
╔╔ 
result
╩╩ 
.
╩╩ 
	IsSucceed
╩╩ (
=
╩╩) *
result
╩╩+ 1
.
╩╩1 2
	IsSucceed
╩╩2 ;
&&
╩╩< >!
removeRelatedResult
╩╩? R
.
╩╩R S
	IsSucceed
╩╩S \
;
╩╩\ ]
result
╦╦ 
.
╦╦ 
Errors
╦╦ %
.
╦╦% &
AddRange
╦╦& .
(
╦╦. /!
removeRelatedResult
╦╦/ B
.
╦╦B C
Errors
╦╦C I
)
╦╦I J
;
╦╦J K
result
╠╠ 
.
╠╠ 
	Exception
╠╠ (
=
╠╠) *!
removeRelatedResult
╠╠+ >
.
╠╠> ?
	Exception
╠╠? H
;
╠╠H I
}
══ 
}
╬╬ 
else
╧╧ 
{
╨╨ 
result
╤╤ 
=
╤╤ 
await
╤╤ "

Repository
╤╤# -
.
╤╤- .
RemoveModelAsync
╤╤. >
(
╤╤> ?
Model
╤╤? D
,
╤╤D E
context
╤╤F M
,
╤╤M N
transaction
╤╤O Z
)
╤╤Z [
.
╤╤[ \
ConfigureAwait
╤╤\ j
(
╤╤j k
false
╤╤k p
)
╤╤p q
;
╤╤q r
}
╥╥ 
UnitOfWorkHelper
╙╙  
<
╙╙  !

TDbContext
╙╙! +
>
╙╙+ ,
.
╙╙, -
HandleTransaction
╙╙- >
(
╙╙> ?
result
╙╙? E
.
╙╙E F
	IsSucceed
╙╙F O
,
╙╙O P
isRoot
╙╙Q W
,
╙╙W X
transaction
╙╙Y d
)
╙╙d e
;
╙╙e f
return
╘╘ 
result
╘╘ 
;
╘╘ 
}
╒╒ 
catch
╓╓ 
(
╓╓ 
	Exception
╓╓ 
ex
╓╓ 
)
╓╓  
{
╫╫ 
return
╪╪ 
UnitOfWorkHelper
╪╪ '
<
╪╪' (

TDbContext
╪╪( 2
>
╪╪2 3
.
╪╪3 4
HandleException
╪╪4 C
<
╪╪C D
TModel
╪╪D J
>
╪╪J K
(
╪╪K L
ex
╪╪L N
,
╪╪N O
isRoot
╪╪P V
,
╪╪V W
transaction
╪╪X c
)
╪╪c d
;
╪╪d e
}
┘┘ 
finally
┌┌ 
{
██ 
if
▄▄ 
(
▄▄ 
isRoot
▄▄ 
)
▄▄ 
{
▌▌ 
context
▀▀ 
.
▀▀ 
Dispose
▀▀ #
(
▀▀# $
)
▀▀$ %
;
▀▀% &
}
рр 
}
сс 
}
тт 	
public
ыы 
virtual
ыы 
async
ыы 
Task
ыы !
<
ыы! " 
RepositoryResponse
ыы" 4
<
ыы4 5
bool
ыы5 9
>
ыы9 :
>
ыы: ;&
RemoveRelatedModelsAsync
ыы< T
(
ыыT U
TView
ыыU Z
view
ыы[ _
,
ыы_ `

TDbContext
ыыa k
_context
ыыl t
=
ыыu v
null
ыыw {
,
ыы{ |$
IDbContextTransactionыы} Т
_transactionыыУ Я
=ыыа б
nullыыв ж
)ыыж з
{
ьь 	
var
ээ 

taskSource
ээ 
=
ээ 
new
ээ  "
TaskCompletionSource
ээ! 5
<
ээ5 6 
RepositoryResponse
ээ6 H
<
ээH I
bool
ээI M
>
ээM N
>
ээN O
(
ээO P
)
ээP Q
;
ээQ R

taskSource
юю 
.
юю 
	SetResult
юю  
(
юю  !
new
юю! $ 
RepositoryResponse
юю% 7
<
юю7 8
bool
юю8 <
>
юю< =
(
юю= >
)
юю> ?
{
юю@ A
	IsSucceed
ююB K
=
ююL M
true
ююN R
}
ююS T
)
ююT U
;
ююU V
return
яя 
await
яя 

taskSource
яя #
.
яя# $
Task
яя$ (
;
яя( )
}
ЁЁ 	
public
∙∙ 
virtual
∙∙ 
async
∙∙ 
Task
∙∙ !
<
∙∙! " 
RepositoryResponse
∙∙" 4
<
∙∙4 5
TView
∙∙5 :
>
∙∙: ;
>
∙∙; <
SaveModelAsync
∙∙= K
(
∙∙K L
bool
∙∙L P
isSaveSubModels
∙∙Q `
=
∙∙a b
false
∙∙c h
,
∙∙h i

TDbContext
∙∙j t
_context
∙∙u }
=
∙∙~ 
null∙∙А Д
,∙∙Д Е%
IDbContextTransaction∙∙Ж Ы
_transaction∙∙Ь и
=∙∙й к
null∙∙л п
)∙∙п ░
{
·· 	
UnitOfWorkHelper
√√ 
<
√√ 

TDbContext
√√ '
>
√√' (
.
√√( )
InitTransaction
√√) 8
(
√√8 9
_context
√√9 A
,
√√A B
_transaction
√√C O
,
√√O P
out
√√Q T

TDbContext
√√U _
context
√√` g
,
√√g h
out
√√i l$
IDbContextTransaction√√m В
transaction√√Г О
,√√О П
out√√Р У
bool√√Ф Ш
isRoot√√Щ Я
)√√Я а
;√√а б 
RepositoryResponse
№№ 
<
№№ 
TView
№№ $
>
№№$ %
result
№№& ,
=
№№- .
new
№№/ 2 
RepositoryResponse
№№3 E
<
№№E F
TView
№№F K
>
№№K L
(
№№L M
)
№№M N
{
№№O P
	IsSucceed
№№Q Z
=
№№[ \
true
№№] a
}
№№b c
;
№№c d
Validate
¤¤ 
(
¤¤ 
context
¤¤ 
,
¤¤ 
transaction
¤¤ )
)
¤¤) *
;
¤¤* +
if
■■ 
(
■■ 
IsValid
■■ 
)
■■ 
{
   
try
АА 
{
ББ 

ParseModel
ВВ 
(
ВВ 
context
ВВ &
,
ВВ& '
transaction
ВВ( 3
)
ВВ3 4
;
ВВ4 5
result
ГГ 
=
ГГ 
await
ГГ "

Repository
ГГ# -
.
ГГ- .
SaveModelAsync
ГГ. <
(
ГГ< =
(
ГГ= >
TView
ГГ> C
)
ГГC D
this
ГГD H
,
ГГH I
_context
ГГJ R
:
ГГR S
context
ГГT [
,
ГГ[ \
_transaction
ГГ] i
:
ГГi j
transaction
ГГk v
)
ГГv w
.
ГГw x
ConfigureAwaitГГx Ж
(ГГЖ З
falseГГЗ М
)ГГМ Н
;ГГН О
if
ЖЖ 
(
ЖЖ 
result
ЖЖ 
.
ЖЖ 
	IsSucceed
ЖЖ (
&&
ЖЖ) +
isSaveSubModels
ЖЖ, ;
)
ЖЖ; <
{
ЗЗ 
var
ИИ 

saveResult
ИИ &
=
ИИ' (
await
ИИ) . 
SaveSubModelsAsync
ИИ/ A
(
ИИA B
Model
ИИB G
,
ИИG H
context
ИИI P
,
ИИP Q
transaction
ИИR ]
)
ИИ] ^
.
ИИ^ _
ConfigureAwait
ИИ_ m
(
ИИm n
false
ИИn s
)
ИИs t
;
ИИt u
if
ЙЙ 
(
ЙЙ 
!
ЙЙ 

saveResult
ЙЙ '
.
ЙЙ' (
	IsSucceed
ЙЙ( 1
)
ЙЙ1 2
{
КК 
result
ЛЛ "
.
ЛЛ" #
Errors
ЛЛ# )
.
ЛЛ) *
AddRange
ЛЛ* 2
(
ЛЛ2 3

saveResult
ЛЛ3 =
.
ЛЛ= >
Errors
ЛЛ> D
)
ЛЛD E
;
ЛЛE F
result
ММ "
.
ММ" #
	Exception
ММ# ,
=
ММ- .

saveResult
ММ/ 9
.
ММ9 :
	Exception
ММ: C
;
ММC D
}
НН 
result
ОО 
.
ОО 
	IsSucceed
ОО (
=
ОО) *
result
ОО+ 1
.
ОО1 2
	IsSucceed
ОО2 ;
&&
ОО< >

saveResult
ОО? I
.
ООI J
	IsSucceed
ООJ S
;
ООS T
}
ПП 
if
ТТ 
(
ТТ 
result
ТТ 
.
ТТ 
	IsSucceed
ТТ (
&&
ТТ) +
IsClone
ТТ, 3
)
ТТ3 4
{
УУ 
var
ФФ 
cloneCultures
ФФ )
=
ФФ* +
Cultures
ФФ, 4
.
ФФ4 5
Where
ФФ5 :
(
ФФ: ;
c
ФФ; <
=>
ФФ= ?
c
ФФ@ A
.
ФФA B
Specificulture
ФФB P
!=
ФФQ S
Specificulture
ФФT b
&&
ФФc e
c
ФФf g
.
ФФg h
IsSupported
ФФh s
)
ФФs t
.
ФФt u
ToList
ФФu {
(
ФФ{ |
)
ФФ| }
;
ФФ} ~
var
ХХ 
cloneResult
ХХ '
=
ХХ( )
await
ХХ* /

CloneAsync
ХХ0 :
(
ХХ: ;
Model
ХХ; @
,
ХХ@ A
cloneCultures
ХХB O
,
ХХO P
_context
ХХQ Y
:
ХХY Z
context
ХХ[ b
,
ХХb c
_transaction
ХХd p
:
ХХp q
transaction
ХХr }
)
ХХ} ~
.
ХХ~ 
ConfigureAwaitХХ Н
(ХХН О
falseХХО У
)ХХУ Ф
;ХХФ Х
if
ЦЦ 
(
ЦЦ 
!
ЦЦ 
cloneResult
ЦЦ (
.
ЦЦ( )
	IsSucceed
ЦЦ) 2
)
ЦЦ2 3
{
ЧЧ 
result
ШШ "
.
ШШ" #
Errors
ШШ# )
.
ШШ) *
AddRange
ШШ* 2
(
ШШ2 3
cloneResult
ШШ3 >
.
ШШ> ?
Errors
ШШ? E
)
ШШE F
;
ШШF G
result
ЩЩ "
.
ЩЩ" #
	Exception
ЩЩ# ,
=
ЩЩ- .
cloneResult
ЩЩ/ :
.
ЩЩ: ;
	Exception
ЩЩ; D
;
ЩЩD E
}
ЪЪ 
result
ЫЫ 
.
ЫЫ 
	IsSucceed
ЫЫ (
=
ЫЫ) *
result
ЫЫ+ 1
.
ЫЫ1 2
	IsSucceed
ЫЫ2 ;
&&
ЫЫ< >
cloneResult
ЫЫ? J
.
ЫЫJ K
	IsSucceed
ЫЫK T
;
ЫЫT U
}
ЬЬ 
UnitOfWorkHelper
ЮЮ $
<
ЮЮ$ %

TDbContext
ЮЮ% /
>
ЮЮ/ 0
.
ЮЮ0 1
HandleTransaction
ЮЮ1 B
(
ЮЮB C
result
ЮЮC I
.
ЮЮI J
	IsSucceed
ЮЮJ S
,
ЮЮS T
isRoot
ЮЮU [
,
ЮЮ[ \
transaction
ЮЮ] h
)
ЮЮh i
;
ЮЮi j
return
ЯЯ 
result
ЯЯ !
;
ЯЯ! "
}
аа 
catch
бб 
(
бб 
	Exception
бб  
ex
бб! #
)
бб# $
{
вв 
return
гг 
UnitOfWorkHelper
гг +
<
гг+ ,

TDbContext
гг, 6
>
гг6 7
.
гг7 8
HandleException
гг8 G
<
ггG H
TView
ггH M
>
ггM N
(
ггN O
ex
ггO Q
,
ггQ R
isRoot
ггS Y
,
ггY Z
transaction
гг[ f
)
ггf g
;
ггg h
}
дд 
finally
ее 
{
жж 
if
зз 
(
зз 
isRoot
зз 
)
зз 
{
ии 
context
кк 
.
кк  
Dispose
кк  '
(
кк' (
)
кк( )
;
кк) *
}
лл 
}
мм 
}
нн 
else
оо 
{
пп 
if
░░ 
(
░░ 
isRoot
░░ 
)
░░ 
{
▒▒ 
context
││ 
.
││ 
Dispose
││ #
(
││# $
)
││$ %
;
││% &
}
┤┤ 
return
╡╡ 
new
╡╡  
RepositoryResponse
╡╡ -
<
╡╡- .
TView
╡╡. 3
>
╡╡3 4
(
╡╡4 5
)
╡╡5 6
{
╢╢ 
	IsSucceed
╖╖ 
=
╖╖ 
false
╖╖  %
,
╖╖% &
Data
╕╕ 
=
╕╕ 
null
╕╕ 
,
╕╕  
Errors
╣╣ 
=
╣╣ 
Errors
╣╣ #
}
║║ 
;
║║ 
}
╗╗ 
}
╝╝ 	
public
┼┼ 
virtual
┼┼ 
async
┼┼ 
Task
┼┼ !
<
┼┼! " 
RepositoryResponse
┼┼" 4
<
┼┼4 5
bool
┼┼5 9
>
┼┼9 :
>
┼┼: ; 
SaveSubModelsAsync
┼┼< N
(
┼┼N O
TModel
┼┼O U
parent
┼┼V \
,
┼┼\ ]

TDbContext
┼┼^ h
_context
┼┼i q
,
┼┼q r$
IDbContextTransaction┼┼s И
_transaction┼┼Й Х
)┼┼Х Ц
{
╞╞ 	
var
╟╟ 

taskSource
╟╟ 
=
╟╟ 
new
╟╟  "
TaskCompletionSource
╟╟! 5
<
╟╟5 6 
RepositoryResponse
╟╟6 H
<
╟╟H I
bool
╟╟I M
>
╟╟M N
>
╟╟N O
(
╟╟O P
)
╟╟P Q
;
╟╟Q R

taskSource
╚╚ 
.
╚╚ 
	SetResult
╚╚  
(
╚╚  !
new
╚╚! $ 
RepositoryResponse
╚╚% 7
<
╚╚7 8
bool
╚╚8 <
>
╚╚< =
(
╚╚= >
)
╚╚> ?
{
╚╚@ A
	IsSucceed
╚╚B K
=
╚╚L M
true
╚╚N R
}
╚╚S T
)
╚╚T U
;
╚╚U V
return
╔╔ 
await
╔╔ 

taskSource
╔╔ #
.
╔╔# $
Task
╔╔$ (
;
╔╔( )
}
╩╩ 	
public
╪╪ 
virtual
╪╪ 
TView
╪╪ 
InitView
╪╪ %
(
╪╪% &
TModel
╪╪& ,
model
╪╪- 2
=
╪╪3 4
null
╪╪5 9
,
╪╪9 :
bool
╪╪; ?

isLazyLoad
╪╪@ J
=
╪╪K L
true
╪╪M Q
,
╪╪Q R

TDbContext
╪╪S ]
_context
╪╪^ f
=
╪╪g h
null
╪╪i m
,
╪╪m n$
IDbContextTransaction╪╪o Д
_transaction╪╪Е С
=╪╪Т У
null╪╪Ф Ш
)╪╪Ш Щ
{
┘┘ 	
Type
┌┌ 
	classType
┌┌ 
=
┌┌ 
typeof
┌┌ #
(
┌┌# $
TView
┌┌$ )
)
┌┌) *
;
┌┌* +
ConstructorInfo
▄▄ 
classConstructor
▄▄ ,
=
▄▄- .
	classType
▄▄/ 8
.
▄▄8 9
GetConstructor
▄▄9 G
(
▄▄G H
new
▄▄H K
Type
▄▄L P
[
▄▄P Q
]
▄▄Q R
{
▄▄S T
}
▄▄U V
)
▄▄V W
;
▄▄W X
if
▌▌ 
(
▌▌ 
model
▌▌ 
==
▌▌ 
null
▌▌ 
&&
▌▌  
classConstructor
▌▌! 1
!=
▌▌2 4
null
▌▌5 9
)
▌▌9 :
{
▐▐ 
return
▀▀ 
(
▀▀ 
TView
▀▀ 
)
▀▀ 
classConstructor
▀▀ .
.
▀▀. /
Invoke
▀▀/ 5
(
▀▀5 6
new
▀▀6 9
object
▀▀: @
[
▀▀@ A
]
▀▀A B
{
▀▀C D
}
▀▀E F
)
▀▀F G
;
▀▀G H
}
рр 
else
сс 
{
тт 
classConstructor
уу  
=
уу! "
	classType
уу# ,
.
уу, -
GetConstructor
уу- ;
(
уу; <
new
уу< ?
Type
уу@ D
[
ууD E
]
ууE F
{
ууG H
typeof
ууI O
(
ууO P
TModel
ууP V
)
ууV W
,
ууW X
typeof
ууY _
(
уу_ `
bool
уу` d
)
ууd e
,
ууe f
typeof
ууg m
(
ууm n

TDbContext
ууn x
)
ууx y
,
ууy z
typeofуу{ Б
(ууБ В%
IDbContextTransactionууВ Ч
)ууЧ Ш
}ууЩ Ъ
)ууЪ Ы
;ууЫ Ь
if
фф 
(
фф 
classConstructor
фф $
!=
фф% '
null
фф( ,
)
фф, -
{
хх 
return
цц 
(
цц 
TView
цц !
)
цц! "
classConstructor
цц" 2
.
цц2 3
Invoke
цц3 9
(
цц9 :
new
цц: =
object
цц> D
[
ццD E
]
ццE F
{
ццG H
model
ццI N
,
ццN O

isLazyLoad
ццP Z
,
ццZ [
_context
цц\ d
,
ццd e
_transaction
ццf r
}
ццs t
)
ццt u
;
ццu v
}
чч 
else
шш 
{
щщ 
classConstructor
ъъ $
=
ъъ% &
	classType
ъъ' 0
.
ъъ0 1
GetConstructor
ъъ1 ?
(
ъъ? @
new
ъъ@ C
Type
ъъD H
[
ъъH I
]
ъъI J
{
ъъK L
typeof
ъъM S
(
ъъS T
TModel
ъъT Z
)
ъъZ [
,
ъъ[ \
typeof
ъъ] c
(
ъъc d

TDbContext
ъъd n
)
ъъn o
,
ъъo p
typeof
ъъq w
(
ъъw x$
IDbContextTransactionъъx Н
)ъъН О
}ъъП Р
)ъъР С
;ъъС Т
return
ыы 
(
ыы 
TView
ыы !
)
ыы! "
classConstructor
ыы" 2
.
ыы2 3
Invoke
ыы3 9
(
ыы9 :
new
ыы: =
object
ыы> D
[
ыыD E
]
ыыE F
{
ыыG H
model
ыыI N
,
ыыN O
_context
ыыP X
,
ыыX Y
_transaction
ыыZ f
}
ыыg h
)
ыыh i
;
ыыi j
}
ьь 
}
ээ 
}
юю 	
public
ўў 
virtual
ўў 
TView
ўў 
	ParseView
ўў &
(
ўў& '
bool
ўў' +
isExpand
ўў, 4
=
ўў5 6
true
ўў7 ;
,
ўў; <

TDbContext
ўў= G
_context
ўўH P
=
ўўQ R
null
ўўS W
,
ўўW X#
IDbContextTransaction
ўўY n
_transaction
ўўo {
=
ўў| }
nullўў~ В
)
°°4 5
{
∙∙ 	
Mapper
√√ 
.
√√ 
Map
√√ 
<
√√ 
TModel
√√ 
,
√√ 
TView
√√ $
>
√√$ %
(
√√% &
Model
√√& +
,
√√+ ,
(
√√- .
TView
√√. 3
)
√√3 4
this
√√4 8
)
√√8 9
;
√√9 :
if
№№ 
(
№№ 
isExpand
№№ 
)
№№ 
{
¤¤ 
UnitOfWorkHelper
■■  
<
■■  !

TDbContext
■■! +
>
■■+ ,
.
■■, -
InitTransaction
■■- <
(
■■< =
_context
■■= E
,
■■E F
_transaction
■■G S
,
■■S T
out
■■U X

TDbContext
■■Y c
context
■■d k
,
■■k l
out
■■m p$
IDbContextTransaction■■q Ж
transaction■■З Т
,■■Т У
out■■Ф Ч
bool■■Ш Ь
isRoot■■Э г
)■■г д
;■■д е
try
   
{
АА 

ExpandView
ББ 
(
ББ 
context
ББ &
,
ББ& '
transaction
ББ( 3
)
ББ3 4
;
ББ4 5
}
ВВ 
catch
ГГ 
(
ГГ 
	Exception
ГГ  
ex
ГГ! #
)
ГГ# $
{
ДД 

Repository
ЕЕ 
.
ЕЕ 
LogErrorMessage
ЕЕ .
(
ЕЕ. /
ex
ЕЕ/ 1
)
ЕЕ1 2
;
ЕЕ2 3
if
ЖЖ 
(
ЖЖ 
isRoot
ЖЖ 
)
ЖЖ 
{
ЗЗ 
transaction
ЙЙ #
.
ЙЙ# $
Rollback
ЙЙ$ ,
(
ЙЙ, -
)
ЙЙ- .
;
ЙЙ. /
}
КК 
}
ЛЛ 
finally
ММ 
{
НН 
if
ОО 
(
ОО 
isRoot
ОО 
)
ОО 
{
ПП 
context
СС 
.
СС  
Dispose
СС  '
(
СС' (
)
СС( )
;
СС) *
}
ТТ 
}
УУ 
}
ФФ 
return
ХХ 
(
ХХ 
TView
ХХ 
)
ХХ 
this
ХХ 
;
ХХ 
}
ЦЦ 	
public
ЭЭ 
virtual
ЭЭ 
void
ЭЭ 

ExpandView
ЭЭ &
(
ЭЭ& '

TDbContext
ЭЭ' 1
_context
ЭЭ2 :
=
ЭЭ; <
null
ЭЭ= A
,
ЭЭA B#
IDbContextTransaction
ЭЭC X
_transaction
ЭЭY e
=
ЭЭf g
null
ЭЭh l
)
ЭЭl m
{
ЮЮ 	
}
ЯЯ 	
public
йй 
virtual
йй  
RepositoryResponse
йй )
<
йй) *
List
йй* .
<
йй. /
TView
йй/ 4
>
йй4 5
>
йй5 6
Clone
йй7 <
(
йй< =
TModel
йй= C
model
ййD I
,
ййI J
List
ййK O
<
ййO P
SupportedCulture
ййP `
>
йй` a
cloneCultures
ййb o
,
ййo p

TDbContext
ййq {
_contextйй| Д
=ййЕ Ж
nullййЗ Л
,ййЛ М%
IDbContextTransactionййН в
_transactionййг п
=йй░ ▒
nullйй▓ ╢
)йй╢ ╖
{
кк 	
UnitOfWorkHelper
лл 
<
лл 

TDbContext
лл '
>
лл' (
.
лл( )
InitTransaction
лл) 8
(
лл8 9
_context
лл9 A
,
ллA B
_transaction
ллC O
,
ллO P
out
ллQ T

TDbContext
ллU _
context
лл` g
,
ллg h
out
ллi l$
IDbContextTransactionллm В
transactionллГ О
,ллО П
outллР У
boolллФ Ш
isRootллЩ Я
)ллЯ а
;лла б 
RepositoryResponse
мм 
<
мм 
List
мм #
<
мм# $
TView
мм$ )
>
мм) *
>
мм* +
result
мм, 2
=
мм3 4
new
мм5 8 
RepositoryResponse
мм9 K
<
ммK L
List
ммL P
<
ммP Q
TView
ммQ V
>
ммV W
>
ммW X
(
ммX Y
)
ммY Z
{
нн 
	IsSucceed
оо 
=
оо 
true
оо  
,
оо  !
Data
пп 
=
пп 
new
пп 
List
пп 
<
пп  
TView
пп  %
>
пп% &
(
пп& '
)
пп' (
}
░░ 
;
░░ 
try
▓▓ 
{
││ 
if
┤┤ 
(
┤┤ 
cloneCultures
┤┤ !
!=
┤┤" $
null
┤┤% )
)
┤┤) *
{
╡╡ 
foreach
╢╢ 
(
╢╢ 
var
╢╢  
culture
╢╢! (
in
╢╢) +
cloneCultures
╢╢, 9
)
╢╢9 :
{
╖╖ 
string
╕╕ 
desSpecificulture
╕╕ 0
=
╕╕1 2
culture
╕╕3 :
.
╕╕: ;
Specificulture
╕╕; I
;
╕╕I J
TView
║║ 
view
║║ "
=
║║# $
InitView
║║% -
(
║║- .
)
║║. /
;
║║/ 0
view
╗╗ 
.
╗╗ 
Model
╗╗ "
=
╗╗# $
model
╗╗% *
;
╗╗* +
view
╝╝ 
.
╝╝ 
	ParseView
╝╝ &
(
╝╝& '
isExpand
╝╝' /
:
╝╝/ 0
false
╝╝1 6
,
╝╝6 7
_context
╝╝8 @
:
╝╝@ A
context
╝╝B I
,
╝╝I J
_transaction
╝╝K W
:
╝╝W X
transaction
╝╝Y d
)
╝╝d e
;
╝╝e f
view
╜╜ 
.
╜╜ 
Specificulture
╜╜ +
=
╜╜, -
desSpecificulture
╜╜. ?
;
╜╜? @
bool
┐┐ 
isExist
┐┐ $
=
┐┐% &

Repository
┐┐' 1
.
┐┐1 2
CheckIsExists
┐┐2 ?
(
┐┐? @
view
┐┐@ D
.
┐┐D E

ParseModel
┐┐E O
(
┐┐O P
context
┐┐P W
,
┐┐W X
transaction
┐┐Y d
)
┐┐d e
,
┐┐e f
_context
┐┐g o
:
┐┐o p
context
┐┐q x
,
┐┐x y
_transaction┐┐z Ж
:┐┐Ж З
transaction┐┐И У
)┐┐У Ф
;┐┐Ф Х
if
┴┴ 
(
┴┴ 
isExist
┴┴ #
)
┴┴# $
{
┬┬ 
result
├├ "
.
├├" #
	IsSucceed
├├# ,
=
├├- .
true
├├/ 3
;
├├3 4
result
── "
.
──" #
Data
──# '
.
──' (
Add
──( +
(
──+ ,
view
──, 0
)
──0 1
;
──1 2
}
┼┼ 
else
╞╞ 
{
╟╟ 
var
╚╚ 
cloneResult
╚╚  +
=
╚╚, -
view
╚╚. 2
.
╚╚2 3
	SaveModel
╚╚3 <
(
╚╚< =
false
╚╚= B
,
╚╚B C
context
╚╚D K
,
╚╚K L
transaction
╚╚M X
)
╚╚X Y
;
╚╚Y Z
if
╔╔ 
(
╔╔  
cloneResult
╔╔  +
.
╔╔+ ,
	IsSucceed
╔╔, 5
)
╔╔5 6
{
╩╩ 
var
╦╦  #
cloneSubResult
╦╦$ 2
=
╦╦3 4
CloneSubModels
╦╦5 C
(
╦╦C D
cloneResult
╦╦D O
.
╦╦O P
Data
╦╦P T
,
╦╦T U
cloneCultures
╦╦V c
,
╦╦c d
context
╦╦e l
,
╦╦l m
transaction
╦╦n y
)
╦╦y z
;
╦╦z {
if
╠╠  "
(
╠╠# $
!
╠╠$ %
cloneSubResult
╠╠% 3
.
╠╠3 4
	IsSucceed
╠╠4 =
)
╠╠= >
{
══  !
cloneResult
╬╬$ /
.
╬╬/ 0
Errors
╬╬0 6
.
╬╬6 7
AddRange
╬╬7 ?
(
╬╬? @
cloneSubResult
╬╬@ N
.
╬╬N O
Errors
╬╬O U
)
╬╬U V
;
╬╬V W
cloneResult
╧╧$ /
.
╧╧/ 0
	Exception
╧╧0 9
=
╧╧: ;
cloneSubResult
╧╧< J
.
╧╧J K
	Exception
╧╧K T
;
╧╧T U
}
╨╨  !
result
╥╥  &
.
╥╥& '
	IsSucceed
╥╥' 0
=
╥╥1 2
result
╥╥3 9
.
╥╥9 :
	IsSucceed
╥╥: C
&&
╥╥D F
cloneResult
╥╥G R
.
╥╥R S
	IsSucceed
╥╥S \
&&
╥╥] _
cloneSubResult
╥╥` n
.
╥╥n o
	IsSucceed
╥╥o x
;
╥╥x y
}
╘╘ 
else
╒╒  
{
╓╓ 
result
╫╫  &
.
╫╫& '
	IsSucceed
╫╫' 0
=
╫╫1 2
result
╫╫3 9
.
╫╫9 :
	IsSucceed
╫╫: C
&&
╫╫D F
cloneResult
╫╫G R
.
╫╫R S
	IsSucceed
╫╫S \
;
╫╫\ ]
result
╪╪  &
.
╪╪& '
Errors
╪╪' -
.
╪╪- .
AddRange
╪╪. 6
(
╪╪6 7
cloneResult
╪╪7 B
.
╪╪B C
Errors
╪╪C I
)
╪╪I J
;
╪╪J K
result
┘┘  &
.
┘┘& '
	Exception
┘┘' 0
=
┘┘1 2
cloneResult
┘┘3 >
.
┘┘> ?
	Exception
┘┘? H
;
┘┘H I
}
┌┌ 
}
██ 
UnitOfWorkHelper
▄▄ (
<
▄▄( )

TDbContext
▄▄) 3
>
▄▄3 4
.
▄▄4 5
HandleTransaction
▄▄5 F
(
▄▄F G
result
▄▄G M
.
▄▄M N
	IsSucceed
▄▄N W
,
▄▄W X
isRoot
▄▄Y _
,
▄▄_ `
transaction
▄▄a l
)
▄▄l m
;
▄▄m n
}
▌▌ 
return
▐▐ 
result
▐▐ !
;
▐▐! "
}
▀▀ 
else
рр 
{
сс 
return
тт 
result
тт !
;
тт! "
}
уу 
}
фф 
catch
хх 
(
хх 
	Exception
хх 
ex
хх 
)
хх  
{
цц 
result
чч 
.
чч 
	IsSucceed
чч  
=
чч! "
false
чч# (
;
чч( )
result
шш 
.
шш 
	Exception
шш  
=
шш! "
ex
шш# %
;
шш% &
return
щщ 
result
щщ 
;
щщ 
}
ъъ 
finally
ыы 
{
ьь 
if
ээ 
(
ээ 
isRoot
ээ 
)
ээ 
{
юю 
context
яя 
.
яя 
Dispose
яя #
(
яя# $
)
яя$ %
;
яя% &
}
ЁЁ 
}
ёё 
}
ЄЄ 	
public
№№ 
virtual
№№  
RepositoryResponse
№№ )
<
№№) *
bool
№№* .
>
№№. /
CloneSubModels
№№0 >
(
№№> ?
TView
№№? D
parent
№№E K
,
№№K L
List
№№M Q
<
№№Q R
SupportedCulture
№№R b
>
№№b c
cloneCultures
№№d q
,
№№q r

TDbContext
№№s }
_context№№~ Ж
=№№З И
null№№Й Н
,№№Н О%
IDbContextTransaction№№П д
_transaction№№е ▒
=№№▓ │
null№№┤ ╕
)№№╕ ╣
{
¤¤ 	
return
■■ 
new
■■  
RepositoryResponse
■■ )
<
■■) *
bool
■■* .
>
■■. /
(
■■/ 0
)
■■0 1
{
■■2 3
	IsSucceed
■■4 =
=
■■> ?
true
■■@ D
}
■■E F
;
■■F G
}
   	
public
ИИ 
virtual
ИИ  
RepositoryResponse
ИИ )
<
ИИ) *
TModel
ИИ* 0
>
ИИ0 1
RemoveModel
ИИ2 =
(
ИИ= >
bool
ИИ> B#
isRemoveRelatedModels
ИИC X
=
ИИY Z
false
ИИ[ `
,
ИИ` a

TDbContext
ИИb l
_context
ИИm u
=
ИИv w
null
ИИx |
,
ИИ| }$
IDbContextTransactionИИ~ У
_transactionИИФ а
=ИИб в
nullИИг з
)ИИз и
{
ЙЙ 	
UnitOfWorkHelper
КК 
<
КК 

TDbContext
КК '
>
КК' (
.
КК( )
InitTransaction
КК) 8
(
КК8 9
_context
КК9 A
,
ККA B
_transaction
ККC O
,
ККO P
out
ККQ T

TDbContext
ККU _
context
КК` g
,
ККg h
out
ККi l$
IDbContextTransactionККm В
transactionККГ О
,ККО П
outККР У
boolККФ Ш
isRootККЩ Я
)ККЯ а
;ККа б 
RepositoryResponse
ЛЛ 
<
ЛЛ 
TModel
ЛЛ %
>
ЛЛ% &
result
ЛЛ' -
=
ЛЛ. /
new
ЛЛ0 3 
RepositoryResponse
ЛЛ4 F
<
ЛЛF G
TModel
ЛЛG M
>
ЛЛM N
(
ЛЛN O
)
ЛЛO P
{
ЛЛQ R
	IsSucceed
ЛЛS \
=
ЛЛ] ^
true
ЛЛ_ c
}
ЛЛd e
;
ЛЛe f
try
ММ 
{
НН 

ParseModel
ОО 
(
ОО 
_context
ОО #
,
ОО# $
_transaction
ОО% 1
)
ОО1 2
;
ОО2 3
if
ПП 
(
ПП #
isRemoveRelatedModels
ПП )
)
ПП) *
{
РР 
var
СС !
removeRelatedResult
СС +
=
СС, -!
RemoveRelatedModels
СС. A
(
ССA B
(
ССB C
TView
ССC H
)
ССH I
this
ССI M
,
ССM N
context
ССO V
,
ССV W
transaction
ССX c
)
ССc d
;
ССd e
if
ТТ 
(
ТТ !
removeRelatedResult
ТТ +
.
ТТ+ ,
	IsSucceed
ТТ, 5
)
ТТ5 6
{
УУ 
result
ФФ 
=
ФФ  

Repository
ФФ! +
.
ФФ+ ,
RemoveModel
ФФ, 7
(
ФФ7 8
Model
ФФ8 =
,
ФФ= >
context
ФФ? F
,
ФФF G
transaction
ФФH S
)
ФФS T
;
ФФT U
}
ХХ 
else
ЦЦ 
{
ЧЧ 
result
ШШ 
.
ШШ 
	IsSucceed
ШШ (
=
ШШ) *
result
ШШ+ 1
.
ШШ1 2
	IsSucceed
ШШ2 ;
&&
ШШ< >!
removeRelatedResult
ШШ? R
.
ШШR S
	IsSucceed
ШШS \
;
ШШ\ ]
result
ЩЩ 
.
ЩЩ 
Errors
ЩЩ %
.
ЩЩ% &
AddRange
ЩЩ& .
(
ЩЩ. /!
removeRelatedResult
ЩЩ/ B
.
ЩЩB C
Errors
ЩЩC I
)
ЩЩI J
;
ЩЩJ K
result
ЪЪ 
.
ЪЪ 
	Exception
ЪЪ (
=
ЪЪ) *!
removeRelatedResult
ЪЪ+ >
.
ЪЪ> ?
	Exception
ЪЪ? H
;
ЪЪH I
}
ЫЫ 
}
ЬЬ 
else
ЭЭ 
{
ЮЮ 
result
ЯЯ 
=
ЯЯ 

Repository
ЯЯ '
.
ЯЯ' (
RemoveModel
ЯЯ( 3
(
ЯЯ3 4
Model
ЯЯ4 9
,
ЯЯ9 :
context
ЯЯ; B
,
ЯЯB C
transaction
ЯЯD O
)
ЯЯO P
;
ЯЯP Q
}
аа 
UnitOfWorkHelper
вв  
<
вв  !

TDbContext
вв! +
>
вв+ ,
.
вв, -
HandleTransaction
вв- >
(
вв> ?
result
вв? E
.
ввE F
	IsSucceed
ввF O
,
ввO P
isRoot
ввQ W
,
ввW X
transaction
ввY d
)
ввd e
;
ввe f
return
гг 
result
гг 
;
гг 
}
дд 
catch
ее 
(
ее 
	Exception
ее 
ex
ее 
)
ее  
{
жж 
return
зз 
UnitOfWorkHelper
зз '
<
зз' (

TDbContext
зз( 2
>
зз2 3
.
зз3 4
HandleException
зз4 C
<
ззC D
TModel
ззD J
>
ззJ K
(
ззK L
ex
ззL N
,
ззN O
isRoot
ззP V
,
ззV W
transaction
ззX c
)
ззc d
;
ззd e
}
ии 
finally
йй 
{
кк 
if
лл 
(
лл 
isRoot
лл 
)
лл 
{
мм 
context
оо 
.
оо 
Dispose
оо #
(
оо# $
)
оо$ %
;
оо% &
}
пп 
}
░░ 
}
▒▒ 	
public
║║ 
virtual
║║  
RepositoryResponse
║║ )
<
║║) *
bool
║║* .
>
║║. /!
RemoveRelatedModels
║║0 C
(
║║C D
TView
║║D I
view
║║J N
,
║║N O

TDbContext
║║P Z
_context
║║[ c
=
║║d e
null
║║f j
,
║║j k$
IDbContextTransaction║║l Б
_transaction║║В О
=║║П Р
null║║С Х
)║║Х Ц
{
╗╗ 	
return
╝╝ 
new
╝╝  
RepositoryResponse
╝╝ )
<
╝╝) *
bool
╝╝* .
>
╝╝. /
(
╝╝/ 0
)
╝╝0 1
{
╝╝2 3
	IsSucceed
╝╝4 =
=
╝╝> ?
true
╝╝@ D
}
╝╝E F
;
╝╝F G
}
╜╜ 	
public
╞╞ 
virtual
╞╞  
RepositoryResponse
╞╞ )
<
╞╞) *
TView
╞╞* /
>
╞╞/ 0
	SaveModel
╞╞1 :
(
╞╞: ;
bool
╞╞; ?
isSaveSubModels
╞╞@ O
=
╞╞P Q
false
╞╞R W
,
╞╞W X

TDbContext
╞╞Y c
_context
╞╞d l
=
╞╞m n
null
╞╞o s
,
╞╞s t$
IDbContextTransaction╞╞u К
_transaction╞╞Л Ч
=╞╞Ш Щ
null╞╞Ъ Ю
)╞╞Ю Я
{
╟╟ 	
UnitOfWorkHelper
╚╚ 
<
╚╚ 

TDbContext
╚╚ '
>
╚╚' (
.
╚╚( )
InitTransaction
╚╚) 8
(
╚╚8 9
_context
╚╚9 A
,
╚╚A B
_transaction
╚╚C O
,
╚╚O P
out
╚╚Q T

TDbContext
╚╚U _
context
╚╚` g
,
╚╚g h
out
╚╚i l$
IDbContextTransaction╚╚m В
transaction╚╚Г О
,╚╚О П
out╚╚Р У
bool╚╚Ф Ш
isRoot╚╚Щ Я
)╚╚Я а
;╚╚а б 
RepositoryResponse
╔╔ 
<
╔╔ 
TView
╔╔ $
>
╔╔$ %
result
╔╔& ,
=
╔╔- .
new
╔╔/ 2 
RepositoryResponse
╔╔3 E
<
╔╔E F
TView
╔╔F K
>
╔╔K L
(
╔╔L M
)
╔╔M N
{
╔╔O P
	IsSucceed
╔╔Q Z
=
╔╔[ \
true
╔╔] a
}
╔╔b c
;
╔╔c d
Validate
╩╩ 
(
╩╩ 
context
╩╩ 
,
╩╩ 
transaction
╩╩ )
)
╩╩) *
;
╩╩* +
if
╦╦ 
(
╦╦ 
IsValid
╦╦ 
)
╦╦ 
{
╠╠ 
try
══ 
{
╬╬ 

ParseModel
╧╧ 
(
╧╧ 
context
╧╧ &
,
╧╧& '
transaction
╧╧( 3
)
╧╧3 4
;
╧╧4 5
result
╨╨ 
=
╨╨ 

Repository
╨╨ '
.
╨╨' (
	SaveModel
╨╨( 1
(
╨╨1 2
(
╨╨2 3
TView
╨╨3 8
)
╨╨8 9
this
╨╨9 =
,
╨╨= >
_context
╨╨? G
:
╨╨G H
context
╨╨I P
,
╨╨P Q
_transaction
╨╨R ^
:
╨╨^ _
transaction
╨╨` k
)
╨╨k l
;
╨╨l m
if
╙╙ 
(
╙╙ 
result
╙╙ 
.
╙╙ 
	IsSucceed
╙╙ (
&&
╙╙) +
isSaveSubModels
╙╙, ;
)
╙╙; <
{
╘╘ 
var
╒╒ 

saveResult
╒╒ &
=
╒╒' (
SaveSubModels
╒╒) 6
(
╒╒6 7
Model
╒╒7 <
,
╒╒< =
context
╒╒> E
,
╒╒E F
transaction
╒╒G R
)
╒╒R S
;
╒╒S T
if
╓╓ 
(
╓╓ 
!
╓╓ 

saveResult
╓╓ '
.
╓╓' (
	IsSucceed
╓╓( 1
)
╓╓1 2
{
╫╫ 
result
╪╪ "
.
╪╪" #
Errors
╪╪# )
.
╪╪) *
AddRange
╪╪* 2
(
╪╪2 3

saveResult
╪╪3 =
.
╪╪= >
Errors
╪╪> D
)
╪╪D E
;
╪╪E F
result
┘┘ "
.
┘┘" #
	Exception
┘┘# ,
=
┘┘- .

saveResult
┘┘/ 9
.
┘┘9 :
	Exception
┘┘: C
;
┘┘C D
}
┌┌ 
result
██ 
.
██ 
	IsSucceed
██ (
=
██) *
result
██+ 1
.
██1 2
	IsSucceed
██2 ;
&&
██< >

saveResult
██? I
.
██I J
	IsSucceed
██J S
;
██S T
}
▄▄ 
if
▀▀ 
(
▀▀ 
result
▀▀ 
.
▀▀ 
	IsSucceed
▀▀ (
&&
▀▀) +
IsClone
▀▀, 3
&&
▀▀4 6
isRoot
▀▀7 =
)
▀▀= >
{
рр 
var
сс 
cloneCultures
сс )
=
сс* +
Cultures
сс, 4
.
сс4 5
Where
сс5 :
(
сс: ;
c
сс; <
=>
сс= ?
c
сс@ A
.
ссA B
Specificulture
ссB P
!=
ссQ S
Specificulture
ссT b
&&
ссc e
c
ссf g
.
ссg h
IsSupported
ссh s
)
ссs t
.
ссt u
ToList
ссu {
(
сс{ |
)
сс| }
;
сс} ~
var
тт 
cloneResult
тт '
=
тт( )
Clone
тт* /
(
тт/ 0
Model
тт0 5
,
тт5 6
cloneCultures
тт7 D
,
ттD E
_context
ттF N
:
ттN O
context
ттP W
,
ттW X
_transaction
ттY e
:
ттe f
transaction
ттg r
)
ттr s
;
ттs t
if
уу 
(
уу 
!
уу 
cloneResult
уу (
.
уу( )
	IsSucceed
уу) 2
)
уу2 3
{
фф 
result
хх "
.
хх" #
Errors
хх# )
.
хх) *
AddRange
хх* 2
(
хх2 3
cloneResult
хх3 >
.
хх> ?
Errors
хх? E
)
ххE F
;
ххF G
result
цц "
.
цц" #
	Exception
цц# ,
=
цц- .
cloneResult
цц/ :
.
цц: ;
	Exception
цц; D
;
ццD E
}
чч 
result
шш 
.
шш 
	IsSucceed
шш (
=
шш) *
result
шш+ 1
.
шш1 2
	IsSucceed
шш2 ;
&&
шш< >
cloneResult
шш? J
.
шшJ K
	IsSucceed
шшK T
;
шшT U
}
щщ 
UnitOfWorkHelper
ыы $
<
ыы$ %

TDbContext
ыы% /
>
ыы/ 0
.
ыы0 1
HandleTransaction
ыы1 B
(
ыыB C
result
ыыC I
.
ыыI J
	IsSucceed
ыыJ S
,
ыыS T
isRoot
ыыU [
,
ыы[ \
transaction
ыы] h
)
ыыh i
;
ыыi j
return
ьь 
result
ьь !
;
ьь! "
}
ээ 
catch
юю 
(
юю 
	Exception
юю  
ex
юю! #
)
юю# $
{
яя 
return
ЁЁ 
UnitOfWorkHelper
ЁЁ +
<
ЁЁ+ ,

TDbContext
ЁЁ, 6
>
ЁЁ6 7
.
ЁЁ7 8
HandleException
ЁЁ8 G
<
ЁЁG H
TView
ЁЁH M
>
ЁЁM N
(
ЁЁN O
ex
ЁЁO Q
,
ЁЁQ R
isRoot
ЁЁS Y
,
ЁЁY Z
transaction
ЁЁ[ f
)
ЁЁf g
;
ЁЁg h
}
ёё 
finally
ЄЄ 
{
єє 
if
ЇЇ 
(
ЇЇ 
isRoot
ЇЇ 
)
ЇЇ 
{
її 
context
ўў 
.
ўў  
Dispose
ўў  '
(
ўў' (
)
ўў( )
;
ўў) *
}
°° 
}
∙∙ 
}
·· 
else
√√ 
{
№№ 
if
¤¤ 
(
¤¤ 
isRoot
¤¤ 
)
¤¤ 
{
■■ 
context
АА 
.
АА 
Dispose
АА #
(
АА# $
)
АА$ %
;
АА% &
}
ББ 
return
ВВ 
new
ВВ  
RepositoryResponse
ВВ -
<
ВВ- .
TView
ВВ. 3
>
ВВ3 4
(
ВВ4 5
)
ВВ5 6
{
ГГ 
	IsSucceed
ДД 
=
ДД 
false
ДД  %
,
ДД% &
Data
ЕЕ 
=
ЕЕ 
null
ЕЕ 
,
ЕЕ  
Errors
ЖЖ 
=
ЖЖ 
Errors
ЖЖ #
}
ЗЗ 
;
ЗЗ 
}
ИИ 
}
ЙЙ 	
public
ТТ 
virtual
ТТ  
RepositoryResponse
ТТ )
<
ТТ) *
bool
ТТ* .
>
ТТ. /
SaveSubModels
ТТ0 =
(
ТТ= >
TModel
ТТ> D
parent
ТТE K
,
ТТK L

TDbContext
ТТM W
_context
ТТX `
,
ТТ` a#
IDbContextTransaction
ТТb w
_transactionТТx Д
)ТТД Е
{
УУ 	
return
ФФ 
new
ФФ  
RepositoryResponse
ФФ )
<
ФФ) *
bool
ФФ* .
>
ФФ. /
(
ФФ/ 0
)
ФФ0 1
{
ФФ2 3
	IsSucceed
ФФ4 =
=
ФФ> ?
true
ФФ@ D
}
ФФE F
;
ФФF G
}
ХХ 	
	protected
бб 
ViewModelBase
бб 
(
бб  
TModel
бб  &
model
бб' ,
,
бб, -

TDbContext
бб. 8
_context
бб9 A
=
ббB C
null
ббD H
,
ббH I#
IDbContextTransaction
ббJ _
_transaction
бб` l
=
ббm n
null
ббo s
)
ббs t
{
вв 	
this
гг 
.
гг 
Model
гг 
=
гг 
model
гг 
;
гг 
	ParseView
дд 
(
дд 
_context
дд 
:
дд 
_context
дд  (
,
дд( )
_transaction
дд* 6
:
дд6 7
_transaction
дд8 D
)
ддD E
;
ддE F
}
ее 	
	protected
оо 
ViewModelBase
оо 
(
оо  
TModel
оо  &
model
оо' ,
,
оо, -
bool
оо. 2

isLazyLoad
оо3 =
,
оо= >

TDbContext
оо? I
_context
ооJ R
=
ооS T
null
ооU Y
,
ооY Z#
IDbContextTransaction
оо[ p
_transaction
ооq }
=
оо~ 
nullооА Д
)ооД Е
{
пп 	
this
░░ 
.
░░ 
Model
░░ 
=
░░ 
model
░░ 
;
░░ 

IsLazyLoad
▒▒ 
=
▒▒ 

isLazyLoad
▒▒ #
;
▒▒# $
	ParseView
▓▓ 
(
▓▓ 
isExpand
▓▓ 
:
▓▓ 

isLazyLoad
▓▓  *
,
▓▓* +
_context
▓▓, 4
:
▓▓4 5
_context
▓▓6 >
,
▓▓> ?
_transaction
▓▓@ L
:
▓▓L M
_transaction
▓▓N Z
)
▓▓Z [
;
▓▓[ \
}
││ 	
	protected
╕╕ 
ViewModelBase
╕╕ 
(
╕╕  
)
╕╕  !
{
╣╣ 	
this
║║ 
.
║║ 
Model
║║ 
=
║║ 
	InitModel
║║ "
(
║║" #
)
║║# $
;
║║$ %
	ParseView
╗╗ 
(
╗╗ 
isExpand
╗╗ 
:
╗╗ 
false
╗╗  %
)
╗╗% &
;
╗╗& '
}
╝╝ 	
}
┐┐ 
}└└ И
ZC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\UI\Core\Controllers\BaseController.cs
	namespace 	
Mix
 
. 
UI 
. 
Base 
. 
Controllers !
{ 
public 

class 
BaseController 
:  !

Controller" ,
{ 
public 
BaseController 
( 
) 
{ 	
} 	
public&& 
override&& 
NotFoundResult&& &
NotFound&&' /
(&&/ 0
)&&0 1
{'' 	
return(( 
base(( 
.(( 
NotFound((  
(((  !
)((! "
;((" #
})) 	
}** 
}++ ╝"
VC:\_workspace\github\mixcore\mix.heart\src\Mix.Heart\UI\Core\SignalR\BaseSignalRHub.cs
	namespace 	
Mix
 
. 
UI 
. 
Core 
. 
SignalR 
{ 
public 

abstract 
class 
BaseSignalRHub (
:) *
Hub+ .
{ 
	protected 
static 
readonly !
List" &
<& '
SignalRClient' 4
>4 5
Users6 ;
=< =
new> A
ListB F
<F G
SignalRClientG T
>T U
(U V
)V W
;W X
public 
override 
Task 
OnConnectedAsync -
(- .
). /
{ 	!
UpdateGroupConnection !
(! "
)" #
;# $
return   
base   
.   
OnConnectedAsync   (
(  ( )
)  ) *
;  * +
}!! 	
public(( 
override(( 
Task(( 
OnDisconnectedAsync(( 0
(((0 1
	Exception((1 :
	exception((; D
)((D E
{)) 	
Users++ 
.++ 
	RemoveAll++ 
(++ 
u++ 
=>++  
u++! "
.++" #
ConnectionId++# /
==++0 2
Context++3 :
.++: ;
ConnectionId++; G
)++G H
;++H I
return,, 
base,, 
.,, 
OnDisconnectedAsync,, +
(,,+ ,
	exception,,, 5
),,5 6
;,,6 7
}-- 	
public22 
virtual22 
void22 !
UpdateGroupConnection22 1
(221 2
)222 3
{33 	
var44 
user44 
=44 
Users44 
.44 
Find44 !
(44! "
p44" #
=>44$ &
p44' (
.44( )
ConnectionId44) 5
==446 8
Context449 @
.44@ A
ConnectionId44A M
)44M N
;44N O
if55 
(55 
user55 
!=55 
null55 
)55 
{66 
}99 
}:: 	
public@@ 
virtual@@ 
void@@ )
UpdatePlayerConnectionIdAsync@@ 9
(@@9 :
string@@: @
playerId@@A I
)@@I J
{AA 	
varCC 
playerCC 
=CC 
UsersCC 
.CC 
FindCC #
(CC# $
pCC$ %
=>CC& (
pCC) *
.CC* +
UserIdCC+ 1
==CC2 4
playerIdCC5 =
)CC= >
;CC> ?
ifDD 
(DD 
playerDD 
!=DD 
nullDD 
&&DD !
playerDD" (
.DD( )
ConnectionIdDD) 5
!=DD6 8
ContextDD9 @
.DD@ A
ConnectionIdDDA M
)DDM N
{EE 
playerHH 
.HH 
ConnectionIdHH #
=HH$ %
ContextHH& -
.HH- .
ConnectionIdHH. :
;HH: ;
}JJ 
}KK 	
privateRR 
voidRR 

FailResultRR 
(RR  
dynamicRR  '
objDataRR( /
,RR/ 0
stringRR1 7
errorMsgRR8 @
)RR@ A
{SS 	
constTT 
stringTT 
responseKeyTT $
=TT% &
$strTT' /
;TT/ 0
constUU 
intUU 
statusUU 
=UU 
$numUU  
;UU  !
	ApiResultVV 
<VV 
dynamicVV 
>VV 
resultVV %
=VV& '
newVV( +
	ApiResultVV, 5
<VV5 6
dynamicVV6 =
>VV= >
(VV> ?
)VV? @
{WW 
ResponseKeyXX 
=XX 
responseKeyXX )
,XX) *
StatusYY 
=YY 
statusYY 
,YY  
DataZZ 
=ZZ 
objDataZZ 
,ZZ 
}\\ 
;\\ 
Clients]] 
.]] 
Client]] 
(]] 
Context]] "
.]]" #
ConnectionId]]# /
)]]/ 0
.]]0 1
	SendAsync]]1 :
(]]: ;
$str]]; K
,]]K L
result]]M S
)]]S T
;]]T U
}^^ 	
}__ 
}`` 