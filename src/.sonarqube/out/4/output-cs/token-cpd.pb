ÆÏ
\C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiAccountController.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
[   
	Authorize   
(   !
AuthenticationSchemes   $
=  % &
JwtBearerDefaults  ' 8
.  8 9 
AuthenticationScheme  9 M
)  M N
]  N O
[!! 
Route!! 

(!!
 
$str!! 
)!! 
]!! 
public"" 

class""  
ApiAccountController"" %
:""& '

Controller""( 2
{## 
private$$ 
readonly$$ 
UserManager$$ $
<$$$ %
ApplicationUser$$% 4
>$$4 5
_userManager$$6 B
;$$B C
private%% 
readonly%% 
SignInManager%% &
<%%& '
ApplicationUser%%' 6
>%%6 7
_signInManager%%8 F
;%%F G
private&& 
readonly&& 
RoleManager&& $
<&&$ %
IdentityRole&&% 1
>&&1 2
_roleManager&&3 ?
;&&? @
private'' 
readonly'' 
ILogger''  
_logger''! (
;''( )
public))  
ApiAccountController)) #
())# $
UserManager** 
<** 
ApplicationUser** '
>**' (
userManager**) 4
,**4 5
SignInManager++ 
<++ 
ApplicationUser++ )
>++) *
signInManager+++ 8
,++8 9
RoleManager,, 
<,, 
IdentityRole,, $
>,,$ %
roleManager,,& 1
,,,1 2
ILogger-- 
<--  
ApiAccountController-- (
>--( )
logger--* 0
)--0 1
{.. 	
_userManager// 
=// 
userManager// &
;//& '
_signInManager00 
=00 
signInManager00 *
;00* +
_roleManager11 
=11 
roleManager11 &
;11& '
_logger22 
=22 
logger22 
;22 
}33 	
[55 	
TempData55	 
]55 
public66 
string66 
ErrorMessage66 "
{66# $
get66% (
;66( )
set66* -
;66- .
}66/ 0
[:: 	
	Authorize::	 
(:: !
AuthenticationSchemes:: (
=::) *
JwtBearerDefaults::+ <
.::< = 
AuthenticationScheme::= Q
)::Q R
]::R S
[;; 	
Route;;	 
(;; 
$str;; 
);; 
];; 
[<< 	
HttpGet<<	 
,<< 
HttpPost<< 
,<< 
HttpOptions<< '
]<<' (
public== 
async== 
Task== 
<== 
RepositoryResponse== ,
<==, -
bool==- 1
>==1 2
>==2 3
Logout==4 :
(==: ;
)==; <
{>> 	
var?? 
result?? 
=?? 
new?? 
RepositoryResponse?? /
<??/ 0
bool??0 4
>??4 5
(??5 6
)??6 7
{??8 9
	IsSucceed??: C
=??D E
true??F J
,??J K
Data??L P
=??Q R
true??S W
}??X Y
;??Y Z
await@@ 
_signInManager@@  
.@@  !
SignOutAsync@@! -
(@@- .
)@@. /
.@@/ 0
ConfigureAwait@@0 >
(@@> ?
false@@? D
)@@D E
;@@E F
awaitAA 
HttpContextAA 
.AA 
SignOutAsyncAA *
(AA* +(
CookieAuthenticationDefaultsAA+ G
.AAG H 
AuthenticationSchemeAAH \
)AA\ ]
.AA] ^
ConfigureAwaitAA^ l
(AAl m
falseAAm r
)AAr s
;AAs t
awaitBB !
RefreshTokenViewModelBB '
.BB' (

RepositoryBB( 2
.BB2 3
RemoveModelAsyncBB3 C
(BBC D
rBBD E
=>BBF H
rBBI J
.BBJ K
UsernameBBK S
==BBT V
UserBBW [
.BB[ \
IdentityBB\ d
.BBd e
NameBBe i
)BBi j
;BBj k
returnCC 
resultCC 
;CC 
}DD 	
[FF 	
RouteFF	 
(FF 
$strFF 
)FF 
]FF 
[GG 	
HttpPostGG	 
,GG 
HttpOptionsGG 
]GG 
[HH 	
AllowAnonymousHH	 
]HH 
publicJJ 
asyncJJ 
TaskJJ 
<JJ 
RepositoryResponseJJ ,
<JJ, - 
AccessTokenViewModelJJ- A
>JJA B
>JJB C
LoginJJD I
(JJI J
[JJJ K
FromBodyJJK S
]JJS T
LoginViewModelJJU c
modelJJd i
)JJi j
{KK 	
RepositoryResponseLL 
<LL  
AccessTokenViewModelLL 3
>LL3 4
loginResultLL5 @
=LLA B
newLLC F
RepositoryResponseLLG Y
<LLY Z 
AccessTokenViewModelLLZ n
>LLn o
(LLo p
)LLp q
;LLq r
ifMM 
(MM 

ModelStateMM 
.MM 
IsValidMM "
)MM" #
{NN 
varQQ 
resultQQ 
=QQ 
awaitQQ "
_signInManagerQQ# 1
.QQ1 2
PasswordSignInAsyncQQ2 E
(QQE F
modelRR 
.RR 
UserNameRR "
,RR" #
modelRR$ )
.RR) *
PasswordRR* 2
,RR2 3
isPersistentRR4 @
:RR@ A
modelRRB G
.RRG H

RememberMeRRH R
,RRR S
lockoutOnFailureRRT d
:RRd e
falseRRf k
)RRk l
.RRl m
ConfigureAwaitRRm {
(RR{ |
false	RR| Å
)
RRÅ Ç
;
RRÇ É
ifSS 
(SS 
resultSS 
.SS 
	SucceededSS $
)SS$ %
{TT 
varUU 
userUU 
=UU 
awaitUU $
_userManagerUU% 1
.UU1 2
FindByNameAsyncUU2 A
(UUA B
modelUUB G
.UUG H
UserNameUUH P
)UUP Q
.UUQ R
ConfigureAwaitUUR `
(UU` a
falseUUa f
)UUf g
;UUg h
varWW 
tokenWW 
=WW 
awaitWW  %$
GenerateAccessTokenAsyncWW& >
(WW> ?
userWW? C
,WWC D
modelWWE J
.WWJ K

RememberMeWWK U
)WWU V
;WWV W
ifXX 
(XX 
tokenXX 
!=XX  
nullXX! %
)XX% &
{YY 
varZZ 
infoZZ  
=ZZ! "
awaitZZ# (
UserInfoViewModelZZ) :
.ZZ: ;

RepositoryZZ; E
.ZZE F
GetSingleModelAsyncZZF Y
(ZZY Z
uZZZ [
=>ZZ\ ^
uZZ_ `
.ZZ` a
UsernameZZa i
==ZZj l
userZZm q
.ZZq r
UserNameZZr z
)ZZz {
;ZZ{ |
if[[ 
([[ 
![[ 
info[[ !
.[[! "
	IsSucceed[[" +
)[[+ ,
{\\ 
info]]  
.]]  !
Data]]! %
=]]& '
new]]( +
UserInfoViewModel]], =
(]]= >
)]]> ?
;]]? @
}^^ 
token__ 
.__ 
UserData__ &
=__' (
info__) -
.__- .
Data__. 2
;__2 3
loginResultaa #
.aa# $
	IsSucceedaa$ -
=aa. /
trueaa0 4
;aa4 5
loginResultbb #
.bb# $
Statusbb$ *
=bb+ ,
$numbb- .
;bb. /
loginResultcc #
.cc# $
Datacc$ (
=cc) *
tokencc+ 0
;cc0 1
_loggerdd 
.dd  
LogInformationdd  .
(dd. /
$strdd/ @
)dd@ A
;ddA B
returnee 
loginResultee *
;ee* +
}ff 
elsegg 
{hh 
returnii 
loginResultii *
;ii* +
}jj 
}kk 
elsell 
{mm 
loginResultnn 
.nn  
Errorsnn  &
.nn& '
Addnn' *
(nn* +
$strnn+ 9
)nn9 :
;nn: ;
returnoo 
loginResultoo &
;oo& '
}pp 
}qq 
elserr 
{ss 
returntt 
loginResulttt "
;tt" #
}uu 
}vv 	
[xx 	
Routexx	 
(xx 
$strxx /
)xx/ 0
]xx0 1
[yy 	
HttpGetyy	 
,yy 
HttpOptionsyy 
]yy 
[zz 	
AllowAnonymouszz	 
]zz 
public{{ 
async{{ 
Task{{ 
<{{ 
RepositoryResponse{{ ,
<{{, - 
AccessTokenViewModel{{- A
>{{A B
>{{B C
RefreshToken{{D P
({{P Q
string{{Q W
refreshTokenId{{X f
){{f g
{|| 	
RepositoryResponse}} 
<}}  
AccessTokenViewModel}} 3
>}}3 4
result}}5 ;
=}}< =
new}}> A
RepositoryResponse}}B T
<}}T U 
AccessTokenViewModel}}U i
>}}i j
(}}j k
)}}k l
;}}l m
var~~ 
getRefreshToken~~ 
=~~  !
await~~" '!
RefreshTokenViewModel~~( =
.~~= >

Repository~~> H
.~~H I
GetSingleModelAsync~~I \
(~~\ ]
t~~] ^
=>~~_ a
t~~b c
.~~c d
Id~~d f
==~~g i
refreshTokenId~~j x
)~~x y
;~~y z
if 
( 
getRefreshToken 
.  
	IsSucceed  )
)) *
{
ÄÄ 
var
ÅÅ 
oldToken
ÅÅ 
=
ÅÅ 
getRefreshToken
ÅÅ .
.
ÅÅ. /
Data
ÅÅ/ 3
;
ÅÅ3 4
if
ÇÇ 
(
ÇÇ 
oldToken
ÇÇ 
.
ÇÇ 

ExpiresUtc
ÇÇ '
>
ÇÇ( )
DateTime
ÇÇ* 2
.
ÇÇ2 3
UtcNow
ÇÇ3 9
)
ÇÇ9 :
{
ÉÉ 
var
ÑÑ 
user
ÑÑ 
=
ÑÑ 
await
ÑÑ $
_userManager
ÑÑ% 1
.
ÑÑ1 2
FindByEmailAsync
ÑÑ2 B
(
ÑÑB C
oldToken
ÑÑC K
.
ÑÑK L
Email
ÑÑL Q
)
ÑÑQ R
;
ÑÑR S
var
ÖÖ 
token
ÖÖ 
=
ÖÖ 
await
ÖÖ  %&
GenerateAccessTokenAsync
ÖÖ& >
(
ÖÖ> ?
user
ÖÖ? C
,
ÖÖC D
true
ÖÖE I
)
ÖÖI J
;
ÖÖJ K
if
ÜÜ 
(
ÜÜ 
token
ÜÜ 
!=
ÜÜ  
null
ÜÜ! %
)
ÜÜ% &
{
áá 
await
àà 
oldToken
àà &
.
àà& '
RemoveModelAsync
àà' 7
(
àà7 8
)
àà8 9
;
àà9 :
}
ââ 
result
ää 
.
ää 
	IsSucceed
ää $
=
ää% &
true
ää' +
;
ää+ ,
result
ãã 
.
ãã 
Data
ãã 
=
ãã  !
token
ãã" '
;
ãã' (
return
åå 
result
åå !
;
åå! "
}
çç 
else
éé 
{
èè 
await
êê 
oldToken
êê "
.
êê" #
RemoveModelAsync
êê# 3
(
êê3 4
)
êê4 5
;
êê5 6
result
ëë 
.
ëë 
Errors
ëë !
.
ëë! "
Add
ëë" %
(
ëë% &
$str
ëë& 5
)
ëë5 6
;
ëë6 7
return
íí 
result
íí !
;
íí! "
}
ìì 
}
îî 
else
ïï 
{
ññ 
result
óó 
.
óó 
Errors
óó 
.
óó 
Add
óó !
(
óó! "
$str
óó" 1
)
óó1 2
;
óó2 3
return
òò 
result
òò 
;
òò 
}
ôô 
}
öö 	
[
úú 	
Route
úú	 
(
úú 
$str
úú 
)
úú 
]
úú 
[
ùù 	
HttpPost
ùù	 
,
ùù 
HttpOptions
ùù 
]
ùù 
[
ûû 	
AllowAnonymous
ûû	 
]
ûû 
public
üü 
async
üü 
Task
üü 
<
üü  
RepositoryResponse
üü ,
<
üü, -"
AccessTokenViewModel
üü- A
>
üüA B
>
üüB C
Register
üüD L
(
üüL M
[
üüM N
FromBody
üüN V
]
üüV W"
MixRegisterViewModel
üüX l
model
üüm r
)
üür s
{
†† 	 
RepositoryResponse
°° 
<
°° "
AccessTokenViewModel
°° 3
>
°°3 4
result
°°5 ;
=
°°< =
new
°°> A 
RepositoryResponse
°°B T
<
°°T U"
AccessTokenViewModel
°°U i
>
°°i j
(
°°j k
)
°°k l
;
°°l m
if
¢¢ 
(
¢¢ 

ModelState
¢¢ 
.
¢¢ 
IsValid
¢¢ "
)
¢¢" #
{
££ 
var
§§ 
user
§§ 
=
§§ 
new
§§ 
ApplicationUser
§§ .
{
•• 
UserName
¶¶ 
=
¶¶ 
model
¶¶ $
.
¶¶$ %
Username
¶¶% -
,
¶¶- .
Email
ßß 
=
ßß 
model
ßß !
.
ßß! "
Email
ßß" '
,
ßß' (
	FirstName
®® 
=
®® 
model
®®  %
.
®®% &
	FirstName
®®& /
,
®®/ 0
LastName
©© 
=
©© 
model
©© $
.
©©$ %
LastName
©©% -
,
©©- .
JoinDate
™™ 
=
™™ 
DateTime
™™ '
.
™™' (
UtcNow
™™( .
}
´´ 
;
´´ 
var
¨¨ 
createResult
¨¨  
=
¨¨! "
await
¨¨# (
_userManager
¨¨) 5
.
¨¨5 6
CreateAsync
¨¨6 A
(
¨¨A B
user
¨¨B F
,
¨¨F G
password
¨¨H P
:
¨¨P Q
model
¨¨R W
.
¨¨W X
Password
¨¨X `
)
¨¨` a
.
¨¨a b
ConfigureAwait
¨¨b p
(
¨¨p q
false
¨¨q v
)
¨¨v w
;
¨¨w x
if
≠≠ 
(
≠≠ 
createResult
≠≠  
.
≠≠  !
	Succeeded
≠≠! *
)
≠≠* +
{
ÆÆ 
_logger
ØØ 
.
ØØ 
LogInformation
ØØ *
(
ØØ* +
$str
ØØ+ V
)
ØØV W
;
ØØW X
user
±± 
=
±± 
await
±±  
_userManager
±±! -
.
±±- .
FindByEmailAsync
±±. >
(
±±> ?
model
±±? D
.
±±D E
Email
±±E J
)
±±J K
.
±±K L
ConfigureAwait
±±L Z
(
±±Z [
false
±±[ `
)
±±` a
;
±±a b
model
≤≤ 
.
≤≤ 
Id
≤≤ 
=
≤≤ 
user
≤≤ #
.
≤≤# $
Id
≤≤$ &
;
≤≤& '
model
≥≥ 
.
≥≥ 
CreatedDateTime
≥≥ )
=
≥≥* +
DateTime
≥≥, 4
.
≥≥4 5
UtcNow
≥≥5 ;
;
≥≥; <
await
∂∂ 
model
∂∂ 
.
∂∂  
SaveModelAsync
∂∂  .
(
∂∂. /
)
∂∂/ 0
;
∂∂0 1
if
∑∑ 
(
∑∑ 
_userManager
∑∑ $
.
∑∑$ %
Users
∑∑% *
.
∑∑* +
Count
∑∑+ 0
(
∑∑0 1
)
∑∑1 2
==
∑∑3 5
$num
∑∑6 7
)
∑∑7 8
{
∏∏ 
await
ππ 
_userManager
ππ *
.
ππ* +
AddToRoleAsync
ππ+ 9
(
ππ9 :
user
ππ: >
,
ππ> ?
$str
ππ@ L
)
ππL M
;
ππM N
}
∫∫ 
var
ªª 
token
ªª 
=
ªª 
await
ªª  %&
GenerateAccessTokenAsync
ªª& >
(
ªª> ?
user
ªª? C
,
ªªC D
true
ªªE I
)
ªªI J
;
ªªJ K
if
ºº 
(
ºº 
token
ºº 
!=
ºº  
null
ºº! %
)
ºº% &
{
ΩΩ 
result
ææ 
.
ææ 
	IsSucceed
ææ (
=
ææ) *
true
ææ+ /
;
ææ/ 0
result
øø 
.
øø 
Data
øø #
=
øø$ %
token
øø& +
;
øø+ ,
_logger
¿¿ 
.
¿¿  
LogInformation
¿¿  .
(
¿¿. /
$str
¿¿/ @
)
¿¿@ A
;
¿¿A B
return
¡¡ 
result
¡¡ %
;
¡¡% &
}
¬¬ 
else
√√ 
{
ƒƒ 
return
≈≈ 
result
≈≈ %
;
≈≈% &
}
∆∆ 
}
«« 
else
»» 
{
…… 
foreach
   
(
   
var
    
error
  ! &
in
  ' )
createResult
  * 6
.
  6 7
Errors
  7 =
)
  = >
{
ÀÀ 
result
ÃÃ 
.
ÃÃ 
Errors
ÃÃ %
.
ÃÃ% &
Add
ÃÃ& )
(
ÃÃ) *
error
ÃÃ* /
.
ÃÃ/ 0
Description
ÃÃ0 ;
)
ÃÃ; <
;
ÃÃ< =
}
ÕÕ 
return
ŒŒ 
result
ŒŒ !
;
ŒŒ! "
}
œœ 
}
–– 
return
““ 
result
““ 
;
““ 
}
”” 	
[
’’ 	
	Authorize
’’	 
(
’’ #
AuthenticationSchemes
’’ (
=
’’) *
JwtBearerDefaults
’’+ <
.
’’< ="
AuthenticationScheme
’’= Q
,
’’Q R
Roles
÷÷ 
=
÷÷ 
$str
÷÷ 
)
÷÷ 
]
÷÷ 
[
◊◊ 	
Route
◊◊	 
(
◊◊ 
$str
◊◊ 
)
◊◊ 
]
◊◊ 
[
ÿÿ 	
HttpPost
ÿÿ	 
,
ÿÿ 
HttpOptions
ÿÿ 
]
ÿÿ 
public
ŸŸ 
async
ŸŸ 
Task
ŸŸ 
<
ŸŸ  
RepositoryResponse
ŸŸ ,
<
ŸŸ, -
bool
ŸŸ- 1
>
ŸŸ1 2
>
ŸŸ2 3
ManageUserInRole
ŸŸ4 D
(
ŸŸD E
[
ŸŸE F
FromBody
ŸŸF N
]
ŸŸN O
UserRoleModel
ŸŸO \
model
ŸŸ] b
)
ŸŸb c
{
⁄⁄ 	
var
€€ 
role
€€ 
=
€€ 
await
€€ 
_roleManager
€€ )
.
€€) *
FindByIdAsync
€€* 7
(
€€7 8
model
€€8 =
.
€€= >
RoleId
€€> D
)
€€D E
;
€€E F
var
‹‹ 
result
‹‹ 
=
‹‹ 
new
‹‹  
RepositoryResponse
‹‹ /
<
‹‹/ 0
bool
‹‹0 4
>
‹‹4 5
(
‹‹5 6
)
‹‹6 7
;
‹‹7 8
List
ﬁﬁ 
<
ﬁﬁ 
string
ﬁﬁ 
>
ﬁﬁ 
errors
ﬁﬁ 
=
ﬁﬁ  !
new
ﬁﬁ" %
List
ﬁﬁ& *
<
ﬁﬁ* +
string
ﬁﬁ+ 1
>
ﬁﬁ1 2
(
ﬁﬁ2 3
)
ﬁﬁ3 4
;
ﬁﬁ4 5
if
‡‡ 
(
‡‡ 
role
‡‡ 
==
‡‡ 
null
‡‡ 
)
‡‡ 
{
·· 
errors
‚‚ 
.
‚‚ 
Add
‚‚ 
(
‚‚ 
$"
‚‚ 
Role: 
‚‚ #
{
‚‚# $
model
‚‚$ )
.
‚‚) *
RoleId
‚‚* 0
}
‚‚0 1
 does not exists
‚‚1 A
"
‚‚A B
)
‚‚B C
;
‚‚C D
}
„„ 
else
‰‰ 
if
‰‰ 
(
‰‰ 
model
‰‰ 
.
‰‰ 
IsUserInRole
‰‰ '
)
‰‰' (
{
ÂÂ 
var
ÊÊ 
appUser
ÊÊ 
=
ÊÊ 
await
ÊÊ #
_userManager
ÊÊ$ 0
.
ÊÊ0 1
FindByIdAsync
ÊÊ1 >
(
ÊÊ> ?
model
ÊÊ? D
.
ÊÊD E
UserId
ÊÊE K
)
ÊÊK L
;
ÊÊL M
if
ËË 
(
ËË 
appUser
ËË 
==
ËË 
null
ËË #
)
ËË# $
{
ÈÈ 
errors
ÍÍ 
.
ÍÍ 
Add
ÍÍ 
(
ÍÍ 
$"
ÍÍ !
User: 
ÍÍ! '
{
ÍÍ' (
model
ÍÍ( -
.
ÍÍ- .
UserId
ÍÍ. 4
}
ÍÍ4 5
 does not exists
ÍÍ5 E
"
ÍÍE F
)
ÍÍF G
;
ÍÍG H
}
ÎÎ 
else
ÏÏ 
if
ÏÏ 
(
ÏÏ 
!
ÏÏ 
(
ÏÏ 
await
ÏÏ  
_userManager
ÏÏ! -
.
ÏÏ- .
IsInRoleAsync
ÏÏ. ;
(
ÏÏ; <
appUser
ÏÏ< C
,
ÏÏC D
role
ÏÏE I
.
ÏÏI J
Name
ÏÏJ N
)
ÏÏN O
)
ÏÏO P
)
ÏÏP Q
{
ÌÌ 
var
ÓÓ 
	addResult
ÓÓ !
=
ÓÓ" #
await
ÓÓ$ )
_userManager
ÓÓ* 6
.
ÓÓ6 7
AddToRoleAsync
ÓÓ7 E
(
ÓÓE F
appUser
ÓÓF M
,
ÓÓM N
role
ÓÓO S
.
ÓÓS T
Name
ÓÓT X
)
ÓÓX Y
;
ÓÓY Z
if
 
(
 
!
 
	addResult
 "
.
" #
	Succeeded
# ,
)
, -
{
ÒÒ 
errors
ÚÚ 
.
ÚÚ 
Add
ÚÚ "
(
ÚÚ" #
$"
ÚÚ# %
User: 
ÚÚ% +
{
ÚÚ+ ,
model
ÚÚ, 1
.
ÚÚ1 2
UserId
ÚÚ2 8
}
ÚÚ8 9)
 could not be added to role
ÚÚ9 T
"
ÚÚT U
)
ÚÚU V
;
ÚÚV W
}
ÛÛ 
}
ÙÙ 
}
ıı 
else
ˆˆ 
{
˜˜ 
var
¯¯ 
appUser
¯¯ 
=
¯¯ 
await
¯¯ #
_userManager
¯¯$ 0
.
¯¯0 1
FindByIdAsync
¯¯1 >
(
¯¯> ?
model
¯¯? D
.
¯¯D E
UserId
¯¯E K
)
¯¯K L
;
¯¯L M
if
˙˙ 
(
˙˙ 
appUser
˙˙ 
==
˙˙ 
null
˙˙ #
)
˙˙# $
{
˚˚ 
errors
¸¸ 
.
¸¸ 
Add
¸¸ 
(
¸¸ 
$"
¸¸ !
User: 
¸¸! '
{
¸¸' (
model
¸¸( -
.
¸¸- .
UserId
¸¸. 4
}
¸¸4 5
 does not exists
¸¸5 E
"
¸¸E F
)
¸¸F G
;
¸¸G H
}
˝˝ 
var
ˇˇ 
removeResult
ˇˇ  
=
ˇˇ! "
await
ˇˇ# (
_userManager
ˇˇ) 5
.
ˇˇ5 6!
RemoveFromRoleAsync
ˇˇ6 I
(
ˇˇI J
appUser
ˇˇJ Q
,
ˇˇQ R
role
ˇˇS W
.
ˇˇW X
Name
ˇˇX \
)
ˇˇ\ ]
;
ˇˇ] ^
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 
removeResult
ÄÄ !
.
ÄÄ! "
	Succeeded
ÄÄ" +
)
ÄÄ+ ,
{
ÅÅ 
errors
ÇÇ 
.
ÇÇ 
Add
ÇÇ 
(
ÇÇ 
$"
ÇÇ !
User: 
ÇÇ! '
{
ÇÇ' (
model
ÇÇ( -
.
ÇÇ- .
UserId
ÇÇ. 4
}
ÇÇ4 5-
 could not be removed from role
ÇÇ5 T
"
ÇÇT U
)
ÇÇU V
;
ÇÇV W
}
ÉÉ 
}
ÑÑ 
result
ÖÖ 
.
ÖÖ 
	IsSucceed
ÖÖ 
=
ÖÖ 
errors
ÖÖ %
.
ÖÖ% &
Count
ÖÖ& +
==
ÖÖ, .
$num
ÖÖ/ 0
;
ÖÖ0 1
result
ÜÜ 
.
ÜÜ 
Data
ÜÜ 
=
ÜÜ 
errors
ÜÜ  
.
ÜÜ  !
Count
ÜÜ! &
==
ÜÜ' )
$num
ÜÜ* +
;
ÜÜ+ ,
result
áá 
.
áá 
Errors
áá 
=
áá 
errors
áá "
;
áá" #
return
àà 
result
àà 
;
àà 
}
ââ 	
[
ãã 	
HttpGet
ãã	 
,
ãã 
HttpOptions
ãã 
]
ãã 
[
åå 	
Route
åå	 
(
åå 
$str
åå (
)
åå( )
]
åå) *
[
çç 	
Route
çç	 
(
çç 
$str
çç #
)
çç# $
]
çç$ %
public
éé 
async
éé 
Task
éé 
<
éé 
JObject
éé !
>
éé! "
Details
éé# *
(
éé* +
string
éé+ 1
viewType
éé2 :
,
éé: ;
string
éé< B
id
ééC E
=
ééF G
null
ééH L
)
ééL M
{
èè 	
switch
êê 
(
êê 
viewType
êê 
)
êê 
{
ëë 
case
íí 
$str
íí 
:
íí 
if
ìì 
(
ìì 
!
ìì 
string
ìì 
.
ìì  
IsNullOrEmpty
ìì  -
(
ìì- .
id
ìì. 0
)
ìì0 1
)
ìì1 2
{
îî 
var
ïï 
beResult
ïï $
=
ïï% &
await
ïï' ,"
MixRegisterViewModel
ïï- A
.
ïïA B

Repository
ïïB L
.
ïïL M!
GetSingleModelAsync
ïïM `
(
ïï` a
model
ññ !
=>
ññ" $
model
ññ% *
.
ññ* +
Id
ññ+ -
==
ññ. 0
id
ññ1 3
)
ññ3 4
.
ññ4 5
ConfigureAwait
ññ5 C
(
ññC D
false
ññD I
)
ññI J
;
ññJ K
return
óó 
JObject
óó &
.
óó& '

FromObject
óó' 1
(
óó1 2
beResult
óó2 :
)
óó: ;
;
óó; <
}
òò 
else
ôô 
{
öö 
var
õõ 
model
õõ !
=
õõ" #
new
õõ$ '

MixCmsUser
õõ( 2
(
õõ2 3
)
õõ3 4
{
õõ5 6
Status
õõ7 =
=
õõ> ?
(
õõ@ A
int
õõA D
)
õõD E
MixUserStatus
õõE R
.
õõR S
Actived
õõS Z
}
õõ[ \
;
õõ\ ] 
RepositoryResponse
ùù *
<
ùù* +"
MixRegisterViewModel
ùù+ ?
>
ùù? @
result
ùùA G
=
ùùH I
new
ùùJ M 
RepositoryResponse
ùùN `
<
ùù` a"
MixRegisterViewModel
ùùa u
>
ùùu v
(
ùùv w
)
ùùw x
{
ûû 
	IsSucceed
üü %
=
üü& '
true
üü( ,
,
üü, -
Data
††  
=
††! "
await
††# ("
MixRegisterViewModel
††) =
.
††= >
InitViewAsync
††> K
(
††K L
model
††L Q
)
††Q R
}
°° 
;
°° 
return
¢¢ 
JObject
¢¢ &
.
¢¢& '

FromObject
¢¢' 1
(
¢¢1 2
result
¢¢2 8
)
¢¢8 9
;
¢¢9 :
}
££ 
default
§§ 
:
§§ 
if
•• 
(
•• 
!
•• 
string
•• 
.
••  
IsNullOrEmpty
••  -
(
••- .
id
••. 0
)
••0 1
)
••1 2
{
¶¶ 
var
ßß 
beResult
ßß $
=
ßß% &
await
ßß' ,
UserInfoViewModel
ßß- >
.
ßß> ?

Repository
ßß? I
.
ßßI J!
GetSingleModelAsync
ßßJ ]
(
ßß] ^
model
®® !
=>
®®" $
model
®®% *
.
®®* +
Id
®®+ -
==
®®. 0
id
®®1 3
)
®®3 4
.
®®4 5
ConfigureAwait
®®5 C
(
®®C D
false
®®D I
)
®®I J
;
®®J K
return
©© 
JObject
©© &
.
©©& '

FromObject
©©' 1
(
©©1 2
beResult
©©2 :
)
©©: ;
;
©©; <
}
™™ 
else
´´ 
{
¨¨ 
var
≠≠ 
model
≠≠ !
=
≠≠" #
new
≠≠$ '

MixCmsUser
≠≠( 2
(
≠≠2 3
)
≠≠3 4
{
≠≠5 6
Status
≠≠7 =
=
≠≠> ?
(
≠≠@ A
int
≠≠A D
)
≠≠D E
MixUserStatus
≠≠E R
.
≠≠R S
Actived
≠≠S Z
}
≠≠[ \
;
≠≠\ ] 
RepositoryResponse
ØØ *
<
ØØ* +
UserInfoViewModel
ØØ+ <
>
ØØ< =
result
ØØ> D
=
ØØE F
new
ØØG J 
RepositoryResponse
ØØK ]
<
ØØ] ^
UserInfoViewModel
ØØ^ o
>
ØØo p
(
ØØp q
)
ØØq r
{
∞∞ 
	IsSucceed
±± %
=
±±& '
true
±±( ,
,
±±, -
Data
≤≤  
=
≤≤! "
await
≤≤# (
UserInfoViewModel
≤≤) :
.
≤≤: ;
InitViewAsync
≤≤; H
(
≤≤H I
model
≤≤I N
)
≤≤N O
}
≥≥ 
;
≥≥ 
return
¥¥ 
JObject
¥¥ &
.
¥¥& '

FromObject
¥¥' 1
(
¥¥1 2
result
¥¥2 8
)
¥¥8 9
;
¥¥9 :
}
µµ 
}
∂∂ 
}
∑∑ 	
[
ªª 	
HttpPost
ªª	 
,
ªª 
HttpOptions
ªª 
]
ªª 
[
ºº 	
Route
ºº	 
(
ºº 
$str
ºº 
)
ºº 
]
ºº 
public
ΩΩ 
async
ΩΩ 
Task
ΩΩ 
<
ΩΩ  
RepositoryResponse
ΩΩ ,
<
ΩΩ, -
UserInfoViewModel
ΩΩ- >
>
ΩΩ> ?
>
ΩΩ? @
Save
ΩΩA E
(
ΩΩE F
[
ææ 
FromBody
ææ 
]
ææ 
UserInfoViewModel
ææ (
model
ææ) .
)
ææ. /
{
øø 	
if
¿¿ 
(
¿¿ 
model
¿¿ 
!=
¿¿ 
null
¿¿ 
)
¿¿ 
{
¡¡ 
var
¬¬ 
result
¬¬ 
=
¬¬ 
await
¬¬ "
model
¬¬# (
.
¬¬( )
SaveModelAsync
¬¬) 7
(
¬¬7 8
true
¬¬8 <
)
¬¬< =
.
¬¬= >
ConfigureAwait
¬¬> L
(
¬¬L M
false
¬¬M R
)
¬¬R S
;
¬¬S T
return
√√ 
result
√√ 
;
√√ 
}
ƒƒ 
return
≈≈ 
new
≈≈  
RepositoryResponse
≈≈ )
<
≈≈) *
UserInfoViewModel
≈≈* ;
>
≈≈; <
(
≈≈< =
)
≈≈= >
;
≈≈> ?
}
∆∆ 	
[
…… 	
HttpPost
……	 
,
…… 
HttpOptions
…… 
]
…… 
[
   	
Route
  	 
(
   
$str
   
)
   
]
   
public
ÀÀ 
async
ÀÀ 
Task
ÀÀ 
<
ÀÀ  
RepositoryResponse
ÀÀ ,
<
ÀÀ, -
PaginationModel
ÀÀ- <
<
ÀÀ< =
UserInfoViewModel
ÀÀ= N
>
ÀÀN O
>
ÀÀO P
>
ÀÀP Q
GetList
ÀÀR Y
(
ÀÀY Z
RequestPaging
ÀÀZ g
request
ÀÀh o
)
ÀÀo p
{
ÃÃ 	

Expression
ÕÕ 
<
ÕÕ 
Func
ÕÕ 
<
ÕÕ 

MixCmsUser
ÕÕ &
,
ÕÕ& '
bool
ÕÕ( ,
>
ÕÕ, -
>
ÕÕ- .
	predicate
ÕÕ/ 8
=
ÕÕ9 :
model
ÕÕ; @
=>
ÕÕA C
(
ŒŒ 
!
ŒŒ 
request
ŒŒ 
.
ŒŒ 
Status
ŒŒ  
.
ŒŒ  !
HasValue
ŒŒ! )
||
ŒŒ* ,
model
ŒŒ- 2
.
ŒŒ2 3
Status
ŒŒ3 9
==
ŒŒ: <
request
ŒŒ= D
.
ŒŒD E
Status
ŒŒE K
.
ŒŒK L
Value
ŒŒL Q
)
ŒŒQ R
&&
œœ 
(
œœ 
string
œœ 
.
œœ  
IsNullOrWhiteSpace
œœ -
(
œœ- .
request
œœ. 5
.
œœ5 6
Keyword
œœ6 =
)
œœ= >
||
–– 
(
–– 
model
—— 
.
—— 
Username
—— "
.
——" #
Contains
——# +
(
——+ ,
request
——, 3
.
——3 4
Keyword
——4 ;
)
——; <
||
““ 
model
““ 
.
““ 
	FirstName
““ %
.
““% &
Contains
““& .
(
““. /
request
““/ 6
.
““6 7
Keyword
““7 >
)
““> ?
||
”” 
model
”” 
.
”” 
LastName
”” $
.
””$ %
Contains
””% -
(
””- .
request
””. 5
.
””5 6
Keyword
””6 =
)
””= >
)
‘‘ 
)
’’ 
&&
÷÷ 
(
÷÷ 
!
÷÷ 
request
÷÷ 
.
÷÷ 
FromDate
÷÷ %
.
÷÷% &
HasValue
÷÷& .
||
◊◊ 
(
◊◊ 
model
◊◊ 
.
◊◊ 
CreatedDateTime
◊◊ -
>=
◊◊. 0
request
◊◊1 8
.
◊◊8 9
FromDate
◊◊9 A
.
◊◊A B
Value
◊◊B G
.
◊◊G H
ToUniversalTime
◊◊H W
(
◊◊W X
)
◊◊X Y
)
◊◊Y Z
)
ÿÿ 
&&
ŸŸ 
(
ŸŸ 
!
ŸŸ 
request
ŸŸ 
.
ŸŸ 
ToDate
ŸŸ #
.
ŸŸ# $
HasValue
ŸŸ$ ,
||
⁄⁄ 
(
⁄⁄ 
model
⁄⁄ 
.
⁄⁄ 
CreatedDateTime
⁄⁄ -
<=
⁄⁄. 0
request
⁄⁄1 8
.
⁄⁄8 9
ToDate
⁄⁄9 ?
.
⁄⁄? @
Value
⁄⁄@ E
.
⁄⁄E F
ToUniversalTime
⁄⁄F U
(
⁄⁄U V
)
⁄⁄V W
)
⁄⁄W X
)
€€ 
;
€€ 
var
›› 
data
›› 
=
›› 
await
›› 
UserInfoViewModel
›› .
.
››. /

Repository
››/ 9
.
››9 :!
GetModelListByAsync
››: M
(
››M N
	predicate
››N W
,
››W X
request
››Y `
.
››` a
OrderBy
››a h
,
››h i
request
››j q
.
››q r
	Direction
››r {
,
››{ |
request››} Ñ
.››Ñ Ö
PageSize››Ö ç
,››ç é
request››è ñ
.››ñ ó
	PageIndex››ó †
)››† °
.››° ¢
ConfigureAwait››¢ ∞
(››∞ ±
false››± ∂
)››∂ ∑
;››∑ ∏
if
ﬁﬁ 
(
ﬁﬁ 
data
ﬁﬁ 
.
ﬁﬁ 
	IsSucceed
ﬁﬁ 
)
ﬁﬁ 
{
ﬂﬂ 
data
‡‡ 
.
‡‡ 
Data
‡‡ 
.
‡‡ 
Items
‡‡ 
.
‡‡  
ForEach
‡‡  '
(
‡‡' (
a
‡‡( )
=>
‡‡* ,
{
·· 
a
‚‚ 
.
‚‚ 

DetailsUrl
‚‚  
=
‚‚! "
MixCmsHelper
‚‚# /
.
‚‚/ 0
GetRouterUrl
‚‚0 <
(
‚‚< =
$str
„„ !
,
„„! "
new
„„# &
{
„„' (
a
„„) *
.
„„* +
Id
„„+ -
}
„„. /
,
„„/ 0
Request
„„1 8
,
„„8 9
Url
„„: =
)
„„= >
;
„„> ?
}
‰‰ 
)
ÂÂ 
;
ÂÂ 
}
ÊÊ 
return
ÁÁ 
data
ÁÁ 
;
ÁÁ 
}
ËË 	
private
ÍÍ 
async
ÍÍ 
Task
ÍÍ 
<
ÍÍ "
AccessTokenViewModel
ÍÍ /
>
ÍÍ/ 0&
GenerateAccessTokenAsync
ÍÍ1 I
(
ÍÍI J
ApplicationUser
ÍÍJ Y
user
ÍÍZ ^
,
ÍÍ^ _
bool
ÍÍ` d

isRemember
ÍÍe o
)
ÍÍo p
{
ÎÎ 	
var
ÏÏ 
dtIssued
ÏÏ 
=
ÏÏ 
DateTime
ÏÏ #
.
ÏÏ# $
UtcNow
ÏÏ$ *
;
ÏÏ* +
var
ÌÌ 
	dtExpired
ÌÌ 
=
ÌÌ 
dtIssued
ÌÌ $
.
ÌÌ$ %
AddDays
ÌÌ% ,
(
ÌÌ, -

MixService
ÌÌ- 7
.
ÌÌ7 8
GetAuthConfig
ÌÌ8 E
<
ÌÌE F
int
ÌÌF I
>
ÌÌI J
(
ÌÌJ K
$str
ÌÌK ]
)
ÌÌ] ^
)
ÌÌ^ _
;
ÌÌ_ `
var
ÓÓ #
dtRefreshTokenExpired
ÓÓ %
=
ÓÓ& '
dtIssued
ÓÓ( 0
.
ÓÓ0 1
AddDays
ÓÓ1 8
(
ÓÓ8 9

MixService
ÓÓ9 C
.
ÓÓC D
GetAuthConfig
ÓÓD Q
<
ÓÓQ R
int
ÓÓR U
>
ÓÓU V
(
ÓÓV W
$str
ÓÓW o
)
ÓÓo p
)
ÓÓp q
;
ÓÓq r
string
ÔÔ 
refreshTokenId
ÔÔ !
=
ÔÔ" #
string
ÔÔ$ *
.
ÔÔ* +
Empty
ÔÔ+ 0
;
ÔÔ0 1
string
 
refreshToken
 
=
  !
string
" (
.
( )
Empty
) .
;
. /
if
ÒÒ 
(
ÒÒ 

isRemember
ÒÒ 
)
ÒÒ 
{
ÚÚ 
refreshToken
ÛÛ 
=
ÛÛ 
Guid
ÛÛ #
.
ÛÛ# $
NewGuid
ÛÛ$ +
(
ÛÛ+ ,
)
ÛÛ, -
.
ÛÛ- .
ToString
ÛÛ. 6
(
ÛÛ6 7
)
ÛÛ7 8
;
ÛÛ8 9#
RefreshTokenViewModel
ÙÙ %
vmRefreshToken
ÙÙ& 4
=
ÙÙ5 6
new
ÙÙ7 :#
RefreshTokenViewModel
ÙÙ; P
(
ÙÙP Q
new
ıı 
RefreshTokens
ıı  -
(
ıı- .
)
ıı. /
{
ˆˆ 
Id
˜˜  "
=
˜˜# $
refreshToken
˜˜% 1
,
˜˜1 2
Email
¯¯  %
=
¯¯& '
user
¯¯( ,
.
¯¯, -
Email
¯¯- 2
,
¯¯2 3
	IssuedUtc
˘˘  )
=
˘˘* +
dtIssued
˘˘, 4
,
˘˘4 5
ClientId
˙˙  (
=
˙˙) *

MixService
˙˙+ 5
.
˙˙5 6
GetAuthConfig
˙˙6 C
<
˙˙C D
string
˙˙D J
>
˙˙J K
(
˙˙K L
$str
˙˙L V
)
˙˙V W
,
˙˙W X
Username
˚˚  (
=
˚˚) *
user
˚˚+ /
.
˚˚/ 0
UserName
˚˚0 8
,
˚˚8 9

ExpiresUtc
˝˝  *
=
˝˝+ ,#
dtRefreshTokenExpired
˝˝- B
}
˛˛ 
)
˛˛ 
;
˛˛ 
var
ÄÄ $
saveRefreshTokenResult
ÄÄ *
=
ÄÄ+ ,
await
ÄÄ- 2
vmRefreshToken
ÄÄ3 A
.
ÄÄA B
SaveModelAsync
ÄÄB P
(
ÄÄP Q
)
ÄÄQ R
;
ÄÄR S
refreshTokenId
ÅÅ 
=
ÅÅ  $
saveRefreshTokenResult
ÅÅ! 7
.
ÅÅ7 8
Data
ÅÅ8 <
?
ÅÅ< =
.
ÅÅ= >
Id
ÅÅ> @
;
ÅÅ@ A
}
ÇÇ "
AccessTokenViewModel
ÑÑ  
token
ÑÑ! &
=
ÑÑ' (
new
ÑÑ) ,"
AccessTokenViewModel
ÑÑ- A
(
ÑÑA B
)
ÑÑB C
{
ÖÖ 
Access_token
ÜÜ 
=
ÜÜ 
await
ÜÜ $ 
GenerateTokenAsync
ÜÜ% 7
(
ÜÜ7 8
user
ÜÜ8 <
,
ÜÜ< =
	dtExpired
ÜÜ> G
,
ÜÜG H
refreshToken
ÜÜI U
)
ÜÜU V
,
ÜÜV W
Refresh_token
áá 
=
áá 
refreshTokenId
áá  .
,
áá. /

Token_type
àà 
=
àà 

MixService
àà '
.
àà' (
GetAuthConfig
àà( 5
<
àà5 6
string
àà6 <
>
àà< =
(
àà= >
$str
àà> I
)
ààI J
,
ààJ K

Expires_in
ââ 
=
ââ 

MixService
ââ '
.
ââ' (
GetAuthConfig
ââ( 5
<
ââ5 6
int
ââ6 9
>
ââ9 :
(
ââ: ;
$str
ââ; M
)
ââM N
,
ââN O
Issued
ãã 
=
ãã 
dtIssued
ãã !
,
ãã! "
Expires
åå 
=
åå 
	dtExpired
åå #
,
åå# $
}
çç 
;
çç 
return
éé 
token
éé 
;
éé 
}
èè 	
private
ëë 
async
ëë 
Task
ëë 
<
ëë 
string
ëë !
>
ëë! " 
GenerateTokenAsync
ëë# 5
(
ëë5 6
ApplicationUser
ëë6 E
user
ëëF J
,
ëëJ K
DateTime
ëëL T
expires
ëëU \
,
ëë\ ]
string
ëë^ d
refreshToken
ëëe q
)
ëëq r
{
íí 	
List
ìì 
<
ìì 
Claim
ìì 
>
ìì 
claims
ìì 
=
ìì  
await
ìì! &
GetClaimsAsync
ìì' 5
(
ìì5 6
user
ìì6 :
)
ìì: ;
;
ìì; <
claims
îî 
.
îî 
AddRange
îî 
(
îî 
new
îî 
[
îî  
]
îî  !
{
ïï 
new
ññ 
Claim
ññ 
(
ññ 
$str
ññ "
,
ññ" #
user
ññ$ (
.
ññ( )
Id
ññ) +
.
ññ+ ,
ToString
ññ, 4
(
ññ4 5
)
ññ5 6
)
ññ6 7
,
ññ7 8
new
óó 
Claim
óó 
(
óó 
$str
óó (
,
óó( )
user
óó* .
.
óó. /
UserName
óó/ 7
)
óó7 8
,
óó8 9
new
òò 
Claim
òò 
(
òò 
$str
òò ,
,
òò, -
refreshToken
òò. :
)
òò: ;
}
ôô 
)
ôô 
;
ôô 
JwtSecurityToken
öö 
jwtSecurityToken
öö -
=
öö. /
new
öö0 3
JwtSecurityToken
öö4 D
(
ööD E
issuer
õõ 
:
õõ 

MixService
õõ "
.
õõ" #
GetAuthConfig
õõ# 0
<
õõ0 1
string
õõ1 7
>
õõ7 8
(
õõ8 9
$str
õõ9 A
)
õõA B
,
õõB C
audience
úú 
:
úú 

MixService
úú $
.
úú$ %
GetAuthConfig
úú% 2
<
úú2 3
string
úú3 9
>
úú9 :
(
úú: ;
$str
úú; E
)
úúE F
,
úúF G
	notBefore
ùù 
:
ùù 
DateTime
ùù #
.
ùù# $
UtcNow
ùù$ *
,
ùù* +
claims
ûû 
:
ûû 
claims
ûû 
,
ûû 
expires
†† 
:
†† 
expires
††  
,
††  ! 
signingCredentials
°° "
:
°°" #
new
°°$ ' 
SigningCredentials
°°( :
(
°°: ;
JwtSecurityKey
°°; I
.
°°I J
Create
°°J P
(
°°P Q

MixService
°°Q [
.
°°[ \
GetAuthConfig
°°\ i
<
°°i j
string
°°j p
>
°°p q
(
°°q r
$str
°°r }
)
°°} ~
)
°°~ 
,°° Ä"
SecurityAlgorithms°°Å ì
.°°ì î

HmacSha256°°î û
)°°û ü
)°°ü †
;°°† °
return
¢¢ 
new
¢¢ %
JwtSecurityTokenHandler
¢¢ .
(
¢¢. /
)
¢¢/ 0
.
¢¢0 1

WriteToken
¢¢1 ;
(
¢¢; <
jwtSecurityToken
¢¢< L
)
¢¢L M
;
¢¢M N
}
££ 	
	protected
•• 
async
•• 
Task
•• 
<
•• 
List
•• !
<
••! "
Claim
••" '
>
••' (
>
••( )
GetClaimsAsync
••* 8
(
••8 9
ApplicationUser
••9 H
user
••I M
)
••M N
{
¶¶ 	
List
ßß 
<
ßß 
Claim
ßß 
>
ßß 
claims
ßß 
=
ßß  
new
ßß! $
List
ßß% )
<
ßß) *
Claim
ßß* /
>
ßß/ 0
(
ßß0 1
)
ßß1 2
;
ßß2 3
var
®® 
	userRoles
®® 
=
®® 
await
®® !
_userManager
®®" .
.
®®. /
GetRolesAsync
®®/ <
(
®®< =
user
®®= A
)
®®A B
;
®®B C
foreach
©© 
(
©© 
var
©© 
claim
©© 
in
©© !
user
©©" &
.
©©& '
Claims
©©' -
)
©©- .
{
™™ 
claims
´´ 
.
´´ 
Add
´´ 
(
´´ 
CreateClaim
´´ &
(
´´& '
claim
´´' ,
.
´´, -
	ClaimType
´´- 6
,
´´6 7
claim
´´8 =
.
´´= >

ClaimValue
´´> H
)
´´H I
)
´´I J
;
´´J K
}
¨¨ 
foreach
ÆÆ 
(
ÆÆ 
var
ÆÆ 
userRole
ÆÆ !
in
ÆÆ" $
	userRoles
ÆÆ% .
)
ÆÆ. /
{
ØØ 
claims
∞∞ 
.
∞∞ 
Add
∞∞ 
(
∞∞ 
new
∞∞ 
Claim
∞∞ $
(
∞∞$ %

ClaimTypes
∞∞% /
.
∞∞/ 0
Role
∞∞0 4
,
∞∞4 5
userRole
∞∞6 >
)
∞∞> ?
)
∞∞? @
;
∞∞@ A
var
±± 
role
±± 
=
±± 
await
±±  
_roleManager
±±! -
.
±±- .
FindByNameAsync
±±. =
(
±±= >
userRole
±±> F
)
±±F G
;
±±G H
if
≤≤ 
(
≤≤ 
role
≤≤ 
!=
≤≤ 
null
≤≤  
)
≤≤  !
{
≥≥ 
var
¥¥ 

roleClaims
¥¥ "
=
¥¥# $
await
¥¥% *
_roleManager
¥¥+ 7
.
¥¥7 8
GetClaimsAsync
¥¥8 F
(
¥¥F G
role
¥¥G K
)
¥¥K L
;
¥¥L M
foreach
µµ 
(
µµ 
Claim
µµ "
	roleClaim
µµ# ,
in
µµ- /

roleClaims
µµ0 :
)
µµ: ;
{
∂∂ 
claims
∑∑ 
.
∑∑ 
Add
∑∑ "
(
∑∑" #
	roleClaim
∑∑# ,
)
∑∑, -
;
∑∑- .
}
∏∏ 
}
ππ 
}
∫∫ 
return
ªª 
claims
ªª 
;
ªª 
}
ºº 	
	protected
ææ 
Claim
ææ 
CreateClaim
ææ #
(
ææ# $
string
ææ$ *
type
ææ+ /
,
ææ/ 0
string
ææ1 7
value
ææ8 =
)
ææ= >
{
øø 	
return
¿¿ 
new
¿¿ 
Claim
¿¿ 
(
¿¿ 
type
¿¿ !
,
¿¿! "
value
¿¿# (
,
¿¿( )
ClaimValueTypes
¿¿* 9
.
¿¿9 :
String
¿¿: @
)
¿¿@ A
;
¿¿A B
}
¡¡ 	
public
√√ 
static
√√ 
class
√√ 
JwtSecurityKey
√√ *
{
ƒƒ 	
public
≈≈ 
static
≈≈ "
SymmetricSecurityKey
≈≈ .
Create
≈≈/ 5
(
≈≈5 6
string
≈≈6 <
secret
≈≈= C
)
≈≈C D
{
∆∆ 
return
«« 
new
«« "
SymmetricSecurityKey
«« /
(
««/ 0
Encoding
««0 8
.
««8 9
ASCII
««9 >
.
««> ?
GetBytes
««? G
(
««G H
secret
««H N
)
««N O
)
««O P
;
««P Q
}
»» 
}
…… 	
}
   
}ÀÀ Ç≠
\C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiArticleController.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 
( 
$str  
)  !
]! "
[ 
Route 

(
 
$str %
)% &
]& '
public 

class  
ApiArticleController %
:& '
BaseApiController 
{ 
public  
ApiArticleController #
(# $
	Microsoft$ -
.- .

AspNetCore. 8
.8 9
SignalR9 @
.@ A
IHubContextA L
<L M
HubM P
.P Q
	PortalHubQ Z
>Z [

hubContext\ f
)f g
:g h
basei m
(m n

hubContextn x
)x y
{ 	
} 	
[## 	
HttpGet##	 
,## 
HttpOptions## 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
RepositoryResponse%% ,
<%%, -

MixArticle%%- 7
>%%7 8
>%%8 9
DeleteAsync%%: E
(%%E F
int%%F I
id%%J L
)%%L M
{&& 	
var'' 

getArticle'' 
='' 
await'' "!
ReadListItemViewModel''# 8
.''8 9

Repository''9 C
.''C D
GetSingleModelAsync''D W
(''W X
model(( 
=>(( 
model(( 
.(( 
Id(( !
==((" $
id((% '
&&((( *
model((+ 0
.((0 1
Specificulture((1 ?
==((@ B
_lang((C H
)((H I
;((I J
if)) 
()) 

getArticle)) 
.)) 
	IsSucceed)) $
)))$ %
{** 
return,, 
await,, 

getArticle,, '
.,,' (
Data,,( ,
.,,, -
RemoveModelAsync,,- =
(,,= >
true,,> B
),,B C
;,,C D
}-- 
else.. 
{// 
return00 
new00 
RepositoryResponse00 -
<00- .

MixArticle00. 8
>008 9
(009 :
)00: ;
{11 
	IsSucceed22 
=22 
false22  %
}33 
;33 
}44 
}55 	
[88 	
HttpGet88	 
,88 
HttpOptions88 
]88 
[99 	
Route99	 
(99 
$str99 (
)99( )
]99) *
[:: 	
Route::	 
(:: 
$str:: #
)::# $
]::$ %
public;; 
async;; 
Task;; 
<;; 
ActionResult;; &
<;;& '
JObject;;' .
>;;. /
>;;/ 0
Details;;1 8
(;;8 9
string;;9 ?
viewType;;@ H
,;;H I
int;;J M
?;;M N
id;;O Q
);;Q R
{<< 	
switch== 
(== 
viewType== 
)== 
{>> 
case?? 
$str?? 
:?? 
if@@ 
(@@ 
id@@ 
.@@ 
HasValue@@ #
)@@# $
{AA 
varBB 
beResultBB $
=BB% &
awaitBB' ,
UpdateViewModelBB- <
.BB< =

RepositoryBB= G
.BBG H
GetSingleModelAsyncBBH [
(BB[ \
modelBB\ a
=>BBb d
modelBBe j
.BBj k
IdBBk m
==BBn p
idBBq s
&&BBt v
modelBBw |
.BB| }
Specificulture	BB} ã
==
BBå é
_lang
BBè î
)
BBî ï
.
BBï ñ
ConfigureAwait
BBñ §
(
BB§ •
false
BB• ™
)
BB™ ´
;
BB´ ¨
ifCC 
(CC 
beResultCC $
.CC$ %
	IsSucceedCC% .
)CC. /
{DD 
beResultEE $
.EE$ %
DataEE% )
.EE) *

DetailsUrlEE* 4
=EE5 6
MixCmsHelperEE7 C
.EEC D
GetRouterUrlEED P
(EEP Q
$strEEQ Z
,EEZ [
newEE\ _
{EE` a
beResultEEb j
.EEj k
DataEEk o
.EEo p
SeoNameEEp w
}EEx y
,EEy z
Request	EE{ Ç
,
EEÇ É
Url
EEÑ á
)
EEá à
;
EEà â
}FF 
returnGG 
OkGG !
(GG! "
JObjectGG" )
.GG) *

FromObjectGG* 4
(GG4 5
beResultGG5 =
)GG= >
)GG> ?
;GG? @
}HH 
elseII 
{JJ 
varKK 
modelKK !
=KK" #
newKK$ '

MixArticleKK( 2
(KK2 3
)KK3 4
{LL 
SpecificultureMM *
=MM+ ,
_langMM- 2
,MM2 3
StatusNN "
=NN# $

MixServiceNN% /
.NN/ 0
	GetConfigNN0 9
<NN9 :
intNN: =
>NN= >
(NN> ?
$strNN? N
)NNN O
,NNO P
PriorityOO $
=OO% &
UpdateViewModelOO' 6
.OO6 7

RepositoryOO7 A
.OOA B
MaxOOB E
(OOE F
aOOF G
=>OOH J
aOOK L
.OOL M
PriorityOOM U
)OOU V
.OOV W
DataOOW [
+OO\ ]
$numOO^ _
}PP 
;PP 
RepositoryResponseRR *
<RR* +
UpdateViewModelRR+ :
>RR: ;
resultRR< B
=RRC D
newRRE H
RepositoryResponseRRI [
<RR[ \
UpdateViewModelRR\ k
>RRk l
(RRl m
)RRm n
{SS 
	IsSucceedTT %
=TT& '
trueTT( ,
,TT, -
DataUU  
=UU! "
awaitUU# (
UpdateViewModelUU) 8
.UU8 9
InitViewAsyncUU9 F
(UUF G
modelUUG L
)UUL M
}VV 
;VV 
returnWW 
JObjectWW &
.WW& '

FromObjectWW' 1
(WW1 2
resultWW2 8
)WW8 9
;WW9 :
}XX 
defaultYY 
:YY 
ifZZ 
(ZZ 
idZZ 
.ZZ 
HasValueZZ #
)ZZ# $
{[[ 
var\\ 
beResult\\ $
=\\% &
await\\' ,
UpdateViewModel\\- <
.\\< =

Repository\\= G
.\\G H
GetSingleModelAsync\\H [
(\\[ \
model\\\ a
=>\\b d
model\\e j
.\\j k
Id\\k m
==\\n p
id\\q s
&&\\t v
model\\w |
.\\| }
Specificulture	\\} ã
==
\\å é
_lang
\\è î
)
\\î ï
.
\\ï ñ
ConfigureAwait
\\ñ §
(
\\§ •
false
\\• ™
)
\\™ ´
;
\\´ ¨
if]] 
(]] 
beResult]] $
.]]$ %
	IsSucceed]]% .
)]]. /
{^^ 
beResult__ $
.__$ %
Data__% )
.__) *

DetailsUrl__* 4
=__5 6
MixCmsHelper__7 C
.__C D
GetRouterUrl__D P
(__P Q
$str__Q Z
,__Z [
new__\ _
{__` a
beResult__b j
.__j k
Data__k o
.__o p
SeoName__p w
}__x y
,__y z
Request	__{ Ç
,
__Ç É
Url
__Ñ á
)
__á à
;
__à â
}`` 
returnaa 
JObjectaa &
.aa& '

FromObjectaa' 1
(aa1 2
beResultaa2 :
)aa: ;
;aa; <
}bb 
elsecc 
{dd 
varee 
modelee !
=ee" #
newee$ '

MixArticleee( 2
(ee2 3
)ee3 4
;ee4 5
RepositoryResponseff *
<ff* +
UpdateViewModelff+ :
>ff: ;
resultff< B
=ffC D
newffE H
RepositoryResponseffI [
<ff[ \
UpdateViewModelff\ k
>ffk l
(ffl m
)ffm n
{gg 
	IsSucceedhh %
=hh& '
truehh( ,
,hh, -
Dataii  
=ii! "
newii# &
UpdateViewModelii' 6
(ii6 7
modelii7 <
)ii< =
{jj 
Specificulturekk  .
=kk/ 0
_langkk1 6
,kk6 7
Statusll  &
=ll' (
MixContentStatusll) 9
.ll9 :
Previewll: A
,llA B
}mm 
}nn 
;nn 
returnoo 
JObjectoo &
.oo& '

FromObjectoo' 1
(oo1 2
resultoo2 8
)oo8 9
;oo9 :
}pp 
}qq 
}rr 	
[zz 	
	Authorizezz	 
(zz !
AuthenticationSchemeszz (
=zz) *
JwtBearerDefaultszz+ <
.zz< = 
AuthenticationSchemezz= Q
,zzQ R
RoleszzS X
=zzY Z
$strzz[ n
)zzn o
]zzo p
[{{ 	
HttpPost{{	 
,{{ 
HttpOptions{{ 
]{{ 
[|| 	
Route||	 
(|| 
$str|| 
)|| 
]|| 
public}} 
async}} 
Task}} 
<}} 
RepositoryResponse}} ,
<}}, -
UpdateViewModel}}- <
>}}< =
>}}= >
Post}}? C
(}}C D
[}}D E
FromBody}}E M
]}}M N
UpdateViewModel}}N ]
model}}^ c
)}}c d
{~~ 	
if 
( 
model 
!= 
null 
) 
{
ÄÄ 
model
ÅÅ 
.
ÅÅ 
	CreatedBy
ÅÅ 
=
ÅÅ  !
User
ÅÅ" &
.
ÅÅ& '
Claims
ÅÅ' -
.
ÅÅ- .
FirstOrDefault
ÅÅ. <
(
ÅÅ< =
c
ÅÅ= >
=>
ÅÅ? A
c
ÅÅB C
.
ÅÅC D
Type
ÅÅD H
==
ÅÅI K
$str
ÅÅL V
)
ÅÅV W
?
ÅÅW X
.
ÅÅX Y
Value
ÅÅY ^
;
ÅÅ^ _
var
ÇÇ 
result
ÇÇ 
=
ÇÇ 
await
ÇÇ "
model
ÇÇ# (
.
ÇÇ( )
SaveModelAsync
ÇÇ) 7
(
ÇÇ7 8
true
ÇÇ8 <
)
ÇÇ< =
.
ÇÇ= >
ConfigureAwait
ÇÇ> L
(
ÇÇL M
false
ÇÇM R
)
ÇÇR S
;
ÇÇS T
return
ÉÉ 
result
ÉÉ 
;
ÉÉ 
}
ÑÑ 
return
ÖÖ 
new
ÖÖ  
RepositoryResponse
ÖÖ )
<
ÖÖ) *
UpdateViewModel
ÖÖ* 9
>
ÖÖ9 :
(
ÖÖ: ;
)
ÖÖ; <
{
ÖÖ= >
Status
ÖÖ? E
=
ÖÖF G
$num
ÖÖH K
}
ÖÖL M
;
ÖÖM N
}
ÜÜ 	
[
ââ 	
HttpPost
ââ	 
,
ââ 
HttpOptions
ââ 
]
ââ 
[
ää 	
Route
ää	 
(
ää 
$str
ää 
)
ää 
]
ää 
public
ãã 
async
ãã 
Task
ãã 
<
ãã  
RepositoryResponse
ãã ,
<
ãã, -

MixArticle
ãã- 7
>
ãã7 8
>
ãã8 9

SaveFields
ãã: D
(
ããD E
int
ããE H
id
ããI K
,
ããK L
[
ããM N
FromBody
ããN V
]
ããV W
List
ããW [
<
ãã[ \
EntityField
ãã\ g
>
ããg h
fields
ããi o
)
ãão p
{
åå 	
if
çç 
(
çç 
fields
çç 
!=
çç 
null
çç 
)
çç 
{
éé 
var
èè 
result
èè 
=
èè 
new
èè   
RepositoryResponse
èè! 3
<
èè3 4

MixArticle
èè4 >
>
èè> ?
(
èè? @
)
èè@ A
{
èèB C
	IsSucceed
èèD M
=
èèN O
true
èèP T
}
èèU V
;
èèV W
foreach
êê 
(
êê 
var
êê 
property
êê %
in
êê& (
fields
êê) /
)
êê/ 0
{
ëë 
if
íí 
(
íí 
result
íí 
.
íí 
	IsSucceed
íí (
)
íí( )
{
ìì 
result
îî 
=
îî  
await
îî! &#
ReadListItemViewModel
îî' <
.
îî< =

Repository
îî= G
.
îîG H
UpdateFieldsAsync
îîH Y
(
îîY Z
c
îîZ [
=>
îî\ ^
c
îî_ `
.
îî` a
Id
îîa c
==
îîd f
id
îîg i
&&
îîj l
c
îîm n
.
îîn o
Specificulture
îîo }
==îî~ Ä
_langîîÅ Ü
,îîÜ á
fieldsîîà é
)îîé è
.îîè ê
ConfigureAwaitîîê û
(îîû ü
falseîîü §
)îî§ •
;îî• ¶
}
ïï 
else
ññ 
{
óó 
break
òò 
;
òò 
}
ôô 
}
õõ 
return
úú 
result
úú 
;
úú 
}
ùù 
return
ûû 
new
ûû  
RepositoryResponse
ûû )
<
ûû) *

MixArticle
ûû* 4
>
ûû4 5
(
ûû5 6
)
ûû6 7
;
ûû7 8
}
üü 	
[
°° 	
HttpPost
°°	 
,
°° 
HttpOptions
°° 
]
°° 
[
¢¢ 	
Route
¢¢	 
(
¢¢ 
$str
¢¢ 
)
¢¢ 
]
¢¢ 
public
££ 
async
££ 
Task
££ 
<
££ 
JObject
££ !
>
££! "
GetList
££# *
(
££* +
[
§§ 
FromBody
§§ 
]
§§ 
RequestPaging
§§ $
request
§§% ,
)
§§, -
{
•• 	$
ParseRequestPagingDate
¶¶ "
(
¶¶" #
request
¶¶# *
)
¶¶* +
;
¶¶+ ,

Expression
ßß 
<
ßß 
Func
ßß 
<
ßß 

MixArticle
ßß &
,
ßß& '
bool
ßß( ,
>
ßß, -
>
ßß- .
	predicate
ßß/ 8
=
ßß9 :
model
ßß; @
=>
ßßA C
model
®® 
.
®® 
Specificulture
®® ,
==
®®- /
_lang
®®0 5
&&
©© 
(
©© 
!
©© 
request
©© $
.
©©$ %
Status
©©% +
.
©©+ ,
HasValue
©©, 4
||
©©5 7
model
©©8 =
.
©©= >
Status
©©> D
==
©©E G
request
©©H O
.
©©O P
Status
©©P V
.
©©V W
Value
©©W \
)
©©\ ]
&&
™™ 
(
™™ 
string
™™ "
.
™™" # 
IsNullOrWhiteSpace
™™# 5
(
™™5 6
request
™™6 =
.
™™= >
Keyword
™™> E
)
™™E F
||
´´ 
(
´´  
model
´´  %
.
´´% &
Title
´´& +
.
´´+ ,
Contains
´´, 4
(
´´4 5
request
´´5 <
.
´´< =
Keyword
´´= D
)
´´D E
||
¨¨ 
model
¨¨ $
.
¨¨$ %
Excerpt
¨¨% ,
.
¨¨, -
Contains
¨¨- 5
(
¨¨5 6
request
¨¨6 =
.
¨¨= >
Keyword
¨¨> E
)
¨¨E F
)
¨¨F G
)
¨¨G H
&&
≠≠ 
(
≠≠ 
!
≠≠ 
request
≠≠ $
.
≠≠$ %
FromDate
≠≠% -
.
≠≠- .
HasValue
≠≠. 6
||
ÆÆ 
(
ÆÆ  
model
ÆÆ  %
.
ÆÆ% &
CreatedDateTime
ÆÆ& 5
>=
ÆÆ6 8
request
ÆÆ9 @
.
ÆÆ@ A
FromDate
ÆÆA I
.
ÆÆI J
Value
ÆÆJ O
)
ÆÆO P
)
ØØ 
&&
∞∞ 
(
∞∞ 
!
∞∞ 
request
∞∞ $
.
∞∞$ %
ToDate
∞∞% +
.
∞∞+ ,
HasValue
∞∞, 4
||
±± 
(
±±  
model
±±  %
.
±±% &
CreatedDateTime
±±& 5
<=
±±6 8
request
±±9 @
.
±±@ A
ToDate
±±A G
.
±±G H
Value
±±H M
)
±±M N
)
≤≤ 
;
≤≤ 
switch
¥¥ 
(
¥¥ 
request
¥¥ 
.
¥¥ 
Key
¥¥ 
)
¥¥  
{
µµ 
case
∂∂ 
$str
∂∂ 
:
∂∂ 
var
∑∑ 
fedata
∑∑ 
=
∑∑  
await
∑∑! &
ReadMvcViewModel
∑∑' 7
.
∑∑7 8

Repository
∑∑8 B
.
∑∑B C!
GetModelListByAsync
∑∑C V
(
∏∏ 
	predicate
∏∏ "
,
∏∏" #
request
∏∏$ +
.
∏∏+ ,
OrderBy
∏∏, 3
,
∏∏3 4
request
∏∏5 <
.
∏∏< =
	Direction
∏∏= F
,
∏∏F G
request
∏∏H O
.
∏∏O P
PageSize
∏∏P X
,
∏∏X Y
request
∏∏Z a
.
∏∏a b
	PageIndex
∏∏b k
)
∏∏k l
.
∏∏l m
ConfigureAwait
∏∏m {
(
∏∏{ |
false∏∏| Å
)∏∏Å Ç
;∏∏Ç É
if
ππ 
(
ππ 
fedata
ππ 
.
ππ 
	IsSucceed
ππ (
)
ππ( )
{
∫∫ 
fedata
ªª 
.
ªª 
Data
ªª #
.
ªª# $
Items
ªª$ )
.
ªª) *
ForEach
ªª* 1
(
ªª1 2
a
ªª2 3
=>
ªª4 6
{
ºº 
a
ΩΩ 
.
ΩΩ 

DetailsUrl
ΩΩ (
=
ΩΩ) *
MixCmsHelper
ΩΩ+ 7
.
ΩΩ7 8
GetRouterUrl
ΩΩ8 D
(
ΩΩD E
$str
ææ  )
,
ææ) *
new
ææ+ .
{
ææ/ 0
seoName
ææ1 8
=
ææ9 :
a
ææ; <
.
ææ< =
SeoName
ææ= D
}
ææE F
,
ææF G
Request
ææH O
,
ææO P
Url
ææQ T
)
ææT U
;
ææU V
}
øø 
)
øø 
;
øø 
}
¿¿ 
return
¡¡ 
JObject
¡¡ "
.
¡¡" #

FromObject
¡¡# -
(
¡¡- .
fedata
¡¡. 4
)
¡¡4 5
;
¡¡5 6
case
¬¬ 
$str
¬¬ 
:
¬¬ 
var
ƒƒ 
bedata
ƒƒ 
=
ƒƒ  
await
ƒƒ! &
UpdateViewModel
ƒƒ' 6
.
ƒƒ6 7

Repository
ƒƒ7 A
.
ƒƒA B!
GetModelListByAsync
ƒƒB U
(
≈≈ 
	predicate
≈≈ "
,
≈≈" #
request
≈≈$ +
.
≈≈+ ,
OrderBy
≈≈, 3
,
≈≈3 4
request
≈≈5 <
.
≈≈< =
	Direction
≈≈= F
,
≈≈F G
request
≈≈H O
.
≈≈O P
PageSize
≈≈P X
,
≈≈X Y
request
≈≈Z a
.
≈≈a b
	PageIndex
≈≈b k
)
≈≈k l
.
≈≈l m
ConfigureAwait
≈≈m {
(
≈≈{ |
false≈≈| Å
)≈≈Å Ç
;≈≈Ç É
if
∆∆ 
(
∆∆ 
bedata
∆∆ 
.
∆∆ 
	IsSucceed
∆∆ (
)
∆∆( )
{
«« 
bedata
»» 
.
»» 
Data
»» #
.
»»# $
Items
»»$ )
.
»») *
ForEach
»»* 1
(
»»1 2
a
»»2 3
=>
»»4 6
{
…… 
a
   
.
   

DetailsUrl
   (
=
  ) *
MixCmsHelper
  + 7
.
  7 8
GetRouterUrl
  8 D
(
  D E
$str
ÀÀ  )
,
ÀÀ) *
new
ÀÀ+ .
{
ÀÀ/ 0
seoName
ÀÀ1 8
=
ÀÀ9 :
a
ÀÀ; <
.
ÀÀ< =
SeoName
ÀÀ= D
}
ÀÀE F
,
ÀÀF G
Request
ÀÀH O
,
ÀÀO P
Url
ÀÀQ T
)
ÀÀT U
;
ÀÀU V
}
ÃÃ 
)
ÃÃ 
;
ÃÃ 
}
ÕÕ 
return
ŒŒ 
JObject
ŒŒ "
.
ŒŒ" #

FromObject
ŒŒ# -
(
ŒŒ- .
bedata
ŒŒ. 4
)
ŒŒ4 5
;
ŒŒ5 6
default
œœ 
:
œœ 
var
—— 
data
—— 
=
—— 
await
—— $#
ReadListItemViewModel
——% :
.
——: ;

Repository
——; E
.
——E F!
GetModelListByAsync
——F Y
(
““ 
	predicate
““ "
,
““" #
request
““$ +
.
““+ ,
OrderBy
““, 3
,
““3 4
request
““5 <
.
““< =
	Direction
““= F
,
““F G
request
““H O
.
““O P
PageSize
““P X
,
““X Y
request
““Z a
.
““a b
	PageIndex
““b k
)
““k l
.
““l m
ConfigureAwait
““m {
(
““{ |
false““| Å
)““Å Ç
;““Ç É
if
”” 
(
”” 
data
”” 
.
”” 
	IsSucceed
”” &
)
””& '
{
‘‘ 
data
’’ 
.
’’ 
Data
’’ !
.
’’! "
Items
’’" '
.
’’' (
ForEach
’’( /
(
’’/ 0
(
’’0 1
Action
’’1 7
<
’’7 8#
ReadListItemViewModel
’’8 M
>
’’M N
)
’’N O
(
’’O P
a
’’P Q
=>
’’R T
{
÷÷ 
a
◊◊ 
.
◊◊ 

DetailsUrl
◊◊ (
=
◊◊) *
MixCmsHelper
◊◊+ 7
.
◊◊7 8
GetRouterUrl
◊◊8 D
(
◊◊D E
$str
ÿÿ  )
,
ÿÿ) *
new
ÿÿ+ .
{
ÿÿ/ 0
seoName
ÿÿ1 8
=
ÿÿ9 :
a
ÿÿ; <
.
ÿÿ< =
SeoName
ÿÿ= D
}
ÿÿE F
,
ÿÿF G
Request
ÿÿH O
,
ÿÿO P
Url
ÿÿQ T
)
ÿÿT U
;
ÿÿU V
}
ŸŸ 
)
ŸŸ 
)
ŸŸ 
;
ŸŸ 
}
⁄⁄ 
return
€€ 
JObject
€€ "
.
€€" #

FromObject
€€# -
(
€€- .
data
€€. 2
)
€€2 3
;
€€3 4
}
‹‹ 
}
›› 	
}
‡‡ 
}·· Ê¥
ZC:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiMediaController.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Route 

(
 
$str #
)# $
]$ %
public 

class 
ApiMediaController #
:$ %
BaseApiController 
{ 
public 
ApiMediaController !
(! "
	Microsoft" +
.+ ,

AspNetCore, 6
.6 7
SignalR7 >
.> ?
IHubContext? J
<J K
HubK N
.N O
	PortalHubO X
>X Y

hubContextZ d
)d e
:f g
baseh l
(l m

hubContextm w
)w x
{ 	
} 	
["" 	
HttpGet""	 
,"" 
HttpOptions"" 
]"" 
[## 	
Route##	 
(## 
$str## (
)##( )
]##) *
[$$ 	
Route$$	 
($$ 
$str$$ #
)$$# $
]$$$ %
public%% 
async%% 
Task%% 
<%% 
JObject%% !
>%%! "
Details%%# *
(%%* +
string%%+ 1
viewType%%2 :
,%%: ;
int%%< ?
?%%? @
id%%A C
=%%D E
null%%F J
)%%J K
{&& 	
switch'' 
('' 
viewType'' 
)'' 
{(( 
default)) 
:)) 
if** 
(** 
id** 
.** 
HasValue** #
)**# $
{++ 
var,, 
feResult,, $
=,,% &
await,,' ,
MediaViewModel,,- ;
.,,; <

Repository,,< F
.,,F G
GetSingleModelAsync,,G Z
(,,Z [
model-- 
=>--  
model--! &
.--& '
Id--' )
==--* ,
id--- /
&&--0 2
model--3 8
.--8 9
Specificulture--9 G
==--H J
_lang--K P
)--P Q
.--Q R
ConfigureAwait--R `
(--` a
false--a f
)--f g
;--g h
return.. 
JObject.. &
...& '

FromObject..' 1
(..1 2
feResult..2 :
)..: ;
;..; <
}// 
else00 
{11 
var22 
media22 !
=22" #
new22$ '
MixMedia22( 0
(220 1
)221 2
{33 
Specificulture44 *
=44+ ,
_lang44- 2
,442 3
Priority55 $
=55% &
MediaViewModel55' 5
.555 6

Repository556 @
.55@ A
Max55A D
(55D E
a55E F
=>55G I
a55J K
.55K L
Priority55L T
)55T U
.55U V
Data55V Z
+55[ \
$num55] ^
}66 
;66 
var77 
result77 "
=77# $
new77% (
RepositoryResponse77) ;
<77; <
MediaViewModel77< J
>77J K
(77K L
)77L M
{88 
	IsSucceed99 %
=99& '
true99( ,
,99, -
Data::  
=::! "
(::# $
await::$ )
MediaViewModel::* 8
.::8 9
InitViewAsync::9 F
(::F G
media::G L
)::L M
)::M N
};; 
;;; 
return<< 
JObject<< &
.<<& '

FromObject<<' 1
(<<1 2
result<<2 8
)<<8 9
;<<9 :
}== 
}?? 
}@@ 	
[BB 	
HttpGetBB	 
,BB 
HttpOptionsBB 
]BB 
[CC 	
RouteCC	 
(CC 
$strCC 
)CC 
]CC 
publicDD 
asyncDD 
TaskDD 
<DD 
JObjectDD !
>DD! "
CloneDD# (
(DD( )
intDD) ,
idDD- /
)DD/ 0
{EE 	
varFF 
resultFF 
=FF 
awaitFF 
MediaViewModelFF -
.FF- .

RepositoryFF. 8
.FF8 9
GetSingleModelAsyncFF9 L
(FFL M
modelGG 
=>GG 
modelGG 
.GG 
IdGG 
==GG  
idGG! #
&&GG$ &
modelGG' ,
.GG, -
SpecificultureGG- ;
==GG< >
_langGG? D
)GGD E
.GGE F
ConfigureAwaitGGF T
(GGT U
falseGGU Z
)GGZ [
;GG[ \
ifHH 
(HH 
resultHH 
.HH 
	IsSucceedHH  
)HH  !
{II 
resultJJ 
.JJ 
DataJJ 
.JJ 
IsCloneJJ #
=JJ$ %
trueJJ& *
;JJ* +
varKK 
cloneResultKK 
=KK  !
awaitKK" '
resultKK( .
.KK. /
DataKK/ 3
.KK3 4
SaveModelAsyncKK4 B
(KKB C
falseKKC H
)KKH I
;KKI J
returnLL 
JObjectLL 
.LL 

FromObjectLL )
(LL) *
cloneResultLL* 5
)LL5 6
;LL6 7
}MM 
elseNN 
{OO 
returnPP 
JObjectPP 
.PP 

FromObjectPP )
(PP) *
resultPP* 0
)PP0 1
;PP1 2
}QQ 
}RR 	
[UU 	
HttpGetUU	 
,UU 
HttpOptionsUU 
]UU 
[VV 	
RouteVV	 
(VV 
$strVV 
)VV 
]VV 
publicWW 
asyncWW 
TaskWW 
<WW 
RepositoryResponseWW ,
<WW, -
MixMediaWW- 5
>WW5 6
>WW6 7
DeleteWW8 >
(WW> ?
intWW? B
idWWC E
)WWE F
{XX 	
varYY 
getMediaYY 
=YY 
MediaViewModelYY )
.YY) *

RepositoryYY* 4
.YY4 5
GetSingleModelYY5 C
(YYC D
aYYD E
=>YYF H
aYYI J
.YYJ K
IdYYK M
==YYN P
idYYQ S
&&YYT V
aYYW X
.YYX Y
SpecificultureYYY g
==YYh j
_langYYk p
)YYp q
;YYq r
ifZZ 
(ZZ 
getMediaZZ 
.ZZ 
	IsSucceedZZ "
)ZZ" #
{[[ 
return\\ 
await\\ 
getMedia\\ %
.\\% &
Data\\& *
.\\* +
RemoveModelAsync\\+ ;
(\\; <
true\\< @
)\\@ A
.\\A B
ConfigureAwait\\B P
(\\P Q
false\\Q V
)\\V W
;\\W X
}]] 
else^^ 
{__ 
return`` 
new`` 
RepositoryResponse`` -
<``- .
MixMedia``. 6
>``6 7
(``7 8
)``8 9
{``: ;
	IsSucceed``< E
=``F G
false``H M
}``N O
;``O P
}aa 
}bb 	
[hh 	
	Authorizehh	 
(hh !
AuthenticationSchemeshh (
=hh) *
JwtBearerDefaultshh+ <
.hh< = 
AuthenticationSchemehh= Q
)hhQ R
]hhR S
[ii 	
Routeii	 
(ii 
$strii 
)ii 
]ii 
[jj 	
HttpPostjj	 
,jj 
HttpOptionsjj 
]jj 
publickk 
asynckk 
Taskkk 
<kk 
RepositoryResponsekk ,
<kk, -
MediaViewModelkk- ;
>kk; <
>kk< =
UploadAsynckk> I
(kkI J
[kkJ K
FromFormkkK S
]kkS T
stringkkU [

fileFolderkk\ f
,kkf g
[kkh i
FromFormkki q
]kkq r
stringkks y
titlekkz 
,	kk Ä
[
kkÅ Ç
FromForm
kkÇ ä
]
kkä ã
string
kkå í
description
kkì û
)
kkû ü
{ll 	
varmm 
filesmm 
=mm 
Requestmm 
.mm  
Formmm  $
.mm$ %
Filesmm% *
;mm* +
ifoo 
(oo 
filesoo 
.oo 
Countoo 
>oo 
$numoo 
)oo  
{pp 
varqq 

fileUploadqq 
=qq  
filesqq! &
.qq& '
FirstOrDefaultqq' 5
(qq5 6
)qq6 7
;qq7 8
stringss 

folderPathss !
=ss" #
CommonHelperss$ 0
.ss0 1
GetFullPathss1 <
(ss< =
newss= @
[ss@ A
]ssA B
{ssC D

MixServicett 
.tt 
	GetConfigtt (
<tt( )
stringtt) /
>tt/ 0
(tt0 1
$strtt1 ?
)tt? @
,tt@ A

fileFolderuu 
,uu 
DateTimevv 
.vv 
UtcNowvv #
.vv# $
ToStringvv$ ,
(vv, -
$strvv- 6
)vv6 7
}ww 
)ww 
;ww 
stringyy 

uploadPathyy !
=yy" #
CommonHelperyy$ 0
.yy0 1
GetFullPathyy1 <
(yy< =
newyy= @
[yy@ A
]yyA B
{yyC D
MixConstantszz  
.zz  !
Folderzz! '
.zz' (
WebRootPathzz( 3
,zz3 4

folderPath{{ 
}|| 
)|| 
;|| 
string~~ 
fileName~~ 
=~~  !
CommonHelper 
. 
GetFullPath (
(( )
new) ,
[, -
]- .
{/ 0
$str
ÄÄ 
,
ÄÄ 
await
ÅÅ 
UploadFileAsync
ÅÅ )
(
ÅÅ) *
files
ÅÅ* /
.
ÅÅ/ 0
FirstOrDefault
ÅÅ0 >
(
ÅÅ> ?
)
ÅÅ? @
,
ÅÅ@ A

uploadPath
ÅÅB L
)
ÅÅL M
.
ÅÅM N
ConfigureAwait
ÅÅN \
(
ÅÅ\ ]
false
ÅÅ] b
)
ÅÅb c
}
ÇÇ 
)
ÇÇ 
;
ÇÇ 
MediaViewModel
ÉÉ 
media
ÉÉ $
=
ÉÉ% &
new
ÉÉ' *
MediaViewModel
ÉÉ+ 9
(
ÉÉ9 :
new
ÉÉ: =
MixMedia
ÉÉ> F
(
ÉÉF G
)
ÉÉG H
{
ÑÑ 
Specificulture
ÖÖ "
=
ÖÖ# $
_lang
ÖÖ% *
,
ÖÖ* +
FileName
ÜÜ 
=
ÜÜ 
fileName
ÜÜ '
.
ÜÜ' (
Split
ÜÜ( -
(
ÜÜ- .
$char
ÜÜ. 1
)
ÜÜ1 2
[
ÜÜ2 3
$num
ÜÜ3 4
]
ÜÜ4 5
.
ÜÜ5 6
	Substring
ÜÜ6 ?
(
ÜÜ? @
fileName
ÜÜ@ H
.
ÜÜH I
LastIndexOf
ÜÜI T
(
ÜÜT U
$char
ÜÜU X
)
ÜÜX Y
+
ÜÜZ [
$num
ÜÜ\ ]
)
ÜÜ] ^
,
ÜÜ^ _

FileFolder
áá 
=
áá  

folderPath
áá! +
,
áá+ ,
	Extension
àà 
=
àà 
fileName
àà  (
.
àà( )
	Substring
àà) 2
(
àà2 3
fileName
àà3 ;
.
àà; <
LastIndexOf
àà< G
(
ààG H
$char
ààH K
)
ààK L
)
ààL M
,
ààM N
CreatedDateTime
ââ #
=
ââ$ %
DateTime
ââ& .
.
ââ. /
UtcNow
ââ/ 5
,
ââ5 6
FileType
ää 
=
ää 

fileUpload
ää )
.
ää) *
ContentType
ää* 5
.
ää5 6
Split
ää6 ;
(
ää; <
$char
ää< ?
)
ää? @
[
ää@ A
$num
ääA B
]
ääB C
,
ääC D
FileSize
ãã 
=
ãã 

fileUpload
ãã )
.
ãã) *
Length
ãã* 0
,
ãã0 1
Title
åå 
=
åå 
title
åå !
??
åå" $
fileName
åå% -
.
åå- .
Split
åå. 3
(
åå3 4
$char
åå4 7
)
åå7 8
[
åå8 9
$num
åå9 :
]
åå: ;
.
åå; <
	Substring
åå< E
(
ååE F
fileName
ååF N
.
ååN O
LastIndexOf
ååO Z
(
ååZ [
$char
åå[ ^
)
åå^ _
+
åå` a
$num
ååb c
)
ååc d
,
ååd e
Description
çç 
=
çç  !
description
çç" -
??
çç. 0
fileName
çç1 9
.
çç9 :
Split
çç: ?
(
çç? @
$char
çç@ C
)
ççC D
[
ççD E
$num
ççE F
]
ççF G
.
ççG H
	Substring
ççH Q
(
ççQ R
fileName
ççR Z
.
ççZ [
LastIndexOf
çç[ f
(
ççf g
$char
ççg j
)
ççj k
+
ççl m
$num
ççn o
)
çço p
}
éé 
)
éé 
;
éé 
return
èè 
await
èè 
media
èè "
.
èè" #
SaveModelAsync
èè# 1
(
èè1 2
)
èè2 3
;
èè3 4
}
êê 
else
ëë 
{
íí 
return
ìì 
new
ìì  
RepositoryResponse
ìì -
<
ìì- .
MediaViewModel
ìì. <
>
ìì< =
(
ìì= >
)
ìì> ?
;
ìì? @
}
îî 
}
ïï 	
[
òò 	
	Authorize
òò	 
(
òò #
AuthenticationSchemes
òò (
=
òò) *
JwtBearerDefaults
òò+ <
.
òò< ="
AuthenticationScheme
òò= Q
)
òòQ R
]
òòR S
[
ôô 	
HttpPost
ôô	 
,
ôô 
HttpOptions
ôô 
]
ôô 
[
öö 	
Route
öö	 
(
öö 
$str
öö 
)
öö 
]
öö 
public
õõ 
async
õõ 
Task
õõ 
<
õõ  
RepositoryResponse
õõ ,
<
õõ, -
MediaViewModel
õõ- ;
>
õõ; <
>
õõ< =
Post
õõ> B
(
õõB C
[
õõC D
FromBody
õõD L
]
õõL M
MediaViewModel
õõM [
model
õõ\ a
)
õõa b
{
úú 	
if
ùù 
(
ùù 
model
ùù 
!=
ùù 
null
ùù 
)
ùù 
{
ûû 
model
üü 
.
üü 
Specificulture
üü $
=
üü% &
_lang
üü' ,
;
üü, -
var
†† 
result
†† 
=
†† 
await
†† "
model
††# (
.
††( )
SaveModelAsync
††) 7
(
††7 8
true
††8 <
)
††< =
.
††= >
ConfigureAwait
††> L
(
††L M
false
††M R
)
††R S
;
††S T
return
¢¢ 
result
¢¢ 
;
¢¢ 
}
££ 
return
§§ 
new
§§  
RepositoryResponse
§§ )
<
§§) *
MediaViewModel
§§* 8
>
§§8 9
(
§§9 :
)
§§: ;
;
§§; <
}
•• 	
[
™™ 	
HttpPost
™™	 
,
™™ 
HttpOptions
™™ 
]
™™ 
[
´´ 	
Route
´´	 
(
´´ 
$str
´´ 
)
´´ 
]
´´ 
public
¨¨ 
async
¨¨ 
Task
¨¨ 
<
¨¨  
RepositoryResponse
¨¨ ,
<
¨¨, -
PaginationModel
¨¨- <
<
¨¨< =
Lib
¨¨= @
.
¨¨@ A

ViewModels
¨¨A K
.
¨¨K L
	MixMedias
¨¨L U
.
¨¨U V
MediaViewModel
¨¨V d
>
¨¨d e
>
¨¨e f
>
¨¨f g
GetList
¨¨h o
(
¨¨o p
[
¨¨p q
FromBody
¨¨q y
]
¨¨y z
RequestPaging¨¨z á
request¨¨à è
)¨¨è ê
{
≠≠ 	$
ParseRequestPagingDate
ÆÆ "
(
ÆÆ" #
request
ÆÆ# *
)
ÆÆ* +
;
ÆÆ+ ,

Expression
ØØ 
<
ØØ 
Func
ØØ 
<
ØØ 
MixMedia
ØØ $
,
ØØ$ %
bool
ØØ& *
>
ØØ* +
>
ØØ+ ,
	predicate
ØØ- 6
=
ØØ7 8
model
ØØ9 >
=>
ØØ? A
model
∞∞ 
.
∞∞ 
Specificulture
∞∞ $
==
∞∞% '
_lang
∞∞( -
&&
±± 
(
±± 
string
±± 
.
±±  
IsNullOrWhiteSpace
±± -
(
±±- .
request
±±. 5
.
±±5 6
Keyword
±±6 =
)
±±= >
||
≤≤ 
(
≤≤ 
model
≤≤ 
.
≤≤ 
FileName
≤≤ "
.
≤≤" #
Contains
≤≤# +
(
≤≤+ ,
request
≤≤, 3
.
≤≤3 4
Keyword
≤≤4 ;
)
≤≤; <
||
≥≥ 
model
≥≥ 
.
≥≥ 
Title
≥≥ 
.
≥≥ 
Contains
≥≥ '
(
≥≥' (
request
≥≥( /
.
≥≥/ 0
Keyword
≥≥0 7
)
≥≥7 8
||
¥¥ 
model
¥¥ 
.
¥¥ 
Description
¥¥ $
.
¥¥$ %
Contains
¥¥% -
(
¥¥- .
request
¥¥. 5
.
¥¥5 6
Keyword
¥¥6 =
)
¥¥= >
)
¥¥> ?
)
¥¥? @
&&
µµ 
(
µµ 
!
µµ 
request
µµ 
.
µµ 
FromDate
µµ %
.
µµ% &
HasValue
µµ& .
||
∂∂ 
(
∂∂ 
model
∂∂ 
.
∂∂ 
CreatedDateTime
∂∂ -
>=
∂∂. 0
request
∂∂1 8
.
∂∂8 9
FromDate
∂∂9 A
.
∂∂A B
Value
∂∂B G
)
∂∂G H
)
∑∑ 
&&
∏∏ 
(
∏∏ 
!
∏∏ 
request
∏∏ 
.
∏∏ 
ToDate
∏∏ #
.
∏∏# $
HasValue
∏∏$ ,
||
ππ 
(
ππ 
model
ππ 
.
ππ 
CreatedDateTime
ππ -
<=
ππ. 0
request
ππ1 8
.
ππ8 9
ToDate
ππ9 ?
.
ππ? @
Value
ππ@ E
)
ππE F
)
∫∫ 
;
∫∫ 
var
ºº 
data
ºº 
=
ºº 
await
ºº 
MediaViewModel
ºº +
.
ºº+ ,

Repository
ºº, 6
.
ºº6 7!
GetModelListByAsync
ºº7 J
(
ººJ K
	predicate
ººK T
,
ººT U
request
ººV ]
.
ºº] ^
OrderBy
ºº^ e
,
ººe f
request
ººg n
.
ººn o
	Direction
ººo x
,
ººx y
requestººz Å
.ººÅ Ç
PageSizeººÇ ä
,ººä ã
requestººå ì
.ººì î
	PageIndexººî ù
)ººù û
.ººû ü
ConfigureAwaitººü ≠
(ºº≠ Æ
falseººÆ ≥
)ºº≥ ¥
;ºº¥ µ
return
ææ 
data
ææ 
;
ææ 
}
øø 	
[
¡¡ 	
	Authorize
¡¡	 
(
¡¡ #
AuthenticationSchemes
¡¡ (
=
¡¡) *
JwtBearerDefaults
¡¡+ <
.
¡¡< ="
AuthenticationScheme
¡¡= Q
)
¡¡Q R
]
¡¡R S
[
¬¬ 	
HttpPost
¬¬	 
,
¬¬ 
HttpOptions
¬¬ 
]
¬¬ 
[
√√ 	
Route
√√	 
(
√√ 
$str
√√ +
)
√√+ ,
]
√√, -
[
ƒƒ 	
Route
ƒƒ	 
(
ƒƒ 
$str
ƒƒ 
)
ƒƒ  
]
ƒƒ  !
public
≈≈ 
async
≈≈ 
Task
≈≈ 
<
≈≈  
RepositoryResponse
≈≈ ,
<
≈≈, -
PaginationModel
≈≈- <
<
≈≈< =
Mix
≈≈= @
.
≈≈@ A
Cms
≈≈A D
.
≈≈D E
Lib
≈≈E H
.
≈≈H I

ViewModels
≈≈I S
.
≈≈S T
MixProductMedias
≈≈T d
.
≈≈d e
ReadViewModel
≈≈e r
>
≈≈r s
>
≈≈s t
>
≈≈t u
GetListByProduct≈≈v Ü
(≈≈Ü á
RequestPaging≈≈á î
request≈≈ï ú
,≈≈ú ù
int≈≈û °
?≈≈° ¢
	productId≈≈£ ¨
=≈≈≠ Æ
null≈≈Ø ≥
)≈≈≥ ¥
{
∆∆ 	
var
«« 
data
«« 
=
«« 
await
«« 
Lib
««  
.
««  !

ViewModels
««! +
.
««+ ,
MixProductMedias
««, <
.
««< =
ReadViewModel
««= J
.
««J K

Repository
««K U
.
««U V!
GetModelListByAsync
««V i
(
««i j
m
»» 
=>
»» 
m
»» 
.
»» 
	ProductId
»» 
==
»» 
	productId
»»  )
&&
»»* ,
m
»»- .
.
»». /
Specificulture
»»/ =
==
»»> @
_lang
»»A F
,
»»F G
request
»»H O
.
»»O P
OrderBy
»»P W
,
…… 
request
…… 
.
…… 
	Direction
…… 
,
……  
request
……! (
.
……( )
PageSize
……) 1
,
……1 2
request
……3 :
.
……: ;
	PageIndex
……; D
)
……D E
.
   
ConfigureAwait
   
(
   
false
   !
)
  ! "
;
  " #
return
ÃÃ 
data
ÃÃ 
;
ÃÃ 
}
ŒŒ 	
	protected
⁄⁄ 
async
⁄⁄ 
Task
⁄⁄ 
<
⁄⁄ 
string
⁄⁄ #
>
⁄⁄# $
UploadFileAsync
⁄⁄% 4
(
⁄⁄4 5
	IFormFile
⁄⁄5 >
file
⁄⁄? C
,
⁄⁄C D
string
⁄⁄E K

folderPath
⁄⁄L V
)
⁄⁄V W
{
€€ 	
if
‹‹ 
(
‹‹ 
file
‹‹ 
?
‹‹ 
.
‹‹ 
Length
‹‹ 
>
‹‹ 
$num
‹‹  
)
‹‹  !
{
›› 
string
ﬁﬁ 
fileName
ﬁﬁ 
=
ﬁﬁ  !
await
ﬁﬁ" '
CommonHelper
ﬁﬁ( 4
.
ﬁﬁ4 5
UploadFileAsync
ﬁﬁ5 D
(
ﬁﬁD E

folderPath
ﬁﬁE O
,
ﬁﬁO P
file
ﬁﬁQ U
)
ﬁﬁU V
.
ﬁﬁV W
ConfigureAwait
ﬁﬁW e
(
ﬁﬁe f
false
ﬁﬁf k
)
ﬁﬁk l
;
ﬁﬁl m
if
ﬂﬂ 
(
ﬂﬂ 
!
ﬂﬂ 
string
ﬂﬂ 
.
ﬂﬂ 
IsNullOrEmpty
ﬂﬂ )
(
ﬂﬂ) *
fileName
ﬂﬂ* 2
)
ﬂﬂ2 3
)
ﬂﬂ3 4
{
‡‡ 
string
·· 
filePath
·· #
=
··$ %
string
··& ,
.
··, -
Format
··- 3
(
··3 4
$str
··4 =
,
··= >

folderPath
··? I
,
··I J
fileName
··K S
)
··S T
;
··T U
return
‚‚ 
filePath
‚‚ #
;
‚‚# $
}
„„ 
else
‰‰ 
{
ÂÂ 
return
ÊÊ 
string
ÊÊ !
.
ÊÊ! "
Empty
ÊÊ" '
;
ÊÊ' (
}
ÁÁ 
}
ËË 
else
ÈÈ 
{
ÍÍ 
return
ÎÎ 
string
ÎÎ 
.
ÎÎ 
Empty
ÎÎ #
;
ÎÎ# $
}
ÏÏ 
}
ÌÌ 	
}
ÒÒ 
}ÚÚ «è
[C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiModuleController.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 
( 
$str  
)  !
]! "
[ 
Route 

(
 
$str $
)$ %
]% &
public 

class 
ApiModuleController $
:% &
BaseApiController 
{ 
public 
ApiModuleController "
(" #
	Microsoft# ,
., -

AspNetCore- 7
.7 8
SignalR8 ?
.? @
IHubContext@ K
<K L
HubL O
.O P
	PortalHubP Y
>Y Z

hubContext[ e
)e f
:g h
basei m
(m n

hubContextn x
)x y
{ 	
} 	
[## 	
HttpGet##	 
,## 
HttpOptions## 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
RepositoryResponse%% ,
<%%, -
	MixModule%%- 6
>%%6 7
>%%7 8
DeleteAsync%%9 D
(%%D E
int%%E H
id%%I K
)%%K L
{&& 	
var'' 
	getModule'' 
='' 
await'' !!
ReadListItemViewModel''" 7
.''7 8

Repository''8 B
.''B C
GetSingleModelAsync''C V
(''V W
model(( 
=>(( 
model(( 
.(( 
Id(( !
==((" $
id((% '
&&((( *
model((+ 0
.((0 1
Specificulture((1 ?
==((@ B
_lang((C H
)((H I
;((I J
if)) 
()) 
	getModule)) 
.)) 
	IsSucceed)) #
)))# $
{** 
return,, 
await,, 
	getModule,, &
.,,& '
Data,,' +
.,,+ ,
RemoveModelAsync,,, <
(,,< =
true,,= A
),,A B
;,,B C
}-- 
else.. 
{// 
return00 
new00 
RepositoryResponse00 -
<00- .
	MixModule00. 7
>007 8
(008 9
)009 :
{11 
	IsSucceed22 
=22 
false22  %
}33 
;33 
}44 
}55 	
[88 	
HttpGet88	 
,88 
HttpOptions88 
]88 
[99 	
Route99	 
(99 
$str99 (
)99( )
]99) *
[:: 	
Route::	 
(:: 
$str:: #
)::# $
]::$ %
public;; 
async;; 
Task;; 
<;; 
ActionResult;; &
<;;& '
JObject;;' .
>;;. /
>;;/ 0
Details;;1 8
(;;8 9
string;;9 ?
viewType;;@ H
,;;H I
int;;J M
?;;M N
id;;O Q
);;Q R
{<< 	
switch== 
(== 
viewType== 
)== 
{>> 
case?? 
$str?? 
:?? 
if@@ 
(@@ 
id@@ 
.@@ 
HasValue@@ #
)@@# $
{AA 
varBB 
beResultBB $
=BB% &
awaitBB' ,
UpdateViewModelBB- <
.BB< =

RepositoryBB= G
.BBG H
GetSingleModelAsyncBBH [
(BB[ \
modelBB\ a
=>BBb d
modelBBe j
.BBj k
IdBBk m
==BBn p
idBBq s
&&BBt v
modelBBw |
.BB| }
Specificulture	BB} ã
==
BBå é
_lang
BBè î
)
BBî ï
.
BBï ñ
ConfigureAwait
BBñ §
(
BB§ •
false
BB• ™
)
BB™ ´
;
BB´ ¨
returnCC 
OkCC !
(CC! "
JObjectCC" )
.CC) *

FromObjectCC* 4
(CC4 5
beResultCC5 =
)CC= >
)CC> ?
;CC? @
}DD 
elseEE 
{FF 
varGG 
modelGG !
=GG" #
newGG$ '
	MixModuleGG( 1
(GG1 2
)GG2 3
{HH 
SpecificultureII *
=II+ ,
_langII- 2
,II2 3
StatusJJ "
=JJ# $

MixServiceJJ% /
.JJ/ 0
	GetConfigJJ0 9
<JJ9 :
intJJ: =
>JJ= >
(JJ> ?
MixConstantsJJ? K
.JJK L 
ConfigurationKeywordJJL `
.JJ` a 
DefaultContentStatusJJa u
)JJu v
,JJv w
PageSizeKK $
=KK% &
$numKK' )
,KK) *
PriorityLL $
=LL% &
UpdateViewModelLL' 6
.LL6 7

RepositoryLL7 A
.LLA B
MaxLLB E
(LLE F
aLLF G
=>LLH J
aLLK L
.LLL M
PriorityLLM U
)LLU V
.LLV W
DataLLW [
+LL\ ]
$numLL^ _
}MM 
;MM 
RepositoryResponseOO *
<OO* +
UpdateViewModelOO+ :
>OO: ;
resultOO< B
=OOC D
newOOE H
RepositoryResponseOOI [
<OO[ \
UpdateViewModelOO\ k
>OOk l
(OOl m
)OOm n
{PP 
	IsSucceedQQ %
=QQ& '
trueQQ( ,
,QQ, -
DataRR  
=RR! "
awaitRR# (
UpdateViewModelRR) 8
.RR8 9
InitViewAsyncRR9 F
(RRF G
modelRRG L
)RRL M
}SS 
;SS 
returnTT 
JObjectTT &
.TT& '

FromObjectTT' 1
(TT1 2
resultTT2 8
)TT8 9
;TT9 :
}UU 
defaultVV 
:VV 
ifWW 
(WW 
idWW 
.WW 
HasValueWW #
)WW# $
{XX 
varYY 
beResultYY $
=YY% &
awaitYY' ,
ReadMvcViewModelYY- =
.YY= >

RepositoryYY> H
.YYH I
GetSingleModelAsyncYYI \
(YY\ ]
modelYY] b
=>YYc e
modelYYf k
.YYk l
IdYYl n
==YYo q
idYYr t
&&YYu w
modelYYx }
.YY} ~
Specificulture	YY~ å
==
YYç è
_lang
YYê ï
)
YYï ñ
.
YYñ ó
ConfigureAwait
YYó •
(
YY• ¶
false
YY¶ ´
)
YY´ ¨
;
YY¨ ≠
returnZZ 
JObjectZZ &
.ZZ& '

FromObjectZZ' 1
(ZZ1 2
beResultZZ2 :
)ZZ: ;
;ZZ; <
}[[ 
else\\ 
{]] 
var^^ 
model^^ !
=^^" #
new^^$ '
	MixModule^^( 1
(^^1 2
)^^2 3
;^^3 4
RepositoryResponse__ *
<__* +
ReadMvcViewModel__+ ;
>__; <
result__= C
=__D E
new__F I
RepositoryResponse__J \
<__\ ]
ReadMvcViewModel__] m
>__m n
(__n o
)__o p
{`` 
	IsSucceedaa %
=aa& '
trueaa( ,
,aa, -
Databb  
=bb! "
newbb# &
ReadMvcViewModelbb' 7
(bb7 8
modelbb8 =
)bb= >
{cc 
Specificulturedd  .
=dd/ 0
_langdd1 6
,dd6 7
Statusee  &
=ee' (
MixContentStatusee) 9
.ee9 :
Previewee: A
,eeA B
PageSizeff  (
=ff) *
$numff+ -
}gg 
}hh 
;hh 
returnii 
JObjectii &
.ii& '

FromObjectii' 1
(ii1 2
resultii2 8
)ii8 9
;ii9 :
}jj 
}kk 
}ll 	
[tt 	
	Authorizett	 
(tt !
AuthenticationSchemestt (
=tt) *
JwtBearerDefaultstt+ <
.tt< = 
AuthenticationSchemett= Q
,ttQ R
RolesttS X
=ttY Z
$strtt[ n
)ttn o
]tto p
[uu 	
HttpPostuu	 
,uu 
HttpOptionsuu 
]uu 
[vv 	
Routevv	 
(vv 
$strvv 
)vv 
]vv 
publicww 
asyncww 
Taskww 
<ww 
RepositoryResponseww ,
<ww, -
UpdateViewModelww- <
>ww< =
>ww= >
Postww? C
(wwC D
[wwD E
FromBodywwE M
]wwM N
UpdateViewModelwwN ]
modelww^ c
)wwc d
{xx 	
ifyy 
(yy 
modelyy 
!=yy 
nullyy 
)yy 
{zz 
model{{ 
.{{ 
	CreatedBy{{ 
={{  !
User{{" &
.{{& '
Claims{{' -
.{{- .
FirstOrDefault{{. <
({{< =
c{{= >
=>{{? A
c{{B C
.{{C D
Type{{D H
=={{I K
$str{{L V
){{V W
?{{W X
.{{X Y
Value{{Y ^
;{{^ _
var|| 
result|| 
=|| 
await|| "
model||# (
.||( )
SaveModelAsync||) 7
(||7 8
true||8 <
)||< =
.||= >
ConfigureAwait||> L
(||L M
false||M R
)||R S
;||S T
return}} 
result}} 
;}} 
}~~ 
return 
new 
RepositoryResponse )
<) *
UpdateViewModel* 9
>9 :
(: ;
); <
{= >
Status? E
=F G
$numH K
}L M
;M N
}
ÄÄ 	
[
ÉÉ 	
HttpPost
ÉÉ	 
,
ÉÉ 
HttpOptions
ÉÉ 
]
ÉÉ 
[
ÑÑ 	
Route
ÑÑ	 
(
ÑÑ 
$str
ÑÑ 
)
ÑÑ 
]
ÑÑ 
public
ÖÖ 
async
ÖÖ 
Task
ÖÖ 
<
ÖÖ  
RepositoryResponse
ÖÖ ,
<
ÖÖ, -
	MixModule
ÖÖ- 6
>
ÖÖ6 7
>
ÖÖ7 8

SaveFields
ÖÖ9 C
(
ÖÖC D
int
ÖÖD G
id
ÖÖH J
,
ÖÖJ K
[
ÖÖL M
FromBody
ÖÖM U
]
ÖÖU V
List
ÖÖV Z
<
ÖÖZ [
EntityField
ÖÖ[ f
>
ÖÖf g
fields
ÖÖh n
)
ÖÖn o
{
ÜÜ 	
if
áá 
(
áá 
fields
áá 
!=
áá 
null
áá 
)
áá 
{
àà 
var
ââ 
result
ââ 
=
ââ 
new
ââ   
RepositoryResponse
ââ! 3
<
ââ3 4
	MixModule
ââ4 =
>
ââ= >
(
ââ> ?
)
ââ? @
{
ââA B
	IsSucceed
ââC L
=
ââM N
true
ââO S
}
ââT U
;
ââU V
foreach
ää 
(
ää 
var
ää 
property
ää %
in
ää& (
fields
ää) /
)
ää/ 0
{
ãã 
if
åå 
(
åå 
result
åå 
.
åå 
	IsSucceed
åå (
)
åå( )
{
çç 
result
éé 
=
éé  
await
éé! &#
ReadListItemViewModel
éé' <
.
éé< =

Repository
éé= G
.
ééG H
UpdateFieldsAsync
ééH Y
(
ééY Z
c
ééZ [
=>
éé\ ^
c
éé_ `
.
éé` a
Id
ééa c
==
ééd f
id
éég i
&&
ééj l
c
éém n
.
één o
Specificulture
ééo }
==éé~ Ä
_langééÅ Ü
,ééÜ á
fieldsééà é
)ééé è
.ééè ê
ConfigureAwaitééê û
(ééû ü
falseééü §
)éé§ •
;éé• ¶
}
èè 
else
êê 
{
ëë 
break
íí 
;
íí 
}
ìì 
}
ïï 
return
ññ 
result
ññ 
;
ññ 
}
óó 
return
òò 
new
òò  
RepositoryResponse
òò )
<
òò) *
	MixModule
òò* 3
>
òò3 4
(
òò4 5
)
òò5 6
;
òò6 7
}
ôô 	
[
úú 	
HttpPost
úú	 
,
úú 
HttpOptions
úú 
]
úú 
[
ùù 	
Route
ùù	 
(
ùù 
$str
ùù 
)
ùù 
]
ùù 
public
ûû 
async
ûû 
Task
ûû 
<
ûû 
JObject
ûû !
>
ûû! "
GetList
ûû# *
(
ûû* +
[
üü 
FromBody
üü 
]
üü 
RequestPaging
üü $
request
üü% ,
)
üü, -
{
†† 	$
ParseRequestPagingDate
¢¢ "
(
¢¢" #
request
¢¢# *
)
¢¢* +
;
¢¢+ ,

Expression
££ 
<
££ 
Func
££ 
<
££ 
	MixModule
££ %
,
££% &
bool
££' +
>
££+ ,
>
££, -
	predicate
££. 7
=
££8 9
model
££: ?
=>
££@ B
model
§§ 
.
§§ 
Specificulture
§§ ,
==
§§- /
_lang
§§0 5
&&
•• 
(
•• 
!
•• 
request
•• $
.
••$ %
Status
••% +
.
••+ ,
HasValue
••, 4
||
••5 7
model
••8 =
.
••= >
Status
••> D
==
••E G
request
••H O
.
••O P
Status
••P V
.
••V W
Value
••W \
)
••\ ]
&&
¶¶ 
(
¶¶ 
string
¶¶ "
.
¶¶" # 
IsNullOrWhiteSpace
¶¶# 5
(
¶¶5 6
request
¶¶6 =
.
¶¶= >
Keyword
¶¶> E
)
¶¶E F
||
ßß 
(
ßß  
model
ßß  %
.
ßß% &
Title
ßß& +
.
ßß+ ,
Contains
ßß, 4
(
ßß4 5
request
ßß5 <
.
ßß< =
Keyword
ßß= D
)
ßßD E
||
®® 
model
®® $
.
®®$ %
Description
®®% 0
.
®®0 1
Contains
®®1 9
(
®®9 :
request
®®: A
.
®®A B
Keyword
®®B I
)
®®I J
)
®®J K
)
®®K L
&&
©© 
(
©© 
!
©© 
request
©© $
.
©©$ %
FromDate
©©% -
.
©©- .
HasValue
©©. 6
||
™™ 
(
™™  
model
™™  %
.
™™% &
CreatedDateTime
™™& 5
>=
™™6 8
request
™™9 @
.
™™@ A
FromDate
™™A I
.
™™I J
Value
™™J O
)
™™O P
)
´´ 
&&
¨¨ 
(
¨¨ 
!
¨¨ 
request
¨¨ $
.
¨¨$ %
ToDate
¨¨% +
.
¨¨+ ,
HasValue
¨¨, 4
||
≠≠ 
(
≠≠  
model
≠≠  %
.
≠≠% &
CreatedDateTime
≠≠& 5
<=
≠≠6 8
request
≠≠9 @
.
≠≠@ A
ToDate
≠≠A G
.
≠≠G H
Value
≠≠H M
)
≠≠M N
)
ÆÆ 
;
ÆÆ 
switch
∞∞ 
(
∞∞ 
request
∞∞ 
.
∞∞ 
Key
∞∞ 
)
∞∞  
{
±± 
case
≥≥ 
$str
≥≥ 
:
≥≥ 
var
¥¥ 
	mvcResult
¥¥ !
=
¥¥" #
await
¥¥$ )
ReadMvcViewModel
¥¥* :
.
¥¥: ;

Repository
¥¥; E
.
¥¥E F!
GetModelListByAsync
¥¥F Y
(
¥¥Y Z
	predicate
¥¥Z c
,
¥¥c d
request
¥¥e l
.
¥¥l m
OrderBy
¥¥m t
,
¥¥t u
request
¥¥v }
.
¥¥} ~
	Direction¥¥~ á
,¥¥á à
request¥¥â ê
.¥¥ê ë
PageSize¥¥ë ô
,¥¥ô ö
request¥¥õ ¢
.¥¥¢ £
	PageIndex¥¥£ ¨
)¥¥¨ ≠
.¥¥≠ Æ
ConfigureAwait¥¥Æ º
(¥¥º Ω
false¥¥Ω ¬
)¥¥¬ √
;¥¥√ ƒ
return
µµ 
JObject
µµ "
.
µµ" #

FromObject
µµ# -
(
µµ- .
	mvcResult
µµ. 7
)
µµ7 8
;
µµ8 9
case
∂∂ 
$str
∂∂ 
:
∂∂ 
var
∑∑ 
portalResult
∑∑ $
=
∑∑% &
await
∑∑' ,
UpdateViewModel
∑∑- <
.
∑∑< =

Repository
∑∑= G
.
∑∑G H!
GetModelListByAsync
∑∑H [
(
∑∑[ \
	predicate
∑∑\ e
,
∑∑e f
request
∑∑g n
.
∑∑n o
OrderBy
∑∑o v
,
∑∑v w
request
∑∑x 
.∑∑ Ä
	Direction∑∑Ä â
,∑∑â ä
request∑∑ã í
.∑∑í ì
PageSize∑∑ì õ
,∑∑õ ú
request∑∑ù §
.∑∑§ •
	PageIndex∑∑• Æ
)∑∑Æ Ø
.∑∑Ø ∞
ConfigureAwait∑∑∞ æ
(∑∑æ ø
false∑∑ø ƒ
)∑∑ƒ ≈
;∑∑≈ ∆
return
∏∏ 
JObject
∏∏ "
.
∏∏" #

FromObject
∏∏# -
(
∏∏- .
portalResult
∏∏. :
)
∏∏: ;
;
∏∏; <
default
ππ 
:
ππ 
var
∫∫ 
data
∫∫ 
=
∫∫ 
await
∫∫ $#
ReadListItemViewModel
∫∫% :
.
∫∫: ;

Repository
∫∫; E
.
∫∫E F!
GetModelListByAsync
∫∫F Y
(
∫∫Y Z
	predicate
∫∫Z c
,
∫∫c d
request
∫∫e l
.
∫∫l m
OrderBy
∫∫m t
,
∫∫t u
request
∫∫v }
.
∫∫} ~
	Direction∫∫~ á
,∫∫á à
request∫∫â ê
.∫∫ê ë
PageSize∫∫ë ô
,∫∫ô ö
request∫∫õ ¢
.∫∫¢ £
	PageIndex∫∫£ ¨
)∫∫¨ ≠
.∫∫≠ Æ
ConfigureAwait∫∫Æ º
(∫∫º Ω
false∫∫Ω ¬
)∫∫¬ √
;∫∫√ ƒ
return
ªª 
JObject
ªª "
.
ªª" #

FromObject
ªª# -
(
ªª- .
data
ªª. 2
)
ªª2 3
;
ªª3 4
}
ºº 
}
ΩΩ 	
}
¿¿ 
}¡¡ ¢«
YC:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiPageController.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 
( 
$str  
)  !
]! "
[ 
Route 

(
 
$str "
)" #
]# $
public 

class 
ApiPageController "
:# $$
BaseGenericApiControoler  
<  !
MixCmsContext! .
,. /
MixPage0 7
>7 8
{ 
public   
ApiPageController    
(    !
IMemoryCache  ! -
memoryCache  . 9
,  9 :
IHubContext  ; F
<  F G
	PortalHub  G P
>  P Q

hubContext  R \
)  \ ]
:  ^ _
base  ` d
(  d e
memoryCache  e p
,  p q

hubContext  r |
)  | }
{!! 	
}## 	
['' 	
HttpGet''	 
,'' 
HttpOptions'' 
]'' 
[(( 	
Route((	 
((( 
$str(( 
)(( 
](( 
public)) 
async)) 
Task)) 
<)) 
RepositoryResponse)) ,
<)), -
MixPage))- 4
>))4 5
>))5 6
DeleteAsync))7 B
())B C
int))C F
id))G I
)))I J
{** 	
var++ 
getPage++ 
=++ 
await++ !
ReadListItemViewModel++  5
.++5 6

Repository++6 @
.++@ A
GetSingleModelAsync++A T
(++T U
model,, 
=>,, 
model,, 
.,, 
Id,, !
==,," $
id,,% '
&&,,( *
model,,+ 0
.,,0 1
Specificulture,,1 ?
==,,@ B
_lang,,C H
),,H I
;,,I J
if-- 
(-- 
getPage-- 
.-- 
	IsSucceed-- !
)--! "
{.. 
return00 
await00 
getPage00 $
.00$ %
Data00% )
.00) *
RemoveModelAsync00* :
(00: ;
true00; ?
)00? @
;00@ A
}11 
else22 
{33 
return44 
new44 
RepositoryResponse44 -
<44- .
MixPage44. 5
>445 6
(446 7
)447 8
{55 
	IsSucceed66 
=66 
false66  %
}77 
;77 
}88 
}99 	
[<< 	
HttpGet<<	 
,<< 
HttpOptions<< 
]<< 
[== 	
Route==	 
(== 
$str== (
)==( )
]==) *
[>> 	
Route>>	 
(>> 
$str>> #
)>># $
]>>$ %
public?? 
async?? 
Task?? 
<?? 
ActionResult?? &
<??& '
JObject??' .
>??. /
>??/ 0
Details??1 8
(??8 9
string??9 ?
viewType??@ H
,??H I
int??J M
???M N
id??O Q
)??Q R
{@@ 	
stringAA 
msgAA 
=AA 
stringAA 
.AA  
EmptyAA  %
;AA% &
switchBB 
(BB 
viewTypeBB 
)BB 
{CC 
caseDD 
$strDD 
:DD 
ifEE 
(EE 
idEE 
.EE 
HasValueEE #
)EE# $
{FF 

ExpressionGG "
<GG" #
FuncGG# '
<GG' (
MixPageGG( /
,GG/ 0
boolGG1 5
>GG5 6
>GG6 7
	predicateGG8 A
=GGB C
modelGGD I
=>GGJ L
modelGGM R
.GGR S
IdGGS U
==GGV X
idGGY [
&&GG\ ^
modelGG_ d
.GGd e
SpecificultureGGe s
==GGt v
_langGGw |
;GG| }
varHH 
portalResultHH (
=HH) *
awaitHH+ 0
baseHH1 5
.HH5 6
GetSingleAsyncHH6 D
<HHD E
UpdateViewModelHHE T
>HHT U
(HHU V
$"HHV X
{HHX Y
viewTypeHHY a
}HHa b
_HHb c
{HHc d
idHHd f
}HHf g
"HHg h
,HHh i
	predicateHHj s
)HHs t
;HHt u
ifII 
(II 
portalResultII (
.II( )
	IsSucceedII) 2
)II2 3
{JJ 
portalResultKK (
.KK( )
DataKK) -
.KK- .

DetailsUrlKK. 8
=KK9 :
MixCmsHelperKK; G
.KKG H
GetRouterUrlKKH T
(KKT U
$strKKU [
,KK[ \
newKK] `
{KKa b
portalResultKKc o
.KKo p
DataKKp t
.KKt u
SeoNameKKu |
}KK} ~
,KK~ 
Request
KKÄ á
,
KKá à
Url
KKâ å
)
KKå ç
;
KKç é
}LL 
returnNN 
OkNN !
(NN! "
JObjectNN" )
.NN) *

FromObjectNN* 4
(NN4 5
portalResultNN5 A
)NNA B
)NNB C
;NNC D
}OO 
elsePP 
{QQ 
varRR 
modelRR !
=RR" #
newRR$ '
MixPageRR( /
(RR/ 0
)RR0 1
{SS 
SpecificultureTT *
=TT+ ,
_langTT- 2
,TT2 3
StatusUU "
=UU# $

MixServiceUU% /
.UU/ 0
	GetConfigUU0 9
<UU9 :
intUU: =
>UU= >
(UU> ?
$strUU? N
)UUN O
,UUO P
PageSizeVV $
=VV% &
$numVV' )
,WW 
PriorityXX $
=XX% &
UpdateViewModelXX' 6
.XX6 7

RepositoryXX7 A
.XXA B
MaxXXB E
(XXE F
aXXF G
=>XXH J
aXXK L
.XXL M
PriorityXXM U
)XXU V
.XXV W
DataXXW [
+XX\ ]
$numXX^ _
}YY 
;YY 
RepositoryResponse[[ *
<[[* +
UpdateViewModel[[+ :
>[[: ;
result[[< B
=[[C D
await[[E J
base[[K O
.[[O P
GetSingleAsync[[P ^
<[[^ _
UpdateViewModel[[_ n
>[[n o
([[o p
$"[[p r
{[[r s
viewType[[s {
}[[{ |
_default	[[| Ñ
"
[[Ñ Ö
,
[[Ö Ü
null
[[á ã
,
[[ã å
model
[[ç í
)
[[í ì
;
[[ì î
return\\ 
JObject\\ &
.\\& '

FromObject\\' 1
(\\1 2
result\\2 8
)\\8 9
;\\9 :
}]] 
default^^ 
:^^ 
if__ 
(__ 
id__ 
.__ 
HasValue__ #
)__# $
{`` 
varaa 
beResultaa $
=aa% &
awaitaa' ,
ReadMvcViewModelaa- =
.aa= >

Repositoryaa> H
.aaH I
GetSingleModelAsyncaaI \
(aa\ ]
modelaa] b
=>aac e
modelaaf k
.aak l
Idaal n
==aao q
idaar t
&&aau w
modelaax }
.aa} ~
Specificulture	aa~ å
==
aaç è
_lang
aaê ï
)
aaï ñ
.
aañ ó
ConfigureAwait
aaó •
(
aa• ¶
false
aa¶ ´
)
aa´ ¨
;
aa¨ ≠
ifbb 
(bb 
beResultbb $
.bb$ %
	IsSucceedbb% .
)bb. /
{cc 
beResultdd $
.dd$ %
Datadd% )
.dd) *

DetailsUrldd* 4
=dd5 6
MixCmsHelperdd7 C
.ddC D
GetRouterUrlddD P
(ddP Q
$strddQ W
,ddW X
newddY \
{dd] ^
beResultdd_ g
.ddg h
Dataddh l
.ddl m
SeoNameddm t
}ddu v
,ddv w
Requestddx 
,	dd Ä
Url
ddÅ Ñ
)
ddÑ Ö
;
ddÖ Ü
}ee 
returnff 
JObjectff &
.ff& '

FromObjectff' 1
(ff1 2
beResultff2 :
)ff: ;
;ff; <
}gg 
elsehh 
{ii 
varjj 
modeljj !
=jj" #
newjj$ '
MixPagejj( /
(jj/ 0
)jj0 1
;jj1 2
RepositoryResponsekk *
<kk* +
ReadMvcViewModelkk+ ;
>kk; <
resultkk= C
=kkD E
newkkF I
RepositoryResponsekkJ \
<kk\ ]
ReadMvcViewModelkk] m
>kkm n
(kkn o
)kko p
{ll 
	IsSucceedmm %
=mm& '
truemm( ,
,mm, -
Datann  
=nn! "
newnn# &
ReadMvcViewModelnn' 7
(nn7 8
modelnn8 =
)nn= >
{oo 
Specificulturepp  .
=pp/ 0
_langpp1 6
,pp6 7
Statusqq  &
=qq' (
MixContentStatusqq) 9
.qq9 :
Previewqq: A
,qqA B
PageSizerr  (
=rr) *
$numrr+ -
}ss 
}tt 
;tt 
returnuu 
JObjectuu &
.uu& '

FromObjectuu' 1
(uu1 2
resultuu2 8
)uu8 9
;uu9 :
}vv 
}ww 
}xx 	
[
ÄÄ 	
	Authorize
ÄÄ	 
(
ÄÄ #
AuthenticationSchemes
ÄÄ (
=
ÄÄ) *
JwtBearerDefaults
ÄÄ+ <
.
ÄÄ< ="
AuthenticationScheme
ÄÄ= Q
,
ÄÄQ R
Roles
ÄÄS X
=
ÄÄY Z
$str
ÄÄ[ n
)
ÄÄn o
]
ÄÄo p
[
ÅÅ 	
HttpPost
ÅÅ	 
,
ÅÅ 
HttpOptions
ÅÅ 
]
ÅÅ 
[
ÇÇ 	
Route
ÇÇ	 
(
ÇÇ 
$str
ÇÇ 
)
ÇÇ 
]
ÇÇ 
public
ÉÉ 
async
ÉÉ 
Task
ÉÉ 
<
ÉÉ  
RepositoryResponse
ÉÉ ,
<
ÉÉ, -
UpdateViewModel
ÉÉ- <
>
ÉÉ< =
>
ÉÉ= >
Post
ÉÉ? C
(
ÉÉC D
[
ÉÉD E
FromBody
ÉÉE M
]
ÉÉM N
UpdateViewModel
ÉÉN ]
model
ÉÉ^ c
)
ÉÉc d
{
ÑÑ 	
if
ÖÖ 
(
ÖÖ 
model
ÖÖ 
!=
ÖÖ 
null
ÖÖ 
)
ÖÖ 
{
ÜÜ 
model
áá 
.
áá 
	CreatedBy
áá 
=
áá  !
User
áá" &
.
áá& '
Claims
áá' -
.
áá- .
FirstOrDefault
áá. <
(
áá< =
c
áá= >
=>
áá? A
c
ááB C
.
ááC D
Type
ááD H
==
ááI K
$str
ááL V
)
ááV W
?
ááW X
.
ááX Y
Value
ááY ^
;
áá^ _
var
àà 
result
àà 
=
àà 
await
àà "
model
àà# (
.
àà( )
SaveModelAsync
àà) 7
(
àà7 8
true
àà8 <
)
àà< =
.
àà= >
ConfigureAwait
àà> L
(
ààL M
false
ààM R
)
ààR S
;
ààS T
return
ââ 
result
ââ 
;
ââ 
}
ää 
return
ãã 
new
ãã  
RepositoryResponse
ãã )
<
ãã) *
UpdateViewModel
ãã* 9
>
ãã9 :
(
ãã: ;
)
ãã; <
{
ãã= >
Status
ãã? E
=
ããF G
$num
ããH K
}
ããL M
;
ããM N
}
åå 	
[
èè 	
HttpPost
èè	 
,
èè 
HttpOptions
èè 
]
èè 
[
êê 	
Route
êê	 
(
êê 
$str
êê 
)
êê 
]
êê 
public
ëë 
async
ëë 
Task
ëë 
<
ëë  
RepositoryResponse
ëë ,
<
ëë, -
MixPage
ëë- 4
>
ëë4 5
>
ëë5 6

SaveFields
ëë7 A
(
ëëA B
int
ëëB E
id
ëëF H
,
ëëH I
[
ëëJ K
FromBody
ëëK S
]
ëëS T
List
ëëT X
<
ëëX Y
EntityField
ëëY d
>
ëëd e
fields
ëëf l
)
ëël m
{
íí 	
if
ìì 
(
ìì 
fields
ìì 
!=
ìì 
null
ìì 
)
ìì 
{
îî 
var
ïï 
result
ïï 
=
ïï 
new
ïï   
RepositoryResponse
ïï! 3
<
ïï3 4
MixPage
ïï4 ;
>
ïï; <
(
ïï< =
)
ïï= >
{
ïï? @
	IsSucceed
ïïA J
=
ïïK L
true
ïïM Q
}
ïïR S
;
ïïS T
foreach
ññ 
(
ññ 
var
ññ 
property
ññ %
in
ññ& (
fields
ññ) /
)
ññ/ 0
{
óó 
if
òò 
(
òò 
result
òò 
.
òò 
	IsSucceed
òò (
)
òò( )
{
ôô 
result
öö 
=
öö  
await
öö! &#
ReadListItemViewModel
öö' <
.
öö< =

Repository
öö= G
.
ööG H
UpdateFieldsAsync
ööH Y
(
ööY Z
c
ööZ [
=>
öö\ ^
c
öö_ `
.
öö` a
Id
ööa c
==
ööd f
id
öög i
&&
ööj l
c
ööm n
.
öön o
Specificulture
ööo }
==öö~ Ä
_langööÅ Ü
,ööÜ á
fieldsööà é
)ööé è
.ööè ê
ConfigureAwaitööê û
(ööû ü
falseööü §
)öö§ •
;öö• ¶
}
õõ 
else
úú 
{
ùù 
break
ûû 
;
ûû 
}
üü 
}
°° 
return
¢¢ 
result
¢¢ 
;
¢¢ 
}
££ 
return
§§ 
new
§§  
RepositoryResponse
§§ )
<
§§) *
MixPage
§§* 1
>
§§1 2
(
§§2 3
)
§§3 4
;
§§4 5
}
•• 	
[
®® 	
HttpPost
®®	 
,
®® 
HttpOptions
®® 
]
®® 
[
©© 	
Route
©©	 
(
©© 
$str
©© 
)
©© 
]
©© 
public
™™ 
async
™™ 
Task
™™ 
<
™™ 
JObject
™™ !
>
™™! "
GetList
™™# *
(
™™* +
[
´´ 
FromBody
´´ 
]
´´ 
RequestPaging
´´ $
request
´´% ,
)
´´, -
{
¨¨ 	
var
≠≠ 
parsed
≠≠ 
=
≠≠ 
HttpUtility
≠≠ $
.
≠≠$ %
ParseQueryString
≠≠% 5
(
≠≠5 6
request
≠≠6 =
.
≠≠= >
Query
≠≠> C
??
≠≠D F
$str
≠≠G I
)
≠≠I J
;
≠≠J K
bool
ÆÆ 
isLevel
ÆÆ 
=
ÆÆ 
int
ÆÆ 
.
ÆÆ 
TryParse
ÆÆ '
(
ÆÆ' (
parsed
ÆÆ( .
.
ÆÆ. /
Get
ÆÆ/ 2
(
ÆÆ2 3
$str
ÆÆ3 :
)
ÆÆ: ;
,
ÆÆ; <
out
ÆÆ= @
int
ÆÆA D
level
ÆÆE J
)
ÆÆJ K
;
ÆÆK L$
ParseRequestPagingDate
ØØ "
(
ØØ" #
request
ØØ# *
)
ØØ* +
;
ØØ+ ,

Expression
∞∞ 
<
∞∞ 
Func
∞∞ 
<
∞∞ 
MixPage
∞∞ #
,
∞∞# $
bool
∞∞% )
>
∞∞) *
>
∞∞* +
	predicate
∞∞, 5
=
∞∞6 7
model
∞∞8 =
=>
∞∞> @
model
±± 
.
±± 
Specificulture
±± ,
==
±±- /
_lang
±±0 5
&&
≤≤ 
(
≤≤ 
!
≤≤ 
request
≤≤ $
.
≤≤$ %
Status
≤≤% +
.
≤≤+ ,
HasValue
≤≤, 4
||
≤≤5 7
model
≤≤8 =
.
≤≤= >
Status
≤≤> D
==
≤≤E G
request
≤≤H O
.
≤≤O P
Status
≤≤P V
.
≤≤V W
Value
≤≤W \
)
≤≤\ ]
&&
≥≥ 
(
≥≥ 
!
≥≥ 
isLevel
≥≥ $
||
≥≥% '
model
≥≥( -
.
≥≥- .
Level
≥≥. 3
==
≥≥4 6
level
≥≥7 <
)
≥≥< =
&&
¥¥ 
(
¥¥ 
string
¥¥ "
.
¥¥" # 
IsNullOrWhiteSpace
¥¥# 5
(
¥¥5 6
request
¥¥6 =
.
¥¥= >
Keyword
¥¥> E
)
¥¥E F
||
µµ 
(
µµ  
model
µµ  %
.
µµ% &
Title
µµ& +
.
µµ+ ,
Contains
µµ, 4
(
µµ4 5
request
µµ5 <
.
µµ< =
Keyword
µµ= D
)
µµD E
||
∂∂ 
model
∂∂ $
.
∂∂$ %
Excerpt
∂∂% ,
.
∂∂, -
Contains
∂∂- 5
(
∂∂5 6
request
∂∂6 =
.
∂∂= >
Keyword
∂∂> E
)
∂∂E F
)
∂∂F G
)
∂∂G H
&&
∑∑ 
(
∑∑ 
!
∑∑ 
request
∑∑ $
.
∑∑$ %
FromDate
∑∑% -
.
∑∑- .
HasValue
∑∑. 6
||
∏∏ 
(
∏∏  
model
∏∏  %
.
∏∏% &
CreatedDateTime
∏∏& 5
>=
∏∏6 8
request
∏∏9 @
.
∏∏@ A
FromDate
∏∏A I
.
∏∏I J
Value
∏∏J O
)
∏∏O P
)
ππ 
&&
∫∫ 
(
∫∫ 
!
∫∫ 
request
∫∫ $
.
∫∫$ %
ToDate
∫∫% +
.
∫∫+ ,
HasValue
∫∫, 4
||
ªª 
(
ªª  
model
ªª  %
.
ªª% &
CreatedDateTime
ªª& 5
<=
ªª6 8
request
ªª9 @
.
ªª@ A
ToDate
ªªA G
.
ªªG H
Value
ªªH M
)
ªªM N
)
ºº 
;
ºº 
switch
ææ 
(
ææ 
request
ææ 
.
ææ 
Key
ææ 
)
ææ  
{
øø 
case
¿¿ 
$str
¿¿ 
:
¿¿ 
var
¡¡ 
fedata
¡¡ 
=
¡¡  
await
¡¡! &
ReadMvcViewModel
¡¡' 7
.
¡¡7 8

Repository
¡¡8 B
.
¡¡B C!
GetModelListByAsync
¡¡C V
(
¡¡V W
	predicate
¡¡W `
,
¡¡` a
request
¡¡b i
.
¡¡i j
OrderBy
¡¡j q
,
¡¡q r
request
¡¡s z
.
¡¡z {
	Direction¡¡{ Ñ
,¡¡Ñ Ö
request¡¡Ü ç
.¡¡ç é
PageSize¡¡é ñ
,¡¡ñ ó
request¡¡ò ü
.¡¡ü †
	PageIndex¡¡† ©
)¡¡© ™
.¡¡™ ´
ConfigureAwait¡¡´ π
(¡¡π ∫
false¡¡∫ ø
)¡¡ø ¿
;¡¡¿ ¡
if
¬¬ 
(
¬¬ 
fedata
¬¬ 
.
¬¬ 
	IsSucceed
¬¬ (
)
¬¬( )
{
√√ 
fedata
ƒƒ 
.
ƒƒ 
Data
ƒƒ #
.
ƒƒ# $
Items
ƒƒ$ )
.
ƒƒ) *
ForEach
ƒƒ* 1
(
ƒƒ1 2
a
ƒƒ2 3
=>
ƒƒ4 6
{
≈≈ 
a
∆∆ 
.
∆∆ 

DetailsUrl
∆∆ (
=
∆∆) *
MixCmsHelper
∆∆+ 7
.
∆∆7 8
GetRouterUrl
∆∆8 D
(
∆∆D E
$str
««  &
,
««& '
new
««( +
{
««, -
seoName
««. 5
=
««6 7
a
««8 9
.
««9 :
SeoName
««: A
}
««B C
,
««C D
Request
««E L
,
««L M
Url
««N Q
)
««Q R
;
««R S
}
»» 
)
»» 
;
»» 
}
…… 

AlertAsync
ÀÀ 
(
ÀÀ 
$str
ÀÀ .
,
ÀÀ. /
$num
ÀÀ0 3
,
ÀÀ3 4
$"
ÀÀ5 7
Get 
ÀÀ7 ;
{
ÀÀ; <
request
ÀÀ< C
.
ÀÀC D
Key
ÀÀD G
}
ÀÀG H

 list page
ÀÀH R
"
ÀÀR S
)
ÀÀS T
;
ÀÀT U
return
ÃÃ 
JObject
ÃÃ "
.
ÃÃ" #

FromObject
ÃÃ# -
(
ÃÃ- .
fedata
ÃÃ. 4
)
ÃÃ4 5
;
ÃÃ5 6
case
ÕÕ 
$str
ÕÕ 
:
ÕÕ 
var
œœ 
bedata
œœ 
=
œœ  
await
œœ! &
UpdateViewModel
œœ' 6
.
œœ6 7

Repository
œœ7 A
.
œœA B!
GetModelListByAsync
œœB U
(
œœU V
	predicate
œœV _
,
œœ_ `
request
œœa h
.
œœh i
OrderBy
œœi p
,
œœp q
request
œœr y
.
œœy z
	Directionœœz É
,œœÉ Ñ
requestœœÖ å
.œœå ç
PageSizeœœç ï
,œœï ñ
requestœœó û
.œœû ü
	PageIndexœœü ®
)œœ® ©
.œœ© ™
ConfigureAwaitœœ™ ∏
(œœ∏ π
falseœœπ æ
)œœæ ø
;œœø ¿
if
–– 
(
–– 
bedata
–– 
.
–– 
	IsSucceed
–– (
)
––( )
{
—— 
bedata
““ 
.
““ 
Data
““ #
.
““# $
Items
““$ )
.
““) *
ForEach
““* 1
(
““1 2
a
““2 3
=>
““4 6
{
”” 
a
‘‘ 
.
‘‘ 

DetailsUrl
‘‘ (
=
‘‘) *
MixCmsHelper
‘‘+ 7
.
‘‘7 8
GetRouterUrl
‘‘8 D
(
‘‘D E
$str
’’  &
,
’’& '
new
’’( +
{
’’, -
seoName
’’. 5
=
’’6 7
a
’’8 9
.
’’9 :
SeoName
’’: A
}
’’B C
,
’’C D
Request
’’E L
,
’’L M
Url
’’N Q
)
’’Q R
;
’’R S
}
÷÷ 
)
÷÷ 
;
÷÷ 
}
◊◊ 

AlertAsync
ŸŸ 
(
ŸŸ 
$str
ŸŸ .
,
ŸŸ. /
$num
ŸŸ0 3
,
ŸŸ3 4
$"
ŸŸ5 7
Get 
ŸŸ7 ;
{
ŸŸ; <
request
ŸŸ< C
.
ŸŸC D
Key
ŸŸD G
}
ŸŸG H

 list page
ŸŸH R
"
ŸŸR S
)
ŸŸS T
;
ŸŸT U
return
⁄⁄ 
JObject
⁄⁄ "
.
⁄⁄" #

FromObject
⁄⁄# -
(
⁄⁄- .
bedata
⁄⁄. 4
)
⁄⁄4 5
;
⁄⁄5 6
default
€€ 
:
€€ 
var
›› 
data
›› 
=
›› 
await
›› $#
ReadListItemViewModel
››% :
.
››: ;

Repository
››; E
.
››E F!
GetModelListByAsync
››F Y
(
››Y Z
	predicate
››Z c
,
››c d
request
››e l
.
››l m
OrderBy
››m t
,
››t u
request
››v }
.
››} ~
	Direction››~ á
,››á à
request››â ê
.››ê ë
PageSize››ë ô
,››ô ö
request››õ ¢
.››¢ £
	PageIndex››£ ¨
)››¨ ≠
.››≠ Æ
ConfigureAwait››Æ º
(››º Ω
false››Ω ¬
)››¬ √
;››√ ƒ
if
ﬁﬁ 
(
ﬁﬁ 
data
ﬁﬁ 
.
ﬁﬁ 
	IsSucceed
ﬁﬁ &
)
ﬁﬁ& '
{
ﬂﬂ 
data
‡‡ 
.
‡‡ 
Data
‡‡ !
.
‡‡! "
Items
‡‡" '
.
‡‡' (
ForEach
‡‡( /
(
‡‡/ 0
(
‡‡0 1
Action
‡‡1 7
<
‡‡7 8#
ReadListItemViewModel
‡‡8 M
>
‡‡M N
)
‡‡N O
(
‡‡O P
a
‡‡P Q
=>
‡‡R T
{
·· 
a
‚‚ 
.
‚‚ 

DetailsUrl
‚‚ (
=
‚‚) *
MixCmsHelper
‚‚+ 7
.
‚‚7 8
GetRouterUrl
‚‚8 D
(
‚‚D E
$str
„„  &
,
„„& '
new
„„( +
{
„„, -
seoName
„„. 5
=
„„6 7
a
„„8 9
.
„„9 :
SeoName
„„: A
}
„„B C
,
„„C D
Request
„„E L
,
„„L M
Url
„„N Q
)
„„Q R
;
„„R S
a
‰‰ 
.
‰‰ 
Childs
‰‰ $
.
‰‰$ %
ForEach
‰‰% ,
(
‰‰, -
(
‰‰- .
Action
‰‰. 4
<
‰‰4 5#
ReadListItemViewModel
‰‰5 J
>
‰‰J K
)
‰‰K L
(
‰‰L M
c
‰‰M N
=>
‰‰O Q
{
ÂÂ 
c
ÊÊ  !
.
ÊÊ! "

DetailsUrl
ÊÊ" ,
=
ÊÊ- .
MixCmsHelper
ÊÊ/ ;
.
ÊÊ; <
GetRouterUrl
ÊÊ< H
(
ÊÊH I
$str
ÁÁ$ *
,
ÁÁ* +
new
ÁÁ, /
{
ÁÁ0 1
seoName
ÁÁ2 9
=
ÁÁ: ;
c
ÁÁ< =
.
ÁÁ= >
SeoName
ÁÁ> E
}
ÁÁF G
,
ÁÁG H
Request
ÁÁI P
,
ÁÁP Q
Url
ÁÁR U
)
ÁÁU V
;
ÁÁV W
}
ËË 
)
ËË 
)
ËË 
;
ËË  
}
ÈÈ 
)
ÈÈ 
)
ÈÈ 
;
ÈÈ 
}
ÍÍ 

AlertAsync
ÏÏ 
(
ÏÏ 
$str
ÏÏ .
,
ÏÏ. /
$num
ÏÏ0 3
,
ÏÏ3 4
$"
ÏÏ5 7
Get 
ÏÏ7 ;
{
ÏÏ; <
request
ÏÏ< C
.
ÏÏC D
Key
ÏÏD G
}
ÏÏG H

 list page
ÏÏH R
"
ÏÏR S
)
ÏÏS T
;
ÏÏT U
return
ÌÌ 
JObject
ÌÌ "
.
ÌÌ" #

FromObject
ÌÌ# -
(
ÌÌ- .
data
ÌÌ. 2
)
ÌÌ2 3
;
ÌÌ3 4
}
ÓÓ 
}
ÔÔ 	
}
ÚÚ 
}ÛÛ ¥ı
[C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiPortalController.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 
( 
$str  
)  !
]! "
[ 
Route 

(
 
$str 
) 
] 
public 

class 
ApiPortalController $
:% &
BaseApiController 
{ 
private   
readonly   
UserManager   $
<  $ %
ApplicationUser  % 4
>  4 5
_userManager  6 B
;  B C
private!! 
readonly!! 
SignInManager!! &
<!!& '
ApplicationUser!!' 6
>!!6 7
_signInManager!!8 F
;!!F G
private"" 
readonly"" 
RoleManager"" $
<""$ %
IdentityRole""% 1
>""1 2
_roleManager""3 ?
;""? @
public## 
ApiPortalController## "
(##" #
UserManager$$ 
<$$ 
ApplicationUser$$ &
>$$& '
userManager$$( 3
,$$3 4
SignInManager%% 
<%% 
ApplicationUser%% (
>%%( )
signInManager%%* 7
,%%7 8
RoleManager&& 
<&& 
IdentityRole&& #
>&&# $
roleManager&&% 0
,&&0 1
	Microsoft'' 
.'' 

AspNetCore''  
.''  !
SignalR''! (
.''( )
IHubContext'') 4
<''4 5
Hub''5 8
.''8 9
	PortalHub''9 B
>''B C

hubContext''D N
)(( 
:)) 
base)) 
()) 

hubContext)) 
))) 
{** 	
_userManager++ 
=++ 
userManager++ &
;++& '
_signInManager,, 
=,, 
signInManager,, *
;,,* +
_roleManager-- 
=-- 
roleManager-- &
;--& '
}.. 	
[33 	
HttpGet33	 
,33 
HttpOptions33 
]33 
[44 	
Route44	 
(44 
$str44 #
)44# $
]44$ %
[55 	
Route55	 
(55 
$str55 
)55 
]55 
public66 
RepositoryResponse66 !
<66! "#
GlobalSettingsViewModel66" 9
>669 :
Settings66; C
(66C D
)66D E
{77 	
var88 
cultures88 
=88 
CommonRepository88 +
.88+ ,
Instance88, 4
.884 5
LoadCultures885 A
(88A B
)88B C
;88C D
var99 
culture99 
=99 
cultures99 "
.99" #
FirstOrDefault99# 1
(991 2
c992 3
=>994 6
c997 8
.998 9
Specificulture999 G
==99H J
_lang99K P
)99P Q
;99Q R#
GlobalSettingsViewModel:: #
settings::$ ,
=::- .
new::/ 2#
GlobalSettingsViewModel::3 J
(::J K
)::K L
{;; 
Lang<< 
=<< 
_lang<< 
,<< 
ThemeId== 
=== 

MixService== $
.==$ %
	GetConfig==% .
<==. /
int==/ 2
>==2 3
(==3 4
MixConstants==4 @
.==@ A 
ConfigurationKeyword==A U
.==U V
ThemeId==V ]
,==] ^
_lang==_ d
)==d e
,==e f
Cultures>> 
=>> 
cultures>> #
,>># $
	PageTypes?? 
=?? 
Enum??  
.??  !
GetNames??! )
(??) *
typeof??* 0
(??0 1
MixPageType??1 <
)??< =
)??= >
.??> ?
ToList??? E
(??E F
)??F G
,??G H
Statuses@@ 
=@@ 
Enum@@ 
.@@  
GetNames@@  (
(@@( )
typeof@@) /
(@@/ 0
MixContentStatus@@0 @
)@@@ A
)@@A B
.@@B C
ToList@@C I
(@@I J
)@@J K
}BB 
;BB 
settingsCC 
.CC 
LangIconCC 
=CC 
cultureCC  '
?CC' (
.CC( )
IconCC) -
??CC. 0

MixServiceCC1 ;
.CC; <
	GetConfigCC< E
<CCE F
stringCCF L
>CCL M
(CCM N
$strCCN X
)CCX Y
;CCY Z
returnDD 
newDD 
RepositoryResponseDD )
<DD) *#
GlobalSettingsViewModelDD* A
>DDA B
(DDB C
)DDC D
{EE 
	IsSucceedFF 
=FF 
trueFF  
,FF  !
DataGG 
=GG 
settingsGG 
}HH 
;HH 
}II 	
[LL 	
HttpGetLL	 
,LL 
HttpOptionsLL 
]LL 
[MM 	
RouteMM	 
(MM 
$strMM '
)MM' (
]MM( )
[NN 	
RouteNN	 
(NN 
$strNN 
)NN 
]NN 
publicOO 
RepositoryResponseOO !
<OO! "
JObjectOO" )
>OO) *
AllSettingsAsyncOO+ ;
(OO; <
)OO< =
{PP 	
varQQ 
culturesQQ 
=QQ 
CommonRepositoryQQ +
.QQ+ ,
InstanceQQ, 4
.QQ4 5
LoadCulturesQQ5 A
(QQA B
)QQB C
;QQC D
varRR 
cultureRR 
=RR 
culturesRR "
.RR" #
FirstOrDefaultRR# 1
(RR1 2
cRR2 3
=>RR4 6
cRR7 8
.RR8 9
SpecificultureRR9 G
==RRH J
_langRRK P
)RRP Q
;RRQ R#
GlobalSettingsViewModelUU #
configurationsUU$ 2
=UU3 4
newUU5 8#
GlobalSettingsViewModelUU9 P
(UUP Q
)UUQ R
{VV 
LangWW 
=WW 
_langWW 
,WW 
ThemeIdXX 
=XX 

MixServiceXX $
.XX$ %
	GetConfigXX% .
<XX. /
intXX/ 2
>XX2 3
(XX3 4
MixConstantsXX4 @
.XX@ A 
ConfigurationKeywordXXA U
.XXU V
ThemeIdXXV ]
,XX] ^
_langXX_ d
)XXd e
,XXe f
ApiEncryptKeyYY 
=YY 

MixServiceYY  *
.YY* +
	GetConfigYY+ 4
<YY4 5
stringYY5 ;
>YY; <
(YY< =
MixConstantsYY= I
.YYI J 
ConfigurationKeywordYYJ ^
.YY^ _
ApiEncryptKeyYY_ l
)YYl m
,YYm n
IsEncryptApiZZ 
=ZZ 

MixServiceZZ )
.ZZ) *
	GetConfigZZ* 3
<ZZ3 4
boolZZ4 8
>ZZ8 9
(ZZ9 :
MixConstantsZZ: F
.ZZF G 
ConfigurationKeywordZZG [
.ZZ[ \
IsEncryptApiZZ\ h
)ZZh i
,ZZi j
Cultures[[ 
=[[ 
cultures[[ #
,[[# $
	PageTypes\\ 
=\\ 
Enum\\  
.\\  !
GetNames\\! )
(\\) *
typeof\\* 0
(\\0 1
MixPageType\\1 <
)\\< =
)\\= >
.\\> ?
ToList\\? E
(\\E F
)\\F G
,\\G H
Statuses]] 
=]] 
Enum]] 
.]]  
GetNames]]  (
(]]( )
typeof]]) /
(]]/ 0
MixContentStatus]]0 @
)]]@ A
)]]A B
.]]B C
ToList]]C I
(]]I J
)]]J K
}^^ 
;^^ 
configurations`` 
.`` 
LangIcon`` #
=``$ %
culture``& -
?``- .
.``. /
Icon``/ 3
??``4 6

MixService``7 A
.``A B
	GetConfig``B K
<``K L
string``L R
>``R S
(``S T
$str``T ^
)``^ _
;``_ `
varcc 

translatorcc 
=cc 
newcc  
JObjectcc! (
(cc( )
)cc) *
{dd 
newee 
	JPropertyee 
(ee 
$stree $
,ee$ %
_langee% *
)ee* +
,ee+ ,
newff 
	JPropertyff 
(ff 
$strff $
,ff$ %

MixServiceff& 0
.ff0 1
GetTranslatorff1 >
(ff> ?
_langff? D
)ffD E
)ffE F
}gg 
;gg 
varjj 
settingsjj 
=jj 
newjj 
JObjectjj &
(jj& '
)jj' (
{kk 
newll 
	JPropertyll 
(ll 
$strll $
,ll$ %
_langll% *
)ll* +
,ll+ ,
newmm 
	JPropertymm 
(mm 
$strmm $
,mm$ %

MixServicemm& 0
.mm0 1
GetLocalSettingsmm1 A
(mmA B
_langmmB G
)mmG H
)mmH I
}nn 
;nn 
JObjectoo 
resultoo 
=oo 
newoo  
JObjectoo! (
(oo( )
)oo) *
{pp 
newqq 
	JPropertyqq 
(qq 
$strqq .
,qq. /
JObjectqq0 7
.qq7 8

FromObjectqq8 B
(qqB C
configurationsqqC Q
)qqQ R
)qqR S
,qqS T
newrr 
	JPropertyrr 
(rr 
$strrr *
,rr* +

translatorrr, 6
)rr6 7
,rr7 8
newss 
	JPropertyss 
(ss 
$strss (
,ss( )
JObjectss* 1
.ss1 2

FromObjectss2 <
(ss< =
settingsss= E
)ssE F
)ssF G
}tt 
;tt 
returnvv 
newvv 
RepositoryResponsevv )
<vv) *
JObjectvv* 1
>vv1 2
(vv2 3
)vv3 4
{ww 
	IsSucceedxx 
=xx 
truexx  
,xx  !
Datayy 
=yy 
resultyy 
}zz 
;zz 
}{{ 	
[~~ 	
HttpGet~~	 
,~~ 
HttpOptions~~ 
]~~ 
[ 	
Route	 
( 
$str %
)% &
]& '
[
ÄÄ 	
Route
ÄÄ	 
(
ÄÄ 
$str
ÄÄ 
)
ÄÄ 
]
ÄÄ 
public
ÅÅ  
RepositoryResponse
ÅÅ !
<
ÅÅ! "
JObject
ÅÅ" )
>
ÅÅ) *
	Languages
ÅÅ+ 4
(
ÅÅ4 5
)
ÅÅ5 6
{
ÇÇ 	
return
ÉÉ 
new
ÉÉ  
RepositoryResponse
ÉÉ )
<
ÉÉ) *
JObject
ÉÉ* 1
>
ÉÉ1 2
(
ÉÉ2 3
)
ÉÉ3 4
{
ÑÑ 
	IsSucceed
ÖÖ 
=
ÖÖ 
true
ÖÖ  
,
ÖÖ  !
Data
ÜÜ 
=
ÜÜ 

MixService
ÜÜ !
.
ÜÜ! "
GetTranslator
ÜÜ" /
(
ÜÜ/ 0
_lang
ÜÜ0 5
)
ÜÜ5 6
}
áá 
;
áá 
}
àà 	
[
ãã 	
HttpGet
ãã	 
,
ãã 
HttpOptions
ãã 
]
ãã 
[
åå 	
Route
åå	 
(
åå 
$str
åå *
)
åå* +
]
åå+ ,
[
çç 	
Route
çç	 
(
çç 
$str
çç  
)
çç  !
]
çç! "
public
éé  
RepositoryResponse
éé !
<
éé! "
JObject
éé" )
>
éé) *
GetGlobalSettings
éé+ <
(
éé< =
)
éé= >
{
èè 	
var
êê 
cultures
êê 
=
êê 
CommonRepository
êê +
.
êê+ ,
Instance
êê, 4
.
êê4 5
LoadCultures
êê5 A
(
êêA B
)
êêB C
;
êêC D
var
ëë 
culture
ëë 
=
ëë 
cultures
ëë "
.
ëë" #
FirstOrDefault
ëë# 1
(
ëë1 2
c
ëë2 3
=>
ëë4 6
c
ëë7 8
.
ëë8 9
Specificulture
ëë9 G
==
ëëH J
_lang
ëëK P
)
ëëP Q
;
ëëQ R%
GlobalSettingsViewModel
îî #
configurations
îî$ 2
=
îî3 4
new
îî5 8%
GlobalSettingsViewModel
îî9 P
(
îîP Q
)
îîQ R
{
ïï 
Lang
ññ 
=
ññ 
_lang
ññ 
,
ññ 
ThemeId
óó 
=
óó 

MixService
óó $
.
óó$ %
	GetConfig
óó% .
<
óó. /
int
óó/ 2
>
óó2 3
(
óó3 4
MixConstants
óó4 @
.
óó@ A"
ConfigurationKeyword
óóA U
.
óóU V
ThemeId
óóV ]
,
óó] ^
_lang
óó_ d
)
óód e
,
óóe f
ApiEncryptKey
òò 
=
òò 

MixService
òò  *
.
òò* +
	GetConfig
òò+ 4
<
òò4 5
string
òò5 ;
>
òò; <
(
òò< =
MixConstants
òò= I
.
òòI J"
ConfigurationKeyword
òòJ ^
.
òò^ _
ApiEncryptKey
òò_ l
)
òòl m
,
òòm n
IsEncryptApi
ôô 
=
ôô 

MixService
ôô )
.
ôô) *
	GetConfig
ôô* 3
<
ôô3 4
bool
ôô4 8
>
ôô8 9
(
ôô9 :
MixConstants
ôô: F
.
ôôF G"
ConfigurationKeyword
ôôG [
.
ôô[ \
IsEncryptApi
ôô\ h
)
ôôh i
,
ôôi j
Cultures
öö 
=
öö 
cultures
öö #
,
öö# $
	PageTypes
õõ 
=
õõ 
Enum
õõ  
.
õõ  !
GetNames
õõ! )
(
õõ) *
typeof
õõ* 0
(
õõ0 1
MixPageType
õõ1 <
)
õõ< =
)
õõ= >
.
õõ> ?
ToList
õõ? E
(
õõE F
)
õõF G
,
õõG H
Statuses
úú 
=
úú 
Enum
úú 
.
úú  
GetNames
úú  (
(
úú( )
typeof
úú) /
(
úú/ 0
MixContentStatus
úú0 @
)
úú@ A
)
úúA B
.
úúB C
ToList
úúC I
(
úúI J
)
úúJ K
}
ûû 
;
ûû 
configurations
†† 
.
†† 
LangIcon
†† #
=
††$ %
culture
††& -
?
††- .
.
††. /
Icon
††/ 3
??
††4 6

MixService
††7 A
.
††A B
	GetConfig
††B K
<
††K L
string
††L R
>
††R S
(
††S T
$str
††T ^
)
††^ _
;
††_ `
return
°° 
new
°°  
RepositoryResponse
°° )
<
°°) *
JObject
°°* 1
>
°°1 2
(
°°2 3
)
°°3 4
{
¢¢ 
	IsSucceed
££ 
=
££ 
true
££  
,
££  !
Data
§§ 
=
§§ 
JObject
§§ 
.
§§ 

FromObject
§§ )
(
§§) *
configurations
§§* 8
)
§§8 9
}
•• 
;
•• 
}
¶¶ 	
[
©© 	
HttpGet
©©	 
,
©© 
HttpOptions
©© 
]
©© 
[
™™ 	
Route
™™	 
(
™™ 
$str
™™ 
)
™™ 
]
™™ 
public
´´  
RepositoryResponse
´´ !
<
´´! " 
DashboardViewModel
´´" 4
>
´´4 5
	Dashboard
´´6 ?
(
´´? @
int
´´@ C
id
´´D F
)
´´F G
{
¨¨ 	
return
≠≠ 
new
≠≠  
RepositoryResponse
≠≠ )
<
≠≠) * 
DashboardViewModel
≠≠* <
>
≠≠< =
(
≠≠= >
)
≠≠> ?
{
ÆÆ 
	IsSucceed
ØØ 
=
ØØ 
true
ØØ  
,
ØØ  !
Data
∞∞ 
=
∞∞ 
new
∞∞  
DashboardViewModel
∞∞ -
(
∞∞- .
)
∞∞. /
}
±± 
;
±± 
}
≤≤ 	
[
ππ 	
	Authorize
ππ	 
(
ππ #
AuthenticationSchemes
ππ (
=
ππ) *
JwtBearerDefaults
ππ+ <
.
ππ< ="
AuthenticationScheme
ππ= Q
,
ππQ R
Roles
ππS X
=
ππY Z
$str
ππ[ n
)
ππn o
]
ππo p
[
∫∫ 	
HttpGet
∫∫	 
,
∫∫ 
HttpOptions
∫∫ 
]
∫∫ 
[
ªª 	
Route
ªª	 
(
ªª 
$str
ªª %
)
ªª% &
]
ªª& '
public
ºº  
RepositoryResponse
ºº !
<
ºº! "
JObject
ºº" )
>
ºº) *
LoadAppSettings
ºº+ :
(
ºº: ;
)
ºº; <
{
ΩΩ 	
return
ææ 
new
ææ  
RepositoryResponse
ææ )
<
ææ) *
JObject
ææ* 1
>
ææ1 2
(
ææ2 3
)
ææ3 4
{
ææ5 6
	IsSucceed
ææ7 @
=
ææA B
true
ææC G
,
ææG H
Data
ææI M
=
ææN O

MixService
ææP Z
.
ææZ [
GetGlobalSetting
ææ[ k
(
ææk l
)
ææl m
}
ææn o
;
ææo p
}
øø 	
[
¬¬ 	
	Authorize
¬¬	 
(
¬¬ #
AuthenticationSchemes
¬¬ (
=
¬¬) *
JwtBearerDefaults
¬¬+ <
.
¬¬< ="
AuthenticationScheme
¬¬= Q
,
¬¬Q R
Roles
¬¬S X
=
¬¬Y Z
$str
¬¬[ n
)
¬¬n o
]
¬¬o p
[
√√ 	
HttpPost
√√	 
,
√√ 
HttpOptions
√√ 
]
√√ 
[
ƒƒ 	
Route
ƒƒ	 
(
ƒƒ 
$str
ƒƒ "
)
ƒƒ" #
]
ƒƒ# $
public
≈≈  
RepositoryResponse
≈≈ !
<
≈≈! "
JObject
≈≈" )
>
≈≈) *
SaveAppSettings
≈≈+ :
(
≈≈: ;
[
≈≈; <
FromBody
≈≈< D
]
≈≈D E
JObject
≈≈E L
model
≈≈M R
)
≈≈R S
{
∆∆ 	
var
«« 
settings
«« 
=
«« 
FileRepository
«« )
.
««) *
Instance
««* 2
.
««2 3
GetFile
««3 :
(
««: ;
$str
««; H
,
««H I
$str
««J Q
,
««Q R
string
««S Y
.
««Y Z
Empty
««Z _
,
««_ `
true
««a e
,
««e f
$str
««g k
)
««k l
;
««l m
if
»» 
(
»» 
model
»» 
!=
»» 
null
»» 
)
»» 
{
…… 
settings
   
.
   
Content
    
=
  ! "
model
  # (
.
  ( )
ToString
  ) 1
(
  1 2
)
  2 3
;
  3 4
FileRepository
ÀÀ 
.
ÀÀ 
Instance
ÀÀ '
.
ÀÀ' (
SaveFile
ÀÀ( 0
(
ÀÀ0 1
settings
ÀÀ1 9
)
ÀÀ9 :
;
ÀÀ: ;
}
ÕÕ 
return
ŒŒ 
new
ŒŒ  
RepositoryResponse
ŒŒ )
<
ŒŒ) *
JObject
ŒŒ* 1
>
ŒŒ1 2
(
ŒŒ2 3
)
ŒŒ3 4
{
ŒŒ5 6
	IsSucceed
ŒŒ7 @
=
ŒŒA B
model
ŒŒC H
!=
ŒŒI K
null
ŒŒL P
,
ŒŒP Q
Data
ŒŒR V
=
ŒŒW X
model
ŒŒY ^
}
ŒŒ_ `
;
ŒŒ` a
}
œœ 	
[
““ 	
	Authorize
““	 
(
““ #
AuthenticationSchemes
““ (
=
““) *
JwtBearerDefaults
““+ <
.
““< ="
AuthenticationScheme
““= Q
,
““Q R
Roles
““S X
=
““Y Z
$str
““[ n
)
““n o
]
““o p
[
”” 	
HttpPost
””	 
,
”” 
HttpOptions
”” 
]
”” 
[
‘‘ 	
Route
‘‘	 
(
‘‘ 
$str
‘‘ 
)
‘‘ 
]
‘‘  
[
’’ 	
Route
’’	 
(
’’ 
$str
’’ (
)
’’( )
]
’’) *
public
÷÷ 
async
÷÷ 
Task
÷÷ 
<
÷÷  
RepositoryResponse
÷÷ ,
<
÷÷, -
bool
÷÷- 1
>
÷÷1 2
>
÷÷2 3"
SaveAppSettingsAsync
÷÷4 H
(
÷÷H I
string
÷÷I O
type
÷÷P T
,
÷÷T U
[
÷÷V W
FromBody
÷÷W _
]
÷÷_ `
FileViewModel
÷÷` m
model
÷÷n s
)
÷÷s t
{
◊◊ 	
var
ÿÿ 
result
ÿÿ 
=
ÿÿ 
FileRepository
ÿÿ '
.
ÿÿ' (
Instance
ÿÿ( 0
.
ÿÿ0 1
SaveWebFile
ÿÿ1 <
(
ÿÿ< =
model
ÿÿ= B
)
ÿÿB C
;
ÿÿC D
if
ŸŸ 
(
ŸŸ 
result
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
var
€€ 
fileContent
€€ 
=
€€  !
FileRepository
€€" 0
.
€€0 1
Instance
€€1 9
.
€€9 :

GetWebFile
€€: D
(
€€D E
$"
€€E G
{
€€G H
model
€€H M
.
€€M N
Filename
€€N V
}
€€V W
{
€€W X
model
€€X ]
.
€€] ^
	Extension
€€^ g
}
€€g h
"
€€h i
,
€€i j
model
€€k p
.
€€p q

FileFolder
€€q {
)
€€{ |
;
€€| }
var
‹‹ 
obj
‹‹ 
=
‹‹ 
JObject
‹‹ !
.
‹‹! "
Parse
‹‹" '
(
‹‹' (
fileContent
‹‹( 3
.
‹‹3 4
Content
‹‹4 ;
)
‹‹; <
;
‹‹< =
switch
›› 
(
›› 
type
›› 
)
›› 
{
ﬁﬁ 
case
ﬂﬂ 
$str
ﬂﬂ #
:
ﬂﬂ# $
var
‡‡ 
arrLanguage
‡‡ '
=
‡‡( )
obj
‡‡* -
[
‡‡- .
$str
‡‡. 4
]
‡‡4 5
.
‡‡5 6
ToObject
‡‡6 >
<
‡‡> ?
List
‡‡? C
<
‡‡C D
MixLanguage
‡‡D O
>
‡‡O P
>
‡‡P Q
(
‡‡Q R
)
‡‡R S
;
‡‡S T
return
·· 
await
·· $
Lib
··% (
.
··( )

ViewModels
··) 3
.
··3 4
MixLanguages
··4 @
.
··@ A
ReadMvcViewModel
··A Q
.
··Q R
ImportLanguages
··R a
(
··a b
arrLanguage
··b m
,
··m n
_lang
··o t
)
··t u
;
··u v
case
‚‚ 
$str
‚‚ (
:
‚‚( )
var
„„ 
arrConfiguration
„„ ,
=
„„- .
obj
„„/ 2
[
„„2 3
$str
„„3 9
]
„„9 :
.
„„: ;
ToObject
„„; C
<
„„C D
List
„„D H
<
„„H I
MixConfiguration
„„I Y
>
„„Y Z
>
„„Z [
(
„„[ \
)
„„\ ]
;
„„] ^
return
‰‰ 
await
‰‰ $
Lib
‰‰% (
.
‰‰( )

ViewModels
‰‰) 3
.
‰‰3 4
MixConfigurations
‰‰4 E
.
‰‰E F
ReadMvcViewModel
‰‰F V
.
‰‰V W"
ImportConfigurations
‰‰W k
(
‰‰k l
arrConfiguration
‰‰l |
,
‰‰| }
_lang‰‰~ É
)‰‰É Ñ
;‰‰Ñ Ö
default
ÊÊ 
:
ÊÊ 
return
ÁÁ 
new
ÁÁ " 
RepositoryResponse
ÁÁ# 5
<
ÁÁ5 6
bool
ÁÁ6 :
>
ÁÁ: ;
(
ÁÁ; <
)
ÁÁ< =
{
ÁÁ> ?
	IsSucceed
ÁÁ@ I
=
ÁÁJ K
false
ÁÁL Q
}
ÁÁR S
;
ÁÁS T
}
ËË 
}
ÈÈ 
return
ÍÍ 
new
ÍÍ  
RepositoryResponse
ÍÍ )
<
ÍÍ) *
bool
ÍÍ* .
>
ÍÍ. /
(
ÍÍ/ 0
)
ÍÍ0 1
;
ÍÍ1 2
}
ÏÏ 	
[
ÔÔ 	
HttpPost
ÔÔ	 
,
ÔÔ 
HttpOptions
ÔÔ 
]
ÔÔ 
[
 	
Route
	 
(
 
$str
 
)
 
]
 
public
ÒÒ 
async
ÒÒ 
Task
ÒÒ 
<
ÒÒ  
RepositoryResponse
ÒÒ ,
<
ÒÒ, -
bool
ÒÒ- 1
>
ÒÒ1 2
>
ÒÒ2 3
Post
ÒÒ4 8
(
ÒÒ8 9
[
ÒÒ9 :
FromBody
ÒÒ: B
]
ÒÒB C
InitCmsViewModel
ÒÒC S
model
ÒÒT Y
)
ÒÒY Z
{
ÚÚ 	
if
ÛÛ 
(
ÛÛ 
model
ÛÛ 
!=
ÛÛ 
null
ÛÛ 
)
ÛÛ 
{
ÙÙ 
var
ıı 
result
ıı 
=
ıı 
await
ıı "
InitCmsAsync
ıı# /
(
ıı/ 0
model
ıı0 5
)
ıı5 6
.
ıı6 7
ConfigureAwait
ıı7 E
(
ııE F
false
ııF K
)
ııK L
;
ııL M
return
ˆˆ 
result
ˆˆ 
;
ˆˆ 
}
˜˜ 
return
¯¯ 
new
¯¯  
RepositoryResponse
¯¯ )
<
¯¯) *
bool
¯¯* .
>
¯¯. /
(
¯¯/ 0
)
¯¯0 1
;
¯¯1 2
}
˘˘ 	
private
˛˛ 
async
˛˛ 
Task
˛˛ 
<
˛˛  
RepositoryResponse
˛˛ -
<
˛˛- .
bool
˛˛. 2
>
˛˛2 3
>
˛˛3 4
InitCmsAsync
˛˛5 A
(
˛˛A B
InitCmsViewModel
˛˛B R
model
˛˛S X
)
˛˛X Y
{
ˇˇ 	
var
ÄÄ 
result
ÄÄ 
=
ÄÄ 
new
ÄÄ  
RepositoryResponse
ÄÄ /
<
ÄÄ/ 0
bool
ÄÄ0 4
>
ÄÄ4 5
(
ÄÄ5 6
)
ÄÄ6 7
;
ÄÄ7 8

MixService
ÇÇ 
.
ÇÇ !
SetConnectionString
ÇÇ *
(
ÇÇ* +
MixConstants
ÇÇ+ 7
.
ÇÇ7 8"
CONST_CMS_CONNECTION
ÇÇ8 L
,
ÇÇL M
model
ÇÇN S
.
ÇÇS T
ConnectionString
ÇÇT d
)
ÇÇd e
;
ÇÇe f

MixService
ÉÉ 
.
ÉÉ !
SetConnectionString
ÉÉ *
(
ÉÉ* +
MixConstants
ÉÉ+ 7
.
ÉÉ7 8&
CONST_ACCOUNT_CONNECTION
ÉÉ8 P
,
ÉÉP Q
model
ÉÉR W
.
ÉÉW X
ConnectionString
ÉÉX h
)
ÉÉh i
;
ÉÉi j

MixService
ÑÑ 
.
ÑÑ 
	SetConfig
ÑÑ  
(
ÑÑ  !
MixConstants
ÑÑ! -
.
ÑÑ- .%
CONST_SETTING_IS_SQLITE
ÑÑ. E
,
ÑÑE F
model
ÑÑG L
.
ÑÑL M
IsSqlite
ÑÑM U
)
ÑÑU V
;
ÑÑV W

MixService
ÖÖ 
.
ÖÖ 
	SetConfig
ÖÖ  
(
ÖÖ  !
MixConstants
ÖÖ! -
.
ÖÖ- .$
CONST_SETTING_LANGUAGE
ÖÖ. D
,
ÖÖD E
model
ÖÖF K
.
ÖÖK L
Culture
ÖÖL S
.
ÖÖS T
Specificulture
ÖÖT b
)
ÖÖb c
;
ÖÖc d
InitCmsService
áá 
sv
áá 
=
áá 
new
áá  #
InitCmsService
áá$ 2
(
áá2 3
)
áá3 4
;
áá4 5
var
àà 

initResult
àà 
=
àà 
await
àà "
sv
àà# %
.
àà% &
InitCms
àà& -
(
àà- .
model
àà. 3
.
àà3 4
Culture
àà4 ;
)
àà; <
;
àà< =
if
ââ 
(
ââ 

initResult
ââ 
.
ââ 
	IsSucceed
ââ $
)
ââ$ %
{
ää 
await
ãã 
InitRolesAsync
ãã $
(
ãã$ %
)
ãã% &
;
ãã& '
result
åå 
.
åå 
	IsSucceed
åå  
=
åå! "
true
åå# '
;
åå' (

MixService
çç 
.
çç 
LoadFromDatabase
çç +
(
çç+ ,
)
çç, -
;
çç- .

MixService
éé 
.
éé 
	SetConfig
éé $
<
éé$ %
bool
éé% )
>
éé) *
(
éé* +
$str
éé+ 3
,
éé3 4
true
éé5 9
)
éé9 :
;
éé: ;

MixService
èè 
.
èè 
	SetConfig
èè $
<
èè$ %
string
èè% +
>
èè+ ,
(
èè, -
$str
èè- =
,
èè= >
model
èè? D
.
èèD E
Culture
èèE L
.
èèL M
Specificulture
èèM [
)
èè[ \
;
èè\ ]

MixService
êê 
.
êê 
Save
êê 
(
êê  
)
êê  !
;
êê! "
}
ëë 
else
íí 
{
ìì 

MixService
îî 
.
îî 
Reload
îî !
(
îî! "
)
îî" #
;
îî# $
if
ïï 
(
ïï 

initResult
ïï 
.
ïï 
	Exception
ïï (
!=
ïï) +
null
ïï, 0
)
ïï0 1
{
ññ 
result
óó 
.
óó 
Errors
óó !
.
óó! "
Add
óó" %
(
óó% &

initResult
óó& 0
.
óó0 1
	Exception
óó1 :
.
óó: ;
Message
óó; B
)
óóB C
;
óóC D
result
òò 
.
òò 
	Exception
òò $
=
òò% &

initResult
òò' 1
.
òò1 2
	Exception
òò2 ;
;
òò; <
}
ôô 
foreach
öö 
(
öö 
var
öö 
item
öö !
in
öö" $

initResult
öö% /
.
öö/ 0
Errors
öö0 6
)
öö6 7
{
õõ 
result
úú 
.
úú 
Errors
úú !
.
úú! "
Add
úú" %
(
úú% &
item
úú& *
)
úú* +
;
úú+ ,
}
ùù 
}
ûû 
return
üü 
result
üü 
;
üü 
}
†† 	
private
¢¢ 
async
¢¢ 
Task
¢¢ 
<
¢¢ 
bool
¢¢ 
>
¢¢  
InitRolesAsync
¢¢! /
(
¢¢/ 0
)
¢¢0 1
{
££ 	
bool
§§ 
	isSucceed
§§ 
=
§§ 
true
§§ !
;
§§! "
var
•• 
getRoles
•• 
=
•• 
await
••  
RoleViewModel
••! .
.
••. /

Repository
••/ 9
.
••9 :
GetModelListAsync
••: K
(
••K L
)
••L M
;
••M N
if
¶¶ 
(
¶¶ 
getRoles
¶¶ 
.
¶¶ 
	IsSucceed
¶¶ "
&&
¶¶# %
getRoles
¶¶& .
.
¶¶. /
Data
¶¶/ 3
.
¶¶3 4
Count
¶¶4 9
==
¶¶: <
$num
¶¶= >
)
¶¶> ?
{
ßß 
var
®® 

saveResult
®® 
=
®®  
await
®®! &
_roleManager
®®' 3
.
®®3 4
CreateAsync
®®4 ?
(
®®? @
new
®®@ C
IdentityRole
®®D P
(
®®P Q
)
®®Q R
{
©© 
Id
™™ 
=
™™ 
Guid
™™ 
.
™™ 
NewGuid
™™ %
(
™™% &
)
™™& '
.
™™' (
ToString
™™( 0
(
™™0 1
)
™™1 2
,
™™2 3
Name
´´ 
=
´´ 
$str
´´ '
}
¨¨ 
)
¨¨ 
;
¨¨ 
	isSucceed
≠≠ 
=
≠≠ 

saveResult
≠≠ &
.
≠≠& '
	Succeeded
≠≠' 0
;
≠≠0 1
}
ÆÆ 
return
ØØ 
	isSucceed
ØØ 
;
ØØ 
}
∞∞ 	
}
≥≥ 
}¥¥ Ç≠
\C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiProductController.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 
( 
$str  
)  !
]! "
[ 
Route 

(
 
$str %
)% &
]& '
public 

class  
ApiProductController %
:& '
BaseApiController 
{ 
public  
ApiProductController #
(# $
	Microsoft$ -
.- .

AspNetCore. 8
.8 9
SignalR9 @
.@ A
IHubContextA L
<L M
HubM P
.P Q
	PortalHubQ Z
>Z [

hubContext\ f
)f g
:h i
basej n
(n o

hubContexto y
)y z
{ 	
} 	
[## 	
HttpGet##	 
,## 
HttpOptions## 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
RepositoryResponse%% ,
<%%, -

MixProduct%%- 7
>%%7 8
>%%8 9
DeleteAsync%%: E
(%%E F
int%%F I
id%%J L
)%%L M
{&& 	
var'' 

getProduct'' 
='' 
await'' "!
ReadListItemViewModel''# 8
.''8 9

Repository''9 C
.''C D
GetSingleModelAsync''D W
(''W X
model(( 
=>(( 
model(( 
.(( 
Id(( !
==((" $
id((% '
&&((( *
model((+ 0
.((0 1
Specificulture((1 ?
==((@ B
_lang((C H
)((H I
;((I J
if)) 
()) 

getProduct)) 
.)) 
	IsSucceed)) $
)))$ %
{** 
return,, 
await,, 

getProduct,, '
.,,' (
Data,,( ,
.,,, -
RemoveModelAsync,,- =
(,,= >
true,,> B
),,B C
;,,C D
}-- 
else.. 
{// 
return00 
new00 
RepositoryResponse00 -
<00- .

MixProduct00. 8
>008 9
(009 :
)00: ;
{11 
	IsSucceed22 
=22 
false22  %
}33 
;33 
}44 
}55 	
[88 	
HttpGet88	 
,88 
HttpOptions88 
]88 
[99 	
Route99	 
(99 
$str99 (
)99( )
]99) *
[:: 	
Route::	 
(:: 
$str:: #
)::# $
]::$ %
public;; 
async;; 
Task;; 
<;; 
ActionResult;; &
<;;& '
JObject;;' .
>;;. /
>;;/ 0
Details;;1 8
(;;8 9
string;;9 ?
viewType;;@ H
,;;H I
int;;J M
?;;M N
id;;O Q
);;Q R
{<< 	
switch== 
(== 
viewType== 
)== 
{>> 
case?? 
$str?? 
:?? 
if@@ 
(@@ 
id@@ 
.@@ 
HasValue@@ #
)@@# $
{AA 
varBB 
beResultBB $
=BB% &
awaitBB' ,
UpdateViewModelBB- <
.BB< =

RepositoryBB= G
.BBG H
GetSingleModelAsyncBBH [
(BB[ \
modelBB\ a
=>BBb d
modelBBe j
.BBj k
IdBBk m
==BBn p
idBBq s
&&BBt v
modelBBw |
.BB| }
Specificulture	BB} ã
==
BBå é
_lang
BBè î
)
BBî ï
.
BBï ñ
ConfigureAwait
BBñ §
(
BB§ •
false
BB• ™
)
BB™ ´
;
BB´ ¨
ifCC 
(CC 
beResultCC $
.CC$ %
	IsSucceedCC% .
)CC. /
{DD 
beResultEE $
.EE$ %
DataEE% )
.EE) *

DetailsUrlEE* 4
=EE5 6
MixCmsHelperEE7 C
.EEC D
GetRouterUrlEED P
(EEP Q
$strEEQ Z
,EEZ [
newEE\ _
{EE` a
beResultEEb j
.EEj k
DataEEk o
.EEo p
SeoNameEEp w
}EEx y
,EEy z
Request	EE{ Ç
,
EEÇ É
Url
EEÑ á
)
EEá à
;
EEà â
}FF 
returnGG 
OkGG !
(GG! "
JObjectGG" )
.GG) *

FromObjectGG* 4
(GG4 5
beResultGG5 =
)GG= >
)GG> ?
;GG? @
}HH 
elseII 
{JJ 
varKK 
modelKK !
=KK" #
newKK$ '

MixProductKK( 2
(KK2 3
)KK3 4
{LL 
SpecificultureMM *
=MM+ ,
_langMM- 2
,MM2 3
StatusNN "
=NN# $

MixServiceNN% /
.NN/ 0
	GetConfigNN0 9
<NN9 :
intNN: =
>NN= >
(NN> ?
$strNN? N
)NNN O
,NNO P
PriorityOO $
=OO% &
UpdateViewModelOO' 6
.OO6 7

RepositoryOO7 A
.OOA B
MaxOOB E
(OOE F
aOOF G
=>OOH J
aOOK L
.OOL M
PriorityOOM U
)OOU V
.OOV W
DataOOW [
+OO\ ]
$numOO^ _
}PP 
;PP 
RepositoryResponseRR *
<RR* +
UpdateViewModelRR+ :
>RR: ;
resultRR< B
=RRC D
newRRE H
RepositoryResponseRRI [
<RR[ \
UpdateViewModelRR\ k
>RRk l
(RRl m
)RRm n
{SS 
	IsSucceedTT %
=TT& '
trueTT( ,
,TT, -
DataUU  
=UU! "
awaitUU# (
UpdateViewModelUU) 8
.UU8 9
InitViewAsyncUU9 F
(UUF G
modelUUG L
)UUL M
}VV 
;VV 
returnWW 
JObjectWW &
.WW& '

FromObjectWW' 1
(WW1 2
resultWW2 8
)WW8 9
;WW9 :
}XX 
defaultYY 
:YY 
ifZZ 
(ZZ 
idZZ 
.ZZ 
HasValueZZ #
)ZZ# $
{[[ 
var\\ 
beResult\\ $
=\\% &
await\\' ,
UpdateViewModel\\- <
.\\< =

Repository\\= G
.\\G H
GetSingleModelAsync\\H [
(\\[ \
model\\\ a
=>\\b d
model\\e j
.\\j k
Id\\k m
==\\n p
id\\q s
&&\\t v
model\\w |
.\\| }
Specificulture	\\} ã
==
\\å é
_lang
\\è î
)
\\î ï
.
\\ï ñ
ConfigureAwait
\\ñ §
(
\\§ •
false
\\• ™
)
\\™ ´
;
\\´ ¨
if]] 
(]] 
beResult]] $
.]]$ %
	IsSucceed]]% .
)]]. /
{^^ 
beResult__ $
.__$ %
Data__% )
.__) *

DetailsUrl__* 4
=__5 6
MixCmsHelper__7 C
.__C D
GetRouterUrl__D P
(__P Q
$str__Q Z
,__Z [
new__\ _
{__` a
beResult__b j
.__j k
Data__k o
.__o p
SeoName__p w
}__x y
,__y z
Request	__{ Ç
,
__Ç É
Url
__Ñ á
)
__á à
;
__à â
}`` 
returnaa 
JObjectaa &
.aa& '

FromObjectaa' 1
(aa1 2
beResultaa2 :
)aa: ;
;aa; <
}bb 
elsecc 
{dd 
varee 
modelee !
=ee" #
newee$ '

MixProductee( 2
(ee2 3
)ee3 4
;ee4 5
RepositoryResponseff *
<ff* +
UpdateViewModelff+ :
>ff: ;
resultff< B
=ffC D
newffE H
RepositoryResponseffI [
<ff[ \
UpdateViewModelff\ k
>ffk l
(ffl m
)ffm n
{gg 
	IsSucceedhh %
=hh& '
truehh( ,
,hh, -
Dataii  
=ii! "
newii# &
UpdateViewModelii' 6
(ii6 7
modelii7 <
)ii< =
{jj 
Specificulturekk  .
=kk/ 0
_langkk1 6
,kk6 7
Statusll  &
=ll' (
MixContentStatusll) 9
.ll9 :
Previewll: A
,llA B
}mm 
}nn 
;nn 
returnoo 
JObjectoo &
.oo& '

FromObjectoo' 1
(oo1 2
resultoo2 8
)oo8 9
;oo9 :
}pp 
}qq 
}rr 	
[zz 	
	Authorizezz	 
(zz !
AuthenticationSchemeszz (
=zz) *
JwtBearerDefaultszz+ <
.zz< = 
AuthenticationSchemezz= Q
,zzQ R
RoleszzS X
=zzY Z
$strzz[ n
)zzn o
]zzo p
[{{ 	
HttpPost{{	 
,{{ 
HttpOptions{{ 
]{{ 
[|| 	
Route||	 
(|| 
$str|| 
)|| 
]|| 
public}} 
async}} 
Task}} 
<}} 
RepositoryResponse}} ,
<}}, -
UpdateViewModel}}- <
>}}< =
>}}= >
Post}}? C
(}}C D
[}}D E
FromBody}}E M
]}}M N
UpdateViewModel}}N ]
model}}^ c
)}}c d
{~~ 	
if 
( 
model 
!= 
null 
) 
{
ÄÄ 
model
ÅÅ 
.
ÅÅ 
	CreatedBy
ÅÅ 
=
ÅÅ  !
User
ÅÅ" &
.
ÅÅ& '
Claims
ÅÅ' -
.
ÅÅ- .
FirstOrDefault
ÅÅ. <
(
ÅÅ< =
c
ÅÅ= >
=>
ÅÅ? A
c
ÅÅB C
.
ÅÅC D
Type
ÅÅD H
==
ÅÅI K
$str
ÅÅL V
)
ÅÅV W
?
ÅÅW X
.
ÅÅX Y
Value
ÅÅY ^
;
ÅÅ^ _
var
ÇÇ 
result
ÇÇ 
=
ÇÇ 
await
ÇÇ "
model
ÇÇ# (
.
ÇÇ( )
SaveModelAsync
ÇÇ) 7
(
ÇÇ7 8
true
ÇÇ8 <
)
ÇÇ< =
.
ÇÇ= >
ConfigureAwait
ÇÇ> L
(
ÇÇL M
false
ÇÇM R
)
ÇÇR S
;
ÇÇS T
return
ÉÉ 
result
ÉÉ 
;
ÉÉ 
}
ÑÑ 
return
ÖÖ 
new
ÖÖ  
RepositoryResponse
ÖÖ )
<
ÖÖ) *
UpdateViewModel
ÖÖ* 9
>
ÖÖ9 :
(
ÖÖ: ;
)
ÖÖ; <
{
ÖÖ= >
Status
ÖÖ? E
=
ÖÖF G
$num
ÖÖH K
}
ÖÖL M
;
ÖÖM N
}
ÜÜ 	
[
ââ 	
HttpPost
ââ	 
,
ââ 
HttpOptions
ââ 
]
ââ 
[
ää 	
Route
ää	 
(
ää 
$str
ää 
)
ää 
]
ää 
public
ãã 
async
ãã 
Task
ãã 
<
ãã  
RepositoryResponse
ãã ,
<
ãã, -

MixProduct
ãã- 7
>
ãã7 8
>
ãã8 9

SaveFields
ãã: D
(
ããD E
int
ããE H
id
ããI K
,
ããK L
[
ããM N
FromBody
ããN V
]
ããV W
List
ããW [
<
ãã[ \
EntityField
ãã\ g
>
ããg h
fields
ããi o
)
ãão p
{
åå 	
if
çç 
(
çç 
fields
çç 
!=
çç 
null
çç 
)
çç 
{
éé 
var
èè 
result
èè 
=
èè 
new
èè   
RepositoryResponse
èè! 3
<
èè3 4

MixProduct
èè4 >
>
èè> ?
(
èè? @
)
èè@ A
{
èèB C
	IsSucceed
èèD M
=
èèN O
true
èèP T
}
èèU V
;
èèV W
foreach
êê 
(
êê 
var
êê 
property
êê %
in
êê& (
fields
êê) /
)
êê/ 0
{
ëë 
if
íí 
(
íí 
result
íí 
.
íí 
	IsSucceed
íí (
)
íí( )
{
ìì 
result
îî 
=
îî  
await
îî! &#
ReadListItemViewModel
îî' <
.
îî< =

Repository
îî= G
.
îîG H
UpdateFieldsAsync
îîH Y
(
îîY Z
c
îîZ [
=>
îî\ ^
c
îî_ `
.
îî` a
Id
îîa c
==
îîd f
id
îîg i
&&
îîj l
c
îîm n
.
îîn o
Specificulture
îîo }
==îî~ Ä
_langîîÅ Ü
,îîÜ á
fieldsîîà é
)îîé è
.îîè ê
ConfigureAwaitîîê û
(îîû ü
falseîîü §
)îî§ •
;îî• ¶
}
ïï 
else
ññ 
{
óó 
break
òò 
;
òò 
}
ôô 
}
õõ 
return
úú 
result
úú 
;
úú 
}
ùù 
return
ûû 
new
ûû  
RepositoryResponse
ûû )
<
ûû) *

MixProduct
ûû* 4
>
ûû4 5
(
ûû5 6
)
ûû6 7
;
ûû7 8
}
üü 	
[
°° 	
HttpPost
°°	 
,
°° 
HttpOptions
°° 
]
°° 
[
¢¢ 	
Route
¢¢	 
(
¢¢ 
$str
¢¢ 
)
¢¢ 
]
¢¢ 
public
££ 
async
££ 
Task
££ 
<
££ 
JObject
££ !
>
££! "
GetList
££# *
(
££* +
[
§§ 
FromBody
§§ 
]
§§ 
RequestPaging
§§ $
request
§§% ,
)
§§, -
{
•• 	$
ParseRequestPagingDate
¶¶ "
(
¶¶" #
request
¶¶# *
)
¶¶* +
;
¶¶+ ,

Expression
ßß 
<
ßß 
Func
ßß 
<
ßß 

MixProduct
ßß &
,
ßß& '
bool
ßß( ,
>
ßß, -
>
ßß- .
	predicate
ßß/ 8
=
ßß9 :
model
ßß; @
=>
ßßA C
model
®® 
.
®® 
Specificulture
®® ,
==
®®- /
_lang
®®0 5
&&
©© 
(
©© 
!
©© 
request
©© $
.
©©$ %
Status
©©% +
.
©©+ ,
HasValue
©©, 4
||
©©5 7
model
©©8 =
.
©©= >
Status
©©> D
==
©©E G
request
©©H O
.
©©O P
Status
©©P V
.
©©V W
Value
©©W \
)
©©\ ]
&&
™™ 
(
™™ 
string
™™ "
.
™™" # 
IsNullOrWhiteSpace
™™# 5
(
™™5 6
request
™™6 =
.
™™= >
Keyword
™™> E
)
™™E F
||
´´ 
(
´´  
model
´´  %
.
´´% &
Title
´´& +
.
´´+ ,
Contains
´´, 4
(
´´4 5
request
´´5 <
.
´´< =
Keyword
´´= D
)
´´D E
||
¨¨ 
model
¨¨ $
.
¨¨$ %
Excerpt
¨¨% ,
.
¨¨, -
Contains
¨¨- 5
(
¨¨5 6
request
¨¨6 =
.
¨¨= >
Keyword
¨¨> E
)
¨¨E F
)
¨¨F G
)
¨¨G H
&&
≠≠ 
(
≠≠ 
!
≠≠ 
request
≠≠ $
.
≠≠$ %
FromDate
≠≠% -
.
≠≠- .
HasValue
≠≠. 6
||
ÆÆ 
(
ÆÆ  
model
ÆÆ  %
.
ÆÆ% &
CreatedDateTime
ÆÆ& 5
>=
ÆÆ6 8
request
ÆÆ9 @
.
ÆÆ@ A
FromDate
ÆÆA I
.
ÆÆI J
Value
ÆÆJ O
)
ÆÆO P
)
ØØ 
&&
∞∞ 
(
∞∞ 
!
∞∞ 
request
∞∞ $
.
∞∞$ %
ToDate
∞∞% +
.
∞∞+ ,
HasValue
∞∞, 4
||
±± 
(
±±  
model
±±  %
.
±±% &
CreatedDateTime
±±& 5
<=
±±6 8
request
±±9 @
.
±±@ A
ToDate
±±A G
.
±±G H
Value
±±H M
)
±±M N
)
≤≤ 
;
≤≤ 
switch
¥¥ 
(
¥¥ 
request
¥¥ 
.
¥¥ 
Key
¥¥ 
)
¥¥  
{
µµ 
case
∂∂ 
$str
∂∂ 
:
∂∂ 
var
∑∑ 
fedata
∑∑ 
=
∑∑  
await
∑∑! &
ReadMvcViewModel
∑∑' 7
.
∑∑7 8

Repository
∑∑8 B
.
∑∑B C!
GetModelListByAsync
∑∑C V
(
∏∏ 
	predicate
∏∏ "
,
∏∏" #
request
∏∏$ +
.
∏∏+ ,
OrderBy
∏∏, 3
,
∏∏3 4
request
∏∏5 <
.
∏∏< =
	Direction
∏∏= F
,
∏∏F G
request
∏∏H O
.
∏∏O P
PageSize
∏∏P X
,
∏∏X Y
request
∏∏Z a
.
∏∏a b
	PageIndex
∏∏b k
)
∏∏k l
.
∏∏l m
ConfigureAwait
∏∏m {
(
∏∏{ |
false∏∏| Å
)∏∏Å Ç
;∏∏Ç É
if
ππ 
(
ππ 
fedata
ππ 
.
ππ 
	IsSucceed
ππ (
)
ππ( )
{
∫∫ 
fedata
ªª 
.
ªª 
Data
ªª #
.
ªª# $
Items
ªª$ )
.
ªª) *
ForEach
ªª* 1
(
ªª1 2
a
ªª2 3
=>
ªª4 6
{
ºº 
a
ΩΩ 
.
ΩΩ 

DetailsUrl
ΩΩ (
=
ΩΩ) *
MixCmsHelper
ΩΩ+ 7
.
ΩΩ7 8
GetRouterUrl
ΩΩ8 D
(
ΩΩD E
$str
ææ  )
,
ææ) *
new
ææ+ .
{
ææ/ 0
seoName
ææ1 8
=
ææ9 :
a
ææ; <
.
ææ< =
SeoName
ææ= D
}
ææE F
,
ææF G
Request
ææH O
,
ææO P
Url
ææQ T
)
ææT U
;
ææU V
}
øø 
)
øø 
;
øø 
}
¿¿ 
return
¡¡ 
JObject
¡¡ "
.
¡¡" #

FromObject
¡¡# -
(
¡¡- .
fedata
¡¡. 4
)
¡¡4 5
;
¡¡5 6
case
¬¬ 
$str
¬¬ 
:
¬¬ 
var
ƒƒ 
bedata
ƒƒ 
=
ƒƒ  
await
ƒƒ! &
UpdateViewModel
ƒƒ' 6
.
ƒƒ6 7

Repository
ƒƒ7 A
.
ƒƒA B!
GetModelListByAsync
ƒƒB U
(
≈≈ 
	predicate
≈≈ "
,
≈≈" #
request
≈≈$ +
.
≈≈+ ,
OrderBy
≈≈, 3
,
≈≈3 4
request
≈≈5 <
.
≈≈< =
	Direction
≈≈= F
,
≈≈F G
request
≈≈H O
.
≈≈O P
PageSize
≈≈P X
,
≈≈X Y
request
≈≈Z a
.
≈≈a b
	PageIndex
≈≈b k
)
≈≈k l
.
≈≈l m
ConfigureAwait
≈≈m {
(
≈≈{ |
false≈≈| Å
)≈≈Å Ç
;≈≈Ç É
if
∆∆ 
(
∆∆ 
bedata
∆∆ 
.
∆∆ 
	IsSucceed
∆∆ (
)
∆∆( )
{
«« 
bedata
»» 
.
»» 
Data
»» #
.
»»# $
Items
»»$ )
.
»») *
ForEach
»»* 1
(
»»1 2
a
»»2 3
=>
»»4 6
{
…… 
a
   
.
   

DetailsUrl
   (
=
  ) *
MixCmsHelper
  + 7
.
  7 8
GetRouterUrl
  8 D
(
  D E
$str
ÀÀ  )
,
ÀÀ) *
new
ÀÀ+ .
{
ÀÀ/ 0
seoName
ÀÀ1 8
=
ÀÀ9 :
a
ÀÀ; <
.
ÀÀ< =
SeoName
ÀÀ= D
}
ÀÀE F
,
ÀÀF G
Request
ÀÀH O
,
ÀÀO P
Url
ÀÀQ T
)
ÀÀT U
;
ÀÀU V
}
ÃÃ 
)
ÃÃ 
;
ÃÃ 
}
ÕÕ 
return
ŒŒ 
JObject
ŒŒ "
.
ŒŒ" #

FromObject
ŒŒ# -
(
ŒŒ- .
bedata
ŒŒ. 4
)
ŒŒ4 5
;
ŒŒ5 6
default
œœ 
:
œœ 
var
—— 
data
—— 
=
—— 
await
—— $#
ReadListItemViewModel
——% :
.
——: ;

Repository
——; E
.
——E F!
GetModelListByAsync
——F Y
(
““ 
	predicate
““ "
,
““" #
request
““$ +
.
““+ ,
OrderBy
““, 3
,
““3 4
request
““5 <
.
““< =
	Direction
““= F
,
““F G
request
““H O
.
““O P
PageSize
““P X
,
““X Y
request
““Z a
.
““a b
	PageIndex
““b k
)
““k l
.
““l m
ConfigureAwait
““m {
(
““{ |
false““| Å
)““Å Ç
;““Ç É
if
”” 
(
”” 
data
”” 
.
”” 
	IsSucceed
”” &
)
””& '
{
‘‘ 
data
’’ 
.
’’ 
Data
’’ !
.
’’! "
Items
’’" '
.
’’' (
ForEach
’’( /
(
’’/ 0
(
’’0 1
Action
’’1 7
<
’’7 8#
ReadListItemViewModel
’’8 M
>
’’M N
)
’’N O
(
’’O P
a
’’P Q
=>
’’R T
{
÷÷ 
a
◊◊ 
.
◊◊ 

DetailsUrl
◊◊ (
=
◊◊) *
MixCmsHelper
◊◊+ 7
.
◊◊7 8
GetRouterUrl
◊◊8 D
(
◊◊D E
$str
ÿÿ  )
,
ÿÿ) *
new
ÿÿ+ .
{
ÿÿ/ 0
seoName
ÿÿ1 8
=
ÿÿ9 :
a
ÿÿ; <
.
ÿÿ< =
SeoName
ÿÿ= D
}
ÿÿE F
,
ÿÿF G
Request
ÿÿH O
,
ÿÿO P
Url
ÿÿQ T
)
ÿÿT U
;
ÿÿU V
}
ŸŸ 
)
ŸŸ 
)
ŸŸ 
;
ŸŸ 
}
⁄⁄ 
return
€€ 
JObject
€€ "
.
€€" #

FromObject
€€# -
(
€€- .
data
€€. 2
)
€€2 3
;
€€3 4
}
‹‹ 
}
›› 	
}
‡‡ 
}·· Ës
]C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiTemplateController.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
	Authorize 
( !
AuthenticationSchemes $
=% &
JwtBearerDefaults' 8
.8 9 
AuthenticationScheme9 M
,M N
Roles 
= 
$str '
)' (
]( )
[ 
Produces 
( 
$str  
)  !
]! "
[ 
Route 

(
 
$str &
)& '
]' (
public 

class !
ApiTemplateController &
:' (
BaseApiController 
{ 
public !
ApiTemplateController $
($ %
	Microsoft% .
.. /

AspNetCore/ 9
.9 :
SignalR: A
.A B
IHubContextB M
<M N
HubN Q
.Q R
	PortalHubR [
>[ \

hubContext] g
)g h
:i j
basek o
(o p

hubContextp z
)z {
{ 	
} 	
[   	
HttpGet  	 
,   
HttpOptions   
]   
[!! 	
Route!!	 
(!! 
$str!! ?
)!!? @
]!!@ A
["" 	
Route""	 
("" 
$str"" :
)"": ;
]""; <
public## 
async## 
Task## 
<## 
RepositoryResponse## ,
<##, -
Lib##- 0
.##0 1

ViewModels##1 ;
.##; <
MixTemplates##< H
.##H I
UpdateViewModel##I X
>##X Y
>##Y Z
DetailsAsync##[ g
(##g h
string##h n
viewType##o w
,##w x
int##y |
themeId	##} Ñ
,
##Ñ Ö
string
##Ü å

folderType
##ç ó
,
##ó ò
int
##ô ú
?
##ú ù
id
##û †
)
##† °
{$$ 	
if%% 
(%% 
id%% 
.%% 
HasValue%% 
)%% 
{&& 
var'' 
beResult'' 
='' 
await'' $
Lib''% (
.''( )

ViewModels'') 3
.''3 4
MixTemplates''4 @
.''@ A
UpdateViewModel''A P
.''P Q

Repository''Q [
.''[ \
GetSingleModelAsync''\ o
(''o p
model(( 
=>(( 
model(( "
.((" #
Id((# %
==((& (
id(() +
&&((, .
model((/ 4
.((4 5
ThemeId((5 <
==((= ?
themeId((@ G
)((G H
.((H I
ConfigureAwait((I W
(((W X
false((X ]
)((] ^
;((^ _
return)) 
beResult)) 
;))  
}** 
else++ 
{,, 
var-- 
getTheme-- 
=-- 
await-- $
Lib--% (
.--( )

ViewModels--) 3
.--3 4
	MixThemes--4 =
.--= >
ReadViewModel--> K
.--K L

Repository--L V
.--V W
GetSingleModelAsync--W j
(--j k
t--k l
=>--m o
t--p q
.--q r
Id--r t
==--u w
themeId--x 
)	-- Ä
;
--Ä Å
if.. 
(.. 
getTheme.. 
... 
	IsSucceed.. &
)..& '
{// 
var00 
model00 
=00 
new00  #
MixTemplate00$ /
(00/ 0
)000 1
{11 
Status22 
=22  
(22! "
int22" %
)22% &
MixContentStatus22& 6
.226 7
Preview227 >
,22> ?
ThemeId33 
=33  !
themeId33" )
,33) *
	ThemeName44 !
=44" #
getTheme44$ ,
.44, -
Data44- 1
.441 2
Name442 6
,446 7
	Extension55 !
=55" #

MixService55$ .
.55. /
	GetConfig55/ 8
<558 9
string559 ?
>55? @
(55@ A
$str55A T
)55T U
,55U V

FolderType66 "
=66# $

folderType66% /
}77 
;77 
RepositoryResponse99 &
<99& '
Lib99' *
.99* +

ViewModels99+ 5
.995 6
MixTemplates996 B
.99B C
UpdateViewModel99C R
>99R S
result99T Z
=99[ \
new99] `
RepositoryResponse99a s
<99s t
Lib99t w
.99w x

ViewModels	99x Ç
.
99Ç É
MixTemplates
99É è
.
99è ê
UpdateViewModel
99ê ü
>
99ü †
(
99† °
)
99° ¢
{:: 
	IsSucceed;; !
=;;" #
true;;$ (
,;;( )
Data<< 
=<< 
await<< $
Lib<<% (
.<<( )

ViewModels<<) 3
.<<3 4
MixTemplates<<4 @
.<<@ A
UpdateViewModel<<A P
.<<P Q
InitViewAsync<<Q ^
(<<^ _
model<<_ d
)<<d e
}== 
;== 
result>> 
.>> 
Data>> 
.>>  
Specificulture>>  .
=>>/ 0
_lang>>1 6
;>>6 7
return?? 
result?? !
;??! "
}@@ 
elseAA 
{BB 
returnCC 
newCC 
RepositoryResponseCC 1
<CC1 2
LibCC2 5
.CC5 6

ViewModelsCC6 @
.CC@ A
MixTemplatesCCA M
.CCM N
UpdateViewModelCCN ]
>CC] ^
(CC^ _
)CC_ `
;CC` a
}DD 
}EE 
}FF 	
[II 	
HttpGetII	 
,II 
HttpOptionsII 
]II 
[JJ 	
RouteJJ	 
(JJ 
$strJJ 
)JJ 
]JJ 
publicKK 
asyncKK 
TaskKK 
<KK 
RepositoryResponseKK ,
<KK, -
MixTemplateKK- 8
>KK8 9
>KK9 :
DeleteAsyncKK; F
(KKF G
intKKG J
idKKK M
)KKM N
{LL 	
varMM 
getPageMM 
=MM 
awaitMM 
LibMM  #
.MM# $

ViewModelsMM$ .
.MM. /
MixTemplatesMM/ ;
.MM; <
UpdateViewModelMM< K
.MMK L

RepositoryMML V
.MMV W
GetSingleModelAsyncMMW j
(MMj k
modelNN 
=>NN 
modelNN 
.NN 
IdNN !
==NN" $
idNN% '
)NN' (
;NN( )
ifOO 
(OO 
getPageOO 
.OO 
	IsSucceedOO !
)OO! "
{PP 
returnRR 
awaitRR 
getPageRR $
.RR$ %
DataRR% )
.RR) *
RemoveModelAsyncRR* :
(RR: ;
trueRR; ?
)RR? @
;RR@ A
}SS 
elseTT 
{UU 
returnVV 
newVV 
RepositoryResponseVV -
<VV- .
MixTemplateVV. 9
>VV9 :
(VV: ;
)VV; <
{WW 
	IsSucceedXX 
=XX 
falseXX  %
}YY 
;YY 
}ZZ 
}[[ 	
[cc 	
HttpPostcc	 
,cc 
HttpOptionscc 
]cc 
[dd 	
Routedd	 
(dd 
$strdd 
)dd 
]dd 
publicee 
asyncee 
Taskee 
<ee 
RepositoryResponseee ,
<ee, -
Libee- 0
.ee0 1

ViewModelsee1 ;
.ee; <
MixTemplatesee< H
.eeH I
UpdateViewModeleeI X
>eeX Y
>eeY Z
Saveee[ _
(ee_ `
[ff 
FromBodyff 
]ff 
Libff 
.ff 

ViewModelsff %
.ff% &
MixTemplatesff& 2
.ff2 3
UpdateViewModelff3 B
modelffC H
)ffH I
{gg 	
ifhh 
(hh 
modelhh 
!=hh 
nullhh 
)hh 
{ii 
varjj 
resultjj 
=jj 
awaitjj "
modeljj# (
.jj( )
SaveModelAsyncjj) 7
(jj7 8
truejj8 <
)jj< =
.jj= >
ConfigureAwaitjj> L
(jjL M
falsejjM R
)jjR S
;jjS T
returnkk 
resultkk 
;kk 
}ll 
returnmm 
newmm 
RepositoryResponsemm )
<mm) *
Libmm* -
.mm- .

ViewModelsmm. 8
.mm8 9
MixTemplatesmm9 E
.mmE F
UpdateViewModelmmF U
>mmU V
(mmV W
)mmW X
;mmX Y
}nn 	
[qq 	
HttpPostqq	 
,qq 
HttpOptionsqq 
]qq 
[rr 	
Routerr	 
(rr 
$strrr 
)rr 
]rr 
publicss 
asyncss 
Taskss 
<ss 
RepositoryResponsess ,
<ss, -
MixTemplatess- 8
>ss8 9
>ss9 :

SaveFieldsss; E
(ssE F
intssF I
idssJ L
,ssL M
[ssN O
FromBodyssO W
]ssW X
ListssX \
<ss\ ]
EntityFieldss] h
>ssh i
fieldsssj p
)ssp q
{tt 	
ifuu 
(uu 
fieldsuu 
!=uu 
nulluu 
)uu 
{vv 
varww 
resultww 
=ww 
newww  
RepositoryResponseww! 3
<ww3 4
MixTemplateww4 ?
>ww? @
(ww@ A
)wwA B
{wwC D
	IsSucceedwwE N
=wwO P
truewwQ U
}wwV W
;wwW X
foreachxx 
(xx 
varxx 
propertyxx %
inxx& (
fieldsxx) /
)xx/ 0
{yy 
ifzz 
(zz 
resultzz 
.zz 
	IsSucceedzz (
)zz( )
{{{ 
result|| 
=||  
await||! &
Lib||' *
.||* +

ViewModels||+ 5
.||5 6
MixTemplates||6 B
.||B C
UpdateViewModel||C R
.||R S

Repository||S ]
.||] ^
UpdateFieldsAsync||^ o
(||o p
c||p q
=>||r t
c||u v
.||v w
Id||w y
==||z |
id||} 
,	|| Ä
fields
||Å á
)
||á à
.
||à â
ConfigureAwait
||â ó
(
||ó ò
false
||ò ù
)
||ù û
;
||û ü
}}} 
else~~ 
{ 
break
ÄÄ 
;
ÄÄ 
}
ÅÅ 
}
ÉÉ 
return
ÑÑ 
result
ÑÑ 
;
ÑÑ 
}
ÖÖ 
return
ÜÜ 
new
ÜÜ  
RepositoryResponse
ÜÜ )
<
ÜÜ) *
MixTemplate
ÜÜ* 5
>
ÜÜ5 6
(
ÜÜ6 7
)
ÜÜ7 8
;
ÜÜ8 9
}
áá 	
[
ää 	
HttpPost
ää	 
,
ää 
HttpOptions
ää 
]
ää 
[
ãã 	
Route
ãã	 
(
ãã 
$str
ãã 
)
ãã  
]
ãã  !
public
åå 
async
åå 
Task
åå 
<
åå  
RepositoryResponse
åå ,
<
åå, -
PaginationModel
åå- <
<
åå< =
Lib
åå= @
.
åå@ A

ViewModels
ååA K
.
ååK L
MixTemplates
ååL X
.
ååX Y
UpdateViewModel
ååY h
>
ååh i
>
ååi j
>
ååj k
GetList
åål s
(
åås t
int
çç 
themeId
çç 
,
çç 
[
éé 
FromBody
éé 
]
éé 
RequestPaging
éé #
request
éé$ +
)
èè 
{
êê 	

Expression
ëë 
<
ëë 
Func
ëë 
<
ëë 
MixTemplate
ëë '
,
ëë' (
bool
ëë) -
>
ëë- .
>
ëë. /
	predicate
ëë0 9
=
ëë: ;
model
ëë< A
=>
ëëB D
model
íí 
.
íí 
ThemeId
íí 
==
íí  
themeId
íí! (
&&
ìì 
(
ìì 
string
ìì 
.
ìì  
IsNullOrWhiteSpace
ìì .
(
ìì. /
request
ìì/ 6
.
ìì6 7
Key
ìì7 :
)
ìì: ;
||
îî 
(
ïï 
model
ññ 
.
ññ 

FolderType
ññ (
==
ññ) +
(
ññ, -
request
ññ- 4
.
ññ4 5
Key
ññ5 8
)
ññ8 9
)
óó 
)
óó 
&&
òò 
(
òò 
string
òò 
.
òò  
IsNullOrWhiteSpace
òò -
(
òò- .
request
òò. 5
.
òò5 6
Keyword
òò6 =
)
òò= >
||
ôô 
(
öö 
model
õõ 
.
õõ 
FileName
õõ '
.
õõ' (
Contains
õõ( 0
(
õõ0 1
request
õõ1 8
.
õõ8 9
Keyword
õõ9 @
)
õõ@ A
||
úú 
model
úú  
.
úú  !

FileFolder
úú! +
.
úú+ ,
Contains
úú, 4
(
úú4 5
request
úú5 <
.
úú< =
Keyword
úú= D
)
úúD E
||
ùù 
model
ùù  
.
ùù  !

FolderType
ùù! +
==
ùù, .
request
ùù/ 6
.
ùù6 7
Keyword
ùù7 >
)
ûû 
)
ûû 
;
ûû 
var
†† 
data
†† 
=
†† 
await
†† 
Lib
††  
.
††  !

ViewModels
††! +
.
††+ ,
MixTemplates
††, 8
.
††8 9
UpdateViewModel
††9 H
.
††H I

Repository
††I S
.
††S T!
GetModelListByAsync
††T g
(
††g h
	predicate
††h q
,
††q r
request
††s z
.
††z {
OrderBy††{ Ç
,††Ç É
request††Ñ ã
.††ã å
	Direction††å ï
,††ï ñ
request††ó û
.††û ü
PageSize††ü ß
,††ß ®
request††© ∞
.††∞ ±
	PageIndex††± ∫
)††∫ ª
.††ª º
ConfigureAwait††º  
(††  À
false††À –
)††– —
;††— “
return
¢¢ 
data
¢¢ 
;
¢¢ 
}
££ 	
}
¶¶ 
}ßß ∆2
YC:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\BaseApiControoler.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
public 

class 
BaseApiController "
:" #

Controller$ .
{ 
	protected 
readonly 
IHubContext &
<& '
	PortalHub' 0
>0 1
_hubContext2 =
;= >
	protected 
readonly 
IMemoryCache '
_memoryCache( 4
;4 5
	protected 
string 
_lang 
; 
	protected 
string 
_domain  
;  !
public$$ 
BaseApiController$$  
($$  !
IHubContext$$! ,
<$$, -
	PortalHub$$- 6
>$$6 7

hubContext$$8 B
)$$B C
{%% 	
_hubContext&& 
=&& 

hubContext&& $
;&&$ %
}'' 	
public// 
override// 
void// 
OnActionExecuting// .
(//. /"
ActionExecutingContext/// E
context//F M
)//M N
{00 	
GetLanguage11 
(11 
)11 
;11 

AlertAsync22 
(22 
$str22 *
,22* +
$num22, /
)22/ 0
;220 1
base33 
.33 
OnActionExecuting33 "
(33" #
context33# *
)33* +
;33+ ,
}44 	
	protected:: 
void:: 

AlertAsync:: !
(::! "
string::" (
action::) /
,::/ 0
int::1 4
status::5 ;
,::; <
string::= C
message::D K
=::L M
null::N R
)::R S
{;; 	
var<< 
logMsg<< 
=<< 
new<< 
JObject<< $
(<<$ %
)<<% &
{== 
new>> 
	JProperty>> !
(>>! "
$str>>" .
,>>. /
DateTime>>0 8
.>>8 9
UtcNow>>9 ?
)>>? @
,>>@ A
new?? 
	JProperty?? !
(??! "
$str??" (
,??( )
User??* .
.??. /
Identity??/ 7
???7 8
.??8 9
Name??9 =
)??= >
,??> ?
new@@ 
	JProperty@@ !
(@@! "
$str@@" /
,@@/ 0
Request@@1 8
.@@8 9
Path@@9 =
.@@= >
Value@@> C
)@@C D
,@@D E
newAA 
	JPropertyAA !
(AA! "
$strAA" *
,AA* +
actionAA, 2
)AA2 3
,AA3 4
newBB 
	JPropertyBB !
(BB! "
$strBB" *
,BB* +
statusBB, 2
)BB2 3
,BB3 4
newCC 
	JPropertyCC !
(CC! "
$strCC" +
,CC+ ,
messageCC- 4
)CC4 5
}DD 
;DD 
_hubContextEE 
.EE 
ClientsEE 
.EE  
AllEE  #
.EE# $
	SendAsyncEE$ -
(EE- .
$strEE. >
,EE> ?
logMsgEE@ F
)EEF G
;EEG H
}FF 	
	protectedHH 
voidHH "
ParseRequestPagingDateHH -
(HH- .
RequestPagingHH. ;
requestHH< C
)HHC D
{II 	
requestJJ 
.JJ 
FromDateJJ 
=JJ 
requestJJ &
.JJ& '
FromDateJJ' /
.JJ/ 0
HasValueJJ0 8
?JJ9 :
newJJ; >
DateTimeJJ? G
(JJG H
requestJJH O
.JJO P
FromDateJJP X
.JJX Y
ValueJJY ^
.JJ^ _
YearJJ_ c
,JJc d
requestJJe l
.JJl m
FromDateJJm u
.JJu v
ValueJJv {
.JJ{ |
Month	JJ| Å
,
JJÅ Ç
request
JJÉ ä
.
JJä ã
FromDate
JJã ì
.
JJì î
Value
JJî ô
.
JJô ö
Day
JJö ù
)
JJù û
.
JJû ü
ToUniversalTime
JJü Æ
(
JJÆ Ø
)
JJØ ∞
:KK 
defaultKK 
(KK 
DateTimeKK "
?KK" #
)KK# $
;KK$ %
requestLL 
.LL 
ToDateLL 
=LL 
requestLL $
.LL$ %
ToDateLL% +
.LL+ ,
HasValueLL, 4
?LL5 6
newLL7 :
DateTimeLL; C
(LLC D
requestLLD K
.LLK L
ToDateLLL R
.LLR S
ValueLLS X
.LLX Y
YearLLY ]
,LL] ^
requestLL_ f
.LLf g
ToDateLLg m
.LLm n
ValueLLn s
.LLs t
MonthLLt y
,LLy z
request	LL{ Ç
.
LLÇ É
ToDate
LLÉ â
.
LLâ ä
Value
LLä è
.
LLè ê
Day
LLê ì
)
LLì î
.
LLî ï
ToUniversalTime
LLï §
(
LL§ •
)
LL• ¶
.
LL¶ ß
AddDays
LLß Æ
(
LLÆ Ø
$num
LLØ ∞
)
LL∞ ±
:MM 
defaultMM 
(MM 
DateTimeMM "
?MM" #
)MM# $
;MM$ %
}NN 	
	protectedSS 
voidSS 
GetLanguageSS "
(SS" #
)SS# $
{TT 	
_langUU 
=UU 
	RouteDataUU 
?UU 
.UU 
ValuesUU %
[UU% &
$strUU& /
]UU/ 0
!=UU1 3
nullUU4 8
?UU9 :
	RouteDataUU; D
.UUD E
ValuesUUE K
[UUK L
$strUUL U
]UUU V
.UUV W
ToStringUUW _
(UU_ `
)UU` a
:UUb c

MixServiceUUd n
.UUn o
	GetConfigUUo x
<UUx y
stringUUy 
>	UU Ä
(
UUÄ Å
$str
UUÅ ã
)
UUã å
;
UUå ç
ViewBagVV 
.VV 
cultureVV 
=VV 
_langVV #
;VV# $
_domainXX 
=XX 
stringXX 
.XX 
FormatXX #
(XX# $
$strXX$ /
,XX/ 0
RequestXX1 8
.XX8 9
SchemeXX9 ?
,XX? @
RequestXXA H
.XXH I
HostXXI M
)XXM N
;XXN O
}YY 	
}ZZ 
}[[ ∆R
`C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\BaseGenericApiControoler.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
. 
Controllers !
{ 
public 

class $
BaseGenericApiControoler )
<) *

TDbContext* 4
,4 5
TModel6 <
>< =
:> ?

Controller@ J
where 

TDbContext 
: 
	DbContext $
where 
TModel 
: 
class 
{ 
	protected 
readonly 
IHubContext &
<& '
	PortalHub' 0
>0 1
_hubContext2 =
;= >
	protected 
readonly 
IMemoryCache '
_memoryCache( 4
;4 5
	protected 
string 
_lang 
; 
	protected## 
string## 
_domain##  
;##  !
public++ $
BaseGenericApiControoler++ '
(++' (
IMemoryCache++( 4
memoryCache++5 @
,++@ A
IHubContext++B M
<++M N
	PortalHub++N W
>++W X

hubContext++Y c
)++c d
{,, 	
_hubContext-- 
=-- 

hubContext-- $
;--$ %
_memoryCache.. 
=.. 
memoryCache.. &
;..& '
}// 	
public77 
override77 
void77 
OnActionExecuting77 .
(77. /"
ActionExecutingContext77/ E
context77F M
)77M N
{88 	
GetLanguage99 
(99 
)99 
;99 

AlertAsync:: 
(:: 
$str:: *
,::* +
$num::, /
)::/ 0
;::0 1
base;; 
.;; 
OnActionExecuting;; "
(;;" #
context;;# *
);;* +
;;;+ ,
}<< 	
	protectedAA 
asyncAA 
TaskAA 
<AA 
RepositoryResponseAA /
<AA/ 0
TViewAA0 5
>AA5 6
>AA6 7
GetSingleAsyncAA8 F
<AAF G
TViewAAG L
>AAL M
(AAM N
stringAAN T
keyAAU X
,AAX Y

ExpressionAAZ d
<AAd e
FuncAAe i
<AAi j
TModelAAj p
,AAp q
boolAAr v
>AAv w
>AAw x
	predicate	AAy Ç
=
AAÉ Ñ
null
AAÖ â
,
AAâ ä
TModel
AAã ë
model
AAí ó
=
AAò ô
null
AAö û
)
AAû ü
whereBB 
TViewBB 
:BB 
ViewModelBaseBB '
<BB' (

TDbContextBB( 2
,BB2 3
TModelBB4 :
,BB: ;
TViewBB< A
>BBA B
{CC 	
varDD 
getPageDD 
=DD 
newDD 
RepositoryResponseDD 0
<DD0 1
LibDD1 4
.DD4 5

ViewModelsDD5 ?
.DD? @
MixPagesDD@ H
.DDH I
ReadMvcViewModelDDI Y
>DDY Z
(DDZ [
)DD[ \
;DD\ ]
varFF 
cacheKeyFF 
=FF 
$"FF 
{FF 
typeofFF $
(FF$ %
TModelFF% +
)FF+ ,
.FF, -
NameFF- 1
}FF1 2
_FF2 3
{FF3 4
_langFF4 9
}FF9 :
_FF: ;
{FF; <
keyFF< ?
}FF? @
"FF@ A
;FFA B
varGG 
dataGG 
=GG 
_memoryCacheGG #
.GG# $
GetGG$ '
<GG' (
RepositoryResponseGG( :
<GG: ;
TViewGG; @
>GG@ A
>GGA B
(GGB C
cacheKeyGGC K
)GGK L
;GGL M
ifHH 
(HH 
dataHH 
==HH 
nullHH 
)HH 
{II 
ifJJ 
(JJ 
	predicateJJ 
!=JJ  
nullJJ! %
)JJ% &
{KK 
dataLL 
=LL 
awaitLL  
DefaultRepositoryLL! 2
<LL2 3

TDbContextLL3 =
,LL= >
TModelLL? E
,LLE F
TViewLLG L
>LLL M
.LLM N
InstanceLLN V
.LLV W
GetSingleModelAsyncLLW j
(LLj k
	predicateLLk t
)LLt u
;LLu v
_memoryCacheMM  
.MM  !
SetMM! $
<MM$ %
RepositoryResponseMM% 7
<MM7 8
TViewMM8 =
>MM= >
>MM> ?
(MM? @
cacheKeyMM@ H
,MMH I
dataMMJ N
)MMN O
;MMO P
}NN 
elseOO 
{PP 
dataQQ 
=QQ 
newQQ 
RepositoryResponseQQ 1
<QQ1 2
TViewQQ2 7
>QQ7 8
(QQ8 9
)QQ9 :
{RR 
	IsSucceedSS !
=SS" #
trueSS$ (
,SS( )
DataTT 
=TT 
DefaultRepositoryTT 0
<TT0 1

TDbContextTT1 ;
,TT; <
TModelTT= C
,TTC D
TViewTTE J
>TTJ K
.TTK L
InstanceTTL T
.TTT U
	ParseViewTTU ^
(TT^ _
modelTT_ d
)TTd e
}UU 
;UU 
_memoryCacheVV  
.VV  !
SetVV! $
<VV$ %
RepositoryResponseVV% 7
<VV7 8
TViewVV8 =
>VV= >
>VV> ?
(VV? @
cacheKeyVV@ H
,VVH I
dataVVJ N
)VVN O
;VVO P
}WW 
}XX 
returnYY 
dataYY 
;YY 
}ZZ 	
	protected\\ 
void\\ 

AlertAsync\\ !
(\\! "
string\\" (
action\\) /
,\\/ 0
int\\1 4
status\\5 ;
,\\; <
string\\= C
message\\D K
=\\L M
null\\N R
)\\R S
{]] 	
var^^ 
logMsg^^ 
=^^ 
new^^ 
JObject^^ $
(^^$ %
)^^% &
{__ 
new`` 
	JProperty`` !
(``! "
$str``" .
,``. /
DateTime``0 8
.``8 9
UtcNow``9 ?
)``? @
,``@ A
newaa 
	JPropertyaa !
(aa! "
$straa" (
,aa( )
Useraa* .
.aa. /
Identityaa/ 7
?aa7 8
.aa8 9
Nameaa9 =
)aa= >
,aa> ?
newbb 
	JPropertybb !
(bb! "
$strbb" /
,bb/ 0
Requestbb1 8
.bb8 9
Pathbb9 =
.bb= >
Valuebb> C
)bbC D
,bbD E
newcc 
	JPropertycc !
(cc! "
$strcc" *
,cc* +
actioncc, 2
)cc2 3
,cc3 4
newdd 
	JPropertydd !
(dd! "
$strdd" *
,dd* +
statusdd, 2
)dd2 3
,dd3 4
newee 
	JPropertyee !
(ee! "
$stree" +
,ee+ ,
messageee- 4
)ee4 5
}ff 
;ff 
_hubContextgg 
.gg 
Clientsgg 
.gg  
Allgg  #
.gg# $
	SendAsyncgg$ -
(gg- .
$strgg. >
,gg> ?
logMsggg@ F
)ggF G
;ggG H
}hh 	
	protectedjj 
voidjj "
ParseRequestPagingDatejj -
(jj- .
RequestPagingjj. ;
requestjj< C
)jjC D
{kk 	
requestll 
.ll 
FromDatell 
=ll 
requestll &
.ll& '
FromDatell' /
.ll/ 0
HasValuell0 8
?ll9 :
newll; >
DateTimell? G
(llG H
requestllH O
.llO P
FromDatellP X
.llX Y
ValuellY ^
.ll^ _
Yearll_ c
,llc d
requestlle l
.lll m
FromDatellm u
.llu v
Valuellv {
.ll{ |
Month	ll| Å
,
llÅ Ç
request
llÉ ä
.
llä ã
FromDate
llã ì
.
llì î
Value
llî ô
.
llô ö
Day
llö ù
)
llù û
.
llû ü
ToUniversalTime
llü Æ
(
llÆ Ø
)
llØ ∞
:mm 
defaultmm 
(mm 
DateTimemm "
?mm" #
)mm# $
;mm$ %
requestnn 
.nn 
ToDatenn 
=nn 
requestnn $
.nn$ %
ToDatenn% +
.nn+ ,
HasValuenn, 4
?nn5 6
newnn7 :
DateTimenn; C
(nnC D
requestnnD K
.nnK L
ToDatennL R
.nnR S
ValuennS X
.nnX Y
YearnnY ]
,nn] ^
requestnn_ f
.nnf g
ToDatenng m
.nnm n
Valuennn s
.nns t
Monthnnt y
,nny z
request	nn{ Ç
.
nnÇ É
ToDate
nnÉ â
.
nnâ ä
Value
nnä è
.
nnè ê
Day
nnê ì
)
nnì î
.
nnî ï
ToUniversalTime
nnï §
(
nn§ •
)
nn• ¶
.
nn¶ ß
AddDays
nnß Æ
(
nnÆ Ø
$num
nnØ ∞
)
nn∞ ±
:oo 
defaultoo 
(oo 
DateTimeoo "
?oo" #
)oo# $
;oo$ %
}pp 	
	protecteduu 
voiduu 
GetLanguageuu "
(uu" #
)uu# $
{vv 	
_langww 
=ww 
	RouteDataww 
?ww 
.ww 
Valuesww %
[ww% &
$strww& /
]ww/ 0
!=ww1 3
nullww4 8
?ww9 :
	RouteDataww; D
.wwD E
ValueswwE K
[wwK L
$strwwL U
]wwU V
.wwV W
ToStringwwW _
(ww_ `
)ww` a
:wwb c

MixServicewwd n
.wwn o
	GetConfigwwo x
<wwx y
stringwwy 
>	ww Ä
(
wwÄ Å
$str
wwÅ ã
)
wwã å
;
wwå ç
ViewBagxx 
.xx 
culturexx 
=xx 
_langxx #
;xx# $
_domainzz 
=zz 
stringzz 
.zz 
Formatzz #
(zz# $
$strzz$ /
,zz/ 0
Requestzz1 8
.zz8 9
Schemezz9 ?
,zz? @
RequestzzA H
.zzH I
HostzzI M
)zzM N
;zzN O
}{{ 	
}|| 
}}} ù	
@C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Program.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	 
CreateWebHostBuilder  
(  !
args! %
)% &
.& '
Build' ,
(, -
)- .
.. /
Run/ 2
(2 3
)3 4
;4 5
} 	
public 
static 
IWebHostBuilder % 
CreateWebHostBuilder& :
(: ;
string; A
[A B
]B C
argsD H
)H I
=>J L
WebHost 
.  
CreateDefaultBuilder (
(( )
args) -
)- .
. 

UseStartup 
< 
Startup #
># $
($ %
)% &
;& '
} 
} ¥
@C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Startup.cs
	namespace 	
Mix
 
. 
Cms 
. 
Api 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddMvc 
( 
) 
. #
SetCompatibilityVersion 5
(5 6 
CompatibilityVersion6 J
.J K
Version_2_1K V
)V W
;W X
} 	
public   
void   
	Configure   
(   
IApplicationBuilder   1
app  2 5
,  5 6
IHostingEnvironment  7 J
env  K N
)  N O
{!! 	
if"" 
("" 
env"" 
."" 
IsDevelopment"" !
(""! "
)""" #
)""# $
{## 
app$$ 
.$$ %
UseDeveloperExceptionPage$$ -
($$- .
)$$. /
;$$/ 0
}%% 
else&& 
{'' 
app(( 
.(( 
UseHsts(( 
((( 
)(( 
;(( 
})) 
app++ 
.++ 
UseHttpsRedirection++ #
(++# $
)++$ %
;++% &
app,, 
.,, 
UseMvc,, 
(,, 
),, 
;,, 
}-- 	
}.. 
}// 