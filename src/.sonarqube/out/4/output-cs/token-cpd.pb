ï¿½ï¿½
\C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiAccountController.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{ 
[   
	Authorize   
(   !
AuthenticationSchemes   $
=  % &
JwtBearerDefaults  ' 8
.  8 9 
AuthenticationScheme  9 M
)  M N
]  N O
[!! 
Route!! 

(!!
 
$str!! 
)!! 
]!! 
public"" 

class""  
ApiAccountController"" %
:""& '

Controller""( 2
{## 
private$$ 
readonly$$ 
UserManager$$ $
<$$$ %
ApplicationUser$$% 4
>$$4 5
_userManager$$6 B
;$$B C
private%% 
readonly%% 

SignInManager%% &
<%%& '
ApplicationUser%%' 6
>%%6 7
_signInManager%%8 F
;%%F G
private&& 
readonly&& 
RoleManager&& $
<&&$ %
IdentityRole&&% 1
>&&1 2
_roleManager&&3 ?
;&&? @
private'' 
readonly'' 
ILogger''  
_logger''! (
;''( )
public))  
ApiAccountController)) #
())# $
UserManager** 
<** 
ApplicationUser** '
>**' (
userManager**) 4
,**4 5

SignInManager++ 
<++ 
ApplicationUser++ )
>++) *

signInManager+++ 8
,++8 9
RoleManager,, 
<,, 
IdentityRole,, $
>,,$ %
roleManager,,& 1
,,,1 2
ILogger-- 
<--  
ApiAccountController-- (
>--( )
logger--* 0
)--0 1
{.. 	
_userManager// 
=// 
userManager// &
;//& '
_signInManager00 
=00 

signInManager00 *
;00* +
_roleManager11 
=11 
roleManager11 &
;11& '
_logger22 
=22 
logger22 
;22 
}33 	
[55 	
TempData55	 
]55 
public66 
string66 
ErrorMessage66 "
{66# $
get66% (
;66( )
set66* -
;66- .
}66/ 0
[:: 	
	Authorize::	 
(:: !
AuthenticationSchemes:: (
=::) *
JwtBearerDefaults::+ <
.::< = 
AuthenticationScheme::= Q
)::Q R
]::R S
[;; 	
Route;;	 
(;; 
$str;; 
);; 
];; 
[<< 	
HttpGet<<	 
,<< 
HttpPost<< 
,<< 
HttpOptions<< '
]<<' (
public== 
async== 
Task== 
<== 
RepositoryResponse== ,
<==, -
bool==- 1
>==1 2
>==2 3
Logout==4 :
(==: ;
)==; <
{>> 	
var?? 
result?? 
=?? 
new?? 
RepositoryResponse?? /
<??/ 0
bool??0 4
>??4 5
(??5 6
)??6 7
{??8 9
	IsSucceed??: C
=??D E
true??F J
,??J K
Data??L P
=??Q R
true??S W
}??X Y
;??Y Z
await@@ 
_signInManager@@  
.@@  !
SignOutAsync@@! -
(@@- .
)@@. /
.@@/ 0
ConfigureAwait@@0 >
(@@> ?
false@@? D
)@@D E
;@@E F
awaitAA 
HttpContextAA 
.AA 
SignOutAsyncAA *
(AA* +(
CookieAuthenticationDefaultsAA+ G
.AAG H 
AuthenticationSchemeAAH \
)AA\ ]
.AA] ^
ConfigureAwaitAA^ l
(AAl m
falseAAm r
)AAr s
;AAs t
awaitBB !
RefreshTokenViewModelBB '
.BB' (

RepositoryBB( 2
.BB2 3
RemoveModelAsyncBB3 C
(BBC D
rBBD E
=>BBF H
rBBI J
.BBJ K
UsernameBBK S
==BBT V
UserBBW [
.BB[ \
IdentityBB\ d
.BBd e
NameBBe i
)BBi j
;BBj k
returnCC 
resultCC 
;CC 
}DD 	
[FF 	
RouteFF	 
(FF 
$strFF 
)FF 
]FF 
[GG 	
HttpPostGG	 
,GG 
HttpOptionsGG 
]GG 
[HH 	
AllowAnonymousHH	 
]HH 
publicJJ 
asyncJJ 
TaskJJ 
<JJ 
RepositoryResponseJJ ,
<JJ, - 
AccessTokenViewModelJJ- A
>JJA B
>JJB C
LoginJJD I
(JJI J
[JJJ K
FromBodyJJK S
]JJS T
LoginViewModelJJU c
modelJJd i
)JJi j
{KK 	
RepositoryResponseLL 
<LL  
AccessTokenViewModelLL 3
>LL3 4
loginResultLL5 @
=LLA B
newLLC F
RepositoryResponseLLG Y
<LLY Z 
AccessTokenViewModelLLZ n
>LLn o
(LLo p
)LLp q
;LLq r
ifMM 
(MM 

ModelStateMM 
.MM 
IsValidMM "
)MM" #
{NN 

varQQ 
resultQQ 
=QQ 
awaitQQ "
_signInManagerQQ# 1
.QQ1 2
PasswordSignInAsyncQQ2 E
(QQE F
modelRR 
.RR 
UserNameRR "
,RR" #
modelRR$ )
.RR) *
PasswordRR* 2
,RR2 3
isPersistentRR4 @
:RR@ A
modelRRB G
.RRG H

RememberMeRRH R
,RRR S
lockoutOnFailureRRT d
:RRd e
falseRRf k
)RRk l
.RRl m
ConfigureAwaitRRm {
(RR{ |
false	RR| ï¿½
)
RRï¿½ ï¿½
;
RRï¿½ ï¿½
ifSS 
(SS 
resultSS 
.SS 
	SucceededSS $
)SS$ %
{TT 
varUU 
userUU 
=UU 
awaitUU $
_userManagerUU% 1
.UU1 2
FindByNameAsyncUU2 A
(UUA B
modelUUB G
.UUG H
UserNameUUH P
)UUP Q
.UUQ R
ConfigureAwaitUUR `
(UU` a
falseUUa f
)UUf g
;UUg h
varWW 
tokenWW 
=WW 
awaitWW  %$
GenerateAccessTokenAsyncWW& >
(WW> ?
userWW? C
,WWC D
modelWWE J
.WWJ K

RememberMeWWK U
)WWU V
;WWV W
ifXX 
(XX 
tokenXX 
!=XX  
nullXX! %
)XX% &
{YY 
varZZ 
infoZZ  
=ZZ! "
awaitZZ# (
UserInfoViewModelZZ) :
.ZZ: ;

RepositoryZZ; E
.ZZE F
GetSingleModelAsyncZZF Y
(ZZY Z
uZZZ [
=>ZZ\ ^
uZZ_ `
.ZZ` a
UsernameZZa i
==ZZj l
userZZm q
.ZZq r
UserNameZZr z
)ZZz {
;ZZ{ |
if[[ 
([[ 
![[ 
info[[ !
.[[! "
	IsSucceed[[" +
)[[+ ,
{\\ 
info]]  
.]]  !
Data]]! %
=]]& '
new]]( +
UserInfoViewModel]], =
(]]= >
)]]> ?
;]]? @
}^^ 
token__ 
.__ 
UserData__ &
=__' (
info__) -
.__- .
Data__. 2
;__2 3
loginResultaa #
.aa# $
	IsSucceedaa$ -
=aa. /
trueaa0 4
;aa4 5
loginResultbb #
.bb# $
Statusbb$ *
=bb+ ,
$numbb- .
;bb. /
loginResultcc #
.cc# $
Datacc$ (
=cc) *
tokencc+ 0
;cc0 1
_loggerdd 
.dd  
LogInformationdd  .
(dd. /
$strdd/ @
)dd@ A
;ddA B
returnee 
loginResultee *
;ee* +
}ff 
elsegg 
{hh 
returnii 
loginResultii *
;ii* +
}jj 
}kk 
elsell 
{mm 
loginResultnn 
.nn  
Errorsnn  &
.nn& '
Addnn' *
(nn* +
$strnn+ 9
)nn9 :
;nn: ;
returnoo 
loginResultoo &
;oo& '
}pp 
}qq 

elserr 
{ss 

returntt 
loginResulttt "
;tt" #
}uu 

}vv 	
[xx 	
Routexx	 
(xx 
$strxx /
)xx/ 0
]xx0 1
[yy 	
HttpGetyy	 
,yy 
HttpOptionsyy 
]yy 
[zz 	
AllowAnonymouszz	 
]zz 
public{{ 
async{{ 
Task{{ 
<{{ 
RepositoryResponse{{ ,
<{{, - 
AccessTokenViewModel{{- A
>{{A B
>{{B C
RefreshToken{{D P
({{P Q
string{{Q W
refreshTokenId{{X f
){{f g
{|| 	
RepositoryResponse}} 
<}}  
AccessTokenViewModel}} 3
>}}3 4
result}}5 ;
=}}< =
new}}> A
RepositoryResponse}}B T
<}}T U 
AccessTokenViewModel}}U i
>}}i j
(}}j k
)}}k l
;}}l m
var~~ 
getRefreshToken~~ 
=~~  !
await~~" '!
RefreshTokenViewModel~~( =
.~~= >

Repository~~> H
.~~H I
GetSingleModelAsync~~I \
(~~\ ]
t~~] ^
=>~~_ a
t~~b c
.~~c d
Id~~d f
==~~g i
refreshTokenId~~j x
)~~x y
;~~y z
if 
( 
getRefreshToken 
.  
	IsSucceed  )
)) *
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
oldToken
ï¿½ï¿½ 
=
ï¿½ï¿½ 
getRefreshToken
ï¿½ï¿½ .
.
ï¿½ï¿½. /
Data
ï¿½ï¿½/ 3
;
ï¿½ï¿½3 4
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
oldToken
ï¿½ï¿½ 
.
ï¿½ï¿½ 

ExpiresUtc
ï¿½ï¿½ '
>
ï¿½ï¿½( )
DateTime
ï¿½ï¿½* 2
.
ï¿½ï¿½2 3
UtcNow
ï¿½ï¿½3 9
)
ï¿½ï¿½9 :
{
ï¿½ï¿½ 
var
ï¿½ï¿½ 
user
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ $
_userManager
ï¿½ï¿½% 1
.
ï¿½ï¿½1 2
FindByEmailAsync
ï¿½ï¿½2 B
(
ï¿½ï¿½B C
oldToken
ï¿½ï¿½C K
.
ï¿½ï¿½K L
Email
ï¿½ï¿½L Q
)
ï¿½ï¿½Q R
;
ï¿½ï¿½R S
var
ï¿½ï¿½ 
token
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½  %&
GenerateAccessTokenAsync
ï¿½ï¿½& >
(
ï¿½ï¿½> ?
user
ï¿½ï¿½? C
,
ï¿½ï¿½C D
true
ï¿½ï¿½E I
)
ï¿½ï¿½I J
;
ï¿½ï¿½J K
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
token
ï¿½ï¿½ 
!=
ï¿½ï¿½  
null
ï¿½ï¿½! %
)
ï¿½ï¿½% &
{
ï¿½ï¿½ 
await
ï¿½ï¿½ 
oldToken
ï¿½ï¿½ &
.
ï¿½ï¿½& '
RemoveModelAsync
ï¿½ï¿½' 7
(
ï¿½ï¿½7 8
)
ï¿½ï¿½8 9
;
ï¿½ï¿½9 :
}
ï¿½ï¿½ 
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ $
=
ï¿½ï¿½% &
true
ï¿½ï¿½' +
;
ï¿½ï¿½+ ,
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ 
=
ï¿½ï¿½  !
token
ï¿½ï¿½" '
;
ï¿½ï¿½' (
return
ï¿½ï¿½ 
result
ï¿½ï¿½ !
;
ï¿½ï¿½! "
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
await
ï¿½ï¿½ 
oldToken
ï¿½ï¿½ "
.
ï¿½ï¿½" #
RemoveModelAsync
ï¿½ï¿½# 3
(
ï¿½ï¿½3 4
)
ï¿½ï¿½4 5
;
ï¿½ï¿½5 6
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Errors
ï¿½ï¿½ !
.
ï¿½ï¿½! "
Add
ï¿½ï¿½" %
(
ï¿½ï¿½% &
$str
ï¿½ï¿½& 5
)
ï¿½ï¿½5 6
;
ï¿½ï¿½6 7
return
ï¿½ï¿½ 
result
ï¿½ï¿½ !
;
ï¿½ï¿½! "
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 

else
ï¿½ï¿½ 
{
ï¿½ï¿½ 

result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Errors
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Add
ï¿½ï¿½ !
(
ï¿½ï¿½! "
$str
ï¿½ï¿½" 1
)
ï¿½ï¿½1 2
;
ï¿½ï¿½2 3
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
AllowAnonymous
ï¿½ï¿½	 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -"
AccessTokenViewModel
ï¿½ï¿½- A
>
ï¿½ï¿½A B
>
ï¿½ï¿½B C
Register
ï¿½ï¿½D L
(
ï¿½ï¿½L M
[
ï¿½ï¿½M N
FromBody
ï¿½ï¿½N V
]
ï¿½ï¿½V W"
MixRegisterViewModel
ï¿½ï¿½X l
model
ï¿½ï¿½m r
)
ï¿½ï¿½r s
{
ï¿½ï¿½ 	 
RepositoryResponse
ï¿½ï¿½ 
<
ï¿½ï¿½ "
AccessTokenViewModel
ï¿½ï¿½ 3
>
ï¿½ï¿½3 4
result
ï¿½ï¿½5 ;
=
ï¿½ï¿½< =
new
ï¿½ï¿½> A 
RepositoryResponse
ï¿½ï¿½B T
<
ï¿½ï¿½T U"
AccessTokenViewModel
ï¿½ï¿½U i
>
ï¿½ï¿½i j
(
ï¿½ï¿½j k
)
ï¿½ï¿½k l
;
ï¿½ï¿½l m
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 

ModelState
ï¿½ï¿½ 
.
ï¿½ï¿½ 
IsValid
ï¿½ï¿½ "
)
ï¿½ï¿½" #
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
user
ï¿½ï¿½ 
=
ï¿½ï¿½ 
new
ï¿½ï¿½ 
ApplicationUser
ï¿½ï¿½ .
{
ï¿½ï¿½ 
UserName
ï¿½ï¿½ 
=
ï¿½ï¿½ 
model
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Username
ï¿½ï¿½% -
,
ï¿½ï¿½- .
Email
ï¿½ï¿½ 
=
ï¿½ï¿½ 
model
ï¿½ï¿½ !
.
ï¿½ï¿½! "
Email
ï¿½ï¿½" '
,
ï¿½ï¿½' (
	FirstName
ï¿½ï¿½ 
=
ï¿½ï¿½ 
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
	FirstName
ï¿½ï¿½& /
,
ï¿½ï¿½/ 0
LastName
ï¿½ï¿½ 
=
ï¿½ï¿½ 
model
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
LastName
ï¿½ï¿½% -
,
ï¿½ï¿½- .
JoinDate
ï¿½ï¿½ 
=
ï¿½ï¿½ 
DateTime
ï¿½ï¿½ '
.
ï¿½ï¿½' (
UtcNow
ï¿½ï¿½( .
}
ï¿½ï¿½ 
;
ï¿½ï¿½ 
var
ï¿½ï¿½ 
createResult
ï¿½ï¿½  
=
ï¿½ï¿½! "
await
ï¿½ï¿½# (
_userManager
ï¿½ï¿½) 5
.
ï¿½ï¿½5 6
CreateAsync
ï¿½ï¿½6 A
(
ï¿½ï¿½A B
user
ï¿½ï¿½B F
,
ï¿½ï¿½F G
password
ï¿½ï¿½H P
:
ï¿½ï¿½P Q
model
ï¿½ï¿½R W
.
ï¿½ï¿½W X
Password
ï¿½ï¿½X `
)
ï¿½ï¿½` a
.
ï¿½ï¿½a b
ConfigureAwait
ï¿½ï¿½b p
(
ï¿½ï¿½p q
false
ï¿½ï¿½q v
)
ï¿½ï¿½v w
;
ï¿½ï¿½w x
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
createResult
ï¿½ï¿½  
.
ï¿½ï¿½  !
	Succeeded
ï¿½ï¿½! *
)
ï¿½ï¿½* +
{
ï¿½ï¿½ 
_logger
ï¿½ï¿½ 
.
ï¿½ï¿½ 
LogInformation
ï¿½ï¿½ *
(
ï¿½ï¿½* +
$str
ï¿½ï¿½+ V
)
ï¿½ï¿½V W
;
ï¿½ï¿½W X
user
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½  
_userManager
ï¿½ï¿½! -
.
ï¿½ï¿½- .
FindByEmailAsync
ï¿½ï¿½. >
(
ï¿½ï¿½> ?
model
ï¿½ï¿½? D
.
ï¿½ï¿½D E
Email
ï¿½ï¿½E J
)
ï¿½ï¿½J K
.
ï¿½ï¿½K L
ConfigureAwait
ï¿½ï¿½L Z
(
ï¿½ï¿½Z [
false
ï¿½ï¿½[ `
)
ï¿½ï¿½` a
;
ï¿½ï¿½a b
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Id
ï¿½ï¿½ 
=
ï¿½ï¿½ 
user
ï¿½ï¿½ #
.
ï¿½ï¿½# $
Id
ï¿½ï¿½$ &
;
ï¿½ï¿½& '
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
CreatedDateTime
ï¿½ï¿½ )
=
ï¿½ï¿½* +
DateTime
ï¿½ï¿½, 4
.
ï¿½ï¿½4 5
UtcNow
ï¿½ï¿½5 ;
;
ï¿½ï¿½; <
await
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½  
SaveModelAsync
ï¿½ï¿½  .
(
ï¿½ï¿½. /
)
ï¿½ï¿½/ 0
;
ï¿½ï¿½0 1
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
_userManager
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Users
ï¿½ï¿½% *
.
ï¿½ï¿½* +
Count
ï¿½ï¿½+ 0
(
ï¿½ï¿½0 1
)
ï¿½ï¿½1 2
==
ï¿½ï¿½3 5
$num
ï¿½ï¿½6 7
)
ï¿½ï¿½7 8
{
ï¿½ï¿½ 
await
ï¿½ï¿½ 
_userManager
ï¿½ï¿½ *
.
ï¿½ï¿½* +
AddToRoleAsync
ï¿½ï¿½+ 9
(
ï¿½ï¿½9 :
user
ï¿½ï¿½: >
,
ï¿½ï¿½> ?
$str
ï¿½ï¿½@ L
)
ï¿½ï¿½L M
;
ï¿½ï¿½M N
}
ï¿½ï¿½ 
var
ï¿½ï¿½ 
token
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½  %&
GenerateAccessTokenAsync
ï¿½ï¿½& >
(
ï¿½ï¿½> ?
user
ï¿½ï¿½? C
,
ï¿½ï¿½C D
true
ï¿½ï¿½E I
)
ï¿½ï¿½I J
;
ï¿½ï¿½J K
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
token
ï¿½ï¿½ 
!=
ï¿½ï¿½  
null
ï¿½ï¿½! %
)
ï¿½ï¿½% &
{
ï¿½ï¿½ 
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
=
ï¿½ï¿½) *
true
ï¿½ï¿½+ /
;
ï¿½ï¿½/ 0
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ #
=
ï¿½ï¿½$ %
token
ï¿½ï¿½& +
;
ï¿½ï¿½+ ,
_logger
ï¿½ï¿½ 
.
ï¿½ï¿½  
LogInformation
ï¿½ï¿½  .
(
ï¿½ï¿½. /
$str
ï¿½ï¿½/ @
)
ï¿½ï¿½@ A
;
ï¿½ï¿½A B
return
ï¿½ï¿½ 
result
ï¿½ï¿½ %
;
ï¿½ï¿½% &
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
return
ï¿½ï¿½ 
result
ï¿½ï¿½ %
;
ï¿½ï¿½% &
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
foreach
ï¿½ï¿½ 
(
ï¿½ï¿½ 
var
ï¿½ï¿½  
error
ï¿½ï¿½! &
in
ï¿½ï¿½' )
createResult
ï¿½ï¿½* 6
.
ï¿½ï¿½6 7
Errors
ï¿½ï¿½7 =
)
ï¿½ï¿½= >
{
ï¿½ï¿½ 
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Errors
ï¿½ï¿½ %
.
ï¿½ï¿½% &
Add
ï¿½ï¿½& )
(
ï¿½ï¿½) *
error
ï¿½ï¿½* /
.
ï¿½ï¿½/ 0
Description
ï¿½ï¿½0 ;
)
ï¿½ï¿½; <
;
ï¿½ï¿½< =
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
result
ï¿½ï¿½ !
;
ï¿½ï¿½! "
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
	Authorize
ï¿½ï¿½	 
(
ï¿½ï¿½ #
AuthenticationSchemes
ï¿½ï¿½ (
=
ï¿½ï¿½) *
JwtBearerDefaults
ï¿½ï¿½+ <
.
ï¿½ï¿½< ="
AuthenticationScheme
ï¿½ï¿½= Q
,
ï¿½ï¿½Q R
Roles
ï¿½ï¿½ 

=
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
bool
ï¿½ï¿½- 1
>
ï¿½ï¿½1 2
>
ï¿½ï¿½2 3
ManageUserInRole
ï¿½ï¿½4 D
(
ï¿½ï¿½D E
[
ï¿½ï¿½E F
FromBody
ï¿½ï¿½F N
]
ï¿½ï¿½N O

UserRoleModel
ï¿½ï¿½O \
model
ï¿½ï¿½] b
)
ï¿½ï¿½b c
{
ï¿½ï¿½ 	
var
ï¿½ï¿½ 
role
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ 
_roleManager
ï¿½ï¿½ )
.
ï¿½ï¿½) *

FindByIdAsync
ï¿½ï¿½* 7
(
ï¿½ï¿½7 8
model
ï¿½ï¿½8 =
.
ï¿½ï¿½= >
RoleId
ï¿½ï¿½> D
)
ï¿½ï¿½D E
;
ï¿½ï¿½E F
var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ /
<
ï¿½ï¿½/ 0
bool
ï¿½ï¿½0 4
>
ï¿½ï¿½4 5
(
ï¿½ï¿½5 6
)
ï¿½ï¿½6 7
;
ï¿½ï¿½7 8
List
ï¿½ï¿½ 
<
ï¿½ï¿½ 
string
ï¿½ï¿½ 
>
ï¿½ï¿½ 
errors
ï¿½ï¿½ 
=
ï¿½ï¿½  !
new
ï¿½ï¿½" %
List
ï¿½ï¿½& *
<
ï¿½ï¿½* +
string
ï¿½ï¿½+ 1
>
ï¿½ï¿½1 2
(
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
;
ï¿½ï¿½4 5
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
role
ï¿½ï¿½ 
==
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

errors
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Add
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$"
ï¿½ï¿½ 
Role: 
ï¿½ï¿½ #
{
ï¿½ï¿½# $
model
ï¿½ï¿½$ )
.
ï¿½ï¿½) *
RoleId
ï¿½ï¿½* 0
}
ï¿½ï¿½0 1
 does not exists
ï¿½ï¿½1 A
"
ï¿½ï¿½A B
)
ï¿½ï¿½B C
;
ï¿½ï¿½C D
}
ï¿½ï¿½ 

else
ï¿½ï¿½ 
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
IsUserInRole
ï¿½ï¿½ '
)
ï¿½ï¿½' (
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
appUser
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ #
_userManager
ï¿½ï¿½$ 0
.
ï¿½ï¿½0 1

FindByIdAsync
ï¿½ï¿½1 >
(
ï¿½ï¿½> ?
model
ï¿½ï¿½? D
.
ï¿½ï¿½D E
UserId
ï¿½ï¿½E K
)
ï¿½ï¿½K L
;
ï¿½ï¿½L M
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
appUser
ï¿½ï¿½ 
==
ï¿½ï¿½ 
null
ï¿½ï¿½ #
)
ï¿½ï¿½# $
{
ï¿½ï¿½ 
errors
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Add
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$"
ï¿½ï¿½ !
User: 
ï¿½ï¿½! '
{
ï¿½ï¿½' (
model
ï¿½ï¿½( -
.
ï¿½ï¿½- .
UserId
ï¿½ï¿½. 4
}
ï¿½ï¿½4 5
 does not exists
ï¿½ï¿½5 E
"
ï¿½ï¿½E F
)
ï¿½ï¿½F G
;
ï¿½ï¿½G H
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
(
ï¿½ï¿½ 
await
ï¿½ï¿½  
_userManager
ï¿½ï¿½! -
.
ï¿½ï¿½- .

IsInRoleAsync
ï¿½ï¿½. ;
(
ï¿½ï¿½; <
appUser
ï¿½ï¿½< C
,
ï¿½ï¿½C D
role
ï¿½ï¿½E I
.
ï¿½ï¿½I J
Name
ï¿½ï¿½J N
)
ï¿½ï¿½N O
)
ï¿½ï¿½O P
)
ï¿½ï¿½P Q
{
ï¿½ï¿½ 
var
ï¿½ï¿½ 
	addResult
ï¿½ï¿½ !
=
ï¿½ï¿½" #
await
ï¿½ï¿½$ )
_userManager
ï¿½ï¿½* 6
.
ï¿½ï¿½6 7
AddToRoleAsync
ï¿½ï¿½7 E
(
ï¿½ï¿½E F
appUser
ï¿½ï¿½F M
,
ï¿½ï¿½M N
role
ï¿½ï¿½O S
.
ï¿½ï¿½S T
Name
ï¿½ï¿½T X
)
ï¿½ï¿½X Y
;
ï¿½ï¿½Y Z
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
	addResult
ï¿½ï¿½ "
.
ï¿½ï¿½" #
	Succeeded
ï¿½ï¿½# ,
)
ï¿½ï¿½, -
{
ï¿½ï¿½ 
errors
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Add
ï¿½ï¿½ "
(
ï¿½ï¿½" #
$"
ï¿½ï¿½# %
User: 
ï¿½ï¿½% +
{
ï¿½ï¿½+ ,
model
ï¿½ï¿½, 1
.
ï¿½ï¿½1 2
UserId
ï¿½ï¿½2 8
}
ï¿½ï¿½8 9)
 could not be added to role
ï¿½ï¿½9 T
"
ï¿½ï¿½T U
)
ï¿½ï¿½U V
;
ï¿½ï¿½V W
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 

else
ï¿½ï¿½ 
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
appUser
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ #
_userManager
ï¿½ï¿½$ 0
.
ï¿½ï¿½0 1

FindByIdAsync
ï¿½ï¿½1 >
(
ï¿½ï¿½> ?
model
ï¿½ï¿½? D
.
ï¿½ï¿½D E
UserId
ï¿½ï¿½E K
)
ï¿½ï¿½K L
;
ï¿½ï¿½L M
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
appUser
ï¿½ï¿½ 
==
ï¿½ï¿½ 
null
ï¿½ï¿½ #
)
ï¿½ï¿½# $
{
ï¿½ï¿½ 
errors
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Add
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$"
ï¿½ï¿½ !
User: 
ï¿½ï¿½! '
{
ï¿½ï¿½' (
model
ï¿½ï¿½( -
.
ï¿½ï¿½- .
UserId
ï¿½ï¿½. 4
}
ï¿½ï¿½4 5
 does not exists
ï¿½ï¿½5 E
"
ï¿½ï¿½E F
)
ï¿½ï¿½F G
;
ï¿½ï¿½G H
}
ï¿½ï¿½ 
var
ï¿½ï¿½ 
removeResult
ï¿½ï¿½  
=
ï¿½ï¿½! "
await
ï¿½ï¿½# (
_userManager
ï¿½ï¿½) 5
.
ï¿½ï¿½5 6!
RemoveFromRoleAsync
ï¿½ï¿½6 I
(
ï¿½ï¿½I J
appUser
ï¿½ï¿½J Q
,
ï¿½ï¿½Q R
role
ï¿½ï¿½S W
.
ï¿½ï¿½W X
Name
ï¿½ï¿½X \
)
ï¿½ï¿½\ ]
;
ï¿½ï¿½] ^
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
removeResult
ï¿½ï¿½ !
.
ï¿½ï¿½! "
	Succeeded
ï¿½ï¿½" +
)
ï¿½ï¿½+ ,
{
ï¿½ï¿½ 
errors
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Add
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$"
ï¿½ï¿½ !
User: 
ï¿½ï¿½! '
{
ï¿½ï¿½' (
model
ï¿½ï¿½( -
.
ï¿½ï¿½- .
UserId
ï¿½ï¿½. 4
}
ï¿½ï¿½4 5-
 could not be removed from role
ï¿½ï¿½5 T
"
ï¿½ï¿½T U
)
ï¿½ï¿½U V
;
ï¿½ï¿½V W
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 

result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ 
=
ï¿½ï¿½ 
errors
ï¿½ï¿½ %
.
ï¿½ï¿½% &
Count
ï¿½ï¿½& +
==
ï¿½ï¿½, .
$num
ï¿½ï¿½/ 0
;
ï¿½ï¿½0 1
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
errors
ï¿½ï¿½  
.
ï¿½ï¿½  !
Count
ï¿½ï¿½! &
==
ï¿½ï¿½' )
$num
ï¿½ï¿½* +
;
ï¿½ï¿½+ ,
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Errors
ï¿½ï¿½ 
=
ï¿½ï¿½ 
errors
ï¿½ï¿½ "
;
ï¿½ï¿½" #
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpGet
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ (
)
ï¿½ï¿½( )
]
ï¿½ï¿½) *
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ #
)
ï¿½ï¿½# $
]
ï¿½ï¿½$ %
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ 
JObject
ï¿½ï¿½ !
>
ï¿½ï¿½! "
Details
ï¿½ï¿½# *
(
ï¿½ï¿½* +
string
ï¿½ï¿½+ 1
viewType
ï¿½ï¿½2 :
,
ï¿½ï¿½: ;
string
ï¿½ï¿½< B
id
ï¿½ï¿½C E
=
ï¿½ï¿½F G
null
ï¿½ï¿½H L
)
ï¿½ï¿½L M
{
ï¿½ï¿½ 	
switch
ï¿½ï¿½ 
(
ï¿½ï¿½ 
viewType
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

case
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
:
ï¿½ï¿½ 
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
string
ï¿½ï¿½ 
.
ï¿½ï¿½  

IsNullOrEmpty
ï¿½ï¿½  -
(
ï¿½ï¿½- .
id
ï¿½ï¿½. 0
)
ï¿½ï¿½0 1
)
ï¿½ï¿½1 2
{
ï¿½ï¿½ 
var
ï¿½ï¿½ 
beResult
ï¿½ï¿½ $
=
ï¿½ï¿½% &
await
ï¿½ï¿½' ,"
MixRegisterViewModel
ï¿½ï¿½- A
.
ï¿½ï¿½A B

Repository
ï¿½ï¿½B L
.
ï¿½ï¿½L M!
GetSingleModelAsync
ï¿½ï¿½M `
(
ï¿½ï¿½` a
model
ï¿½ï¿½ !
=>
ï¿½ï¿½" $
model
ï¿½ï¿½% *
.
ï¿½ï¿½* +
Id
ï¿½ï¿½+ -
==
ï¿½ï¿½. 0
id
ï¿½ï¿½1 3
)
ï¿½ï¿½3 4
.
ï¿½ï¿½4 5
ConfigureAwait
ï¿½ï¿½5 C
(
ï¿½ï¿½C D
false
ï¿½ï¿½D I
)
ï¿½ï¿½I J
;
ï¿½ï¿½J K
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ &
.
ï¿½ï¿½& '

FromObject
ï¿½ï¿½' 1
(
ï¿½ï¿½1 2
beResult
ï¿½ï¿½2 :
)
ï¿½ï¿½: ;
;
ï¿½ï¿½; <
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
var
ï¿½ï¿½ 
model
ï¿½ï¿½ !
=
ï¿½ï¿½" #
new
ï¿½ï¿½$ '

MixCmsUser
ï¿½ï¿½( 2
(
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
{
ï¿½ï¿½5 6
Status
ï¿½ï¿½7 =
=
ï¿½ï¿½> ?
(
ï¿½ï¿½@ A
int
ï¿½ï¿½A D
)
ï¿½ï¿½D E

MixUserStatus
ï¿½ï¿½E R
.
ï¿½ï¿½R S
Actived
ï¿½ï¿½S Z
}
ï¿½ï¿½[ \
;
ï¿½ï¿½\ ] 
RepositoryResponse
ï¿½ï¿½ *
<
ï¿½ï¿½* +"
MixRegisterViewModel
ï¿½ï¿½+ ?
>
ï¿½ï¿½? @
result
ï¿½ï¿½A G
=
ï¿½ï¿½H I
new
ï¿½ï¿½J M 
RepositoryResponse
ï¿½ï¿½N `
<
ï¿½ï¿½` a"
MixRegisterViewModel
ï¿½ï¿½a u
>
ï¿½ï¿½u v
(
ï¿½ï¿½v w
)
ï¿½ï¿½w x
{
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ %
=
ï¿½ï¿½& '
true
ï¿½ï¿½( ,
,
ï¿½ï¿½, -
Data
ï¿½ï¿½  
=
ï¿½ï¿½! "
await
ï¿½ï¿½# ("
MixRegisterViewModel
ï¿½ï¿½) =
.
ï¿½ï¿½= >

InitViewAsync
ï¿½ï¿½> K
(
ï¿½ï¿½K L
model
ï¿½ï¿½L Q
)
ï¿½ï¿½Q R
}
ï¿½ï¿½ 
;
ï¿½ï¿½ 
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ &
.
ï¿½ï¿½& '

FromObject
ï¿½ï¿½' 1
(
ï¿½ï¿½1 2
result
ï¿½ï¿½2 8
)
ï¿½ï¿½8 9
;
ï¿½ï¿½9 :
}
ï¿½ï¿½ 
default
ï¿½ï¿½ 
:
ï¿½ï¿½ 
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
string
ï¿½ï¿½ 
.
ï¿½ï¿½  

IsNullOrEmpty
ï¿½ï¿½  -
(
ï¿½ï¿½- .
id
ï¿½ï¿½. 0
)
ï¿½ï¿½0 1
)
ï¿½ï¿½1 2
{
ï¿½ï¿½ 
var
ï¿½ï¿½ 
beResult
ï¿½ï¿½ $
=
ï¿½ï¿½% &
await
ï¿½ï¿½' ,
UserInfoViewModel
ï¿½ï¿½- >
.
ï¿½ï¿½> ?

Repository
ï¿½ï¿½? I
.
ï¿½ï¿½I J!
GetSingleModelAsync
ï¿½ï¿½J ]
(
ï¿½ï¿½] ^
model
ï¿½ï¿½ !
=>
ï¿½ï¿½" $
model
ï¿½ï¿½% *
.
ï¿½ï¿½* +
Id
ï¿½ï¿½+ -
==
ï¿½ï¿½. 0
id
ï¿½ï¿½1 3
)
ï¿½ï¿½3 4
.
ï¿½ï¿½4 5
ConfigureAwait
ï¿½ï¿½5 C
(
ï¿½ï¿½C D
false
ï¿½ï¿½D I
)
ï¿½ï¿½I J
;
ï¿½ï¿½J K
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ &
.
ï¿½ï¿½& '

FromObject
ï¿½ï¿½' 1
(
ï¿½ï¿½1 2
beResult
ï¿½ï¿½2 :
)
ï¿½ï¿½: ;
;
ï¿½ï¿½; <
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
var
ï¿½ï¿½ 
model
ï¿½ï¿½ !
=
ï¿½ï¿½" #
new
ï¿½ï¿½$ '

MixCmsUser
ï¿½ï¿½( 2
(
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
{
ï¿½ï¿½5 6
Status
ï¿½ï¿½7 =
=
ï¿½ï¿½> ?
(
ï¿½ï¿½@ A
int
ï¿½ï¿½A D
)
ï¿½ï¿½D E

MixUserStatus
ï¿½ï¿½E R
.
ï¿½ï¿½R S
Actived
ï¿½ï¿½S Z
}
ï¿½ï¿½[ \
;
ï¿½ï¿½\ ] 
RepositoryResponse
ï¿½ï¿½ *
<
ï¿½ï¿½* +
UserInfoViewModel
ï¿½ï¿½+ <
>
ï¿½ï¿½< =
result
ï¿½ï¿½> D
=
ï¿½ï¿½E F
new
ï¿½ï¿½G J 
RepositoryResponse
ï¿½ï¿½K ]
<
ï¿½ï¿½] ^
UserInfoViewModel
ï¿½ï¿½^ o
>
ï¿½ï¿½o p
(
ï¿½ï¿½p q
)
ï¿½ï¿½q r
{
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ %
=
ï¿½ï¿½& '
true
ï¿½ï¿½( ,
,
ï¿½ï¿½, -
Data
ï¿½ï¿½  
=
ï¿½ï¿½! "
await
ï¿½ï¿½# (
UserInfoViewModel
ï¿½ï¿½) :
.
ï¿½ï¿½: ;

InitViewAsync
ï¿½ï¿½; H
(
ï¿½ï¿½H I
model
ï¿½ï¿½I N
)
ï¿½ï¿½N O
}
ï¿½ï¿½ 
;
ï¿½ï¿½ 
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ &
.
ï¿½ï¿½& '

FromObject
ï¿½ï¿½' 1
(
ï¿½ï¿½1 2
result
ï¿½ï¿½2 8
)
ï¿½ï¿½8 9
;
ï¿½ï¿½9 :
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 

}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
UserInfoViewModel
ï¿½ï¿½- >
>
ï¿½ï¿½> ?
>
ï¿½ï¿½? @
Save
ï¿½ï¿½A E
(
ï¿½ï¿½E F
[
ï¿½ï¿½ 

FromBody
ï¿½ï¿½
 
]
ï¿½ï¿½ 
UserInfoViewModel
ï¿½ï¿½ (
model
ï¿½ï¿½) .
)
ï¿½ï¿½. /
{
ï¿½ï¿½ 	
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ "
model
ï¿½ï¿½# (
.
ï¿½ï¿½( )
SaveModelAsync
ï¿½ï¿½) 7
(
ï¿½ï¿½7 8
true
ï¿½ï¿½8 <
)
ï¿½ï¿½< =
.
ï¿½ï¿½= >
ConfigureAwait
ï¿½ï¿½> L
(
ï¿½ï¿½L M
false
ï¿½ï¿½M R
)
ï¿½ï¿½R S
;
ï¿½ï¿½S T
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
UserInfoViewModel
ï¿½ï¿½* ;
>
ï¿½ï¿½; <
(
ï¿½ï¿½< =
)
ï¿½ï¿½= >
;
ï¿½ï¿½> ?
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
PaginationModel
ï¿½ï¿½- <
<
ï¿½ï¿½< =
UserInfoViewModel
ï¿½ï¿½= N
>
ï¿½ï¿½N O
>
ï¿½ï¿½O P
>
ï¿½ï¿½P Q
GetList
ï¿½ï¿½R Y
(
ï¿½ï¿½Y Z

RequestPaging
ï¿½ï¿½Z g
request
ï¿½ï¿½h o
)
ï¿½ï¿½o p
{
ï¿½ï¿½ 	

Expression
ï¿½ï¿½ 
<
ï¿½ï¿½ 
Func
ï¿½ï¿½ 
<
ï¿½ï¿½ 

MixCmsUser
ï¿½ï¿½ &
,
ï¿½ï¿½& '
bool
ï¿½ï¿½( ,
>
ï¿½ï¿½, -
>
ï¿½ï¿½- .
	predicate
ï¿½ï¿½/ 8
=
ï¿½ï¿½9 :
model
ï¿½ï¿½; @
=>
ï¿½ï¿½A C
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Status
ï¿½ï¿½  
.
ï¿½ï¿½  !
HasValue
ï¿½ï¿½! )
||
ï¿½ï¿½* ,
model
ï¿½ï¿½- 2
.
ï¿½ï¿½2 3
Status
ï¿½ï¿½3 9
==
ï¿½ï¿½: <
request
ï¿½ï¿½= D
.
ï¿½ï¿½D E
Status
ï¿½ï¿½E K
.
ï¿½ï¿½K L
Value
ï¿½ï¿½L Q
)
ï¿½ï¿½Q R
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
string
ï¿½ï¿½ 
.
ï¿½ï¿½  
IsNullOrWhiteSpace
ï¿½ï¿½ -
(
ï¿½ï¿½- .
request
ï¿½ï¿½. 5
.
ï¿½ï¿½5 6
Keyword
ï¿½ï¿½6 =
)
ï¿½ï¿½= >
||
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Username
ï¿½ï¿½ "
.
ï¿½ï¿½" #
Contains
ï¿½ï¿½# +
(
ï¿½ï¿½+ ,
request
ï¿½ï¿½, 3
.
ï¿½ï¿½3 4
Keyword
ï¿½ï¿½4 ;
)
ï¿½ï¿½; <
||
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	FirstName
ï¿½ï¿½ %
.
ï¿½ï¿½% &
Contains
ï¿½ï¿½& .
(
ï¿½ï¿½. /
request
ï¿½ï¿½/ 6
.
ï¿½ï¿½6 7
Keyword
ï¿½ï¿½7 >
)
ï¿½ï¿½> ?
||
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
LastName
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Contains
ï¿½ï¿½% -
(
ï¿½ï¿½- .
request
ï¿½ï¿½. 5
.
ï¿½ï¿½5 6
Keyword
ï¿½ï¿½6 =
)
ï¿½ï¿½= >
)
ï¿½ï¿½ 
)
ï¿½ï¿½ 
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
FromDate
ï¿½ï¿½ %
.
ï¿½ï¿½% &
HasValue
ï¿½ï¿½& .
||
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
CreatedDateTime
ï¿½ï¿½ -
>=
ï¿½ï¿½. 0
request
ï¿½ï¿½1 8
.
ï¿½ï¿½8 9
FromDate
ï¿½ï¿½9 A
.
ï¿½ï¿½A B
Value
ï¿½ï¿½B G
.
ï¿½ï¿½G H
ToUniversalTime
ï¿½ï¿½H W
(
ï¿½ï¿½W X
)
ï¿½ï¿½X Y
)
ï¿½ï¿½Y Z
)
ï¿½ï¿½ 
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
ToDate
ï¿½ï¿½ #
.
ï¿½ï¿½# $
HasValue
ï¿½ï¿½$ ,
||
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
CreatedDateTime
ï¿½ï¿½ -
<=
ï¿½ï¿½. 0
request
ï¿½ï¿½1 8
.
ï¿½ï¿½8 9
ToDate
ï¿½ï¿½9 ?
.
ï¿½ï¿½? @
Value
ï¿½ï¿½@ E
.
ï¿½ï¿½E F
ToUniversalTime
ï¿½ï¿½F U
(
ï¿½ï¿½U V
)
ï¿½ï¿½V W
)
ï¿½ï¿½W X
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
var
ï¿½ï¿½ 
data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ 
UserInfoViewModel
ï¿½ï¿½ .
.
ï¿½ï¿½. /

Repository
ï¿½ï¿½/ 9
.
ï¿½ï¿½9 :!
GetModelListByAsync
ï¿½ï¿½: M
(
ï¿½ï¿½M N
	predicate
ï¿½ï¿½N W
,
ï¿½ï¿½W X
request
ï¿½ï¿½Y `
.
ï¿½ï¿½` a
OrderBy
ï¿½ï¿½a h
,
ï¿½ï¿½h i
request
ï¿½ï¿½j q
.
ï¿½ï¿½q r
	Direction
ï¿½ï¿½r {
,
ï¿½ï¿½{ |
requestï¿½ï¿½} ï¿½
.ï¿½ï¿½ï¿½ ï¿½
PageSizeï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	PageIndexï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
data
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

data
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Items
ï¿½ï¿½ 
.
ï¿½ï¿½  
ForEach
ï¿½ï¿½  '
(
ï¿½ï¿½' (
a
ï¿½ï¿½( )
=>
ï¿½ï¿½* ,
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½  
=
ï¿½ï¿½! "
MixCmsHelper
ï¿½ï¿½# /
.
ï¿½ï¿½/ 0
GetRouterUrl
ï¿½ï¿½0 <
(
ï¿½ï¿½< =
$str
ï¿½ï¿½ !
,
ï¿½ï¿½! "
new
ï¿½ï¿½# &
{
ï¿½ï¿½' (
a
ï¿½ï¿½) *
.
ï¿½ï¿½* +
Id
ï¿½ï¿½+ -
}
ï¿½ï¿½. /
,
ï¿½ï¿½/ 0
Request
ï¿½ï¿½1 8
,
ï¿½ï¿½8 9
Url
ï¿½ï¿½: =
)
ï¿½ï¿½= >
;
ï¿½ï¿½> ?
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
data
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
private
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ "
AccessTokenViewModel
ï¿½ï¿½ /
>
ï¿½ï¿½/ 0&
GenerateAccessTokenAsync
ï¿½ï¿½1 I
(
ï¿½ï¿½I J
ApplicationUser
ï¿½ï¿½J Y
user
ï¿½ï¿½Z ^
,
ï¿½ï¿½^ _
bool
ï¿½ï¿½` d

isRemember
ï¿½ï¿½e o
)
ï¿½ï¿½o p
{
ï¿½ï¿½ 	
var
ï¿½ï¿½ 
dtIssued
ï¿½ï¿½ 
=
ï¿½ï¿½ 
DateTime
ï¿½ï¿½ #
.
ï¿½ï¿½# $
UtcNow
ï¿½ï¿½$ *
;
ï¿½ï¿½* +
var
ï¿½ï¿½ 
	dtExpired
ï¿½ï¿½ 
=
ï¿½ï¿½ 
dtIssued
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
AddDays
ï¿½ï¿½% ,
(
ï¿½ï¿½, -

MixService
ï¿½ï¿½- 7
.
ï¿½ï¿½7 8

GetAuthConfig
ï¿½ï¿½8 E
<
ï¿½ï¿½E F
int
ï¿½ï¿½F I
>
ï¿½ï¿½I J
(
ï¿½ï¿½J K
$str
ï¿½ï¿½K ]
)
ï¿½ï¿½] ^
)
ï¿½ï¿½^ _
;
ï¿½ï¿½_ `
var
ï¿½ï¿½ #
dtRefreshTokenExpired
ï¿½ï¿½ %
=
ï¿½ï¿½& '
dtIssued
ï¿½ï¿½( 0
.
ï¿½ï¿½0 1
AddDays
ï¿½ï¿½1 8
(
ï¿½ï¿½8 9

MixService
ï¿½ï¿½9 C
.
ï¿½ï¿½C D

GetAuthConfig
ï¿½ï¿½D Q
<
ï¿½ï¿½Q R
int
ï¿½ï¿½R U
>
ï¿½ï¿½U V
(
ï¿½ï¿½V W
$str
ï¿½ï¿½W o
)
ï¿½ï¿½o p
)
ï¿½ï¿½p q
;
ï¿½ï¿½q r
string
ï¿½ï¿½ 
refreshTokenId
ï¿½ï¿½ !
=
ï¿½ï¿½" #
string
ï¿½ï¿½$ *
.
ï¿½ï¿½* +
Empty
ï¿½ï¿½+ 0
;
ï¿½ï¿½0 1
string
ï¿½ï¿½ 
refreshToken
ï¿½ï¿½ 
=
ï¿½ï¿½  !
string
ï¿½ï¿½" (
.
ï¿½ï¿½( )
Empty
ï¿½ï¿½) .
;
ï¿½ï¿½. /
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 

isRemember
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

refreshToken
ï¿½ï¿½ 
=
ï¿½ï¿½ 
Guid
ï¿½ï¿½ #
.
ï¿½ï¿½# $
NewGuid
ï¿½ï¿½$ +
(
ï¿½ï¿½+ ,
)
ï¿½ï¿½, -
.
ï¿½ï¿½- .
ToString
ï¿½ï¿½. 6
(
ï¿½ï¿½6 7
)
ï¿½ï¿½7 8
;
ï¿½ï¿½8 9#
RefreshTokenViewModel
ï¿½ï¿½ %
vmRefreshToken
ï¿½ï¿½& 4
=
ï¿½ï¿½5 6
new
ï¿½ï¿½7 :#
RefreshTokenViewModel
ï¿½ï¿½; P
(
ï¿½ï¿½P Q
new
ï¿½ï¿½ 

RefreshTokens
ï¿½ï¿½  -
(
ï¿½ï¿½- .
)
ï¿½ï¿½. /
{
ï¿½ï¿½ 
Id
ï¿½ï¿½  "
=
ï¿½ï¿½# $
refreshToken
ï¿½ï¿½% 1
,
ï¿½ï¿½1 2
Email
ï¿½ï¿½  %
=
ï¿½ï¿½& '
user
ï¿½ï¿½( ,
.
ï¿½ï¿½, -
Email
ï¿½ï¿½- 2
,
ï¿½ï¿½2 3
	IssuedUtc
ï¿½ï¿½  )
=
ï¿½ï¿½* +
dtIssued
ï¿½ï¿½, 4
,
ï¿½ï¿½4 5
ClientId
ï¿½ï¿½  (
=
ï¿½ï¿½) *

MixService
ï¿½ï¿½+ 5
.
ï¿½ï¿½5 6

GetAuthConfig
ï¿½ï¿½6 C
<
ï¿½ï¿½C D
string
ï¿½ï¿½D J
>
ï¿½ï¿½J K
(
ï¿½ï¿½K L
$str
ï¿½ï¿½L V
)
ï¿½ï¿½V W
,
ï¿½ï¿½W X
Username
ï¿½ï¿½  (
=
ï¿½ï¿½) *
user
ï¿½ï¿½+ /
.
ï¿½ï¿½/ 0
UserName
ï¿½ï¿½0 8
,
ï¿½ï¿½8 9

ExpiresUtc
ï¿½ï¿½  *
=
ï¿½ï¿½+ ,#
dtRefreshTokenExpired
ï¿½ï¿½- B
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
var
ï¿½ï¿½ $
saveRefreshTokenResult
ï¿½ï¿½ *
=
ï¿½ï¿½+ ,
await
ï¿½ï¿½- 2
vmRefreshToken
ï¿½ï¿½3 A
.
ï¿½ï¿½A B
SaveModelAsync
ï¿½ï¿½B P
(
ï¿½ï¿½P Q
)
ï¿½ï¿½Q R
;
ï¿½ï¿½R S
refreshTokenId
ï¿½ï¿½ 
=
ï¿½ï¿½  $
saveRefreshTokenResult
ï¿½ï¿½! 7
.
ï¿½ï¿½7 8
Data
ï¿½ï¿½8 <
?
ï¿½ï¿½< =
.
ï¿½ï¿½= >
Id
ï¿½ï¿½> @
;
ï¿½ï¿½@ A
}
ï¿½ï¿½ 
"
AccessTokenViewModel
ï¿½ï¿½  
token
ï¿½ï¿½! &
=
ï¿½ï¿½' (
new
ï¿½ï¿½) ,"
AccessTokenViewModel
ï¿½ï¿½- A
(
ï¿½ï¿½A B
)
ï¿½ï¿½B C
{
ï¿½ï¿½ 

Access_token
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ $ 
GenerateTokenAsync
ï¿½ï¿½% 7
(
ï¿½ï¿½7 8
user
ï¿½ï¿½8 <
,
ï¿½ï¿½< =
	dtExpired
ï¿½ï¿½> G
,
ï¿½ï¿½G H
refreshToken
ï¿½ï¿½I U
)
ï¿½ï¿½U V
,
ï¿½ï¿½V W

Refresh_token
ï¿½ï¿½ 
=
ï¿½ï¿½ 
refreshTokenId
ï¿½ï¿½  .
,
ï¿½ï¿½. /

Token_type
ï¿½ï¿½ 
=
ï¿½ï¿½ 

MixService
ï¿½ï¿½ '
.
ï¿½ï¿½' (

GetAuthConfig
ï¿½ï¿½( 5
<
ï¿½ï¿½5 6
string
ï¿½ï¿½6 <
>
ï¿½ï¿½< =
(
ï¿½ï¿½= >
$str
ï¿½ï¿½> I
)
ï¿½ï¿½I J
,
ï¿½ï¿½J K

Expires_in
ï¿½ï¿½ 
=
ï¿½ï¿½ 

MixService
ï¿½ï¿½ '
.
ï¿½ï¿½' (

GetAuthConfig
ï¿½ï¿½( 5
<
ï¿½ï¿½5 6
int
ï¿½ï¿½6 9
>
ï¿½ï¿½9 :
(
ï¿½ï¿½: ;
$str
ï¿½ï¿½; M
)
ï¿½ï¿½M N
,
ï¿½ï¿½N O
Issued
ï¿½ï¿½ 
=
ï¿½ï¿½ 
dtIssued
ï¿½ï¿½ !
,
ï¿½ï¿½! "
Expires
ï¿½ï¿½ 
=
ï¿½ï¿½ 
	dtExpired
ï¿½ï¿½ #
,
ï¿½ï¿½# $
}
ï¿½ï¿½ 

;
ï¿½ï¿½
 
return
ï¿½ï¿½ 
token
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
private
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ 
string
ï¿½ï¿½ !
>
ï¿½ï¿½! " 
GenerateTokenAsync
ï¿½ï¿½# 5
(
ï¿½ï¿½5 6
ApplicationUser
ï¿½ï¿½6 E
user
ï¿½ï¿½F J
,
ï¿½ï¿½J K
DateTime
ï¿½ï¿½L T
expires
ï¿½ï¿½U \
,
ï¿½ï¿½\ ]
string
ï¿½ï¿½^ d
refreshToken
ï¿½ï¿½e q
)
ï¿½ï¿½q r
{
ï¿½ï¿½ 	
List
ï¿½ï¿½ 
<
ï¿½ï¿½ 
Claim
ï¿½ï¿½ 
>
ï¿½ï¿½ 
claims
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &
GetClaimsAsync
ï¿½ï¿½' 5
(
ï¿½ï¿½5 6
user
ï¿½ï¿½6 :
)
ï¿½ï¿½: ;
;
ï¿½ï¿½; <
claims
ï¿½ï¿½ 
.
ï¿½ï¿½ 
AddRange
ï¿½ï¿½ 
(
ï¿½ï¿½ 
new
ï¿½ï¿½ 
[
ï¿½ï¿½  
]
ï¿½ï¿½  !
{
ï¿½ï¿½ 
new
ï¿½ï¿½ 
Claim
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ "
,
ï¿½ï¿½" #
user
ï¿½ï¿½$ (
.
ï¿½ï¿½( )
Id
ï¿½ï¿½) +
.
ï¿½ï¿½+ ,
ToString
ï¿½ï¿½, 4
(
ï¿½ï¿½4 5
)
ï¿½ï¿½5 6
)
ï¿½ï¿½6 7
,
ï¿½ï¿½7 8
new
ï¿½ï¿½ 
Claim
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ (
,
ï¿½ï¿½( )
user
ï¿½ï¿½* .
.
ï¿½ï¿½. /
UserName
ï¿½ï¿½/ 7
)
ï¿½ï¿½7 8
,
ï¿½ï¿½8 9
new
ï¿½ï¿½ 
Claim
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ ,
,
ï¿½ï¿½, -
refreshToken
ï¿½ï¿½. :
)
ï¿½ï¿½: ;
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
JwtSecurityToken
ï¿½ï¿½ 
jwtSecurityToken
ï¿½ï¿½ -
=
ï¿½ï¿½. /
new
ï¿½ï¿½0 3
JwtSecurityToken
ï¿½ï¿½4 D
(
ï¿½ï¿½D E
issuer
ï¿½ï¿½ 
:
ï¿½ï¿½ 

MixService
ï¿½ï¿½ "
.
ï¿½ï¿½" #

GetAuthConfig
ï¿½ï¿½# 0
<
ï¿½ï¿½0 1
string
ï¿½ï¿½1 7
>
ï¿½ï¿½7 8
(
ï¿½ï¿½8 9
$str
ï¿½ï¿½9 A
)
ï¿½ï¿½A B
,
ï¿½ï¿½B C
audience
ï¿½ï¿½ 
:
ï¿½ï¿½ 

MixService
ï¿½ï¿½ $
.
ï¿½ï¿½$ %

GetAuthConfig
ï¿½ï¿½% 2
<
ï¿½ï¿½2 3
string
ï¿½ï¿½3 9
>
ï¿½ï¿½9 :
(
ï¿½ï¿½: ;
$str
ï¿½ï¿½; E
)
ï¿½ï¿½E F
,
ï¿½ï¿½F G
	notBefore
ï¿½ï¿½ 
:
ï¿½ï¿½ 
DateTime
ï¿½ï¿½ #
.
ï¿½ï¿½# $
UtcNow
ï¿½ï¿½$ *
,
ï¿½ï¿½* +
claims
ï¿½ï¿½ 
:
ï¿½ï¿½ 
claims
ï¿½ï¿½ 
,
ï¿½ï¿½ 
expires
ï¿½ï¿½ 
:
ï¿½ï¿½ 
expires
ï¿½ï¿½  
,
ï¿½ï¿½  ! 
signingCredentials
ï¿½ï¿½ "
:
ï¿½ï¿½" #
new
ï¿½ï¿½$ ' 
SigningCredentials
ï¿½ï¿½( :
(
ï¿½ï¿½: ;
JwtSecurityKey
ï¿½ï¿½; I
.
ï¿½ï¿½I J
Create
ï¿½ï¿½J P
(
ï¿½ï¿½P Q

MixService
ï¿½ï¿½Q [
.
ï¿½ï¿½[ \

GetAuthConfig
ï¿½ï¿½\ i
<
ï¿½ï¿½i j
string
ï¿½ï¿½j p
>
ï¿½ï¿½p q
(
ï¿½ï¿½q r
$str
ï¿½ï¿½r }
)
ï¿½ï¿½} ~
)
ï¿½ï¿½~ 
,ï¿½ï¿½ ï¿½"
SecurityAlgorithmsï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½

HmacSha256ï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
return
ï¿½ï¿½ 
new
ï¿½ï¿½ %
JwtSecurityTokenHandler
ï¿½ï¿½ .
(
ï¿½ï¿½. /
)
ï¿½ï¿½/ 0
.
ï¿½ï¿½0 1

WriteToken
ï¿½ï¿½1 ;
(
ï¿½ï¿½; <
jwtSecurityToken
ï¿½ï¿½< L
)
ï¿½ï¿½L M
;
ï¿½ï¿½M N
}
ï¿½ï¿½ 	
	protected
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ 
List
ï¿½ï¿½ !
<
ï¿½ï¿½! "
Claim
ï¿½ï¿½" '
>
ï¿½ï¿½' (
>
ï¿½ï¿½( )
GetClaimsAsync
ï¿½ï¿½* 8
(
ï¿½ï¿½8 9
ApplicationUser
ï¿½ï¿½9 H
user
ï¿½ï¿½I M
)
ï¿½ï¿½M N
{
ï¿½ï¿½ 	
List
ï¿½ï¿½ 
<
ï¿½ï¿½ 
Claim
ï¿½ï¿½ 
>
ï¿½ï¿½ 
claims
ï¿½ï¿½ 
=
ï¿½ï¿½  
new
ï¿½ï¿½! $
List
ï¿½ï¿½% )
<
ï¿½ï¿½) *
Claim
ï¿½ï¿½* /
>
ï¿½ï¿½/ 0
(
ï¿½ï¿½0 1
)
ï¿½ï¿½1 2
;
ï¿½ï¿½2 3
var
ï¿½ï¿½ 
	userRoles
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ !
_userManager
ï¿½ï¿½" .
.
ï¿½ï¿½. /

GetRolesAsync
ï¿½ï¿½/ <
(
ï¿½ï¿½< =
user
ï¿½ï¿½= A
)
ï¿½ï¿½A B
;
ï¿½ï¿½B C
foreach
ï¿½ï¿½ 
(
ï¿½ï¿½ 
var
ï¿½ï¿½ 
claim
ï¿½ï¿½ 
in
ï¿½ï¿½ !
user
ï¿½ï¿½" &
.
ï¿½ï¿½& '
Claims
ï¿½ï¿½' -
)
ï¿½ï¿½- .
{
ï¿½ï¿½ 

claims
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Add
ï¿½ï¿½ 
(
ï¿½ï¿½ 
CreateClaim
ï¿½ï¿½ &
(
ï¿½ï¿½& '
claim
ï¿½ï¿½' ,
.
ï¿½ï¿½, -
	ClaimType
ï¿½ï¿½- 6
,
ï¿½ï¿½6 7
claim
ï¿½ï¿½8 =
.
ï¿½ï¿½= >

ClaimValue
ï¿½ï¿½> H
)
ï¿½ï¿½H I
)
ï¿½ï¿½I J
;
ï¿½ï¿½J K
}
ï¿½ï¿½ 

foreach
ï¿½ï¿½ 
(
ï¿½ï¿½ 
var
ï¿½ï¿½ 
userRole
ï¿½ï¿½ !
in
ï¿½ï¿½" $
	userRoles
ï¿½ï¿½% .
)
ï¿½ï¿½. /
{
ï¿½ï¿½ 

claims
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Add
ï¿½ï¿½ 
(
ï¿½ï¿½ 
new
ï¿½ï¿½ 
Claim
ï¿½ï¿½ $
(
ï¿½ï¿½$ %

ClaimTypes
ï¿½ï¿½% /
.
ï¿½ï¿½/ 0
Role
ï¿½ï¿½0 4
,
ï¿½ï¿½4 5
userRole
ï¿½ï¿½6 >
)
ï¿½ï¿½> ?
)
ï¿½ï¿½? @
;
ï¿½ï¿½@ A
var
ï¿½ï¿½ 
role
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½  
_roleManager
ï¿½ï¿½! -
.
ï¿½ï¿½- .
FindByNameAsync
ï¿½ï¿½. =
(
ï¿½ï¿½= >
userRole
ï¿½ï¿½> F
)
ï¿½ï¿½F G
;
ï¿½ï¿½G H
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
role
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½  
)
ï¿½ï¿½  !
{
ï¿½ï¿½ 
var
ï¿½ï¿½ 

roleClaims
ï¿½ï¿½ "
=
ï¿½ï¿½# $
await
ï¿½ï¿½% *
_roleManager
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetClaimsAsync
ï¿½ï¿½8 F
(
ï¿½ï¿½F G
role
ï¿½ï¿½G K
)
ï¿½ï¿½K L
;
ï¿½ï¿½L M
foreach
ï¿½ï¿½ 
(
ï¿½ï¿½ 
Claim
ï¿½ï¿½ "
	roleClaim
ï¿½ï¿½# ,
in
ï¿½ï¿½- /

roleClaims
ï¿½ï¿½0 :
)
ï¿½ï¿½: ;
{
ï¿½ï¿½ 
claims
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Add
ï¿½ï¿½ "
(
ï¿½ï¿½" #
	roleClaim
ï¿½ï¿½# ,
)
ï¿½ï¿½, -
;
ï¿½ï¿½- .
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
claims
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
	protected
ï¿½ï¿½ 
Claim
ï¿½ï¿½ 
CreateClaim
ï¿½ï¿½ #
(
ï¿½ï¿½# $
string
ï¿½ï¿½$ *
type
ï¿½ï¿½+ /
,
ï¿½ï¿½/ 0
string
ï¿½ï¿½1 7
value
ï¿½ï¿½8 =
)
ï¿½ï¿½= >
{
ï¿½ï¿½ 	
return
ï¿½ï¿½ 
new
ï¿½ï¿½ 
Claim
ï¿½ï¿½ 
(
ï¿½ï¿½ 
type
ï¿½ï¿½ !
,
ï¿½ï¿½! "
value
ï¿½ï¿½# (
,
ï¿½ï¿½( )
ClaimValueTypes
ï¿½ï¿½* 9
.
ï¿½ï¿½9 :
String
ï¿½ï¿½: @
)
ï¿½ï¿½@ A
;
ï¿½ï¿½A B
}
ï¿½ï¿½ 	
public
ï¿½ï¿½ 
static
ï¿½ï¿½ 
class
ï¿½ï¿½ 
JwtSecurityKey
ï¿½ï¿½ *
{
ï¿½ï¿½ 	
public
ï¿½ï¿½ 
static
ï¿½ï¿½ "
SymmetricSecurityKey
ï¿½ï¿½ .
Create
ï¿½ï¿½/ 5
(
ï¿½ï¿½5 6
string
ï¿½ï¿½6 <
secret
ï¿½ï¿½= C
)
ï¿½ï¿½C D
{
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½ "
SymmetricSecurityKey
ï¿½ï¿½ /
(
ï¿½ï¿½/ 0
Encoding
ï¿½ï¿½0 8
.
ï¿½ï¿½8 9
ASCII
ï¿½ï¿½9 >
.
ï¿½ï¿½> ?
GetBytes
ï¿½ï¿½? G
(
ï¿½ï¿½G H
secret
ï¿½ï¿½H N
)
ï¿½ï¿½N O
)
ï¿½ï¿½O P
;
ï¿½ï¿½P Q
}
ï¿½ï¿½ 

}
ï¿½ï¿½ 	
}
ï¿½ï¿½ 
}ï¿½ï¿½ ï¿½ï¿½
\C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiArticleController.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 

(
 
$str  
)  !
]! "
[ 
Route 

(
 
$str %
)% &
]& '
public 

class  
ApiArticleController %
:& '
BaseApiController 
{ 
public  
ApiArticleController #
(# $
	Microsoft$ -
.- .

AspNetCore. 8
.8 9
SignalR9 @
.@ A
IHubContextA L
<L M
HubM P
.P Q
	PortalHubQ Z
>Z [

hubContext\ f
)f g
:g h
basei m
(m n

hubContextn x
)x y
{ 	
} 	
[## 	
HttpGet##	 
,## 
HttpOptions## 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
RepositoryResponse%% ,
<%%, -

MixArticle%%- 7
>%%7 8
>%%8 9
DeleteAsync%%: E
(%%E F
int%%F I
id%%J L
)%%L M
{&& 	
var'' 

getArticle'' 
='' 
await'' "!
ReadListItemViewModel''# 8
.''8 9

Repository''9 C
.''C D
GetSingleModelAsync''D W
(''W X
model(( 
=>(( 
model(( 
.(( 
Id(( !
==((" $
id((% '
&&((( *
model((+ 0
.((0 1
Specificulture((1 ?
==((@ B
_lang((C H
)((H I
;((I J
if)) 
()) 

getArticle)) 
.)) 
	IsSucceed)) $
)))$ %
{** 

return,, 
await,, 

getArticle,, '
.,,' (
Data,,( ,
.,,, -
RemoveModelAsync,,- =
(,,= >
true,,> B
),,B C
;,,C D
}-- 

else.. 
{// 

return00 
new00 
RepositoryResponse00 -
<00- .

MixArticle00. 8
>008 9
(009 :
)00: ;
{11 
	IsSucceed22 
=22 
false22  %
}33 
;33 
}44 

}55 	
[88 	
HttpGet88	 
,88 
HttpOptions88 
]88 
[99 	
Route99	 
(99 
$str99 (
)99( )
]99) *
[:: 	
Route::	 
(:: 
$str:: #
)::# $
]::$ %
public;; 
async;; 
Task;; 
<;; 
ActionResult;; &
<;;& '
JObject;;' .
>;;. /
>;;/ 0
Details;;1 8
(;;8 9
string;;9 ?
viewType;;@ H
,;;H I
int;;J M
?;;M N
id;;O Q
);;Q R
{<< 	
switch== 
(== 
viewType== 
)== 
{>> 

case?? 
$str?? 
:?? 
if@@ 
(@@ 
id@@ 
.@@ 
HasValue@@ #
)@@# $
{AA 
varBB 
beResultBB $
=BB% &
awaitBB' ,
UpdateViewModelBB- <
.BB< =

RepositoryBB= G
.BBG H
GetSingleModelAsyncBBH [
(BB[ \
modelBB\ a
=>BBb d
modelBBe j
.BBj k
IdBBk m
==BBn p
idBBq s
&&BBt v
modelBBw |
.BB| }
Specificulture	BB} ï¿½
==
BBï¿½ ï¿½
_lang
BBï¿½ ï¿½
)
BBï¿½ ï¿½
.
BBï¿½ ï¿½
ConfigureAwait
BBï¿½ ï¿½
(
BBï¿½ ï¿½
false
BBï¿½ ï¿½
)
BBï¿½ ï¿½
;
BBï¿½ ï¿½
ifCC 
(CC 
beResultCC $
.CC$ %
	IsSucceedCC% .
)CC. /
{DD 
beResultEE $
.EE$ %
DataEE% )
.EE) *

DetailsUrlEE* 4
=EE5 6
MixCmsHelperEE7 C
.EEC D
GetRouterUrlEED P
(EEP Q
$strEEQ Z
,EEZ [
newEE\ _
{EE` a
beResultEEb j
.EEj k
DataEEk o
.EEo p
SeoNameEEp w
}EEx y
,EEy z
Request	EE{ ï¿½
,
EEï¿½ ï¿½
Url
EEï¿½ ï¿½
)
EEï¿½ ï¿½
;
EEï¿½ ï¿½
}FF 
returnGG 
OkGG !
(GG! "
JObjectGG" )
.GG) *

FromObjectGG* 4
(GG4 5
beResultGG5 =
)GG= >
)GG> ?
;GG? @
}HH 
elseII 
{JJ 
varKK 
modelKK !
=KK" #
newKK$ '

MixArticleKK( 2
(KK2 3
)KK3 4
{LL 
SpecificultureMM *
=MM+ ,
_langMM- 2
,MM2 3
StatusNN "
=NN# $

MixServiceNN% /
.NN/ 0
	GetConfigNN0 9
<NN9 :
intNN: =
>NN= >
(NN> ?
$strNN? N
)NNN O
,NNO P
PriorityOO $
=OO% &
UpdateViewModelOO' 6
.OO6 7

RepositoryOO7 A
.OOA B
MaxOOB E
(OOE F
aOOF G
=>OOH J
aOOK L
.OOL M
PriorityOOM U
)OOU V
.OOV W
DataOOW [
+OO\ ]
$numOO^ _
}PP 
;PP 
RepositoryResponseRR *
<RR* +
UpdateViewModelRR+ :
>RR: ;
resultRR< B
=RRC D
newRRE H
RepositoryResponseRRI [
<RR[ \
UpdateViewModelRR\ k
>RRk l
(RRl m
)RRm n
{SS 
	IsSucceedTT %
=TT& '
trueTT( ,
,TT, -
DataUU  
=UU! "
awaitUU# (
UpdateViewModelUU) 8
.UU8 9

InitViewAsyncUU9 F
(UUF G
modelUUG L
)UUL M
}VV 
;VV 
returnWW 
JObjectWW &
.WW& '

FromObjectWW' 1
(WW1 2
resultWW2 8
)WW8 9
;WW9 :
}XX 
defaultYY 
:YY 
ifZZ 
(ZZ 
idZZ 
.ZZ 
HasValueZZ #
)ZZ# $
{[[ 
var\\ 
beResult\\ $
=\\% &
await\\' ,
UpdateViewModel\\- <
.\\< =

Repository\\= G
.\\G H
GetSingleModelAsync\\H [
(\\[ \
model\\\ a
=>\\b d
model\\e j
.\\j k
Id\\k m
==\\n p
id\\q s
&&\\t v
model\\w |
.\\| }
Specificulture	\\} ï¿½
==
\\ï¿½ ï¿½
_lang
\\ï¿½ ï¿½
)
\\ï¿½ ï¿½
.
\\ï¿½ ï¿½
ConfigureAwait
\\ï¿½ ï¿½
(
\\ï¿½ ï¿½
false
\\ï¿½ ï¿½
)
\\ï¿½ ï¿½
;
\\ï¿½ ï¿½
if]] 
(]] 
beResult]] $
.]]$ %
	IsSucceed]]% .
)]]. /
{^^ 
beResult__ $
.__$ %
Data__% )
.__) *

DetailsUrl__* 4
=__5 6
MixCmsHelper__7 C
.__C D
GetRouterUrl__D P
(__P Q
$str__Q Z
,__Z [
new__\ _
{__` a
beResult__b j
.__j k
Data__k o
.__o p
SeoName__p w
}__x y
,__y z
Request	__{ ï¿½
,
__ï¿½ ï¿½
Url
__ï¿½ ï¿½
)
__ï¿½ ï¿½
;
__ï¿½ ï¿½
}`` 
returnaa 
JObjectaa &
.aa& '

FromObjectaa' 1
(aa1 2
beResultaa2 :
)aa: ;
;aa; <
}bb 
elsecc 
{dd 
varee 
modelee !
=ee" #
newee$ '

MixArticleee( 2
(ee2 3
)ee3 4
;ee4 5
RepositoryResponseff *
<ff* +
UpdateViewModelff+ :
>ff: ;
resultff< B
=ffC D
newffE H
RepositoryResponseffI [
<ff[ \
UpdateViewModelff\ k
>ffk l
(ffl m
)ffm n
{gg 
	IsSucceedhh %
=hh& '
truehh( ,
,hh, -
Dataii  
=ii! "
newii# &
UpdateViewModelii' 6
(ii6 7
modelii7 <
)ii< =
{jj 
Specificulturekk  .
=kk/ 0
_langkk1 6
,kk6 7
Statusll  &
=ll' (
MixContentStatusll) 9
.ll9 :
Previewll: A
,llA B
}mm 
}nn 
;nn 
returnoo 
JObjectoo &
.oo& '

FromObjectoo' 1
(oo1 2
resultoo2 8
)oo8 9
;oo9 :
}pp 
}qq 

}rr 	
[zz 	
	Authorizezz	 
(zz !
AuthenticationSchemeszz (
=zz) *
JwtBearerDefaultszz+ <
.zz< = 
AuthenticationSchemezz= Q
,zzQ R
RoleszzS X
=zzY Z
$strzz[ n
)zzn o
]zzo p
[{{ 	
HttpPost{{	 
,{{ 
HttpOptions{{ 
]{{ 
[|| 	
Route||	 
(|| 
$str|| 
)|| 
]|| 
public}} 
async}} 
Task}} 
<}} 
RepositoryResponse}} ,
<}}, -
UpdateViewModel}}- <
>}}< =
>}}= >
Post}}? C
(}}C D
[}}D E
FromBody}}E M
]}}M N
UpdateViewModel}}N ]
model}}^ c
)}}c d
{~~ 	
if 
( 
model 
!= 
null 
) 
{
ï¿½ï¿½ 

model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	CreatedBy
ï¿½ï¿½ 
=
ï¿½ï¿½  !
User
ï¿½ï¿½" &
.
ï¿½ï¿½& '
Claims
ï¿½ï¿½' -
.
ï¿½ï¿½- .
FirstOrDefault
ï¿½ï¿½. <
(
ï¿½ï¿½< =
c
ï¿½ï¿½= >
=>
ï¿½ï¿½? A
c
ï¿½ï¿½B C
.
ï¿½ï¿½C D
Type
ï¿½ï¿½D H
==
ï¿½ï¿½I K
$str
ï¿½ï¿½L V
)
ï¿½ï¿½V W
?
ï¿½ï¿½W X
.
ï¿½ï¿½X Y
Value
ï¿½ï¿½Y ^
;
ï¿½ï¿½^ _
var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ "
model
ï¿½ï¿½# (
.
ï¿½ï¿½( )
SaveModelAsync
ï¿½ï¿½) 7
(
ï¿½ï¿½7 8
true
ï¿½ï¿½8 <
)
ï¿½ï¿½< =
.
ï¿½ï¿½= >
ConfigureAwait
ï¿½ï¿½> L
(
ï¿½ï¿½L M
false
ï¿½ï¿½M R
)
ï¿½ï¿½R S
;
ï¿½ï¿½S T
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
UpdateViewModel
ï¿½ï¿½* 9
>
ï¿½ï¿½9 :
(
ï¿½ï¿½: ;
)
ï¿½ï¿½; <
{
ï¿½ï¿½= >
Status
ï¿½ï¿½? E
=
ï¿½ï¿½F G
$num
ï¿½ï¿½H K
}
ï¿½ï¿½L M
;
ï¿½ï¿½M N
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -

MixArticle
ï¿½ï¿½- 7
>
ï¿½ï¿½7 8
>
ï¿½ï¿½8 9

SaveFields
ï¿½ï¿½: D
(
ï¿½ï¿½D E
int
ï¿½ï¿½E H
id
ï¿½ï¿½I K
,
ï¿½ï¿½K L
[
ï¿½ï¿½M N
FromBody
ï¿½ï¿½N V
]
ï¿½ï¿½V W
List
ï¿½ï¿½W [
<
ï¿½ï¿½[ \
EntityField
ï¿½ï¿½\ g
>
ï¿½ï¿½g h
fields
ï¿½ï¿½i o
)
ï¿½ï¿½o p
{
ï¿½ï¿½ 	
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
fields
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
new
ï¿½ï¿½   
RepositoryResponse
ï¿½ï¿½! 3
<
ï¿½ï¿½3 4

MixArticle
ï¿½ï¿½4 >
>
ï¿½ï¿½> ?
(
ï¿½ï¿½? @
)
ï¿½ï¿½@ A
{
ï¿½ï¿½B C
	IsSucceed
ï¿½ï¿½D M
=
ï¿½ï¿½N O
true
ï¿½ï¿½P T
}
ï¿½ï¿½U V
;
ï¿½ï¿½V W
foreach
ï¿½ï¿½ 
(
ï¿½ï¿½ 
var
ï¿½ï¿½ 
property
ï¿½ï¿½ %
in
ï¿½ï¿½& (
fields
ï¿½ï¿½) /
)
ï¿½ï¿½/ 0
{
ï¿½ï¿½ 
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &#
ReadListItemViewModel
ï¿½ï¿½' <
.
ï¿½ï¿½< =

Repository
ï¿½ï¿½= G
.
ï¿½ï¿½G H
UpdateFieldsAsync
ï¿½ï¿½H Y
(
ï¿½ï¿½Y Z
c
ï¿½ï¿½Z [
=>
ï¿½ï¿½\ ^
c
ï¿½ï¿½_ `
.
ï¿½ï¿½` a
Id
ï¿½ï¿½a c
==
ï¿½ï¿½d f
id
ï¿½ï¿½g i
&&
ï¿½ï¿½j l
c
ï¿½ï¿½m n
.
ï¿½ï¿½n o
Specificulture
ï¿½ï¿½o }
==ï¿½ï¿½~ ï¿½
_langï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
fieldsï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
break
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *

MixArticle
ï¿½ï¿½* 4
>
ï¿½ï¿½4 5
(
ï¿½ï¿½5 6
)
ï¿½ï¿½6 7
;
ï¿½ï¿½7 8
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ 
JObject
ï¿½ï¿½ !
>
ï¿½ï¿½! "
GetList
ï¿½ï¿½# *
(
ï¿½ï¿½* +
[
ï¿½ï¿½ 

FromBody
ï¿½ï¿½
 
]
ï¿½ï¿½ 

RequestPaging
ï¿½ï¿½ $
request
ï¿½ï¿½% ,
)
ï¿½ï¿½, -
{
ï¿½ï¿½ 	$
ParseRequestPagingDate
ï¿½ï¿½ "
(
ï¿½ï¿½" #
request
ï¿½ï¿½# *
)
ï¿½ï¿½* +
;
ï¿½ï¿½+ ,

Expression
ï¿½ï¿½ 
<
ï¿½ï¿½ 
Func
ï¿½ï¿½ 
<
ï¿½ï¿½ 

MixArticle
ï¿½ï¿½ &
,
ï¿½ï¿½& '
bool
ï¿½ï¿½( ,
>
ï¿½ï¿½, -
>
ï¿½ï¿½- .
	predicate
ï¿½ï¿½/ 8
=
ï¿½ï¿½9 :
model
ï¿½ï¿½; @
=>
ï¿½ï¿½A C
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Specificulture
ï¿½ï¿½ ,
==
ï¿½ï¿½- /
_lang
ï¿½ï¿½0 5
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Status
ï¿½ï¿½% +
.
ï¿½ï¿½+ ,
HasValue
ï¿½ï¿½, 4
||
ï¿½ï¿½5 7
model
ï¿½ï¿½8 =
.
ï¿½ï¿½= >
Status
ï¿½ï¿½> D
==
ï¿½ï¿½E G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
Status
ï¿½ï¿½P V
.
ï¿½ï¿½V W
Value
ï¿½ï¿½W \
)
ï¿½ï¿½\ ]
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
string
ï¿½ï¿½ "
.
ï¿½ï¿½" # 
IsNullOrWhiteSpace
ï¿½ï¿½# 5
(
ï¿½ï¿½5 6
request
ï¿½ï¿½6 =
.
ï¿½ï¿½= >
Keyword
ï¿½ï¿½> E
)
ï¿½ï¿½E F
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
Title
ï¿½ï¿½& +
.
ï¿½ï¿½+ ,
Contains
ï¿½ï¿½, 4
(
ï¿½ï¿½4 5
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
Keyword
ï¿½ï¿½= D
)
ï¿½ï¿½D E
||
ï¿½ï¿½ 
model
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Excerpt
ï¿½ï¿½% ,
.
ï¿½ï¿½, -
Contains
ï¿½ï¿½- 5
(
ï¿½ï¿½5 6
request
ï¿½ï¿½6 =
.
ï¿½ï¿½= >
Keyword
ï¿½ï¿½> E
)
ï¿½ï¿½E F
)
ï¿½ï¿½F G
)
ï¿½ï¿½G H
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
FromDate
ï¿½ï¿½% -
.
ï¿½ï¿½- .
HasValue
ï¿½ï¿½. 6
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
CreatedDateTime
ï¿½ï¿½& 5
>=
ï¿½ï¿½6 8
request
ï¿½ï¿½9 @
.
ï¿½ï¿½@ A
FromDate
ï¿½ï¿½A I
.
ï¿½ï¿½I J
Value
ï¿½ï¿½J O
)
ï¿½ï¿½O P
)
ï¿½ï¿½ 
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
ToDate
ï¿½ï¿½% +
.
ï¿½ï¿½+ ,
HasValue
ï¿½ï¿½, 4
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
CreatedDateTime
ï¿½ï¿½& 5
<=
ï¿½ï¿½6 8
request
ï¿½ï¿½9 @
.
ï¿½ï¿½@ A
ToDate
ï¿½ï¿½A G
.
ï¿½ï¿½G H
Value
ï¿½ï¿½H M
)
ï¿½ï¿½M N
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
switch
ï¿½ï¿½ 
(
ï¿½ï¿½ 
request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Key
ï¿½ï¿½ 
)
ï¿½ï¿½  
{
ï¿½ï¿½ 

case
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
fedata
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &
ReadMvcViewModel
ï¿½ï¿½' 7
.
ï¿½ï¿½7 8

Repository
ï¿½ï¿½8 B
.
ï¿½ï¿½B C!
GetModelListByAsync
ï¿½ï¿½C V
(
ï¿½ï¿½ 
	predicate
ï¿½ï¿½ "
,
ï¿½ï¿½" #
request
ï¿½ï¿½$ +
.
ï¿½ï¿½+ ,
OrderBy
ï¿½ï¿½, 3
,
ï¿½ï¿½3 4
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
	Direction
ï¿½ï¿½= F
,
ï¿½ï¿½F G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
PageSize
ï¿½ï¿½P X
,
ï¿½ï¿½X Y
request
ï¿½ï¿½Z a
.
ï¿½ï¿½a b
	PageIndex
ï¿½ï¿½b k
)
ï¿½ï¿½k l
.
ï¿½ï¿½l m
ConfigureAwait
ï¿½ï¿½m {
(
ï¿½ï¿½{ |
falseï¿½ï¿½| ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
fedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
fedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ #
.
ï¿½ï¿½# $
Items
ï¿½ï¿½$ )
.
ï¿½ï¿½) *
ForEach
ï¿½ï¿½* 1
(
ï¿½ï¿½1 2
a
ï¿½ï¿½2 3
=>
ï¿½ï¿½4 6
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½ (
=
ï¿½ï¿½) *
MixCmsHelper
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetRouterUrl
ï¿½ï¿½8 D
(
ï¿½ï¿½D E
$str
ï¿½ï¿½  )
,
ï¿½ï¿½) *
new
ï¿½ï¿½+ .
{
ï¿½ï¿½/ 0
seoName
ï¿½ï¿½1 8
=
ï¿½ï¿½9 :
a
ï¿½ï¿½; <
.
ï¿½ï¿½< =
SeoName
ï¿½ï¿½= D
}
ï¿½ï¿½E F
,
ï¿½ï¿½F G
Request
ï¿½ï¿½H O
,
ï¿½ï¿½O P
Url
ï¿½ï¿½Q T
)
ï¿½ï¿½T U
;
ï¿½ï¿½U V
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
fedata
ï¿½ï¿½. 4
)
ï¿½ï¿½4 5
;
ï¿½ï¿½5 6
case
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
bedata
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &
UpdateViewModel
ï¿½ï¿½' 6
.
ï¿½ï¿½6 7

Repository
ï¿½ï¿½7 A
.
ï¿½ï¿½A B!
GetModelListByAsync
ï¿½ï¿½B U
(
ï¿½ï¿½ 
	predicate
ï¿½ï¿½ "
,
ï¿½ï¿½" #
request
ï¿½ï¿½$ +
.
ï¿½ï¿½+ ,
OrderBy
ï¿½ï¿½, 3
,
ï¿½ï¿½3 4
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
	Direction
ï¿½ï¿½= F
,
ï¿½ï¿½F G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
PageSize
ï¿½ï¿½P X
,
ï¿½ï¿½X Y
request
ï¿½ï¿½Z a
.
ï¿½ï¿½a b
	PageIndex
ï¿½ï¿½b k
)
ï¿½ï¿½k l
.
ï¿½ï¿½l m
ConfigureAwait
ï¿½ï¿½m {
(
ï¿½ï¿½{ |
falseï¿½ï¿½| ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
bedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
bedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ #
.
ï¿½ï¿½# $
Items
ï¿½ï¿½$ )
.
ï¿½ï¿½) *
ForEach
ï¿½ï¿½* 1
(
ï¿½ï¿½1 2
a
ï¿½ï¿½2 3
=>
ï¿½ï¿½4 6
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½ (
=
ï¿½ï¿½) *
MixCmsHelper
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetRouterUrl
ï¿½ï¿½8 D
(
ï¿½ï¿½D E
$str
ï¿½ï¿½  )
,
ï¿½ï¿½) *
new
ï¿½ï¿½+ .
{
ï¿½ï¿½/ 0
seoName
ï¿½ï¿½1 8
=
ï¿½ï¿½9 :
a
ï¿½ï¿½; <
.
ï¿½ï¿½< =
SeoName
ï¿½ï¿½= D
}
ï¿½ï¿½E F
,
ï¿½ï¿½F G
Request
ï¿½ï¿½H O
,
ï¿½ï¿½O P
Url
ï¿½ï¿½Q T
)
ï¿½ï¿½T U
;
ï¿½ï¿½U V
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
bedata
ï¿½ï¿½. 4
)
ï¿½ï¿½4 5
;
ï¿½ï¿½5 6
default
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ $#
ReadListItemViewModel
ï¿½ï¿½% :
.
ï¿½ï¿½: ;

Repository
ï¿½ï¿½; E
.
ï¿½ï¿½E F!
GetModelListByAsync
ï¿½ï¿½F Y
(
ï¿½ï¿½ 
	predicate
ï¿½ï¿½ "
,
ï¿½ï¿½" #
request
ï¿½ï¿½$ +
.
ï¿½ï¿½+ ,
OrderBy
ï¿½ï¿½, 3
,
ï¿½ï¿½3 4
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
	Direction
ï¿½ï¿½= F
,
ï¿½ï¿½F G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
PageSize
ï¿½ï¿½P X
,
ï¿½ï¿½X Y
request
ï¿½ï¿½Z a
.
ï¿½ï¿½a b
	PageIndex
ï¿½ï¿½b k
)
ï¿½ï¿½k l
.
ï¿½ï¿½l m
ConfigureAwait
ï¿½ï¿½m {
(
ï¿½ï¿½{ |
falseï¿½ï¿½| ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
data
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ &
)
ï¿½ï¿½& '
{
ï¿½ï¿½ 
data
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ !
.
ï¿½ï¿½! "
Items
ï¿½ï¿½" '
.
ï¿½ï¿½' (
ForEach
ï¿½ï¿½( /
(
ï¿½ï¿½/ 0
(
ï¿½ï¿½0 1
Action
ï¿½ï¿½1 7
<
ï¿½ï¿½7 8#
ReadListItemViewModel
ï¿½ï¿½8 M
>
ï¿½ï¿½M N
)
ï¿½ï¿½N O
(
ï¿½ï¿½O P
a
ï¿½ï¿½P Q
=>
ï¿½ï¿½R T
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½ (
=
ï¿½ï¿½) *
MixCmsHelper
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetRouterUrl
ï¿½ï¿½8 D
(
ï¿½ï¿½D E
$str
ï¿½ï¿½  )
,
ï¿½ï¿½) *
new
ï¿½ï¿½+ .
{
ï¿½ï¿½/ 0
seoName
ï¿½ï¿½1 8
=
ï¿½ï¿½9 :
a
ï¿½ï¿½; <
.
ï¿½ï¿½< =
SeoName
ï¿½ï¿½= D
}
ï¿½ï¿½E F
,
ï¿½ï¿½F G
Request
ï¿½ï¿½H O
,
ï¿½ï¿½O P
Url
ï¿½ï¿½Q T
)
ï¿½ï¿½T U
;
ï¿½ï¿½U V
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
data
ï¿½ï¿½. 2
)
ï¿½ï¿½2 3
;
ï¿½ï¿½3 4
}
ï¿½ï¿½ 

}
ï¿½ï¿½ 	
}
ï¿½ï¿½ 
}ï¿½ï¿½ ï¿½
ZC:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiMediaController.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Route 

(
 
$str #
)# $
]$ %
public 

class 
ApiMediaController #
:$ %
BaseApiController 
{ 
public 
ApiMediaController !
(! "
	Microsoft" +
.+ ,

AspNetCore, 6
.6 7
SignalR7 >
.> ?
IHubContext? J
<J K
HubK N
.N O
	PortalHubO X
>X Y

hubContextZ d
)d e
:f g
baseh l
(l m

hubContextm w
)w x
{ 	
} 	
["" 	
HttpGet""	 
,"" 
HttpOptions"" 
]"" 
[## 	
Route##	 
(## 
$str## (
)##( )
]##) *
[$$ 	
Route$$	 
($$ 
$str$$ #
)$$# $
]$$$ %
public%% 
async%% 
Task%% 
<%% 
JObject%% !
>%%! "
Details%%# *
(%%* +
string%%+ 1
viewType%%2 :
,%%: ;
int%%< ?
?%%? @
id%%A C
=%%D E
null%%F J
)%%J K
{&& 	
switch'' 
('' 
viewType'' 
)'' 
{(( 

default)) 
:)) 
if** 
(** 
id** 
.** 
HasValue** #
)**# $
{++ 
var,, 
feResult,, $
=,,% &
await,,' ,
MediaViewModel,,- ;
.,,; <

Repository,,< F
.,,F G
GetSingleModelAsync,,G Z
(,,Z [
model-- 
=>--  
model--! &
.--& '
Id--' )
==--* ,
id--- /
&&--0 2
model--3 8
.--8 9
Specificulture--9 G
==--H J
_lang--K P
)--P Q
.--Q R
ConfigureAwait--R `
(--` a
false--a f
)--f g
;--g h
return.. 
JObject.. &
...& '

FromObject..' 1
(..1 2
feResult..2 :
)..: ;
;..; <
}// 
else00 
{11 
var22 
media22 !
=22" #
new22$ '
MixMedia22( 0
(220 1
)221 2
{33 
Specificulture44 *
=44+ ,
_lang44- 2
,442 3
Priority55 $
=55% &
MediaViewModel55' 5
.555 6

Repository556 @
.55@ A
Max55A D
(55D E
a55E F
=>55G I
a55J K
.55K L
Priority55L T
)55T U
.55U V
Data55V Z
+55[ \
$num55] ^
}66 
;66 
var77 
result77 "
=77# $
new77% (
RepositoryResponse77) ;
<77; <
MediaViewModel77< J
>77J K
(77K L
)77L M
{88 
	IsSucceed99 %
=99& '
true99( ,
,99, -
Data::  
=::! "
(::# $
await::$ )
MediaViewModel::* 8
.::8 9

InitViewAsync::9 F
(::F G
media::G L
)::L M
)::M N
};; 
;;; 
return<< 
JObject<< &
.<<& '

FromObject<<' 1
(<<1 2
result<<2 8
)<<8 9
;<<9 :
}== 
}?? 

}@@ 	
[BB 	
HttpGetBB	 
,BB 
HttpOptionsBB 
]BB 
[CC 	
RouteCC	 
(CC 
$strCC 
)CC 
]CC 
publicDD 
asyncDD 
TaskDD 
<DD 
JObjectDD !
>DD! "
CloneDD# (
(DD( )
intDD) ,
idDD- /
)DD/ 0
{EE 	
varFF 
resultFF 
=FF 
awaitFF 
MediaViewModelFF -
.FF- .

RepositoryFF. 8
.FF8 9
GetSingleModelAsyncFF9 L
(FFL M
modelGG 
=>GG 
modelGG 
.GG 
IdGG 
==GG  
idGG! #
&&GG$ &
modelGG' ,
.GG, -
SpecificultureGG- ;
==GG< >
_langGG? D
)GGD E
.GGE F
ConfigureAwaitGGF T
(GGT U
falseGGU Z
)GGZ [
;GG[ \
ifHH 
(HH 
resultHH 
.HH 
	IsSucceedHH  
)HH  !
{II 

resultJJ 
.JJ 
DataJJ 
.JJ 
IsCloneJJ #
=JJ$ %
trueJJ& *
;JJ* +
varKK 
cloneResultKK 
=KK  !
awaitKK" '
resultKK( .
.KK. /
DataKK/ 3
.KK3 4
SaveModelAsyncKK4 B
(KKB C
falseKKC H
)KKH I
;KKI J
returnLL 
JObjectLL 
.LL 

FromObjectLL )
(LL) *
cloneResultLL* 5
)LL5 6
;LL6 7
}MM 

elseNN 
{OO 

returnPP 
JObjectPP 
.PP 

FromObjectPP )
(PP) *
resultPP* 0
)PP0 1
;PP1 2
}QQ 

}RR 	
[UU 	
HttpGetUU	 
,UU 
HttpOptionsUU 
]UU 
[VV 	
RouteVV	 
(VV 
$strVV 
)VV 
]VV 
publicWW 
asyncWW 
TaskWW 
<WW 
RepositoryResponseWW ,
<WW, -
MixMediaWW- 5
>WW5 6
>WW6 7
DeleteWW8 >
(WW> ?
intWW? B
idWWC E
)WWE F
{XX 	
varYY 
getMediaYY 
=YY 
MediaViewModelYY )
.YY) *

RepositoryYY* 4
.YY4 5
GetSingleModelYY5 C
(YYC D
aYYD E
=>YYF H
aYYI J
.YYJ K
IdYYK M
==YYN P
idYYQ S
&&YYT V
aYYW X
.YYX Y
SpecificultureYYY g
==YYh j
_langYYk p
)YYp q
;YYq r
ifZZ 
(ZZ 
getMediaZZ 
.ZZ 
	IsSucceedZZ "
)ZZ" #
{[[ 

return\\ 
await\\ 
getMedia\\ %
.\\% &
Data\\& *
.\\* +
RemoveModelAsync\\+ ;
(\\; <
true\\< @
)\\@ A
.\\A B
ConfigureAwait\\B P
(\\P Q
false\\Q V
)\\V W
;\\W X
}]] 

else^^ 
{__ 

return`` 
new`` 
RepositoryResponse`` -
<``- .
MixMedia``. 6
>``6 7
(``7 8
)``8 9
{``: ;
	IsSucceed``< E
=``F G
false``H M
}``N O
;``O P
}aa 

}bb 	
[hh 	
	Authorizehh	 
(hh !
AuthenticationSchemeshh (
=hh) *
JwtBearerDefaultshh+ <
.hh< = 
AuthenticationSchemehh= Q
)hhQ R
]hhR S
[ii 	
Routeii	 
(ii 
$strii 
)ii 
]ii 
[jj 	
HttpPostjj	 
,jj 
HttpOptionsjj 
]jj 
publickk 
asynckk 
Taskkk 
<kk 
RepositoryResponsekk ,
<kk, -
MediaViewModelkk- ;
>kk; <
>kk< =
UploadAsynckk> I
(kkI J
[kkJ K
FromFormkkK S
]kkS T
stringkkU [

fileFolderkk\ f
,kkf g
[kkh i
FromFormkki q
]kkq r
stringkks y
titlekkz 
,	kk ï¿½
[
kkï¿½ ï¿½
FromForm
kkï¿½ ï¿½
]
kkï¿½ ï¿½
string
kkï¿½ ï¿½
description
kkï¿½ ï¿½
)
kkï¿½ ï¿½
{ll 	
varmm 
filesmm 
=mm 
Requestmm 
.mm  
Formmm  $
.mm$ %
Filesmm% *
;mm* +
ifoo 
(oo 
filesoo 
.oo 
Countoo 
>oo 
$numoo 
)oo  
{pp 

varqq 

fileUploadqq 
=qq  
filesqq! &
.qq& '
FirstOrDefaultqq' 5
(qq5 6
)qq6 7
;qq7 8
stringss 

folderPathss !
=ss" #
CommonHelperss$ 0
.ss0 1
GetFullPathss1 <
(ss< =
newss= @
[ss@ A
]ssA B
{ssC D

MixServicett 
.tt 
	GetConfigtt (
<tt( )
stringtt) /
>tt/ 0
(tt0 1
$strtt1 ?
)tt? @
,tt@ A

fileFolderuu 
,uu 
DateTimevv 
.vv 
UtcNowvv #
.vv# $
ToStringvv$ ,
(vv, -
$strvv- 6
)vv6 7
}ww 
)ww 
;ww 
stringyy 

uploadPathyy !
=yy" #
CommonHelperyy$ 0
.yy0 1
GetFullPathyy1 <
(yy< =
newyy= @
[yy@ A
]yyA B
{yyC D
MixConstantszz  
.zz  !
Folderzz! '
.zz' (
WebRootPathzz( 3
,zz3 4

folderPath{{ 
}|| 
)|| 
;|| 
string~~ 
fileName~~ 
=~~  !
CommonHelper 
. 
GetFullPath (
(( )
new) ,
[, -
]- .
{/ 0
$str
ï¿½ï¿½ 
,
ï¿½ï¿½ 
await
ï¿½ï¿½ 
UploadFileAsync
ï¿½ï¿½ )
(
ï¿½ï¿½) *
files
ï¿½ï¿½* /
.
ï¿½ï¿½/ 0
FirstOrDefault
ï¿½ï¿½0 >
(
ï¿½ï¿½> ?
)
ï¿½ï¿½? @
,
ï¿½ï¿½@ A

uploadPath
ï¿½ï¿½B L
)
ï¿½ï¿½L M
.
ï¿½ï¿½M N
ConfigureAwait
ï¿½ï¿½N \
(
ï¿½ï¿½\ ]
false
ï¿½ï¿½] b
)
ï¿½ï¿½b c
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
MediaViewModel
ï¿½ï¿½ 
media
ï¿½ï¿½ $
=
ï¿½ï¿½% &
new
ï¿½ï¿½' *
MediaViewModel
ï¿½ï¿½+ 9
(
ï¿½ï¿½9 :
new
ï¿½ï¿½: =
MixMedia
ï¿½ï¿½> F
(
ï¿½ï¿½F G
)
ï¿½ï¿½G H
{
ï¿½ï¿½ 
Specificulture
ï¿½ï¿½ "
=
ï¿½ï¿½# $
_lang
ï¿½ï¿½% *
,
ï¿½ï¿½* +
FileName
ï¿½ï¿½ 
=
ï¿½ï¿½ 
fileName
ï¿½ï¿½ '
.
ï¿½ï¿½' (
Split
ï¿½ï¿½( -
(
ï¿½ï¿½- .
$char
ï¿½ï¿½. 1
)
ï¿½ï¿½1 2
[
ï¿½ï¿½2 3
$num
ï¿½ï¿½3 4
]
ï¿½ï¿½4 5
.
ï¿½ï¿½5 6
	Substring
ï¿½ï¿½6 ?
(
ï¿½ï¿½? @
fileName
ï¿½ï¿½@ H
.
ï¿½ï¿½H I
LastIndexOf
ï¿½ï¿½I T
(
ï¿½ï¿½T U
$char
ï¿½ï¿½U X
)
ï¿½ï¿½X Y
+
ï¿½ï¿½Z [
$num
ï¿½ï¿½\ ]
)
ï¿½ï¿½] ^
,
ï¿½ï¿½^ _

FileFolder
ï¿½ï¿½ 
=
ï¿½ï¿½  

folderPath
ï¿½ï¿½! +
,
ï¿½ï¿½+ ,
	Extension
ï¿½ï¿½ 
=
ï¿½ï¿½ 
fileName
ï¿½ï¿½  (
.
ï¿½ï¿½( )
	Substring
ï¿½ï¿½) 2
(
ï¿½ï¿½2 3
fileName
ï¿½ï¿½3 ;
.
ï¿½ï¿½; <
LastIndexOf
ï¿½ï¿½< G
(
ï¿½ï¿½G H
$char
ï¿½ï¿½H K
)
ï¿½ï¿½K L
)
ï¿½ï¿½L M
,
ï¿½ï¿½M N
CreatedDateTime
ï¿½ï¿½ #
=
ï¿½ï¿½$ %
DateTime
ï¿½ï¿½& .
.
ï¿½ï¿½. /
UtcNow
ï¿½ï¿½/ 5
,
ï¿½ï¿½5 6
FileType
ï¿½ï¿½ 
=
ï¿½ï¿½ 

fileUpload
ï¿½ï¿½ )
.
ï¿½ï¿½) *
ContentType
ï¿½ï¿½* 5
.
ï¿½ï¿½5 6
Split
ï¿½ï¿½6 ;
(
ï¿½ï¿½; <
$char
ï¿½ï¿½< ?
)
ï¿½ï¿½? @
[
ï¿½ï¿½@ A
$num
ï¿½ï¿½A B
]
ï¿½ï¿½B C
,
ï¿½ï¿½C D
FileSize
ï¿½ï¿½ 
=
ï¿½ï¿½ 

fileUpload
ï¿½ï¿½ )
.
ï¿½ï¿½) *
Length
ï¿½ï¿½* 0
,
ï¿½ï¿½0 1
Title
ï¿½ï¿½ 
=
ï¿½ï¿½ 
title
ï¿½ï¿½ !
??
ï¿½ï¿½" $
fileName
ï¿½ï¿½% -
.
ï¿½ï¿½- .
Split
ï¿½ï¿½. 3
(
ï¿½ï¿½3 4
$char
ï¿½ï¿½4 7
)
ï¿½ï¿½7 8
[
ï¿½ï¿½8 9
$num
ï¿½ï¿½9 :
]
ï¿½ï¿½: ;
.
ï¿½ï¿½; <
	Substring
ï¿½ï¿½< E
(
ï¿½ï¿½E F
fileName
ï¿½ï¿½F N
.
ï¿½ï¿½N O
LastIndexOf
ï¿½ï¿½O Z
(
ï¿½ï¿½Z [
$char
ï¿½ï¿½[ ^
)
ï¿½ï¿½^ _
+
ï¿½ï¿½` a
$num
ï¿½ï¿½b c
)
ï¿½ï¿½c d
,
ï¿½ï¿½d e
Description
ï¿½ï¿½ 
=
ï¿½ï¿½  !
description
ï¿½ï¿½" -
??
ï¿½ï¿½. 0
fileName
ï¿½ï¿½1 9
.
ï¿½ï¿½9 :
Split
ï¿½ï¿½: ?
(
ï¿½ï¿½? @
$char
ï¿½ï¿½@ C
)
ï¿½ï¿½C D
[
ï¿½ï¿½D E
$num
ï¿½ï¿½E F
]
ï¿½ï¿½F G
.
ï¿½ï¿½G H
	Substring
ï¿½ï¿½H Q
(
ï¿½ï¿½Q R
fileName
ï¿½ï¿½R Z
.
ï¿½ï¿½Z [
LastIndexOf
ï¿½ï¿½[ f
(
ï¿½ï¿½f g
$char
ï¿½ï¿½g j
)
ï¿½ï¿½j k
+
ï¿½ï¿½l m
$num
ï¿½ï¿½n o
)
ï¿½ï¿½o p
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
return
ï¿½ï¿½ 
await
ï¿½ï¿½ 
media
ï¿½ï¿½ "
.
ï¿½ï¿½" #
SaveModelAsync
ï¿½ï¿½# 1
(
ï¿½ï¿½1 2
)
ï¿½ï¿½2 3
;
ï¿½ï¿½3 4
}
ï¿½ï¿½ 

else
ï¿½ï¿½ 
{
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ -
<
ï¿½ï¿½- .
MediaViewModel
ï¿½ï¿½. <
>
ï¿½ï¿½< =
(
ï¿½ï¿½= >
)
ï¿½ï¿½> ?
;
ï¿½ï¿½? @
}
ï¿½ï¿½ 

}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
	Authorize
ï¿½ï¿½	 
(
ï¿½ï¿½ #
AuthenticationSchemes
ï¿½ï¿½ (
=
ï¿½ï¿½) *
JwtBearerDefaults
ï¿½ï¿½+ <
.
ï¿½ï¿½< ="
AuthenticationScheme
ï¿½ï¿½= Q
)
ï¿½ï¿½Q R
]
ï¿½ï¿½R S
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
MediaViewModel
ï¿½ï¿½- ;
>
ï¿½ï¿½; <
>
ï¿½ï¿½< =
Post
ï¿½ï¿½> B
(
ï¿½ï¿½B C
[
ï¿½ï¿½C D
FromBody
ï¿½ï¿½D L
]
ï¿½ï¿½L M
MediaViewModel
ï¿½ï¿½M [
model
ï¿½ï¿½\ a
)
ï¿½ï¿½a b
{
ï¿½ï¿½ 	
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Specificulture
ï¿½ï¿½ $
=
ï¿½ï¿½% &
_lang
ï¿½ï¿½' ,
;
ï¿½ï¿½, -
var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ "
model
ï¿½ï¿½# (
.
ï¿½ï¿½( )
SaveModelAsync
ï¿½ï¿½) 7
(
ï¿½ï¿½7 8
true
ï¿½ï¿½8 <
)
ï¿½ï¿½< =
.
ï¿½ï¿½= >
ConfigureAwait
ï¿½ï¿½> L
(
ï¿½ï¿½L M
false
ï¿½ï¿½M R
)
ï¿½ï¿½R S
;
ï¿½ï¿½S T
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
MediaViewModel
ï¿½ï¿½* 8
>
ï¿½ï¿½8 9
(
ï¿½ï¿½9 :
)
ï¿½ï¿½: ;
;
ï¿½ï¿½; <
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
PaginationModel
ï¿½ï¿½- <
<
ï¿½ï¿½< =
Lib
ï¿½ï¿½= @
.
ï¿½ï¿½@ A

ViewModels
ï¿½ï¿½A K
.
ï¿½ï¿½K L
	MixMedias
ï¿½ï¿½L U
.
ï¿½ï¿½U V
MediaViewModel
ï¿½ï¿½V d
>
ï¿½ï¿½d e
>
ï¿½ï¿½e f
>
ï¿½ï¿½f g
GetList
ï¿½ï¿½h o
(
ï¿½ï¿½o p
[
ï¿½ï¿½p q
FromBody
ï¿½ï¿½q y
]
ï¿½ï¿½y z

RequestPagingï¿½ï¿½z ï¿½
requestï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
{
ï¿½ï¿½ 	$
ParseRequestPagingDate
ï¿½ï¿½ "
(
ï¿½ï¿½" #
request
ï¿½ï¿½# *
)
ï¿½ï¿½* +
;
ï¿½ï¿½+ ,

Expression
ï¿½ï¿½ 
<
ï¿½ï¿½ 
Func
ï¿½ï¿½ 
<
ï¿½ï¿½ 
MixMedia
ï¿½ï¿½ $
,
ï¿½ï¿½$ %
bool
ï¿½ï¿½& *
>
ï¿½ï¿½* +
>
ï¿½ï¿½+ ,
	predicate
ï¿½ï¿½- 6
=
ï¿½ï¿½7 8
model
ï¿½ï¿½9 >
=>
ï¿½ï¿½? A
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Specificulture
ï¿½ï¿½ $
==
ï¿½ï¿½% '
_lang
ï¿½ï¿½( -
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
string
ï¿½ï¿½ 
.
ï¿½ï¿½  
IsNullOrWhiteSpace
ï¿½ï¿½ -
(
ï¿½ï¿½- .
request
ï¿½ï¿½. 5
.
ï¿½ï¿½5 6
Keyword
ï¿½ï¿½6 =
)
ï¿½ï¿½= >
||
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
FileName
ï¿½ï¿½ "
.
ï¿½ï¿½" #
Contains
ï¿½ï¿½# +
(
ï¿½ï¿½+ ,
request
ï¿½ï¿½, 3
.
ï¿½ï¿½3 4
Keyword
ï¿½ï¿½4 ;
)
ï¿½ï¿½; <
||
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Title
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Contains
ï¿½ï¿½ '
(
ï¿½ï¿½' (
request
ï¿½ï¿½( /
.
ï¿½ï¿½/ 0
Keyword
ï¿½ï¿½0 7
)
ï¿½ï¿½7 8
||
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Description
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Contains
ï¿½ï¿½% -
(
ï¿½ï¿½- .
request
ï¿½ï¿½. 5
.
ï¿½ï¿½5 6
Keyword
ï¿½ï¿½6 =
)
ï¿½ï¿½= >
)
ï¿½ï¿½> ?
)
ï¿½ï¿½? @
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
FromDate
ï¿½ï¿½ %
.
ï¿½ï¿½% &
HasValue
ï¿½ï¿½& .
||
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
CreatedDateTime
ï¿½ï¿½ -
>=
ï¿½ï¿½. 0
request
ï¿½ï¿½1 8
.
ï¿½ï¿½8 9
FromDate
ï¿½ï¿½9 A
.
ï¿½ï¿½A B
Value
ï¿½ï¿½B G
)
ï¿½ï¿½G H
)
ï¿½ï¿½ 
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
ToDate
ï¿½ï¿½ #
.
ï¿½ï¿½# $
HasValue
ï¿½ï¿½$ ,
||
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
CreatedDateTime
ï¿½ï¿½ -
<=
ï¿½ï¿½. 0
request
ï¿½ï¿½1 8
.
ï¿½ï¿½8 9
ToDate
ï¿½ï¿½9 ?
.
ï¿½ï¿½? @
Value
ï¿½ï¿½@ E
)
ï¿½ï¿½E F
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
var
ï¿½ï¿½ 
data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ 
MediaViewModel
ï¿½ï¿½ +
.
ï¿½ï¿½+ ,

Repository
ï¿½ï¿½, 6
.
ï¿½ï¿½6 7!
GetModelListByAsync
ï¿½ï¿½7 J
(
ï¿½ï¿½J K
	predicate
ï¿½ï¿½K T
,
ï¿½ï¿½T U
request
ï¿½ï¿½V ]
.
ï¿½ï¿½] ^
OrderBy
ï¿½ï¿½^ e
,
ï¿½ï¿½e f
request
ï¿½ï¿½g n
.
ï¿½ï¿½n o
	Direction
ï¿½ï¿½o x
,
ï¿½ï¿½x y
requestï¿½ï¿½z ï¿½
.ï¿½ï¿½ï¿½ ï¿½
PageSizeï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	PageIndexï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
return
ï¿½ï¿½ 
data
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
	Authorize
ï¿½ï¿½	 
(
ï¿½ï¿½ #
AuthenticationSchemes
ï¿½ï¿½ (
=
ï¿½ï¿½) *
JwtBearerDefaults
ï¿½ï¿½+ <
.
ï¿½ï¿½< ="
AuthenticationScheme
ï¿½ï¿½= Q
)
ï¿½ï¿½Q R
]
ï¿½ï¿½R S
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ +
)
ï¿½ï¿½+ ,
]
ï¿½ï¿½, -
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½  
]
ï¿½ï¿½  !
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
PaginationModel
ï¿½ï¿½- <
<
ï¿½ï¿½< =
Mix
ï¿½ï¿½= @
.
ï¿½ï¿½@ A
Cms
ï¿½ï¿½A D
.
ï¿½ï¿½D E
Lib
ï¿½ï¿½E H
.
ï¿½ï¿½H I

ViewModels
ï¿½ï¿½I S
.
ï¿½ï¿½S T
MixProductMedias
ï¿½ï¿½T d
.
ï¿½ï¿½d e

ReadViewModel
ï¿½ï¿½e r
>
ï¿½ï¿½r s
>
ï¿½ï¿½s t
>
ï¿½ï¿½t u
GetListByProductï¿½ï¿½v ï¿½
(ï¿½ï¿½ï¿½ ï¿½

RequestPagingï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
intï¿½ï¿½ï¿½ ï¿½
?ï¿½ï¿½ï¿½ ï¿½
	productIdï¿½ï¿½ï¿½ ï¿½
=ï¿½ï¿½ï¿½ ï¿½
nullï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
{
ï¿½ï¿½ 	
var
ï¿½ï¿½ 
data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ 
Lib
ï¿½ï¿½  
.
ï¿½ï¿½  !

ViewModels
ï¿½ï¿½! +
.
ï¿½ï¿½+ ,
MixProductMedias
ï¿½ï¿½, <
.
ï¿½ï¿½< =

ReadViewModel
ï¿½ï¿½= J
.
ï¿½ï¿½J K

Repository
ï¿½ï¿½K U
.
ï¿½ï¿½U V!
GetModelListByAsync
ï¿½ï¿½V i
(
ï¿½ï¿½i j
m
ï¿½ï¿½ 

=>
ï¿½ï¿½ 
m
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	ProductId
ï¿½ï¿½ 
==
ï¿½ï¿½ 
	productId
ï¿½ï¿½  )
&&
ï¿½ï¿½* ,
m
ï¿½ï¿½- .
.
ï¿½ï¿½. /
Specificulture
ï¿½ï¿½/ =
==
ï¿½ï¿½> @
_lang
ï¿½ï¿½A F
,
ï¿½ï¿½F G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
OrderBy
ï¿½ï¿½P W
,
ï¿½ï¿½ 

request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	Direction
ï¿½ï¿½ 
,
ï¿½ï¿½  
request
ï¿½ï¿½! (
.
ï¿½ï¿½( )
PageSize
ï¿½ï¿½) 1
,
ï¿½ï¿½1 2
request
ï¿½ï¿½3 :
.
ï¿½ï¿½: ;
	PageIndex
ï¿½ï¿½; D
)
ï¿½ï¿½D E
.
ï¿½ï¿½ 

ConfigureAwait
ï¿½ï¿½
 
(
ï¿½ï¿½ 
false
ï¿½ï¿½ !
)
ï¿½ï¿½! "
;
ï¿½ï¿½" #
return
ï¿½ï¿½ 
data
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
	protected
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ 
string
ï¿½ï¿½ #
>
ï¿½ï¿½# $
UploadFileAsync
ï¿½ï¿½% 4
(
ï¿½ï¿½4 5
	IFormFile
ï¿½ï¿½5 >
file
ï¿½ï¿½? C
,
ï¿½ï¿½C D
string
ï¿½ï¿½E K

folderPath
ï¿½ï¿½L V
)
ï¿½ï¿½V W
{
ï¿½ï¿½ 	
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
file
ï¿½ï¿½ 
?
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Length
ï¿½ï¿½ 
>
ï¿½ï¿½ 
$num
ï¿½ï¿½  
)
ï¿½ï¿½  !
{
ï¿½ï¿½ 

string
ï¿½ï¿½ 
fileName
ï¿½ï¿½ 
=
ï¿½ï¿½  !
await
ï¿½ï¿½" '
CommonHelper
ï¿½ï¿½( 4
.
ï¿½ï¿½4 5
UploadFileAsync
ï¿½ï¿½5 D
(
ï¿½ï¿½D E

folderPath
ï¿½ï¿½E O
,
ï¿½ï¿½O P
file
ï¿½ï¿½Q U
)
ï¿½ï¿½U V
.
ï¿½ï¿½V W
ConfigureAwait
ï¿½ï¿½W e
(
ï¿½ï¿½e f
false
ï¿½ï¿½f k
)
ï¿½ï¿½k l
;
ï¿½ï¿½l m
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
string
ï¿½ï¿½ 
.
ï¿½ï¿½ 

IsNullOrEmpty
ï¿½ï¿½ )
(
ï¿½ï¿½) *
fileName
ï¿½ï¿½* 2
)
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
{
ï¿½ï¿½ 
string
ï¿½ï¿½ 
filePath
ï¿½ï¿½ #
=
ï¿½ï¿½$ %
string
ï¿½ï¿½& ,
.
ï¿½ï¿½, -
Format
ï¿½ï¿½- 3
(
ï¿½ï¿½3 4
$str
ï¿½ï¿½4 =
,
ï¿½ï¿½= >

folderPath
ï¿½ï¿½? I
,
ï¿½ï¿½I J
fileName
ï¿½ï¿½K S
)
ï¿½ï¿½S T
;
ï¿½ï¿½T U
return
ï¿½ï¿½ 
filePath
ï¿½ï¿½ #
;
ï¿½ï¿½# $
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
return
ï¿½ï¿½ 
string
ï¿½ï¿½ !
.
ï¿½ï¿½! "
Empty
ï¿½ï¿½" '
;
ï¿½ï¿½' (
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 

else
ï¿½ï¿½ 
{
ï¿½ï¿½ 

return
ï¿½ï¿½ 
string
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Empty
ï¿½ï¿½ #
;
ï¿½ï¿½# $
}
ï¿½ï¿½ 

}
ï¿½ï¿½ 	
}
ï¿½ï¿½ 
}ï¿½ï¿½ Ç
[C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiModuleController.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 

(
 
$str  
)  !
]! "
[ 
Route 

(
 
$str $
)$ %
]% &
public 

class 
ApiModuleController $
:% &
BaseApiController 
{ 
public 
ApiModuleController "
(" #
	Microsoft# ,
., -

AspNetCore- 7
.7 8
SignalR8 ?
.? @
IHubContext@ K
<K L
HubL O
.O P
	PortalHubP Y
>Y Z

hubContext[ e
)e f
:g h
basei m
(m n

hubContextn x
)x y
{ 	
} 	
[## 	
HttpGet##	 
,## 
HttpOptions## 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
RepositoryResponse%% ,
<%%, -
	MixModule%%- 6
>%%6 7
>%%7 8
DeleteAsync%%9 D
(%%D E
int%%E H
id%%I K
)%%K L
{&& 	
var'' 
	getModule'' 
='' 
await'' !!
ReadListItemViewModel''" 7
.''7 8

Repository''8 B
.''B C
GetSingleModelAsync''C V
(''V W
model(( 
=>(( 
model(( 
.(( 
Id(( !
==((" $
id((% '
&&((( *
model((+ 0
.((0 1
Specificulture((1 ?
==((@ B
_lang((C H
)((H I
;((I J
if)) 
()) 
	getModule)) 
.)) 
	IsSucceed)) #
)))# $
{** 

return,, 
await,, 
	getModule,, &
.,,& '
Data,,' +
.,,+ ,
RemoveModelAsync,,, <
(,,< =
true,,= A
),,A B
;,,B C
}-- 

else.. 
{// 

return00 
new00 
RepositoryResponse00 -
<00- .
	MixModule00. 7
>007 8
(008 9
)009 :
{11 
	IsSucceed22 
=22 
false22  %
}33 
;33 
}44 

}55 	
[88 	
HttpGet88	 
,88 
HttpOptions88 
]88 
[99 	
Route99	 
(99 
$str99 (
)99( )
]99) *
[:: 	
Route::	 
(:: 
$str:: #
)::# $
]::$ %
public;; 
async;; 
Task;; 
<;; 
ActionResult;; &
<;;& '
JObject;;' .
>;;. /
>;;/ 0
Details;;1 8
(;;8 9
string;;9 ?
viewType;;@ H
,;;H I
int;;J M
?;;M N
id;;O Q
);;Q R
{<< 	
switch== 
(== 
viewType== 
)== 
{>> 

case?? 
$str?? 
:?? 
if@@ 
(@@ 
id@@ 
.@@ 
HasValue@@ #
)@@# $
{AA 
varBB 
beResultBB $
=BB% &
awaitBB' ,
UpdateViewModelBB- <
.BB< =

RepositoryBB= G
.BBG H
GetSingleModelAsyncBBH [
(BB[ \
modelBB\ a
=>BBb d
modelBBe j
.BBj k
IdBBk m
==BBn p
idBBq s
&&BBt v
modelBBw |
.BB| }
Specificulture	BB} ï¿½
==
BBï¿½ ï¿½
_lang
BBï¿½ ï¿½
)
BBï¿½ ï¿½
.
BBï¿½ ï¿½
ConfigureAwait
BBï¿½ ï¿½
(
BBï¿½ ï¿½
false
BBï¿½ ï¿½
)
BBï¿½ ï¿½
;
BBï¿½ ï¿½
returnCC 
OkCC !
(CC! "
JObjectCC" )
.CC) *

FromObjectCC* 4
(CC4 5
beResultCC5 =
)CC= >
)CC> ?
;CC? @
}DD 
elseEE 
{FF 
varGG 
modelGG !
=GG" #
newGG$ '
	MixModuleGG( 1
(GG1 2
)GG2 3
{HH 
SpecificultureII *
=II+ ,
_langII- 2
,II2 3
StatusJJ "
=JJ# $

MixServiceJJ% /
.JJ/ 0
	GetConfigJJ0 9
<JJ9 :
intJJ: =
>JJ= >
(JJ> ?
MixConstantsJJ? K
.JJK L 
ConfigurationKeywordJJL `
.JJ` a 
DefaultContentStatusJJa u
)JJu v
,JJv w
PageSizeKK $
=KK% &
$numKK' )
,KK) *
PriorityLL $
=LL% &
UpdateViewModelLL' 6
.LL6 7

RepositoryLL7 A
.LLA B
MaxLLB E
(LLE F
aLLF G
=>LLH J
aLLK L
.LLL M
PriorityLLM U
)LLU V
.LLV W
DataLLW [
+LL\ ]
$numLL^ _
}MM 
;MM 
RepositoryResponseOO *
<OO* +
UpdateViewModelOO+ :
>OO: ;
resultOO< B
=OOC D
newOOE H
RepositoryResponseOOI [
<OO[ \
UpdateViewModelOO\ k
>OOk l
(OOl m
)OOm n
{PP 
	IsSucceedQQ %
=QQ& '
trueQQ( ,
,QQ, -
DataRR  
=RR! "
awaitRR# (
UpdateViewModelRR) 8
.RR8 9

InitViewAsyncRR9 F
(RRF G
modelRRG L
)RRL M
}SS 
;SS 
returnTT 
JObjectTT &
.TT& '

FromObjectTT' 1
(TT1 2
resultTT2 8
)TT8 9
;TT9 :
}UU 
defaultVV 
:VV 
ifWW 
(WW 
idWW 
.WW 
HasValueWW #
)WW# $
{XX 
varYY 
beResultYY $
=YY% &
awaitYY' ,
ReadMvcViewModelYY- =
.YY= >

RepositoryYY> H
.YYH I
GetSingleModelAsyncYYI \
(YY\ ]
modelYY] b
=>YYc e
modelYYf k
.YYk l
IdYYl n
==YYo q
idYYr t
&&YYu w
modelYYx }
.YY} ~
Specificulture	YY~ ï¿½
==
YYï¿½ ï¿½
_lang
YYï¿½ ï¿½
)
YYï¿½ ï¿½
.
YYï¿½ ï¿½
ConfigureAwait
YYï¿½ ï¿½
(
YYï¿½ ï¿½
false
YYï¿½ ï¿½
)
YYï¿½ ï¿½
;
YYï¿½ ï¿½
returnZZ 
JObjectZZ &
.ZZ& '

FromObjectZZ' 1
(ZZ1 2
beResultZZ2 :
)ZZ: ;
;ZZ; <
}[[ 
else\\ 
{]] 
var^^ 
model^^ !
=^^" #
new^^$ '
	MixModule^^( 1
(^^1 2
)^^2 3
;^^3 4
RepositoryResponse__ *
<__* +
ReadMvcViewModel__+ ;
>__; <
result__= C
=__D E
new__F I
RepositoryResponse__J \
<__\ ]
ReadMvcViewModel__] m
>__m n
(__n o
)__o p
{`` 
	IsSucceedaa %
=aa& '
trueaa( ,
,aa, -
Databb  
=bb! "
newbb# &
ReadMvcViewModelbb' 7
(bb7 8
modelbb8 =
)bb= >
{cc 
Specificulturedd  .
=dd/ 0
_langdd1 6
,dd6 7
Statusee  &
=ee' (
MixContentStatusee) 9
.ee9 :
Previewee: A
,eeA B
PageSizeff  (
=ff) *
$numff+ -
}gg 
}hh 
;hh 
returnii 
JObjectii &
.ii& '

FromObjectii' 1
(ii1 2
resultii2 8
)ii8 9
;ii9 :
}jj 
}kk 

}ll 	
[tt 	
	Authorizett	 
(tt !
AuthenticationSchemestt (
=tt) *
JwtBearerDefaultstt+ <
.tt< = 
AuthenticationSchemett= Q
,ttQ R
RolesttS X
=ttY Z
$strtt[ n
)ttn o
]tto p
[uu 	
HttpPostuu	 
,uu 
HttpOptionsuu 
]uu 
[vv 	
Routevv	 
(vv 
$strvv 
)vv 
]vv 
publicww 
asyncww 
Taskww 
<ww 
RepositoryResponseww ,
<ww, -
UpdateViewModelww- <
>ww< =
>ww= >
Postww? C
(wwC D
[wwD E
FromBodywwE M
]wwM N
UpdateViewModelwwN ]
modelww^ c
)wwc d
{xx 	
ifyy 
(yy 
modelyy 
!=yy 
nullyy 
)yy 
{zz 

model{{ 
.{{ 
	CreatedBy{{ 
={{  !
User{{" &
.{{& '
Claims{{' -
.{{- .
FirstOrDefault{{. <
({{< =
c{{= >
=>{{? A
c{{B C
.{{C D
Type{{D H
=={{I K
$str{{L V
){{V W
?{{W X
.{{X Y
Value{{Y ^
;{{^ _
var|| 
result|| 
=|| 
await|| "
model||# (
.||( )
SaveModelAsync||) 7
(||7 8
true||8 <
)||< =
.||= >
ConfigureAwait||> L
(||L M
false||M R
)||R S
;||S T
return}} 
result}} 
;}} 
}~~ 

return 
new 
RepositoryResponse )
<) *
UpdateViewModel* 9
>9 :
(: ;
); <
{= >
Status? E
=F G
$numH K
}L M
;M N
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
	MixModule
ï¿½ï¿½- 6
>
ï¿½ï¿½6 7
>
ï¿½ï¿½7 8

SaveFields
ï¿½ï¿½9 C
(
ï¿½ï¿½C D
int
ï¿½ï¿½D G
id
ï¿½ï¿½H J
,
ï¿½ï¿½J K
[
ï¿½ï¿½L M
FromBody
ï¿½ï¿½M U
]
ï¿½ï¿½U V
List
ï¿½ï¿½V Z
<
ï¿½ï¿½Z [
EntityField
ï¿½ï¿½[ f
>
ï¿½ï¿½f g
fields
ï¿½ï¿½h n
)
ï¿½ï¿½n o
{
ï¿½ï¿½ 	
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
fields
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
new
ï¿½ï¿½   
RepositoryResponse
ï¿½ï¿½! 3
<
ï¿½ï¿½3 4
	MixModule
ï¿½ï¿½4 =
>
ï¿½ï¿½= >
(
ï¿½ï¿½> ?
)
ï¿½ï¿½? @
{
ï¿½ï¿½A B
	IsSucceed
ï¿½ï¿½C L
=
ï¿½ï¿½M N
true
ï¿½ï¿½O S
}
ï¿½ï¿½T U
;
ï¿½ï¿½U V
foreach
ï¿½ï¿½ 
(
ï¿½ï¿½ 
var
ï¿½ï¿½ 
property
ï¿½ï¿½ %
in
ï¿½ï¿½& (
fields
ï¿½ï¿½) /
)
ï¿½ï¿½/ 0
{
ï¿½ï¿½ 
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &#
ReadListItemViewModel
ï¿½ï¿½' <
.
ï¿½ï¿½< =

Repository
ï¿½ï¿½= G
.
ï¿½ï¿½G H
UpdateFieldsAsync
ï¿½ï¿½H Y
(
ï¿½ï¿½Y Z
c
ï¿½ï¿½Z [
=>
ï¿½ï¿½\ ^
c
ï¿½ï¿½_ `
.
ï¿½ï¿½` a
Id
ï¿½ï¿½a c
==
ï¿½ï¿½d f
id
ï¿½ï¿½g i
&&
ï¿½ï¿½j l
c
ï¿½ï¿½m n
.
ï¿½ï¿½n o
Specificulture
ï¿½ï¿½o }
==ï¿½ï¿½~ ï¿½
_langï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
fieldsï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
break
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
	MixModule
ï¿½ï¿½* 3
>
ï¿½ï¿½3 4
(
ï¿½ï¿½4 5
)
ï¿½ï¿½5 6
;
ï¿½ï¿½6 7
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ 
JObject
ï¿½ï¿½ !
>
ï¿½ï¿½! "
GetList
ï¿½ï¿½# *
(
ï¿½ï¿½* +
[
ï¿½ï¿½ 

FromBody
ï¿½ï¿½
 
]
ï¿½ï¿½ 

RequestPaging
ï¿½ï¿½ $
request
ï¿½ï¿½% ,
)
ï¿½ï¿½, -
{
ï¿½ï¿½ 	$
ParseRequestPagingDate
ï¿½ï¿½ "
(
ï¿½ï¿½" #
request
ï¿½ï¿½# *
)
ï¿½ï¿½* +
;
ï¿½ï¿½+ ,

Expression
ï¿½ï¿½ 
<
ï¿½ï¿½ 
Func
ï¿½ï¿½ 
<
ï¿½ï¿½ 
	MixModule
ï¿½ï¿½ %
,
ï¿½ï¿½% &
bool
ï¿½ï¿½' +
>
ï¿½ï¿½+ ,
>
ï¿½ï¿½, -
	predicate
ï¿½ï¿½. 7
=
ï¿½ï¿½8 9
model
ï¿½ï¿½: ?
=>
ï¿½ï¿½@ B
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Specificulture
ï¿½ï¿½ ,
==
ï¿½ï¿½- /
_lang
ï¿½ï¿½0 5
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Status
ï¿½ï¿½% +
.
ï¿½ï¿½+ ,
HasValue
ï¿½ï¿½, 4
||
ï¿½ï¿½5 7
model
ï¿½ï¿½8 =
.
ï¿½ï¿½= >
Status
ï¿½ï¿½> D
==
ï¿½ï¿½E G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
Status
ï¿½ï¿½P V
.
ï¿½ï¿½V W
Value
ï¿½ï¿½W \
)
ï¿½ï¿½\ ]
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
string
ï¿½ï¿½ "
.
ï¿½ï¿½" # 
IsNullOrWhiteSpace
ï¿½ï¿½# 5
(
ï¿½ï¿½5 6
request
ï¿½ï¿½6 =
.
ï¿½ï¿½= >
Keyword
ï¿½ï¿½> E
)
ï¿½ï¿½E F
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
Title
ï¿½ï¿½& +
.
ï¿½ï¿½+ ,
Contains
ï¿½ï¿½, 4
(
ï¿½ï¿½4 5
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
Keyword
ï¿½ï¿½= D
)
ï¿½ï¿½D E
||
ï¿½ï¿½ 
model
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Description
ï¿½ï¿½% 0
.
ï¿½ï¿½0 1
Contains
ï¿½ï¿½1 9
(
ï¿½ï¿½9 :
request
ï¿½ï¿½: A
.
ï¿½ï¿½A B
Keyword
ï¿½ï¿½B I
)
ï¿½ï¿½I J
)
ï¿½ï¿½J K
)
ï¿½ï¿½K L
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
FromDate
ï¿½ï¿½% -
.
ï¿½ï¿½- .
HasValue
ï¿½ï¿½. 6
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
CreatedDateTime
ï¿½ï¿½& 5
>=
ï¿½ï¿½6 8
request
ï¿½ï¿½9 @
.
ï¿½ï¿½@ A
FromDate
ï¿½ï¿½A I
.
ï¿½ï¿½I J
Value
ï¿½ï¿½J O
)
ï¿½ï¿½O P
)
ï¿½ï¿½ 
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
ToDate
ï¿½ï¿½% +
.
ï¿½ï¿½+ ,
HasValue
ï¿½ï¿½, 4
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
CreatedDateTime
ï¿½ï¿½& 5
<=
ï¿½ï¿½6 8
request
ï¿½ï¿½9 @
.
ï¿½ï¿½@ A
ToDate
ï¿½ï¿½A G
.
ï¿½ï¿½G H
Value
ï¿½ï¿½H M
)
ï¿½ï¿½M N
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
switch
ï¿½ï¿½ 
(
ï¿½ï¿½ 
request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Key
ï¿½ï¿½ 
)
ï¿½ï¿½  
{
ï¿½ï¿½ 

case
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
	mvcResult
ï¿½ï¿½ !
=
ï¿½ï¿½" #
await
ï¿½ï¿½$ )
ReadMvcViewModel
ï¿½ï¿½* :
.
ï¿½ï¿½: ;

Repository
ï¿½ï¿½; E
.
ï¿½ï¿½E F!
GetModelListByAsync
ï¿½ï¿½F Y
(
ï¿½ï¿½Y Z
	predicate
ï¿½ï¿½Z c
,
ï¿½ï¿½c d
request
ï¿½ï¿½e l
.
ï¿½ï¿½l m
OrderBy
ï¿½ï¿½m t
,
ï¿½ï¿½t u
request
ï¿½ï¿½v }
.
ï¿½ï¿½} ~
	Directionï¿½ï¿½~ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
PageSizeï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	PageIndexï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
	mvcResult
ï¿½ï¿½. 7
)
ï¿½ï¿½7 8
;
ï¿½ï¿½8 9
case
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
portalResult
ï¿½ï¿½ $
=
ï¿½ï¿½% &
await
ï¿½ï¿½' ,
UpdateViewModel
ï¿½ï¿½- <
.
ï¿½ï¿½< =

Repository
ï¿½ï¿½= G
.
ï¿½ï¿½G H!
GetModelListByAsync
ï¿½ï¿½H [
(
ï¿½ï¿½[ \
	predicate
ï¿½ï¿½\ e
,
ï¿½ï¿½e f
request
ï¿½ï¿½g n
.
ï¿½ï¿½n o
OrderBy
ï¿½ï¿½o v
,
ï¿½ï¿½v w
request
ï¿½ï¿½x 
.ï¿½ï¿½ ï¿½
	Directionï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
PageSizeï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	PageIndexï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
portalResult
ï¿½ï¿½. :
)
ï¿½ï¿½: ;
;
ï¿½ï¿½; <
default
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ $#
ReadListItemViewModel
ï¿½ï¿½% :
.
ï¿½ï¿½: ;

Repository
ï¿½ï¿½; E
.
ï¿½ï¿½E F!
GetModelListByAsync
ï¿½ï¿½F Y
(
ï¿½ï¿½Y Z
	predicate
ï¿½ï¿½Z c
,
ï¿½ï¿½c d
request
ï¿½ï¿½e l
.
ï¿½ï¿½l m
OrderBy
ï¿½ï¿½m t
,
ï¿½ï¿½t u
request
ï¿½ï¿½v }
.
ï¿½ï¿½} ~
	Directionï¿½ï¿½~ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
PageSizeï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	PageIndexï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
data
ï¿½ï¿½. 2
)
ï¿½ï¿½2 3
;
ï¿½ï¿½3 4
}
ï¿½ï¿½ 

}
ï¿½ï¿½ 	
}
ï¿½ï¿½ 
}ï¿½ï¿½ ï¿½ï¿½
YC:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiPageController.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 

(
 
$str  
)  !
]! "
[ 
Route 

(
 
$str "
)" #
]# $
public 

class 
ApiPageController "
:# $$
BaseGenericApiControoler  
<  !

MixCmsContext! .
,. /
MixPage0 7
>7 8
{ 
public   
ApiPageController    
(    !
IMemoryCache  ! -
memoryCache  . 9
,  9 :
IHubContext  ; F
<  F G
	PortalHub  G P
>  P Q

hubContext  R \
)  \ ]
:  ^ _
base  ` d
(  d e
memoryCache  e p
,  p q

hubContext  r |
)  | }
{!! 	
}## 	
['' 	
HttpGet''	 
,'' 
HttpOptions'' 
]'' 
[(( 	
Route((	 
((( 
$str(( 
)(( 
](( 
public)) 
async)) 
Task)) 
<)) 
RepositoryResponse)) ,
<)), -
MixPage))- 4
>))4 5
>))5 6
DeleteAsync))7 B
())B C
int))C F
id))G I
)))I J
{** 	
var++ 
getPage++ 
=++ 
await++ !
ReadListItemViewModel++  5
.++5 6

Repository++6 @
.++@ A
GetSingleModelAsync++A T
(++T U
model,, 
=>,, 
model,, 
.,, 
Id,, !
==,," $
id,,% '
&&,,( *
model,,+ 0
.,,0 1
Specificulture,,1 ?
==,,@ B
_lang,,C H
),,H I
;,,I J
if-- 
(-- 
getPage-- 
.-- 
	IsSucceed-- !
)--! "
{.. 

return00 
await00 
getPage00 $
.00$ %
Data00% )
.00) *
RemoveModelAsync00* :
(00: ;
true00; ?
)00? @
;00@ A
}11 

else22 
{33 

return44 
new44 
RepositoryResponse44 -
<44- .
MixPage44. 5
>445 6
(446 7
)447 8
{55 
	IsSucceed66 
=66 
false66  %
}77 
;77 
}88 

}99 	
[<< 	
HttpGet<<	 
,<< 
HttpOptions<< 
]<< 
[== 	
Route==	 
(== 
$str== (
)==( )
]==) *
[>> 	
Route>>	 
(>> 
$str>> #
)>># $
]>>$ %
public?? 
async?? 
Task?? 
<?? 
ActionResult?? &
<??& '
JObject??' .
>??. /
>??/ 0
Details??1 8
(??8 9
string??9 ?
viewType??@ H
,??H I
int??J M
???M N
id??O Q
)??Q R
{@@ 	
stringAA 
msgAA 
=AA 
stringAA 
.AA  
EmptyAA  %
;AA% &
switchBB 
(BB 
viewTypeBB 
)BB 
{CC 

caseDD 
$strDD 
:DD 
ifEE 
(EE 
idEE 
.EE 
HasValueEE #
)EE# $
{FF 

ExpressionGG "
<GG" #
FuncGG# '
<GG' (
MixPageGG( /
,GG/ 0
boolGG1 5
>GG5 6
>GG6 7
	predicateGG8 A
=GGB C
modelGGD I
=>GGJ L
modelGGM R
.GGR S
IdGGS U
==GGV X
idGGY [
&&GG\ ^
modelGG_ d
.GGd e
SpecificultureGGe s
==GGt v
_langGGw |
;GG| }
varHH 
portalResultHH (
=HH) *
awaitHH+ 0
baseHH1 5
.HH5 6
GetSingleAsyncHH6 D
<HHD E
UpdateViewModelHHE T
>HHT U
(HHU V
$"HHV X
{HHX Y
viewTypeHHY a
}HHa b
_HHb c
{HHc d
idHHd f
}HHf g
"HHg h
,HHh i
	predicateHHj s
)HHs t
;HHt u
ifII 
(II 
portalResultII (
.II( )
	IsSucceedII) 2
)II2 3
{JJ 
portalResultKK (
.KK( )
DataKK) -
.KK- .

DetailsUrlKK. 8
=KK9 :
MixCmsHelperKK; G
.KKG H
GetRouterUrlKKH T
(KKT U
$strKKU [
,KK[ \
newKK] `
{KKa b
portalResultKKc o
.KKo p
DataKKp t
.KKt u
SeoNameKKu |
}KK} ~
,KK~ 
Request
KKï¿½ ï¿½
,
KKï¿½ ï¿½
Url
KKï¿½ ï¿½
)
KKï¿½ ï¿½
;
KKï¿½ ï¿½
}LL 
returnNN 
OkNN !
(NN! "
JObjectNN" )
.NN) *

FromObjectNN* 4
(NN4 5
portalResultNN5 A
)NNA B
)NNB C
;NNC D
}OO 
elsePP 
{QQ 
varRR 
modelRR !
=RR" #
newRR$ '
MixPageRR( /
(RR/ 0
)RR0 1
{SS 
SpecificultureTT *
=TT+ ,
_langTT- 2
,TT2 3
StatusUU "
=UU# $

MixServiceUU% /
.UU/ 0
	GetConfigUU0 9
<UU9 :
intUU: =
>UU= >
(UU> ?
$strUU? N
)UUN O
,UUO P
PageSizeVV $
=VV% &
$numVV' )
,WW 
PriorityXX $
=XX% &
UpdateViewModelXX' 6
.XX6 7

RepositoryXX7 A
.XXA B
MaxXXB E
(XXE F
aXXF G
=>XXH J
aXXK L
.XXL M
PriorityXXM U
)XXU V
.XXV W
DataXXW [
+XX\ ]
$numXX^ _
}YY 
;YY 
RepositoryResponse[[ *
<[[* +
UpdateViewModel[[+ :
>[[: ;
result[[< B
=[[C D
await[[E J
base[[K O
.[[O P
GetSingleAsync[[P ^
<[[^ _
UpdateViewModel[[_ n
>[[n o
([[o p
$"[[p r
{[[r s
viewType[[s {
}[[{ |
_default	[[| ï¿½
"
[[ï¿½ ï¿½
,
[[ï¿½ ï¿½
null
[[ï¿½ ï¿½
,
[[ï¿½ ï¿½
model
[[ï¿½ ï¿½
)
[[ï¿½ ï¿½
;
[[ï¿½ ï¿½
return\\ 
JObject\\ &
.\\& '

FromObject\\' 1
(\\1 2
result\\2 8
)\\8 9
;\\9 :
}]] 
default^^ 
:^^ 
if__ 
(__ 
id__ 
.__ 
HasValue__ #
)__# $
{`` 
varaa 
beResultaa $
=aa% &
awaitaa' ,
ReadMvcViewModelaa- =
.aa= >

Repositoryaa> H
.aaH I
GetSingleModelAsyncaaI \
(aa\ ]
modelaa] b
=>aac e
modelaaf k
.aak l
Idaal n
==aao q
idaar t
&&aau w
modelaax }
.aa} ~
Specificulture	aa~ ï¿½
==
aaï¿½ ï¿½
_lang
aaï¿½ ï¿½
)
aaï¿½ ï¿½
.
aaï¿½ ï¿½
ConfigureAwait
aaï¿½ ï¿½
(
aaï¿½ ï¿½
false
aaï¿½ ï¿½
)
aaï¿½ ï¿½
;
aaï¿½ ï¿½
ifbb 
(bb 
beResultbb $
.bb$ %
	IsSucceedbb% .
)bb. /
{cc 
beResultdd $
.dd$ %
Datadd% )
.dd) *

DetailsUrldd* 4
=dd5 6
MixCmsHelperdd7 C
.ddC D
GetRouterUrlddD P
(ddP Q
$strddQ W
,ddW X
newddY \
{dd] ^
beResultdd_ g
.ddg h
Dataddh l
.ddl m
SeoNameddm t
}ddu v
,ddv w
Requestddx 
,	dd ï¿½
Url
ddï¿½ ï¿½
)
ddï¿½ ï¿½
;
ddï¿½ ï¿½
}ee 
returnff 
JObjectff &
.ff& '

FromObjectff' 1
(ff1 2
beResultff2 :
)ff: ;
;ff; <
}gg 
elsehh 
{ii 
varjj 
modeljj !
=jj" #
newjj$ '
MixPagejj( /
(jj/ 0
)jj0 1
;jj1 2
RepositoryResponsekk *
<kk* +
ReadMvcViewModelkk+ ;
>kk; <
resultkk= C
=kkD E
newkkF I
RepositoryResponsekkJ \
<kk\ ]
ReadMvcViewModelkk] m
>kkm n
(kkn o
)kko p
{ll 
	IsSucceedmm %
=mm& '
truemm( ,
,mm, -
Datann  
=nn! "
newnn# &
ReadMvcViewModelnn' 7
(nn7 8
modelnn8 =
)nn= >
{oo 
Specificulturepp  .
=pp/ 0
_langpp1 6
,pp6 7
Statusqq  &
=qq' (
MixContentStatusqq) 9
.qq9 :
Previewqq: A
,qqA B
PageSizerr  (
=rr) *
$numrr+ -
}ss 
}tt 
;tt 
returnuu 
JObjectuu &
.uu& '

FromObjectuu' 1
(uu1 2
resultuu2 8
)uu8 9
;uu9 :
}vv 
}ww 

}xx 	
[
ï¿½ï¿½ 	
	Authorize
ï¿½ï¿½	 
(
ï¿½ï¿½ #
AuthenticationSchemes
ï¿½ï¿½ (
=
ï¿½ï¿½) *
JwtBearerDefaults
ï¿½ï¿½+ <
.
ï¿½ï¿½< ="
AuthenticationScheme
ï¿½ï¿½= Q
,
ï¿½ï¿½Q R
Roles
ï¿½ï¿½S X
=
ï¿½ï¿½Y Z
$str
ï¿½ï¿½[ n
)
ï¿½ï¿½n o
]
ï¿½ï¿½o p
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
UpdateViewModel
ï¿½ï¿½- <
>
ï¿½ï¿½< =
>
ï¿½ï¿½= >
Post
ï¿½ï¿½? C
(
ï¿½ï¿½C D
[
ï¿½ï¿½D E
FromBody
ï¿½ï¿½E M
]
ï¿½ï¿½M N
UpdateViewModel
ï¿½ï¿½N ]
model
ï¿½ï¿½^ c
)
ï¿½ï¿½c d
{
ï¿½ï¿½ 	
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	CreatedBy
ï¿½ï¿½ 
=
ï¿½ï¿½  !
User
ï¿½ï¿½" &
.
ï¿½ï¿½& '
Claims
ï¿½ï¿½' -
.
ï¿½ï¿½- .
FirstOrDefault
ï¿½ï¿½. <
(
ï¿½ï¿½< =
c
ï¿½ï¿½= >
=>
ï¿½ï¿½? A
c
ï¿½ï¿½B C
.
ï¿½ï¿½C D
Type
ï¿½ï¿½D H
==
ï¿½ï¿½I K
$str
ï¿½ï¿½L V
)
ï¿½ï¿½V W
?
ï¿½ï¿½W X
.
ï¿½ï¿½X Y
Value
ï¿½ï¿½Y ^
;
ï¿½ï¿½^ _
var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ "
model
ï¿½ï¿½# (
.
ï¿½ï¿½( )
SaveModelAsync
ï¿½ï¿½) 7
(
ï¿½ï¿½7 8
true
ï¿½ï¿½8 <
)
ï¿½ï¿½< =
.
ï¿½ï¿½= >
ConfigureAwait
ï¿½ï¿½> L
(
ï¿½ï¿½L M
false
ï¿½ï¿½M R
)
ï¿½ï¿½R S
;
ï¿½ï¿½S T
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
UpdateViewModel
ï¿½ï¿½* 9
>
ï¿½ï¿½9 :
(
ï¿½ï¿½: ;
)
ï¿½ï¿½; <
{
ï¿½ï¿½= >
Status
ï¿½ï¿½? E
=
ï¿½ï¿½F G
$num
ï¿½ï¿½H K
}
ï¿½ï¿½L M
;
ï¿½ï¿½M N
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
MixPage
ï¿½ï¿½- 4
>
ï¿½ï¿½4 5
>
ï¿½ï¿½5 6

SaveFields
ï¿½ï¿½7 A
(
ï¿½ï¿½A B
int
ï¿½ï¿½B E
id
ï¿½ï¿½F H
,
ï¿½ï¿½H I
[
ï¿½ï¿½J K
FromBody
ï¿½ï¿½K S
]
ï¿½ï¿½S T
List
ï¿½ï¿½T X
<
ï¿½ï¿½X Y
EntityField
ï¿½ï¿½Y d
>
ï¿½ï¿½d e
fields
ï¿½ï¿½f l
)
ï¿½ï¿½l m
{
ï¿½ï¿½ 	
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
fields
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
new
ï¿½ï¿½   
RepositoryResponse
ï¿½ï¿½! 3
<
ï¿½ï¿½3 4
MixPage
ï¿½ï¿½4 ;
>
ï¿½ï¿½; <
(
ï¿½ï¿½< =
)
ï¿½ï¿½= >
{
ï¿½ï¿½? @
	IsSucceed
ï¿½ï¿½A J
=
ï¿½ï¿½K L
true
ï¿½ï¿½M Q
}
ï¿½ï¿½R S
;
ï¿½ï¿½S T
foreach
ï¿½ï¿½ 
(
ï¿½ï¿½ 
var
ï¿½ï¿½ 
property
ï¿½ï¿½ %
in
ï¿½ï¿½& (
fields
ï¿½ï¿½) /
)
ï¿½ï¿½/ 0
{
ï¿½ï¿½ 
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &#
ReadListItemViewModel
ï¿½ï¿½' <
.
ï¿½ï¿½< =

Repository
ï¿½ï¿½= G
.
ï¿½ï¿½G H
UpdateFieldsAsync
ï¿½ï¿½H Y
(
ï¿½ï¿½Y Z
c
ï¿½ï¿½Z [
=>
ï¿½ï¿½\ ^
c
ï¿½ï¿½_ `
.
ï¿½ï¿½` a
Id
ï¿½ï¿½a c
==
ï¿½ï¿½d f
id
ï¿½ï¿½g i
&&
ï¿½ï¿½j l
c
ï¿½ï¿½m n
.
ï¿½ï¿½n o
Specificulture
ï¿½ï¿½o }
==ï¿½ï¿½~ ï¿½
_langï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
fieldsï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
break
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
MixPage
ï¿½ï¿½* 1
>
ï¿½ï¿½1 2
(
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
;
ï¿½ï¿½4 5
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ 
JObject
ï¿½ï¿½ !
>
ï¿½ï¿½! "
GetList
ï¿½ï¿½# *
(
ï¿½ï¿½* +
[
ï¿½ï¿½ 

FromBody
ï¿½ï¿½
 
]
ï¿½ï¿½ 

RequestPaging
ï¿½ï¿½ $
request
ï¿½ï¿½% ,
)
ï¿½ï¿½, -
{
ï¿½ï¿½ 	
var
ï¿½ï¿½ 
parsed
ï¿½ï¿½ 
=
ï¿½ï¿½ 
HttpUtility
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
ParseQueryString
ï¿½ï¿½% 5
(
ï¿½ï¿½5 6
request
ï¿½ï¿½6 =
.
ï¿½ï¿½= >
Query
ï¿½ï¿½> C
??
ï¿½ï¿½D F
$str
ï¿½ï¿½G I
)
ï¿½ï¿½I J
;
ï¿½ï¿½J K
bool
ï¿½ï¿½ 
isLevel
ï¿½ï¿½ 
=
ï¿½ï¿½ 
int
ï¿½ï¿½ 
.
ï¿½ï¿½ 
TryParse
ï¿½ï¿½ '
(
ï¿½ï¿½' (
parsed
ï¿½ï¿½( .
.
ï¿½ï¿½. /
Get
ï¿½ï¿½/ 2
(
ï¿½ï¿½2 3
$str
ï¿½ï¿½3 :
)
ï¿½ï¿½: ;
,
ï¿½ï¿½; <
out
ï¿½ï¿½= @
int
ï¿½ï¿½A D
level
ï¿½ï¿½E J
)
ï¿½ï¿½J K
;
ï¿½ï¿½K L$
ParseRequestPagingDate
ï¿½ï¿½ "
(
ï¿½ï¿½" #
request
ï¿½ï¿½# *
)
ï¿½ï¿½* +
;
ï¿½ï¿½+ ,

Expression
ï¿½ï¿½ 
<
ï¿½ï¿½ 
Func
ï¿½ï¿½ 
<
ï¿½ï¿½ 
MixPage
ï¿½ï¿½ #
,
ï¿½ï¿½# $
bool
ï¿½ï¿½% )
>
ï¿½ï¿½) *
>
ï¿½ï¿½* +
	predicate
ï¿½ï¿½, 5
=
ï¿½ï¿½6 7
model
ï¿½ï¿½8 =
=>
ï¿½ï¿½> @
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Specificulture
ï¿½ï¿½ ,
==
ï¿½ï¿½- /
_lang
ï¿½ï¿½0 5
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Status
ï¿½ï¿½% +
.
ï¿½ï¿½+ ,
HasValue
ï¿½ï¿½, 4
||
ï¿½ï¿½5 7
model
ï¿½ï¿½8 =
.
ï¿½ï¿½= >
Status
ï¿½ï¿½> D
==
ï¿½ï¿½E G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
Status
ï¿½ï¿½P V
.
ï¿½ï¿½V W
Value
ï¿½ï¿½W \
)
ï¿½ï¿½\ ]
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
isLevel
ï¿½ï¿½ $
||
ï¿½ï¿½% '
model
ï¿½ï¿½( -
.
ï¿½ï¿½- .
Level
ï¿½ï¿½. 3
==
ï¿½ï¿½4 6
level
ï¿½ï¿½7 <
)
ï¿½ï¿½< =
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
string
ï¿½ï¿½ "
.
ï¿½ï¿½" # 
IsNullOrWhiteSpace
ï¿½ï¿½# 5
(
ï¿½ï¿½5 6
request
ï¿½ï¿½6 =
.
ï¿½ï¿½= >
Keyword
ï¿½ï¿½> E
)
ï¿½ï¿½E F
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
Title
ï¿½ï¿½& +
.
ï¿½ï¿½+ ,
Contains
ï¿½ï¿½, 4
(
ï¿½ï¿½4 5
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
Keyword
ï¿½ï¿½= D
)
ï¿½ï¿½D E
||
ï¿½ï¿½ 
model
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Excerpt
ï¿½ï¿½% ,
.
ï¿½ï¿½, -
Contains
ï¿½ï¿½- 5
(
ï¿½ï¿½5 6
request
ï¿½ï¿½6 =
.
ï¿½ï¿½= >
Keyword
ï¿½ï¿½> E
)
ï¿½ï¿½E F
)
ï¿½ï¿½F G
)
ï¿½ï¿½G H
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
FromDate
ï¿½ï¿½% -
.
ï¿½ï¿½- .
HasValue
ï¿½ï¿½. 6
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
CreatedDateTime
ï¿½ï¿½& 5
>=
ï¿½ï¿½6 8
request
ï¿½ï¿½9 @
.
ï¿½ï¿½@ A
FromDate
ï¿½ï¿½A I
.
ï¿½ï¿½I J
Value
ï¿½ï¿½J O
)
ï¿½ï¿½O P
)
ï¿½ï¿½ 
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
ToDate
ï¿½ï¿½% +
.
ï¿½ï¿½+ ,
HasValue
ï¿½ï¿½, 4
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
CreatedDateTime
ï¿½ï¿½& 5
<=
ï¿½ï¿½6 8
request
ï¿½ï¿½9 @
.
ï¿½ï¿½@ A
ToDate
ï¿½ï¿½A G
.
ï¿½ï¿½G H
Value
ï¿½ï¿½H M
)
ï¿½ï¿½M N
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
switch
ï¿½ï¿½ 
(
ï¿½ï¿½ 
request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Key
ï¿½ï¿½ 
)
ï¿½ï¿½  
{
ï¿½ï¿½ 

case
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
fedata
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &
ReadMvcViewModel
ï¿½ï¿½' 7
.
ï¿½ï¿½7 8

Repository
ï¿½ï¿½8 B
.
ï¿½ï¿½B C!
GetModelListByAsync
ï¿½ï¿½C V
(
ï¿½ï¿½V W
	predicate
ï¿½ï¿½W `
,
ï¿½ï¿½` a
request
ï¿½ï¿½b i
.
ï¿½ï¿½i j
OrderBy
ï¿½ï¿½j q
,
ï¿½ï¿½q r
request
ï¿½ï¿½s z
.
ï¿½ï¿½z {
	Directionï¿½ï¿½{ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
PageSizeï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	PageIndexï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
fedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
fedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ #
.
ï¿½ï¿½# $
Items
ï¿½ï¿½$ )
.
ï¿½ï¿½) *
ForEach
ï¿½ï¿½* 1
(
ï¿½ï¿½1 2
a
ï¿½ï¿½2 3
=>
ï¿½ï¿½4 6
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½ (
=
ï¿½ï¿½) *
MixCmsHelper
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetRouterUrl
ï¿½ï¿½8 D
(
ï¿½ï¿½D E
$str
ï¿½ï¿½  &
,
ï¿½ï¿½& '
new
ï¿½ï¿½( +
{
ï¿½ï¿½, -
seoName
ï¿½ï¿½. 5
=
ï¿½ï¿½6 7
a
ï¿½ï¿½8 9
.
ï¿½ï¿½9 :
SeoName
ï¿½ï¿½: A
}
ï¿½ï¿½B C
,
ï¿½ï¿½C D
Request
ï¿½ï¿½E L
,
ï¿½ï¿½L M
Url
ï¿½ï¿½N Q
)
ï¿½ï¿½Q R
;
ï¿½ï¿½R S
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

AlertAsync
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ .
,
ï¿½ï¿½. /
$num
ï¿½ï¿½0 3
,
ï¿½ï¿½3 4
$"
ï¿½ï¿½5 7
Get 
ï¿½ï¿½7 ;
{
ï¿½ï¿½; <
request
ï¿½ï¿½< C
.
ï¿½ï¿½C D
Key
ï¿½ï¿½D G
}
ï¿½ï¿½G H

 list page
ï¿½ï¿½H R
"
ï¿½ï¿½R S
)
ï¿½ï¿½S T
;
ï¿½ï¿½T U
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
fedata
ï¿½ï¿½. 4
)
ï¿½ï¿½4 5
;
ï¿½ï¿½5 6
case
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
bedata
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &
UpdateViewModel
ï¿½ï¿½' 6
.
ï¿½ï¿½6 7

Repository
ï¿½ï¿½7 A
.
ï¿½ï¿½A B!
GetModelListByAsync
ï¿½ï¿½B U
(
ï¿½ï¿½U V
	predicate
ï¿½ï¿½V _
,
ï¿½ï¿½_ `
request
ï¿½ï¿½a h
.
ï¿½ï¿½h i
OrderBy
ï¿½ï¿½i p
,
ï¿½ï¿½p q
request
ï¿½ï¿½r y
.
ï¿½ï¿½y z
	Directionï¿½ï¿½z ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
PageSizeï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	PageIndexï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
bedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
bedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ #
.
ï¿½ï¿½# $
Items
ï¿½ï¿½$ )
.
ï¿½ï¿½) *
ForEach
ï¿½ï¿½* 1
(
ï¿½ï¿½1 2
a
ï¿½ï¿½2 3
=>
ï¿½ï¿½4 6
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½ (
=
ï¿½ï¿½) *
MixCmsHelper
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetRouterUrl
ï¿½ï¿½8 D
(
ï¿½ï¿½D E
$str
ï¿½ï¿½  &
,
ï¿½ï¿½& '
new
ï¿½ï¿½( +
{
ï¿½ï¿½, -
seoName
ï¿½ï¿½. 5
=
ï¿½ï¿½6 7
a
ï¿½ï¿½8 9
.
ï¿½ï¿½9 :
SeoName
ï¿½ï¿½: A
}
ï¿½ï¿½B C
,
ï¿½ï¿½C D
Request
ï¿½ï¿½E L
,
ï¿½ï¿½L M
Url
ï¿½ï¿½N Q
)
ï¿½ï¿½Q R
;
ï¿½ï¿½R S
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

AlertAsync
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ .
,
ï¿½ï¿½. /
$num
ï¿½ï¿½0 3
,
ï¿½ï¿½3 4
$"
ï¿½ï¿½5 7
Get 
ï¿½ï¿½7 ;
{
ï¿½ï¿½; <
request
ï¿½ï¿½< C
.
ï¿½ï¿½C D
Key
ï¿½ï¿½D G
}
ï¿½ï¿½G H

 list page
ï¿½ï¿½H R
"
ï¿½ï¿½R S
)
ï¿½ï¿½S T
;
ï¿½ï¿½T U
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
bedata
ï¿½ï¿½. 4
)
ï¿½ï¿½4 5
;
ï¿½ï¿½5 6
default
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ $#
ReadListItemViewModel
ï¿½ï¿½% :
.
ï¿½ï¿½: ;

Repository
ï¿½ï¿½; E
.
ï¿½ï¿½E F!
GetModelListByAsync
ï¿½ï¿½F Y
(
ï¿½ï¿½Y Z
	predicate
ï¿½ï¿½Z c
,
ï¿½ï¿½c d
request
ï¿½ï¿½e l
.
ï¿½ï¿½l m
OrderBy
ï¿½ï¿½m t
,
ï¿½ï¿½t u
request
ï¿½ï¿½v }
.
ï¿½ï¿½} ~
	Directionï¿½ï¿½~ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
PageSizeï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	PageIndexï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
data
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ &
)
ï¿½ï¿½& '
{
ï¿½ï¿½ 
data
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ !
.
ï¿½ï¿½! "
Items
ï¿½ï¿½" '
.
ï¿½ï¿½' (
ForEach
ï¿½ï¿½( /
(
ï¿½ï¿½/ 0
(
ï¿½ï¿½0 1
Action
ï¿½ï¿½1 7
<
ï¿½ï¿½7 8#
ReadListItemViewModel
ï¿½ï¿½8 M
>
ï¿½ï¿½M N
)
ï¿½ï¿½N O
(
ï¿½ï¿½O P
a
ï¿½ï¿½P Q
=>
ï¿½ï¿½R T
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½ (
=
ï¿½ï¿½) *
MixCmsHelper
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetRouterUrl
ï¿½ï¿½8 D
(
ï¿½ï¿½D E
$str
ï¿½ï¿½  &
,
ï¿½ï¿½& '
new
ï¿½ï¿½( +
{
ï¿½ï¿½, -
seoName
ï¿½ï¿½. 5
=
ï¿½ï¿½6 7
a
ï¿½ï¿½8 9
.
ï¿½ï¿½9 :
SeoName
ï¿½ï¿½: A
}
ï¿½ï¿½B C
,
ï¿½ï¿½C D
Request
ï¿½ï¿½E L
,
ï¿½ï¿½L M
Url
ï¿½ï¿½N Q
)
ï¿½ï¿½Q R
;
ï¿½ï¿½R S
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Childs
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
ForEach
ï¿½ï¿½% ,
(
ï¿½ï¿½, -
(
ï¿½ï¿½- .
Action
ï¿½ï¿½. 4
<
ï¿½ï¿½4 5#
ReadListItemViewModel
ï¿½ï¿½5 J
>
ï¿½ï¿½J K
)
ï¿½ï¿½K L
(
ï¿½ï¿½L M
c
ï¿½ï¿½M N
=>
ï¿½ï¿½O Q
{
ï¿½ï¿½ 
c
ï¿½ï¿½  !
.
ï¿½ï¿½! "

DetailsUrl
ï¿½ï¿½" ,
=
ï¿½ï¿½- .
MixCmsHelper
ï¿½ï¿½/ ;
.
ï¿½ï¿½; <
GetRouterUrl
ï¿½ï¿½< H
(
ï¿½ï¿½H I
$str
ï¿½ï¿½$ *
,
ï¿½ï¿½* +
new
ï¿½ï¿½, /
{
ï¿½ï¿½0 1
seoName
ï¿½ï¿½2 9
=
ï¿½ï¿½: ;
c
ï¿½ï¿½< =
.
ï¿½ï¿½= >
SeoName
ï¿½ï¿½> E
}
ï¿½ï¿½F G
,
ï¿½ï¿½G H
Request
ï¿½ï¿½I P
,
ï¿½ï¿½P Q
Url
ï¿½ï¿½R U
)
ï¿½ï¿½U V
;
ï¿½ï¿½V W
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½  
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

AlertAsync
ï¿½ï¿½ 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ .
,
ï¿½ï¿½. /
$num
ï¿½ï¿½0 3
,
ï¿½ï¿½3 4
$"
ï¿½ï¿½5 7
Get 
ï¿½ï¿½7 ;
{
ï¿½ï¿½; <
request
ï¿½ï¿½< C
.
ï¿½ï¿½C D
Key
ï¿½ï¿½D G
}
ï¿½ï¿½G H

 list page
ï¿½ï¿½H R
"
ï¿½ï¿½R S
)
ï¿½ï¿½S T
;
ï¿½ï¿½T U
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
data
ï¿½ï¿½. 2
)
ï¿½ï¿½2 3
;
ï¿½ï¿½3 4
}
ï¿½ï¿½ 

}
ï¿½ï¿½ 	
}
ï¿½ï¿½ 
}ï¿½ï¿½ ï¿½ï¿½
[C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiPortalController.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 

(
 
$str  
)  !
]! "
[ 
Route 

(
 
$str 
) 
] 
public 

class 
ApiPortalController $
:% &
BaseApiController 
{ 
private   
readonly   
UserManager   $
<  $ %
ApplicationUser  % 4
>  4 5
_userManager  6 B
;  B C
private!! 
readonly!! 

SignInManager!! &
<!!& '
ApplicationUser!!' 6
>!!6 7
_signInManager!!8 F
;!!F G
private"" 
readonly"" 
RoleManager"" $
<""$ %
IdentityRole""% 1
>""1 2
_roleManager""3 ?
;""? @
public## 
ApiPortalController## "
(##" #
UserManager$$ 
<$$ 
ApplicationUser$$ &
>$$& '
userManager$$( 3
,$$3 4

SignInManager%% 
<%% 
ApplicationUser%% (
>%%( )

signInManager%%* 7
,%%7 8
RoleManager&& 
<&& 
IdentityRole&& #
>&&# $
roleManager&&% 0
,&&0 1
	Microsoft'' 
.'' 

AspNetCore''  
.''  !
SignalR''! (
.''( )
IHubContext'') 4
<''4 5
Hub''5 8
.''8 9
	PortalHub''9 B
>''B C

hubContext''D N
)(( 

:)) 

base)) 
()) 

hubContext)) 
))) 
{** 	
_userManager++ 
=++ 
userManager++ &
;++& '
_signInManager,, 
=,, 

signInManager,, *
;,,* +
_roleManager-- 
=-- 
roleManager-- &
;--& '
}.. 	
[33 	
HttpGet33	 
,33 
HttpOptions33 
]33 
[44 	
Route44	 
(44 
$str44 #
)44# $
]44$ %
[55 	
Route55	 
(55 
$str55 
)55 
]55 
public66 
RepositoryResponse66 !
<66! "#
GlobalSettingsViewModel66" 9
>669 :
Settings66; C
(66C D
)66D E
{77 	
var88 
cultures88 
=88 
CommonRepository88 +
.88+ ,
Instance88, 4
.884 5
LoadCultures885 A
(88A B
)88B C
;88C D
var99 
culture99 
=99 
cultures99 "
.99" #
FirstOrDefault99# 1
(991 2
c992 3
=>994 6
c997 8
.998 9
Specificulture999 G
==99H J
_lang99K P
)99P Q
;99Q R#
GlobalSettingsViewModel:: #
settings::$ ,
=::- .
new::/ 2#
GlobalSettingsViewModel::3 J
(::J K
)::K L
{;; 

Lang<< 
=<< 
_lang<< 
,<< 
ThemeId== 
=== 

MixService== $
.==$ %
	GetConfig==% .
<==. /
int==/ 2
>==2 3
(==3 4
MixConstants==4 @
.==@ A 
ConfigurationKeyword==A U
.==U V
ThemeId==V ]
,==] ^
_lang==_ d
)==d e
,==e f
Cultures>> 
=>> 
cultures>> #
,>># $
	PageTypes?? 
=?? 
Enum??  
.??  !
GetNames??! )
(??) *
typeof??* 0
(??0 1
MixPageType??1 <
)??< =
)??= >
.??> ?
ToList??? E
(??E F
)??F G
,??G H
Statuses@@ 
=@@ 
Enum@@ 
.@@  
GetNames@@  (
(@@( )
typeof@@) /
(@@/ 0
MixContentStatus@@0 @
)@@@ A
)@@A B
.@@B C
ToList@@C I
(@@I J
)@@J K
}BB 

;BB
 
settingsCC 
.CC 
LangIconCC 
=CC 
cultureCC  '
?CC' (
.CC( )
IconCC) -
??CC. 0

MixServiceCC1 ;
.CC; <
	GetConfigCC< E
<CCE F
stringCCF L
>CCL M
(CCM N
$strCCN X
)CCX Y
;CCY Z
returnDD 
newDD 
RepositoryResponseDD )
<DD) *#
GlobalSettingsViewModelDD* A
>DDA B
(DDB C
)DDC D
{EE 

	IsSucceedFF 
=FF 
trueFF  
,FF  !
DataGG 
=GG 
settingsGG 
}HH 

;HH
 
}II 	
[LL 	
HttpGetLL	 
,LL 
HttpOptionsLL 
]LL 
[MM 	
RouteMM	 
(MM 
$strMM '
)MM' (
]MM( )
[NN 	
RouteNN	 
(NN 
$strNN 
)NN 
]NN 
publicOO 
RepositoryResponseOO !
<OO! "
JObjectOO" )
>OO) *
AllSettingsAsyncOO+ ;
(OO; <
)OO< =
{PP 	
varQQ 
culturesQQ 
=QQ 
CommonRepositoryQQ +
.QQ+ ,
InstanceQQ, 4
.QQ4 5
LoadCulturesQQ5 A
(QQA B
)QQB C
;QQC D
varRR 
cultureRR 
=RR 
culturesRR "
.RR" #
FirstOrDefaultRR# 1
(RR1 2
cRR2 3
=>RR4 6
cRR7 8
.RR8 9
SpecificultureRR9 G
==RRH J
_langRRK P
)RRP Q
;RRQ R#
GlobalSettingsViewModelUU #
configurationsUU$ 2
=UU3 4
newUU5 8#
GlobalSettingsViewModelUU9 P
(UUP Q
)UUQ R
{VV 

LangWW 
=WW 
_langWW 
,WW 
ThemeIdXX 
=XX 

MixServiceXX $
.XX$ %
	GetConfigXX% .
<XX. /
intXX/ 2
>XX2 3
(XX3 4
MixConstantsXX4 @
.XX@ A 
ConfigurationKeywordXXA U
.XXU V
ThemeIdXXV ]
,XX] ^
_langXX_ d
)XXd e
,XXe f

ApiEncryptKeyYY 
=YY 

MixServiceYY  *
.YY* +
	GetConfigYY+ 4
<YY4 5
stringYY5 ;
>YY; <
(YY< =
MixConstantsYY= I
.YYI J 
ConfigurationKeywordYYJ ^
.YY^ _

ApiEncryptKeyYY_ l
)YYl m
,YYm n
IsEncryptApiZZ 
=ZZ 

MixServiceZZ )
.ZZ) *
	GetConfigZZ* 3
<ZZ3 4
boolZZ4 8
>ZZ8 9
(ZZ9 :
MixConstantsZZ: F
.ZZF G 
ConfigurationKeywordZZG [
.ZZ[ \
IsEncryptApiZZ\ h
)ZZh i
,ZZi j
Cultures[[ 
=[[ 
cultures[[ #
,[[# $
	PageTypes\\ 
=\\ 
Enum\\  
.\\  !
GetNames\\! )
(\\) *
typeof\\* 0
(\\0 1
MixPageType\\1 <
)\\< =
)\\= >
.\\> ?
ToList\\? E
(\\E F
)\\F G
,\\G H
Statuses]] 
=]] 
Enum]] 
.]]  
GetNames]]  (
(]]( )
typeof]]) /
(]]/ 0
MixContentStatus]]0 @
)]]@ A
)]]A B
.]]B C
ToList]]C I
(]]I J
)]]J K
}^^ 

;^^
 
configurations`` 
.`` 
LangIcon`` #
=``$ %
culture``& -
?``- .
.``. /
Icon``/ 3
??``4 6

MixService``7 A
.``A B
	GetConfig``B K
<``K L
string``L R
>``R S
(``S T
$str``T ^
)``^ _
;``_ `
varcc 

translatorcc 
=cc 
newcc  
JObjectcc! (
(cc( )
)cc) *
{dd 

newee 
	JPropertyee 
(ee 
$stree $
,ee$ %
_langee% *
)ee* +
,ee+ ,
newff 
	JPropertyff 
(ff 
$strff $
,ff$ %

MixServiceff& 0
.ff0 1

GetTranslatorff1 >
(ff> ?
_langff? D
)ffD E
)ffE F
}gg 

;gg
 
varjj 
settingsjj 
=jj 
newjj 
JObjectjj &
(jj& '
)jj' (
{kk 

newll 
	JPropertyll 
(ll 
$strll $
,ll$ %
_langll% *
)ll* +
,ll+ ,
newmm 
	JPropertymm 
(mm 
$strmm $
,mm$ %

MixServicemm& 0
.mm0 1
GetLocalSettingsmm1 A
(mmA B
_langmmB G
)mmG H
)mmH I
}nn 

;nn
 
JObjectoo 
resultoo 
=oo 
newoo  
JObjectoo! (
(oo( )
)oo) *
{pp 

newqq 
	JPropertyqq 
(qq 
$strqq .
,qq. /
JObjectqq0 7
.qq7 8

FromObjectqq8 B
(qqB C
configurationsqqC Q
)qqQ R
)qqR S
,qqS T
newrr 
	JPropertyrr 
(rr 
$strrr *
,rr* +

translatorrr, 6
)rr6 7
,rr7 8
newss 
	JPropertyss 
(ss 
$strss (
,ss( )
JObjectss* 1
.ss1 2

FromObjectss2 <
(ss< =
settingsss= E
)ssE F
)ssF G
}tt 

;tt
 
returnvv 
newvv 
RepositoryResponsevv )
<vv) *
JObjectvv* 1
>vv1 2
(vv2 3
)vv3 4
{ww 

	IsSucceedxx 
=xx 
truexx  
,xx  !
Datayy 
=yy 
resultyy 
}zz 

;zz
 
}{{ 	
[~~ 	
HttpGet~~	 
,~~ 
HttpOptions~~ 
]~~ 
[ 	
Route	 
( 
$str %
)% &
]& '
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ !
<
ï¿½ï¿½! "
JObject
ï¿½ï¿½" )
>
ï¿½ï¿½) *
	Languages
ï¿½ï¿½+ 4
(
ï¿½ï¿½4 5
)
ï¿½ï¿½5 6
{
ï¿½ï¿½ 	
return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
JObject
ï¿½ï¿½* 1
>
ï¿½ï¿½1 2
(
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
{
ï¿½ï¿½ 

	IsSucceed
ï¿½ï¿½ 
=
ï¿½ï¿½ 
true
ï¿½ï¿½  
,
ï¿½ï¿½  !
Data
ï¿½ï¿½ 
=
ï¿½ï¿½ 

MixService
ï¿½ï¿½ !
.
ï¿½ï¿½! "

GetTranslator
ï¿½ï¿½" /
(
ï¿½ï¿½/ 0
_lang
ï¿½ï¿½0 5
)
ï¿½ï¿½5 6
}
ï¿½ï¿½ 

;
ï¿½ï¿½
 
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpGet
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ *
)
ï¿½ï¿½* +
]
ï¿½ï¿½+ ,
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½  
)
ï¿½ï¿½  !
]
ï¿½ï¿½! "
public
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ !
<
ï¿½ï¿½! "
JObject
ï¿½ï¿½" )
>
ï¿½ï¿½) *
GetGlobalSettings
ï¿½ï¿½+ <
(
ï¿½ï¿½< =
)
ï¿½ï¿½= >
{
ï¿½ï¿½ 	
var
ï¿½ï¿½ 
cultures
ï¿½ï¿½ 
=
ï¿½ï¿½ 
CommonRepository
ï¿½ï¿½ +
.
ï¿½ï¿½+ ,
Instance
ï¿½ï¿½, 4
.
ï¿½ï¿½4 5
LoadCultures
ï¿½ï¿½5 A
(
ï¿½ï¿½A B
)
ï¿½ï¿½B C
;
ï¿½ï¿½C D
var
ï¿½ï¿½ 
culture
ï¿½ï¿½ 
=
ï¿½ï¿½ 
cultures
ï¿½ï¿½ "
.
ï¿½ï¿½" #
FirstOrDefault
ï¿½ï¿½# 1
(
ï¿½ï¿½1 2
c
ï¿½ï¿½2 3
=>
ï¿½ï¿½4 6
c
ï¿½ï¿½7 8
.
ï¿½ï¿½8 9
Specificulture
ï¿½ï¿½9 G
==
ï¿½ï¿½H J
_lang
ï¿½ï¿½K P
)
ï¿½ï¿½P Q
;
ï¿½ï¿½Q R%
GlobalSettingsViewModel
ï¿½ï¿½ #
configurations
ï¿½ï¿½$ 2
=
ï¿½ï¿½3 4
new
ï¿½ï¿½5 8%
GlobalSettingsViewModel
ï¿½ï¿½9 P
(
ï¿½ï¿½P Q
)
ï¿½ï¿½Q R
{
ï¿½ï¿½ 

Lang
ï¿½ï¿½ 
=
ï¿½ï¿½ 
_lang
ï¿½ï¿½ 
,
ï¿½ï¿½ 
ThemeId
ï¿½ï¿½ 
=
ï¿½ï¿½ 

MixService
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
	GetConfig
ï¿½ï¿½% .
<
ï¿½ï¿½. /
int
ï¿½ï¿½/ 2
>
ï¿½ï¿½2 3
(
ï¿½ï¿½3 4
MixConstants
ï¿½ï¿½4 @
.
ï¿½ï¿½@ A"
ConfigurationKeyword
ï¿½ï¿½A U
.
ï¿½ï¿½U V
ThemeId
ï¿½ï¿½V ]
,
ï¿½ï¿½] ^
_lang
ï¿½ï¿½_ d
)
ï¿½ï¿½d e
,
ï¿½ï¿½e f

ApiEncryptKey
ï¿½ï¿½ 
=
ï¿½ï¿½ 

MixService
ï¿½ï¿½  *
.
ï¿½ï¿½* +
	GetConfig
ï¿½ï¿½+ 4
<
ï¿½ï¿½4 5
string
ï¿½ï¿½5 ;
>
ï¿½ï¿½; <
(
ï¿½ï¿½< =
MixConstants
ï¿½ï¿½= I
.
ï¿½ï¿½I J"
ConfigurationKeyword
ï¿½ï¿½J ^
.
ï¿½ï¿½^ _

ApiEncryptKey
ï¿½ï¿½_ l
)
ï¿½ï¿½l m
,
ï¿½ï¿½m n
IsEncryptApi
ï¿½ï¿½ 
=
ï¿½ï¿½ 

MixService
ï¿½ï¿½ )
.
ï¿½ï¿½) *
	GetConfig
ï¿½ï¿½* 3
<
ï¿½ï¿½3 4
bool
ï¿½ï¿½4 8
>
ï¿½ï¿½8 9
(
ï¿½ï¿½9 :
MixConstants
ï¿½ï¿½: F
.
ï¿½ï¿½F G"
ConfigurationKeyword
ï¿½ï¿½G [
.
ï¿½ï¿½[ \
IsEncryptApi
ï¿½ï¿½\ h
)
ï¿½ï¿½h i
,
ï¿½ï¿½i j
Cultures
ï¿½ï¿½ 
=
ï¿½ï¿½ 
cultures
ï¿½ï¿½ #
,
ï¿½ï¿½# $
	PageTypes
ï¿½ï¿½ 
=
ï¿½ï¿½ 
Enum
ï¿½ï¿½  
.
ï¿½ï¿½  !
GetNames
ï¿½ï¿½! )
(
ï¿½ï¿½) *
typeof
ï¿½ï¿½* 0
(
ï¿½ï¿½0 1
MixPageType
ï¿½ï¿½1 <
)
ï¿½ï¿½< =
)
ï¿½ï¿½= >
.
ï¿½ï¿½> ?
ToList
ï¿½ï¿½? E
(
ï¿½ï¿½E F
)
ï¿½ï¿½F G
,
ï¿½ï¿½G H
Statuses
ï¿½ï¿½ 
=
ï¿½ï¿½ 
Enum
ï¿½ï¿½ 
.
ï¿½ï¿½  
GetNames
ï¿½ï¿½  (
(
ï¿½ï¿½( )
typeof
ï¿½ï¿½) /
(
ï¿½ï¿½/ 0
MixContentStatus
ï¿½ï¿½0 @
)
ï¿½ï¿½@ A
)
ï¿½ï¿½A B
.
ï¿½ï¿½B C
ToList
ï¿½ï¿½C I
(
ï¿½ï¿½I J
)
ï¿½ï¿½J K
}
ï¿½ï¿½ 

;
ï¿½ï¿½
 
configurations
ï¿½ï¿½ 
.
ï¿½ï¿½ 
LangIcon
ï¿½ï¿½ #
=
ï¿½ï¿½$ %
culture
ï¿½ï¿½& -
?
ï¿½ï¿½- .
.
ï¿½ï¿½. /
Icon
ï¿½ï¿½/ 3
??
ï¿½ï¿½4 6

MixService
ï¿½ï¿½7 A
.
ï¿½ï¿½A B
	GetConfig
ï¿½ï¿½B K
<
ï¿½ï¿½K L
string
ï¿½ï¿½L R
>
ï¿½ï¿½R S
(
ï¿½ï¿½S T
$str
ï¿½ï¿½T ^
)
ï¿½ï¿½^ _
;
ï¿½ï¿½_ `
return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
JObject
ï¿½ï¿½* 1
>
ï¿½ï¿½1 2
(
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
{
ï¿½ï¿½ 

	IsSucceed
ï¿½ï¿½ 
=
ï¿½ï¿½ 
true
ï¿½ï¿½  
,
ï¿½ï¿½  !
Data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
JObject
ï¿½ï¿½ 
.
ï¿½ï¿½ 

FromObject
ï¿½ï¿½ )
(
ï¿½ï¿½) *
configurations
ï¿½ï¿½* 8
)
ï¿½ï¿½8 9
}
ï¿½ï¿½ 

;
ï¿½ï¿½
 
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpGet
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ !
<
ï¿½ï¿½! " 
DashboardViewModel
ï¿½ï¿½" 4
>
ï¿½ï¿½4 5
	Dashboard
ï¿½ï¿½6 ?
(
ï¿½ï¿½? @
int
ï¿½ï¿½@ C
id
ï¿½ï¿½D F
)
ï¿½ï¿½F G
{
ï¿½ï¿½ 	
return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) * 
DashboardViewModel
ï¿½ï¿½* <
>
ï¿½ï¿½< =
(
ï¿½ï¿½= >
)
ï¿½ï¿½> ?
{
ï¿½ï¿½ 

	IsSucceed
ï¿½ï¿½ 
=
ï¿½ï¿½ 
true
ï¿½ï¿½  
,
ï¿½ï¿½  !
Data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
new
ï¿½ï¿½  
DashboardViewModel
ï¿½ï¿½ -
(
ï¿½ï¿½- .
)
ï¿½ï¿½. /
}
ï¿½ï¿½ 

;
ï¿½ï¿½
 
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
	Authorize
ï¿½ï¿½	 
(
ï¿½ï¿½ #
AuthenticationSchemes
ï¿½ï¿½ (
=
ï¿½ï¿½) *
JwtBearerDefaults
ï¿½ï¿½+ <
.
ï¿½ï¿½< ="
AuthenticationScheme
ï¿½ï¿½= Q
,
ï¿½ï¿½Q R
Roles
ï¿½ï¿½S X
=
ï¿½ï¿½Y Z
$str
ï¿½ï¿½[ n
)
ï¿½ï¿½n o
]
ï¿½ï¿½o p
[
ï¿½ï¿½ 	
HttpGet
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ %
)
ï¿½ï¿½% &
]
ï¿½ï¿½& '
public
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ !
<
ï¿½ï¿½! "
JObject
ï¿½ï¿½" )
>
ï¿½ï¿½) *
LoadAppSettings
ï¿½ï¿½+ :
(
ï¿½ï¿½: ;
)
ï¿½ï¿½; <
{
ï¿½ï¿½ 	
return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
JObject
ï¿½ï¿½* 1
>
ï¿½ï¿½1 2
(
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
{
ï¿½ï¿½5 6
	IsSucceed
ï¿½ï¿½7 @
=
ï¿½ï¿½A B
true
ï¿½ï¿½C G
,
ï¿½ï¿½G H
Data
ï¿½ï¿½I M
=
ï¿½ï¿½N O

MixService
ï¿½ï¿½P Z
.
ï¿½ï¿½Z [
GetGlobalSetting
ï¿½ï¿½[ k
(
ï¿½ï¿½k l
)
ï¿½ï¿½l m
}
ï¿½ï¿½n o
;
ï¿½ï¿½o p
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
	Authorize
ï¿½ï¿½	 
(
ï¿½ï¿½ #
AuthenticationSchemes
ï¿½ï¿½ (
=
ï¿½ï¿½) *
JwtBearerDefaults
ï¿½ï¿½+ <
.
ï¿½ï¿½< ="
AuthenticationScheme
ï¿½ï¿½= Q
,
ï¿½ï¿½Q R
Roles
ï¿½ï¿½S X
=
ï¿½ï¿½Y Z
$str
ï¿½ï¿½[ n
)
ï¿½ï¿½n o
]
ï¿½ï¿½o p
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ "
)
ï¿½ï¿½" #
]
ï¿½ï¿½# $
public
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ !
<
ï¿½ï¿½! "
JObject
ï¿½ï¿½" )
>
ï¿½ï¿½) *
SaveAppSettings
ï¿½ï¿½+ :
(
ï¿½ï¿½: ;
[
ï¿½ï¿½; <
FromBody
ï¿½ï¿½< D
]
ï¿½ï¿½D E
JObject
ï¿½ï¿½E L
model
ï¿½ï¿½M R
)
ï¿½ï¿½R S
{
ï¿½ï¿½ 	
var
ï¿½ï¿½ 
settings
ï¿½ï¿½ 
=
ï¿½ï¿½ 
FileRepository
ï¿½ï¿½ )
.
ï¿½ï¿½) *
Instance
ï¿½ï¿½* 2
.
ï¿½ï¿½2 3
GetFile
ï¿½ï¿½3 :
(
ï¿½ï¿½: ;
$str
ï¿½ï¿½; H
,
ï¿½ï¿½H I
$str
ï¿½ï¿½J Q
,
ï¿½ï¿½Q R
string
ï¿½ï¿½S Y
.
ï¿½ï¿½Y Z
Empty
ï¿½ï¿½Z _
,
ï¿½ï¿½_ `
true
ï¿½ï¿½a e
,
ï¿½ï¿½e f
$str
ï¿½ï¿½g k
)
ï¿½ï¿½k l
;
ï¿½ï¿½l m
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

settings
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Content
ï¿½ï¿½  
=
ï¿½ï¿½! "
model
ï¿½ï¿½# (
.
ï¿½ï¿½( )
ToString
ï¿½ï¿½) 1
(
ï¿½ï¿½1 2
)
ï¿½ï¿½2 3
;
ï¿½ï¿½3 4
FileRepository
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Instance
ï¿½ï¿½ '
.
ï¿½ï¿½' (
SaveFile
ï¿½ï¿½( 0
(
ï¿½ï¿½0 1
settings
ï¿½ï¿½1 9
)
ï¿½ï¿½9 :
;
ï¿½ï¿½: ;
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
JObject
ï¿½ï¿½* 1
>
ï¿½ï¿½1 2
(
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
{
ï¿½ï¿½5 6
	IsSucceed
ï¿½ï¿½7 @
=
ï¿½ï¿½A B
model
ï¿½ï¿½C H
!=
ï¿½ï¿½I K
null
ï¿½ï¿½L P
,
ï¿½ï¿½P Q
Data
ï¿½ï¿½R V
=
ï¿½ï¿½W X
model
ï¿½ï¿½Y ^
}
ï¿½ï¿½_ `
;
ï¿½ï¿½` a
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
	Authorize
ï¿½ï¿½	 
(
ï¿½ï¿½ #
AuthenticationSchemes
ï¿½ï¿½ (
=
ï¿½ï¿½) *
JwtBearerDefaults
ï¿½ï¿½+ <
.
ï¿½ï¿½< ="
AuthenticationScheme
ï¿½ï¿½= Q
,
ï¿½ï¿½Q R
Roles
ï¿½ï¿½S X
=
ï¿½ï¿½Y Z
$str
ï¿½ï¿½[ n
)
ï¿½ï¿½n o
]
ï¿½ï¿½o p
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½  
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ (
)
ï¿½ï¿½( )
]
ï¿½ï¿½) *
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
bool
ï¿½ï¿½- 1
>
ï¿½ï¿½1 2
>
ï¿½ï¿½2 3"
SaveAppSettingsAsync
ï¿½ï¿½4 H
(
ï¿½ï¿½H I
string
ï¿½ï¿½I O
type
ï¿½ï¿½P T
,
ï¿½ï¿½T U
[
ï¿½ï¿½V W
FromBody
ï¿½ï¿½W _
]
ï¿½ï¿½_ `

FileViewModel
ï¿½ï¿½` m
model
ï¿½ï¿½n s
)
ï¿½ï¿½s t
{
ï¿½ï¿½ 	
var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
FileRepository
ï¿½ï¿½ '
.
ï¿½ï¿½' (
Instance
ï¿½ï¿½( 0
.
ï¿½ï¿½0 1
SaveWebFile
ï¿½ï¿½1 <
(
ï¿½ï¿½< =
model
ï¿½ï¿½= B
)
ï¿½ï¿½B C
;
ï¿½ï¿½C D
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
result
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
fileContent
ï¿½ï¿½ 
=
ï¿½ï¿½  !
FileRepository
ï¿½ï¿½" 0
.
ï¿½ï¿½0 1
Instance
ï¿½ï¿½1 9
.
ï¿½ï¿½9 :

GetWebFile
ï¿½ï¿½: D
(
ï¿½ï¿½D E
$"
ï¿½ï¿½E G
{
ï¿½ï¿½G H
model
ï¿½ï¿½H M
.
ï¿½ï¿½M N
Filename
ï¿½ï¿½N V
}
ï¿½ï¿½V W
{
ï¿½ï¿½W X
model
ï¿½ï¿½X ]
.
ï¿½ï¿½] ^
	Extension
ï¿½ï¿½^ g
}
ï¿½ï¿½g h
"
ï¿½ï¿½h i
,
ï¿½ï¿½i j
model
ï¿½ï¿½k p
.
ï¿½ï¿½p q

FileFolder
ï¿½ï¿½q {
)
ï¿½ï¿½{ |
;
ï¿½ï¿½| }
var
ï¿½ï¿½ 
obj
ï¿½ï¿½ 
=
ï¿½ï¿½ 
JObject
ï¿½ï¿½ !
.
ï¿½ï¿½! "
Parse
ï¿½ï¿½" '
(
ï¿½ï¿½' (
fileContent
ï¿½ï¿½( 3
.
ï¿½ï¿½3 4
Content
ï¿½ï¿½4 ;
)
ï¿½ï¿½; <
;
ï¿½ï¿½< =
switch
ï¿½ï¿½ 
(
ï¿½ï¿½ 
type
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 
case
ï¿½ï¿½ 
$str
ï¿½ï¿½ #
:
ï¿½ï¿½# $
var
ï¿½ï¿½ 
arrLanguage
ï¿½ï¿½ '
=
ï¿½ï¿½( )
obj
ï¿½ï¿½* -
[
ï¿½ï¿½- .
$str
ï¿½ï¿½. 4
]
ï¿½ï¿½4 5
.
ï¿½ï¿½5 6
ToObject
ï¿½ï¿½6 >
<
ï¿½ï¿½> ?
List
ï¿½ï¿½? C
<
ï¿½ï¿½C D
MixLanguage
ï¿½ï¿½D O
>
ï¿½ï¿½O P
>
ï¿½ï¿½P Q
(
ï¿½ï¿½Q R
)
ï¿½ï¿½R S
;
ï¿½ï¿½S T
return
ï¿½ï¿½ 
await
ï¿½ï¿½ $
Lib
ï¿½ï¿½% (
.
ï¿½ï¿½( )

ViewModels
ï¿½ï¿½) 3
.
ï¿½ï¿½3 4
MixLanguages
ï¿½ï¿½4 @
.
ï¿½ï¿½@ A
ReadMvcViewModel
ï¿½ï¿½A Q
.
ï¿½ï¿½Q R
ImportLanguages
ï¿½ï¿½R a
(
ï¿½ï¿½a b
arrLanguage
ï¿½ï¿½b m
,
ï¿½ï¿½m n
_lang
ï¿½ï¿½o t
)
ï¿½ï¿½t u
;
ï¿½ï¿½u v
case
ï¿½ï¿½ 
$str
ï¿½ï¿½ (
:
ï¿½ï¿½( )
var
ï¿½ï¿½ 
arrConfiguration
ï¿½ï¿½ ,
=
ï¿½ï¿½- .
obj
ï¿½ï¿½/ 2
[
ï¿½ï¿½2 3
$str
ï¿½ï¿½3 9
]
ï¿½ï¿½9 :
.
ï¿½ï¿½: ;
ToObject
ï¿½ï¿½; C
<
ï¿½ï¿½C D
List
ï¿½ï¿½D H
<
ï¿½ï¿½H I
MixConfiguration
ï¿½ï¿½I Y
>
ï¿½ï¿½Y Z
>
ï¿½ï¿½Z [
(
ï¿½ï¿½[ \
)
ï¿½ï¿½\ ]
;
ï¿½ï¿½] ^
return
ï¿½ï¿½ 
await
ï¿½ï¿½ $
Lib
ï¿½ï¿½% (
.
ï¿½ï¿½( )

ViewModels
ï¿½ï¿½) 3
.
ï¿½ï¿½3 4
MixConfigurations
ï¿½ï¿½4 E
.
ï¿½ï¿½E F
ReadMvcViewModel
ï¿½ï¿½F V
.
ï¿½ï¿½V W"
ImportConfigurations
ï¿½ï¿½W k
(
ï¿½ï¿½k l
arrConfiguration
ï¿½ï¿½l |
,
ï¿½ï¿½| }
_langï¿½ï¿½~ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
default
ï¿½ï¿½ 
:
ï¿½ï¿½ 
return
ï¿½ï¿½ 
new
ï¿½ï¿½ " 
RepositoryResponse
ï¿½ï¿½# 5
<
ï¿½ï¿½5 6
bool
ï¿½ï¿½6 :
>
ï¿½ï¿½: ;
(
ï¿½ï¿½; <
)
ï¿½ï¿½< =
{
ï¿½ï¿½> ?
	IsSucceed
ï¿½ï¿½@ I
=
ï¿½ï¿½J K
false
ï¿½ï¿½L Q
}
ï¿½ï¿½R S
;
ï¿½ï¿½S T
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
bool
ï¿½ï¿½* .
>
ï¿½ï¿½. /
(
ï¿½ï¿½/ 0
)
ï¿½ï¿½0 1
;
ï¿½ï¿½1 2
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
bool
ï¿½ï¿½- 1
>
ï¿½ï¿½1 2
>
ï¿½ï¿½2 3
Post
ï¿½ï¿½4 8
(
ï¿½ï¿½8 9
IsMysql
ï¿½ï¿½9 :
FromBody
ï¿½ï¿½: B
]
ï¿½ï¿½B C
InitCmsViewModel
ï¿½ï¿½C S
model
ï¿½ï¿½T Y
)
ï¿½ï¿½Y Z
{
ï¿½ï¿½ 	
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ "
InitCmsAsync
ï¿½ï¿½# /
(
ï¿½ï¿½/ 0
model
ï¿½ï¿½0 5
)
ï¿½ï¿½5 6
.
ï¿½ï¿½6 7
ConfigureAwait
ï¿½ï¿½7 E
(
ï¿½ï¿½E F
false
ï¿½ï¿½F K
)
ï¿½ï¿½K L
;
ï¿½ï¿½L M
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
bool
ï¿½ï¿½* .
>
ï¿½ï¿½. /
(
ï¿½ï¿½/ 0
)
ï¿½ï¿½0 1
;
ï¿½ï¿½1 2
}
ï¿½ï¿½ 	
private
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ -
<
ï¿½ï¿½- .
bool
ï¿½ï¿½. 2
>
ï¿½ï¿½2 3
>
ï¿½ï¿½3 4
InitCmsAsync
ï¿½ï¿½5 A
(
ï¿½ï¿½A B
InitCmsViewModel
ï¿½ï¿½B R
model
ï¿½ï¿½S X
)
ï¿½ï¿½X Y
{
ï¿½ï¿½ 	
var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ /
<
ï¿½ï¿½/ 0
bool
ï¿½ï¿½0 4
>
ï¿½ï¿½4 5
(
ï¿½ï¿½5 6
)
ï¿½ï¿½6 7
;
ï¿½ï¿½7 8

MixService
ï¿½ï¿½ 
.
ï¿½ï¿½ !
SetConnectionString
ï¿½ï¿½ *
(
ï¿½ï¿½* +
MixConstants
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8"
CONST_CMS_CONNECTION
ï¿½ï¿½8 L
,
ï¿½ï¿½L M
model
ï¿½ï¿½N S
.
ï¿½ï¿½S T
ConnectionString
ï¿½ï¿½T d
)
ï¿½ï¿½d e
;
ï¿½ï¿½e f

MixService
ï¿½ï¿½ 
.
ï¿½ï¿½ !
SetConnectionString
ï¿½ï¿½ *
(
ï¿½ï¿½* +
MixConstants
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8&
CONST_ACCOUNT_CONNECTION
ï¿½ï¿½8 P
,
ï¿½ï¿½P Q
model
ï¿½ï¿½R W
.
ï¿½ï¿½W X
ConnectionString
ï¿½ï¿½X h
)
ï¿½ï¿½h i
;
ï¿½ï¿½i j

MixService
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	SetConfig
ï¿½ï¿½  
(
ï¿½ï¿½  !
MixConstants
ï¿½ï¿½! -
.
ï¿½ï¿½- .%
CONST_SETTING_IS_SQLITE
ï¿½ï¿½. E
,
ï¿½ï¿½E F
model
ï¿½ï¿½G L
.
ï¿½ï¿½L M
IsSqlite
ï¿½ï¿½M U
)
ï¿½ï¿½U V
;
ï¿½ï¿½V W

MixService
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	SetConfig
ï¿½ï¿½  
(
ï¿½ï¿½  !
MixConstants
ï¿½ï¿½! -
.
ï¿½ï¿½- .$
CONST_SETTING_LANGUAGE
ï¿½ï¿½. D
,
ï¿½ï¿½D E
model
ï¿½ï¿½F K
.
ï¿½ï¿½K L
Culture
ï¿½ï¿½L S
.
ï¿½ï¿½S T
Specificulture
ï¿½ï¿½T b
)
ï¿½ï¿½b c
;
ï¿½ï¿½c d
InitCmsService
ï¿½ï¿½ 
sv
ï¿½ï¿½ 
=
ï¿½ï¿½ 
new
ï¿½ï¿½  #
InitCmsService
ï¿½ï¿½$ 2
(
ï¿½ï¿½2 3
)
ï¿½ï¿½3 4
;
ï¿½ï¿½4 5
var
ï¿½ï¿½ 

initResult
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ "
sv
ï¿½ï¿½# %
.
ï¿½ï¿½% &
InitCms
ï¿½ï¿½& -
(
ï¿½ï¿½- .
model
ï¿½ï¿½. 3
.
ï¿½ï¿½3 4
Culture
ï¿½ï¿½4 ;
)
ï¿½ï¿½; <
;
ï¿½ï¿½< =
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 

initResult
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ $
)
ï¿½ï¿½$ %
{
ï¿½ï¿½ 

await
ï¿½ï¿½ 
InitRolesAsync
ï¿½ï¿½ $
(
ï¿½ï¿½$ %
)
ï¿½ï¿½% &
;
ï¿½ï¿½& '
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½  
=
ï¿½ï¿½! "
true
ï¿½ï¿½# '
;
ï¿½ï¿½' (

MixService
ï¿½ï¿½ 
.
ï¿½ï¿½ 
LoadFromDatabase
ï¿½ï¿½ +
(
ï¿½ï¿½+ ,
)
ï¿½ï¿½, -
;
ï¿½ï¿½- .

MixService
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	SetConfig
ï¿½ï¿½ $
<
ï¿½ï¿½$ %
bool
ï¿½ï¿½% )
>
ï¿½ï¿½) *
(
ï¿½ï¿½* +
$str
ï¿½ï¿½+ 3
,
ï¿½ï¿½3 4
true
ï¿½ï¿½5 9
)
ï¿½ï¿½9 :
;
ï¿½ï¿½: ;

MixService
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	SetConfig
ï¿½ï¿½ $
<
ï¿½ï¿½$ %
string
ï¿½ï¿½% +
>
ï¿½ï¿½+ ,
(
ï¿½ï¿½, -
$str
ï¿½ï¿½- =
,
ï¿½ï¿½= >
model
ï¿½ï¿½? D
.
ï¿½ï¿½D E
Culture
ï¿½ï¿½E L
.
ï¿½ï¿½L M
Specificulture
ï¿½ï¿½M [
)
ï¿½ï¿½[ \
;
ï¿½ï¿½\ ]

MixService
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Save
ï¿½ï¿½ 
(
ï¿½ï¿½  
)
ï¿½ï¿½  !
;
ï¿½ï¿½! "
}
ï¿½ï¿½ 

else
ï¿½ï¿½ 
{
ï¿½ï¿½ 


MixService
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Reload
ï¿½ï¿½ !
(
ï¿½ï¿½! "
)
ï¿½ï¿½" #
;
ï¿½ï¿½# $
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 

initResult
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	Exception
ï¿½ï¿½ (
!=
ï¿½ï¿½) +
null
ï¿½ï¿½, 0
)
ï¿½ï¿½0 1
{
ï¿½ï¿½ 
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Errors
ï¿½ï¿½ !
.
ï¿½ï¿½! "
Add
ï¿½ï¿½" %
(
ï¿½ï¿½% &

initResult
ï¿½ï¿½& 0
.
ï¿½ï¿½0 1
	Exception
ï¿½ï¿½1 :
.
ï¿½ï¿½: ;
Message
ï¿½ï¿½; B
)
ï¿½ï¿½B C
;
ï¿½ï¿½C D
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	Exception
ï¿½ï¿½ $
=
ï¿½ï¿½% &

initResult
ï¿½ï¿½' 1
.
ï¿½ï¿½1 2
	Exception
ï¿½ï¿½2 ;
;
ï¿½ï¿½; <
}
ï¿½ï¿½ 
foreach
ï¿½ï¿½ 
(
ï¿½ï¿½ 
var
ï¿½ï¿½ 
item
ï¿½ï¿½ !
in
ï¿½ï¿½" $

initResult
ï¿½ï¿½% /
.
ï¿½ï¿½/ 0
Errors
ï¿½ï¿½0 6
)
ï¿½ï¿½6 7
{
ï¿½ï¿½ 
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Errors
ï¿½ï¿½ !
.
ï¿½ï¿½! "
Add
ï¿½ï¿½" %
(
ï¿½ï¿½% &
item
ï¿½ï¿½& *
)
ï¿½ï¿½* +
;
ï¿½ï¿½+ ,
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
private
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ 
bool
ï¿½ï¿½ 
>
ï¿½ï¿½  
InitRolesAsync
ï¿½ï¿½! /
(
ï¿½ï¿½/ 0
)
ï¿½ï¿½0 1
{
ï¿½ï¿½ 	
bool
ï¿½ï¿½ 
	isSucceed
ï¿½ï¿½ 
=
ï¿½ï¿½ 
true
ï¿½ï¿½ !
;
ï¿½ï¿½! "
var
ï¿½ï¿½ 
getRoles
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½  

RoleViewModel
ï¿½ï¿½! .
.
ï¿½ï¿½. /

Repository
ï¿½ï¿½/ 9
.
ï¿½ï¿½9 :
GetModelListAsync
ï¿½ï¿½: K
(
ï¿½ï¿½K L
)
ï¿½ï¿½L M
;
ï¿½ï¿½M N
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
getRoles
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ "
&&
ï¿½ï¿½# %
getRoles
ï¿½ï¿½& .
.
ï¿½ï¿½. /
Data
ï¿½ï¿½/ 3
.
ï¿½ï¿½3 4
Count
ï¿½ï¿½4 9
==
ï¿½ï¿½: <
$num
ï¿½ï¿½= >
)
ï¿½ï¿½> ?
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 

saveResult
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &
_roleManager
ï¿½ï¿½' 3
.
ï¿½ï¿½3 4
CreateAsync
ï¿½ï¿½4 ?
(
ï¿½ï¿½? @
new
ï¿½ï¿½@ C
IdentityRole
ï¿½ï¿½D P
(
ï¿½ï¿½P Q
)
ï¿½ï¿½Q R
{
ï¿½ï¿½ 
Id
ï¿½ï¿½ 
=
ï¿½ï¿½ 
Guid
ï¿½ï¿½ 
.
ï¿½ï¿½ 
NewGuid
ï¿½ï¿½ %
(
ï¿½ï¿½% &
)
ï¿½ï¿½& '
.
ï¿½ï¿½' (
ToString
ï¿½ï¿½( 0
(
ï¿½ï¿½0 1
)
ï¿½ï¿½1 2
,
ï¿½ï¿½2 3
Name
ï¿½ï¿½ 
=
ï¿½ï¿½ 
$str
ï¿½ï¿½ '
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
	isSucceed
ï¿½ï¿½ 
=
ï¿½ï¿½ 

saveResult
ï¿½ï¿½ &
.
ï¿½ï¿½& '
	Succeeded
ï¿½ï¿½' 0
;
ï¿½ï¿½0 1
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
	isSucceed
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
}
ï¿½ï¿½ 
}ï¿½ï¿½ ï¿½ï¿½
\C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiProductController.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
Produces 

(
 
$str  
)  !
]! "
[ 
Route 

(
 
$str %
)% &
]& '
public 

class  
ApiProductController %
:& '
BaseApiController 
{ 
public  
ApiProductController #
(# $
	Microsoft$ -
.- .

AspNetCore. 8
.8 9
SignalR9 @
.@ A
IHubContextA L
<L M
HubM P
.P Q
	PortalHubQ Z
>Z [

hubContext\ f
)f g
:h i
basej n
(n o

hubContexto y
)y z
{ 	
} 	
[## 	
HttpGet##	 
,## 
HttpOptions## 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
RepositoryResponse%% ,
<%%, -

MixProduct%%- 7
>%%7 8
>%%8 9
DeleteAsync%%: E
(%%E F
int%%F I
id%%J L
)%%L M
{&& 	
var'' 

getProduct'' 
='' 
await'' "!
ReadListItemViewModel''# 8
.''8 9

Repository''9 C
.''C D
GetSingleModelAsync''D W
(''W X
model(( 
=>(( 
model(( 
.(( 
Id(( !
==((" $
id((% '
&&((( *
model((+ 0
.((0 1
Specificulture((1 ?
==((@ B
_lang((C H
)((H I
;((I J
if)) 
()) 

getProduct)) 
.)) 
	IsSucceed)) $
)))$ %
{** 

return,, 
await,, 

getProduct,, '
.,,' (
Data,,( ,
.,,, -
RemoveModelAsync,,- =
(,,= >
true,,> B
),,B C
;,,C D
}-- 

else.. 
{// 

return00 
new00 
RepositoryResponse00 -
<00- .

MixProduct00. 8
>008 9
(009 :
)00: ;
{11 
	IsSucceed22 
=22 
false22  %
}33 
;33 
}44 

}55 	
[88 	
HttpGet88	 
,88 
HttpOptions88 
]88 
[99 	
Route99	 
(99 
$str99 (
)99( )
]99) *
[:: 	
Route::	 
(:: 
$str:: #
)::# $
]::$ %
public;; 
async;; 
Task;; 
<;; 
ActionResult;; &
<;;& '
JObject;;' .
>;;. /
>;;/ 0
Details;;1 8
(;;8 9
string;;9 ?
viewType;;@ H
,;;H I
int;;J M
?;;M N
id;;O Q
);;Q R
{<< 	
switch== 
(== 
viewType== 
)== 
{>> 

case?? 
$str?? 
:?? 
if@@ 
(@@ 
id@@ 
.@@ 
HasValue@@ #
)@@# $
{AA 
varBB 
beResultBB $
=BB% &
awaitBB' ,
UpdateViewModelBB- <
.BB< =

RepositoryBB= G
.BBG H
GetSingleModelAsyncBBH [
(BB[ \
modelBB\ a
=>BBb d
modelBBe j
.BBj k
IdBBk m
==BBn p
idBBq s
&&BBt v
modelBBw |
.BB| }
Specificulture	BB} ï¿½
==
BBï¿½ ï¿½
_lang
BBï¿½ ï¿½
)
BBï¿½ ï¿½
.
BBï¿½ ï¿½
ConfigureAwait
BBï¿½ ï¿½
(
BBï¿½ ï¿½
false
BBï¿½ ï¿½
)
BBï¿½ ï¿½
;
BBï¿½ ï¿½
ifCC 
(CC 
beResultCC $
.CC$ %
	IsSucceedCC% .
)CC. /
{DD 
beResultEE $
.EE$ %
DataEE% )
.EE) *

DetailsUrlEE* 4
=EE5 6
MixCmsHelperEE7 C
.EEC D
GetRouterUrlEED P
(EEP Q
$strEEQ Z
,EEZ [
newEE\ _
{EE` a
beResultEEb j
.EEj k
DataEEk o
.EEo p
SeoNameEEp w
}EEx y
,EEy z
Request	EE{ ï¿½
,
EEï¿½ ï¿½
Url
EEï¿½ ï¿½
)
EEï¿½ ï¿½
;
EEï¿½ ï¿½
}FF 
returnGG 
OkGG !
(GG! "
JObjectGG" )
.GG) *

FromObjectGG* 4
(GG4 5
beResultGG5 =
)GG= >
)GG> ?
;GG? @
}HH 
elseII 
{JJ 
varKK 
modelKK !
=KK" #
newKK$ '

MixProductKK( 2
(KK2 3
)KK3 4
{LL 
SpecificultureMM *
=MM+ ,
_langMM- 2
,MM2 3
StatusNN "
=NN# $

MixServiceNN% /
.NN/ 0
	GetConfigNN0 9
<NN9 :
intNN: =
>NN= >
(NN> ?
$strNN? N
)NNN O
,NNO P
PriorityOO $
=OO% &
UpdateViewModelOO' 6
.OO6 7

RepositoryOO7 A
.OOA B
MaxOOB E
(OOE F
aOOF G
=>OOH J
aOOK L
.OOL M
PriorityOOM U
)OOU V
.OOV W
DataOOW [
+OO\ ]
$numOO^ _
}PP 
;PP 
RepositoryResponseRR *
<RR* +
UpdateViewModelRR+ :
>RR: ;
resultRR< B
=RRC D
newRRE H
RepositoryResponseRRI [
<RR[ \
UpdateViewModelRR\ k
>RRk l
(RRl m
)RRm n
{SS 
	IsSucceedTT %
=TT& '
trueTT( ,
,TT, -
DataUU  
=UU! "
awaitUU# (
UpdateViewModelUU) 8
.UU8 9

InitViewAsyncUU9 F
(UUF G
modelUUG L
)UUL M
}VV 
;VV 
returnWW 
JObjectWW &
.WW& '

FromObjectWW' 1
(WW1 2
resultWW2 8
)WW8 9
;WW9 :
}XX 
defaultYY 
:YY 
ifZZ 
(ZZ 
idZZ 
.ZZ 
HasValueZZ #
)ZZ# $
{[[ 
var\\ 
beResult\\ $
=\\% &
await\\' ,
UpdateViewModel\\- <
.\\< =

Repository\\= G
.\\G H
GetSingleModelAsync\\H [
(\\[ \
model\\\ a
=>\\b d
model\\e j
.\\j k
Id\\k m
==\\n p
id\\q s
&&\\t v
model\\w |
.\\| }
Specificulture	\\} ï¿½
==
\\ï¿½ ï¿½
_lang
\\ï¿½ ï¿½
)
\\ï¿½ ï¿½
.
\\ï¿½ ï¿½
ConfigureAwait
\\ï¿½ ï¿½
(
\\ï¿½ ï¿½
false
\\ï¿½ ï¿½
)
\\ï¿½ ï¿½
;
\\ï¿½ ï¿½
if]] 
(]] 
beResult]] $
.]]$ %
	IsSucceed]]% .
)]]. /
{^^ 
beResult__ $
.__$ %
Data__% )
.__) *

DetailsUrl__* 4
=__5 6
MixCmsHelper__7 C
.__C D
GetRouterUrl__D P
(__P Q
$str__Q Z
,__Z [
new__\ _
{__` a
beResult__b j
.__j k
Data__k o
.__o p
SeoName__p w
}__x y
,__y z
Request	__{ ï¿½
,
__ï¿½ ï¿½
Url
__ï¿½ ï¿½
)
__ï¿½ ï¿½
;
__ï¿½ ï¿½
}`` 
returnaa 
JObjectaa &
.aa& '

FromObjectaa' 1
(aa1 2
beResultaa2 :
)aa: ;
;aa; <
}bb 
elsecc 
{dd 
varee 
modelee !
=ee" #
newee$ '

MixProductee( 2
(ee2 3
)ee3 4
;ee4 5
RepositoryResponseff *
<ff* +
UpdateViewModelff+ :
>ff: ;
resultff< B
=ffC D
newffE H
RepositoryResponseffI [
<ff[ \
UpdateViewModelff\ k
>ffk l
(ffl m
)ffm n
{gg 
	IsSucceedhh %
=hh& '
truehh( ,
,hh, -
Dataii  
=ii! "
newii# &
UpdateViewModelii' 6
(ii6 7
modelii7 <
)ii< =
{jj 
Specificulturekk  .
=kk/ 0
_langkk1 6
,kk6 7
Statusll  &
=ll' (
MixContentStatusll) 9
.ll9 :
Previewll: A
,llA B
}mm 
}nn 
;nn 
returnoo 
JObjectoo &
.oo& '

FromObjectoo' 1
(oo1 2
resultoo2 8
)oo8 9
;oo9 :
}pp 
}qq 

}rr 	
[zz 	
	Authorizezz	 
(zz !
AuthenticationSchemeszz (
=zz) *
JwtBearerDefaultszz+ <
.zz< = 
AuthenticationSchemezz= Q
,zzQ R
RoleszzS X
=zzY Z
$strzz[ n
)zzn o
]zzo p
[{{ 	
HttpPost{{	 
,{{ 
HttpOptions{{ 
]{{ 
[|| 	
Route||	 
(|| 
$str|| 
)|| 
]|| 
public}} 
async}} 
Task}} 
<}} 
RepositoryResponse}} ,
<}}, -
UpdateViewModel}}- <
>}}< =
>}}= >
Post}}? C
(}}C D
[}}D E
FromBody}}E M
]}}M N
UpdateViewModel}}N ]
model}}^ c
)}}c d
{~~ 	
if 
( 
model 
!= 
null 
) 
{
ï¿½ï¿½ 

model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	CreatedBy
ï¿½ï¿½ 
=
ï¿½ï¿½  !
User
ï¿½ï¿½" &
.
ï¿½ï¿½& '
Claims
ï¿½ï¿½' -
.
ï¿½ï¿½- .
FirstOrDefault
ï¿½ï¿½. <
(
ï¿½ï¿½< =
c
ï¿½ï¿½= >
=>
ï¿½ï¿½? A
c
ï¿½ï¿½B C
.
ï¿½ï¿½C D
Type
ï¿½ï¿½D H
==
ï¿½ï¿½I K
$str
ï¿½ï¿½L V
)
ï¿½ï¿½V W
?
ï¿½ï¿½W X
.
ï¿½ï¿½X Y
Value
ï¿½ï¿½Y ^
;
ï¿½ï¿½^ _
var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ "
model
ï¿½ï¿½# (
.
ï¿½ï¿½( )
SaveModelAsync
ï¿½ï¿½) 7
(
ï¿½ï¿½7 8
true
ï¿½ï¿½8 <
)
ï¿½ï¿½< =
.
ï¿½ï¿½= >
ConfigureAwait
ï¿½ï¿½> L
(
ï¿½ï¿½L M
false
ï¿½ï¿½M R
)
ï¿½ï¿½R S
;
ï¿½ï¿½S T
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
UpdateViewModel
ï¿½ï¿½* 9
>
ï¿½ï¿½9 :
(
ï¿½ï¿½: ;
)
ï¿½ï¿½; <
{
ï¿½ï¿½= >
Status
ï¿½ï¿½? E
=
ï¿½ï¿½F G
$num
ï¿½ï¿½H K
}
ï¿½ï¿½L M
;
ï¿½ï¿½M N
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -

MixProduct
ï¿½ï¿½- 7
>
ï¿½ï¿½7 8
>
ï¿½ï¿½8 9

SaveFields
ï¿½ï¿½: D
(
ï¿½ï¿½D E
int
ï¿½ï¿½E H
id
ï¿½ï¿½I K
,
ï¿½ï¿½K L
[
ï¿½ï¿½M N
FromBody
ï¿½ï¿½N V
]
ï¿½ï¿½V W
List
ï¿½ï¿½W [
<
ï¿½ï¿½[ \
EntityField
ï¿½ï¿½\ g
>
ï¿½ï¿½g h
fields
ï¿½ï¿½i o
)
ï¿½ï¿½o p
{
ï¿½ï¿½ 	
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
fields
ï¿½ï¿½ 
!=
ï¿½ï¿½ 
null
ï¿½ï¿½ 
)
ï¿½ï¿½ 
{
ï¿½ï¿½ 

var
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½ 
new
ï¿½ï¿½   
RepositoryResponse
ï¿½ï¿½! 3
<
ï¿½ï¿½3 4

MixProduct
ï¿½ï¿½4 >
>
ï¿½ï¿½> ?
(
ï¿½ï¿½? @
)
ï¿½ï¿½@ A
{
ï¿½ï¿½B C
	IsSucceed
ï¿½ï¿½D M
=
ï¿½ï¿½N O
true
ï¿½ï¿½P T
}
ï¿½ï¿½U V
;
ï¿½ï¿½V W
foreach
ï¿½ï¿½ 
(
ï¿½ï¿½ 
var
ï¿½ï¿½ 
property
ï¿½ï¿½ %
in
ï¿½ï¿½& (
fields
ï¿½ï¿½) /
)
ï¿½ï¿½/ 0
{
ï¿½ï¿½ 
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
result
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
result
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &#
ReadListItemViewModel
ï¿½ï¿½' <
.
ï¿½ï¿½< =

Repository
ï¿½ï¿½= G
.
ï¿½ï¿½G H
UpdateFieldsAsync
ï¿½ï¿½H Y
(
ï¿½ï¿½Y Z
c
ï¿½ï¿½Z [
=>
ï¿½ï¿½\ ^
c
ï¿½ï¿½_ `
.
ï¿½ï¿½` a
Id
ï¿½ï¿½a c
==
ï¿½ï¿½d f
id
ï¿½ï¿½g i
&&
ï¿½ï¿½j l
c
ï¿½ï¿½m n
.
ï¿½ï¿½n o
Specificulture
ï¿½ï¿½o }
==ï¿½ï¿½~ ï¿½
_langï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
fieldsï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
}
ï¿½ï¿½ 
else
ï¿½ï¿½ 
{
ï¿½ï¿½ 
break
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *

MixProduct
ï¿½ï¿½* 4
>
ï¿½ï¿½4 5
(
ï¿½ï¿½5 6
)
ï¿½ï¿½6 7
;
ï¿½ï¿½7 8
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½ 
]
ï¿½ï¿½ 
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½ 
JObject
ï¿½ï¿½ !
>
ï¿½ï¿½! "
GetList
ï¿½ï¿½# *
(
ï¿½ï¿½* +
[
ï¿½ï¿½ 

FromBody
ï¿½ï¿½
 
]
ï¿½ï¿½ 

RequestPaging
ï¿½ï¿½ $
request
ï¿½ï¿½% ,
)
ï¿½ï¿½, -
{
ï¿½ï¿½ 	$
ParseRequestPagingDate
ï¿½ï¿½ "
(
ï¿½ï¿½" #
request
ï¿½ï¿½# *
)
ï¿½ï¿½* +
;
ï¿½ï¿½+ ,

Expression
ï¿½ï¿½ 
<
ï¿½ï¿½ 
Func
ï¿½ï¿½ 
<
ï¿½ï¿½ 

MixProduct
ï¿½ï¿½ &
,
ï¿½ï¿½& '
bool
ï¿½ï¿½( ,
>
ï¿½ï¿½, -
>
ï¿½ï¿½- .
	predicate
ï¿½ï¿½/ 8
=
ï¿½ï¿½9 :
model
ï¿½ï¿½; @
=>
ï¿½ï¿½A C
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Specificulture
ï¿½ï¿½ ,
==
ï¿½ï¿½- /
_lang
ï¿½ï¿½0 5
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Status
ï¿½ï¿½% +
.
ï¿½ï¿½+ ,
HasValue
ï¿½ï¿½, 4
||
ï¿½ï¿½5 7
model
ï¿½ï¿½8 =
.
ï¿½ï¿½= >
Status
ï¿½ï¿½> D
==
ï¿½ï¿½E G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
Status
ï¿½ï¿½P V
.
ï¿½ï¿½V W
Value
ï¿½ï¿½W \
)
ï¿½ï¿½\ ]
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
string
ï¿½ï¿½ "
.
ï¿½ï¿½" # 
IsNullOrWhiteSpace
ï¿½ï¿½# 5
(
ï¿½ï¿½5 6
request
ï¿½ï¿½6 =
.
ï¿½ï¿½= >
Keyword
ï¿½ï¿½> E
)
ï¿½ï¿½E F
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
Title
ï¿½ï¿½& +
.
ï¿½ï¿½+ ,
Contains
ï¿½ï¿½, 4
(
ï¿½ï¿½4 5
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
Keyword
ï¿½ï¿½= D
)
ï¿½ï¿½D E
||
ï¿½ï¿½ 
model
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
Excerpt
ï¿½ï¿½% ,
.
ï¿½ï¿½, -
Contains
ï¿½ï¿½- 5
(
ï¿½ï¿½5 6
request
ï¿½ï¿½6 =
.
ï¿½ï¿½= >
Keyword
ï¿½ï¿½> E
)
ï¿½ï¿½E F
)
ï¿½ï¿½F G
)
ï¿½ï¿½G H
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
FromDate
ï¿½ï¿½% -
.
ï¿½ï¿½- .
HasValue
ï¿½ï¿½. 6
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
CreatedDateTime
ï¿½ï¿½& 5
>=
ï¿½ï¿½6 8
request
ï¿½ï¿½9 @
.
ï¿½ï¿½@ A
FromDate
ï¿½ï¿½A I
.
ï¿½ï¿½I J
Value
ï¿½ï¿½J O
)
ï¿½ï¿½O P
)
ï¿½ï¿½ 
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
!
ï¿½ï¿½ 
request
ï¿½ï¿½ $
.
ï¿½ï¿½$ %
ToDate
ï¿½ï¿½% +
.
ï¿½ï¿½+ ,
HasValue
ï¿½ï¿½, 4
||
ï¿½ï¿½ 
(
ï¿½ï¿½  
model
ï¿½ï¿½  %
.
ï¿½ï¿½% &
CreatedDateTime
ï¿½ï¿½& 5
<=
ï¿½ï¿½6 8
request
ï¿½ï¿½9 @
.
ï¿½ï¿½@ A
ToDate
ï¿½ï¿½A G
.
ï¿½ï¿½G H
Value
ï¿½ï¿½H M
)
ï¿½ï¿½M N
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
switch
ï¿½ï¿½ 
(
ï¿½ï¿½ 
request
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Key
ï¿½ï¿½ 
)
ï¿½ï¿½  
{
ï¿½ï¿½ 

case
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
fedata
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &
ReadMvcViewModel
ï¿½ï¿½' 7
.
ï¿½ï¿½7 8

Repository
ï¿½ï¿½8 B
.
ï¿½ï¿½B C!
GetModelListByAsync
ï¿½ï¿½C V
(
ï¿½ï¿½ 
	predicate
ï¿½ï¿½ "
,
ï¿½ï¿½" #
request
ï¿½ï¿½$ +
.
ï¿½ï¿½+ ,
OrderBy
ï¿½ï¿½, 3
,
ï¿½ï¿½3 4
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
	Direction
ï¿½ï¿½= F
,
ï¿½ï¿½F G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
PageSize
ï¿½ï¿½P X
,
ï¿½ï¿½X Y
request
ï¿½ï¿½Z a
.
ï¿½ï¿½a b
	PageIndex
ï¿½ï¿½b k
)
ï¿½ï¿½k l
.
ï¿½ï¿½l m
ConfigureAwait
ï¿½ï¿½m {
(
ï¿½ï¿½{ |
falseï¿½ï¿½| ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
fedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
fedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ #
.
ï¿½ï¿½# $
Items
ï¿½ï¿½$ )
.
ï¿½ï¿½) *
ForEach
ï¿½ï¿½* 1
(
ï¿½ï¿½1 2
a
ï¿½ï¿½2 3
=>
ï¿½ï¿½4 6
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½ (
=
ï¿½ï¿½) *
MixCmsHelper
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetRouterUrl
ï¿½ï¿½8 D
(
ï¿½ï¿½D E
$str
ï¿½ï¿½  )
,
ï¿½ï¿½) *
new
ï¿½ï¿½+ .
{
ï¿½ï¿½/ 0
seoName
ï¿½ï¿½1 8
=
ï¿½ï¿½9 :
a
ï¿½ï¿½; <
.
ï¿½ï¿½< =
SeoName
ï¿½ï¿½= D
}
ï¿½ï¿½E F
,
ï¿½ï¿½F G
Request
ï¿½ï¿½H O
,
ï¿½ï¿½O P
Url
ï¿½ï¿½Q T
)
ï¿½ï¿½T U
;
ï¿½ï¿½U V
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
fedata
ï¿½ï¿½. 4
)
ï¿½ï¿½4 5
;
ï¿½ï¿½5 6
case
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
bedata
ï¿½ï¿½ 
=
ï¿½ï¿½  
await
ï¿½ï¿½! &
UpdateViewModel
ï¿½ï¿½' 6
.
ï¿½ï¿½6 7

Repository
ï¿½ï¿½7 A
.
ï¿½ï¿½A B!
GetModelListByAsync
ï¿½ï¿½B U
(
ï¿½ï¿½ 
	predicate
ï¿½ï¿½ "
,
ï¿½ï¿½" #
request
ï¿½ï¿½$ +
.
ï¿½ï¿½+ ,
OrderBy
ï¿½ï¿½, 3
,
ï¿½ï¿½3 4
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
	Direction
ï¿½ï¿½= F
,
ï¿½ï¿½F G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
PageSize
ï¿½ï¿½P X
,
ï¿½ï¿½X Y
request
ï¿½ï¿½Z a
.
ï¿½ï¿½a b
	PageIndex
ï¿½ï¿½b k
)
ï¿½ï¿½k l
.
ï¿½ï¿½l m
ConfigureAwait
ï¿½ï¿½m {
(
ï¿½ï¿½{ |
falseï¿½ï¿½| ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
bedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ (
)
ï¿½ï¿½( )
{
ï¿½ï¿½ 
bedata
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ #
.
ï¿½ï¿½# $
Items
ï¿½ï¿½$ )
.
ï¿½ï¿½) *
ForEach
ï¿½ï¿½* 1
(
ï¿½ï¿½1 2
a
ï¿½ï¿½2 3
=>
ï¿½ï¿½4 6
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½ (
=
ï¿½ï¿½) *
MixCmsHelper
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetRouterUrl
ï¿½ï¿½8 D
(
ï¿½ï¿½D E
$str
ï¿½ï¿½  )
,
ï¿½ï¿½) *
new
ï¿½ï¿½+ .
{
ï¿½ï¿½/ 0
seoName
ï¿½ï¿½1 8
=
ï¿½ï¿½9 :
a
ï¿½ï¿½; <
.
ï¿½ï¿½< =
SeoName
ï¿½ï¿½= D
}
ï¿½ï¿½E F
,
ï¿½ï¿½F G
Request
ï¿½ï¿½H O
,
ï¿½ï¿½O P
Url
ï¿½ï¿½Q T
)
ï¿½ï¿½T U
;
ï¿½ï¿½U V
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
bedata
ï¿½ï¿½. 4
)
ï¿½ï¿½4 5
;
ï¿½ï¿½5 6
default
ï¿½ï¿½ 
:
ï¿½ï¿½ 
var
ï¿½ï¿½ 
data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ $#
ReadListItemViewModel
ï¿½ï¿½% :
.
ï¿½ï¿½: ;

Repository
ï¿½ï¿½; E
.
ï¿½ï¿½E F!
GetModelListByAsync
ï¿½ï¿½F Y
(
ï¿½ï¿½ 
	predicate
ï¿½ï¿½ "
,
ï¿½ï¿½" #
request
ï¿½ï¿½$ +
.
ï¿½ï¿½+ ,
OrderBy
ï¿½ï¿½, 3
,
ï¿½ï¿½3 4
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
	Direction
ï¿½ï¿½= F
,
ï¿½ï¿½F G
request
ï¿½ï¿½H O
.
ï¿½ï¿½O P
PageSize
ï¿½ï¿½P X
,
ï¿½ï¿½X Y
request
ï¿½ï¿½Z a
.
ï¿½ï¿½a b
	PageIndex
ï¿½ï¿½b k
)
ï¿½ï¿½k l
.
ï¿½ï¿½l m
ConfigureAwait
ï¿½ï¿½m {
(
ï¿½ï¿½{ |
falseï¿½ï¿½| ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
if
ï¿½ï¿½ 
(
ï¿½ï¿½ 
data
ï¿½ï¿½ 
.
ï¿½ï¿½ 
	IsSucceed
ï¿½ï¿½ &
)
ï¿½ï¿½& '
{
ï¿½ï¿½ 
data
ï¿½ï¿½ 
.
ï¿½ï¿½ 
Data
ï¿½ï¿½ !
.
ï¿½ï¿½! "
Items
ï¿½ï¿½" '
.
ï¿½ï¿½' (
ForEach
ï¿½ï¿½( /
(
ï¿½ï¿½/ 0
(
ï¿½ï¿½0 1
Action
ï¿½ï¿½1 7
<
ï¿½ï¿½7 8#
ReadListItemViewModel
ï¿½ï¿½8 M
>
ï¿½ï¿½M N
)
ï¿½ï¿½N O
(
ï¿½ï¿½O P
a
ï¿½ï¿½P Q
=>
ï¿½ï¿½R T
{
ï¿½ï¿½ 
a
ï¿½ï¿½ 
.
ï¿½ï¿½ 

DetailsUrl
ï¿½ï¿½ (
=
ï¿½ï¿½) *
MixCmsHelper
ï¿½ï¿½+ 7
.
ï¿½ï¿½7 8
GetRouterUrl
ï¿½ï¿½8 D
(
ï¿½ï¿½D E
$str
ï¿½ï¿½  )
,
ï¿½ï¿½) *
new
ï¿½ï¿½+ .
{
ï¿½ï¿½/ 0
seoName
ï¿½ï¿½1 8
=
ï¿½ï¿½9 :
a
ï¿½ï¿½; <
.
ï¿½ï¿½< =
SeoName
ï¿½ï¿½= D
}
ï¿½ï¿½E F
,
ï¿½ï¿½F G
Request
ï¿½ï¿½H O
,
ï¿½ï¿½O P
Url
ï¿½ï¿½Q T
)
ï¿½ï¿½T U
;
ï¿½ï¿½U V
}
ï¿½ï¿½ 
)
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
JObject
ï¿½ï¿½ "
.
ï¿½ï¿½" #

FromObject
ï¿½ï¿½# -
(
ï¿½ï¿½- .
data
ï¿½ï¿½. 2
)
ï¿½ï¿½2 3
;
ï¿½ï¿½3 4
}
ï¿½ï¿½ 

}
ï¿½ï¿½ 	
}
ï¿½ï¿½ 
}ï¿½ï¿½ ï¿½s
]C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\ApiTemplateController.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{ 
[ 
	Authorize 
( !
AuthenticationSchemes $
=% &
JwtBearerDefaults' 8
.8 9 
AuthenticationScheme9 M
,M N
Roles 
= 
$str '
)' (
]( )
[ 
Produces 

(
 
$str  
)  !
]! "
[ 
Route 

(
 
$str &
)& '
]' (
public 

class !
ApiTemplateController &
:' (
BaseApiController 
{ 
public !
ApiTemplateController $
($ %
	Microsoft% .
.. /

AspNetCore/ 9
.9 :
SignalR: A
.A B
IHubContextB M
<M N
HubN Q
.Q R
	PortalHubR [
>[ \

hubContext] g
)g h
:i j
basek o
(o p

hubContextp z
)z {
{ 	
} 	
[   	
HttpGet  	 
,   
HttpOptions   
]   
[!! 	
Route!!	 
(!! 
$str!! ?
)!!? @
]!!@ A
["" 	
Route""	 
("" 
$str"" :
)"": ;
]""; <
public## 
async## 
Task## 
<## 
RepositoryResponse## ,
<##, -
Lib##- 0
.##0 1

ViewModels##1 ;
.##; <
MixTemplates##< H
.##H I
UpdateViewModel##I X
>##X Y
>##Y Z
DetailsAsync##[ g
(##g h
string##h n
viewType##o w
,##w x
int##y |
themeId	##} ï¿½
,
##ï¿½ ï¿½
string
##ï¿½ ï¿½

folderType
##ï¿½ ï¿½
,
##ï¿½ ï¿½
int
##ï¿½ ï¿½
?
##ï¿½ ï¿½
id
##ï¿½ ï¿½
)
##ï¿½ ï¿½
{$$ 	
if%% 
(%% 
id%% 
.%% 
HasValue%% 
)%% 
{&& 

var'' 
beResult'' 
='' 
await'' $
Lib''% (
.''( )

ViewModels'') 3
.''3 4
MixTemplates''4 @
.''@ A
UpdateViewModel''A P
.''P Q

Repository''Q [
.''[ \
GetSingleModelAsync''\ o
(''o p
model(( 
=>(( 
model(( "
.((" #
Id((# %
==((& (
id(() +
&&((, .
model((/ 4
.((4 5
ThemeId((5 <
==((= ?
themeId((@ G
)((G H
.((H I
ConfigureAwait((I W
(((W X
false((X ]
)((] ^
;((^ _
return)) 
beResult)) 
;))  
}** 

else++ 
{,, 

var-- 
getTheme-- 
=-- 
await-- $
Lib--% (
.--( )

ViewModels--) 3
.--3 4
	MixThemes--4 =
.--= >

ReadViewModel--> K
.--K L

Repository--L V
.--V W
GetSingleModelAsync--W j
(--j k
t--k l
=>--m o
t--p q
.--q r
Id--r t
==--u w
themeId--x 
)	-- ï¿½
;
--ï¿½ ï¿½
if.. 
(.. 
getTheme.. 
... 
	IsSucceed.. &
)..& '
{// 
var00 
model00 
=00 
new00  #
MixTemplate00$ /
(00/ 0
)000 1
{11 
Status22 
=22  
(22! "
int22" %
)22% &
MixContentStatus22& 6
.226 7
Preview227 >
,22> ?
ThemeId33 
=33  !
themeId33" )
,33) *
	ThemeName44 !
=44" #
getTheme44$ ,
.44, -
Data44- 1
.441 2
Name442 6
,446 7
	Extension55 !
=55" #

MixService55$ .
.55. /
	GetConfig55/ 8
<558 9
string559 ?
>55? @
(55@ A
$str55A T
)55T U
,55U V

FolderType66 "
=66# $

folderType66% /
}77 
;77 
RepositoryResponse99 &
<99& '
Lib99' *
.99* +

ViewModels99+ 5
.995 6
MixTemplates996 B
.99B C
UpdateViewModel99C R
>99R S
result99T Z
=99[ \
new99] `
RepositoryResponse99a s
<99s t
Lib99t w
.99w x

ViewModels	99x ï¿½
.
99ï¿½ ï¿½
MixTemplates
99ï¿½ ï¿½
.
99ï¿½ ï¿½
UpdateViewModel
99ï¿½ ï¿½
>
99ï¿½ ï¿½
(
99ï¿½ ï¿½
)
99ï¿½ ï¿½
{:: 
	IsSucceed;; !
=;;" #
true;;$ (
,;;( )
Data<< 
=<< 
await<< $
Lib<<% (
.<<( )

ViewModels<<) 3
.<<3 4
MixTemplates<<4 @
.<<@ A
UpdateViewModel<<A P
.<<P Q

InitViewAsync<<Q ^
(<<^ _
model<<_ d
)<<d e
}== 
;== 
result>> 
.>> 
Data>> 
.>>  
Specificulture>>  .
=>>/ 0
_lang>>1 6
;>>6 7
return?? 
result?? !
;??! "
}@@ 
elseAA 
{BB 
returnCC 
newCC 
RepositoryResponseCC 1
<CC1 2
LibCC2 5
.CC5 6

ViewModelsCC6 @
.CC@ A
MixTemplatesCCA M
.CCM N
UpdateViewModelCCN ]
>CC] ^
(CC^ _
)CC_ `
;CC` a
}DD 
}EE 

}FF 	
[II 	
HttpGetII	 
,II 
HttpOptionsII 
]II 
[JJ 	
RouteJJ	 
(JJ 
$strJJ 
)JJ 
]JJ 
publicKK 
asyncKK 
TaskKK 
<KK 
RepositoryResponseKK ,
<KK, -
MixTemplateKK- 8
>KK8 9
>KK9 :
DeleteAsyncKK; F
(KKF G
intKKG J
idKKK M
)KKM N
{LL 	
varMM 
getPageMM 
=MM 
awaitMM 
LibMM  #
.MM# $

ViewModelsMM$ .
.MM. /
MixTemplatesMM/ ;
.MM; <
UpdateViewModelMM< K
.MMK L

RepositoryMML V
.MMV W
GetSingleModelAsyncMMW j
(MMj k
modelNN 
=>NN 
modelNN 
.NN 
IdNN !
==NN" $
idNN% '
)NN' (
;NN( )
ifOO 
(OO 
getPageOO 
.OO 
	IsSucceedOO !
)OO! "
{PP 

returnRR 
awaitRR 
getPageRR $
.RR$ %
DataRR% )
.RR) *
RemoveModelAsyncRR* :
(RR: ;
trueRR; ?
)RR? @
;RR@ A
}SS 

elseTT 
{UU 

returnVV 
newVV 
RepositoryResponseVV -
<VV- .
MixTemplateVV. 9
>VV9 :
(VV: ;
)VV; <
{WW 
	IsSucceedXX 
=XX 
falseXX  %
}YY 
;YY 
}ZZ 

}[[ 	
[cc 	
HttpPostcc	 
,cc 
HttpOptionscc 
]cc 
[dd 	
Routedd	 
(dd 
$strdd 
)dd 
]dd 
publicee 
asyncee 
Taskee 
<ee 
RepositoryResponseee ,
<ee, -
Libee- 0
.ee0 1

ViewModelsee1 ;
.ee; <
MixTemplatesee< H
.eeH I
UpdateViewModeleeI X
>eeX Y
>eeY Z
Saveee[ _
(ee_ `
[ff 

FromBodyff
 
]ff 
Libff 
.ff 

ViewModelsff %
.ff% &
MixTemplatesff& 2
.ff2 3
UpdateViewModelff3 B
modelffC H
)ffH I
{gg 	
ifhh 
(hh 
modelhh 
!=hh 
nullhh 
)hh 
{ii 

varjj 
resultjj 
=jj 
awaitjj "
modeljj# (
.jj( )
SaveModelAsyncjj) 7
(jj7 8
truejj8 <
)jj< =
.jj= >
ConfigureAwaitjj> L
(jjL M
falsejjM R
)jjR S
;jjS T
returnkk 
resultkk 
;kk 
}ll 

returnmm 
newmm 
RepositoryResponsemm )
<mm) *
Libmm* -
.mm- .

ViewModelsmm. 8
.mm8 9
MixTemplatesmm9 E
.mmE F
UpdateViewModelmmF U
>mmU V
(mmV W
)mmW X
;mmX Y
}nn 	
[qq 	
HttpPostqq	 
,qq 
HttpOptionsqq 
]qq 
[rr 	
Routerr	 
(rr 
$strrr 
)rr 
]rr 
publicss 
asyncss 
Taskss 
<ss 
RepositoryResponsess ,
<ss, -
MixTemplatess- 8
>ss8 9
>ss9 :

SaveFieldsss; E
(ssE F
intssF I
idssJ L
,ssL M
[ssN O
FromBodyssO W
]ssW X
ListssX \
<ss\ ]
EntityFieldss] h
>ssh i
fieldsssj p
)ssp q
{tt 	
ifuu 
(uu 
fieldsuu 
!=uu 
nulluu 
)uu 
{vv 

varww 
resultww 
=ww 
newww  
RepositoryResponseww! 3
<ww3 4
MixTemplateww4 ?
>ww? @
(ww@ A
)wwA B
{wwC D
	IsSucceedwwE N
=wwO P
truewwQ U
}wwV W
;wwW X
foreachxx 
(xx 
varxx 
propertyxx %
inxx& (
fieldsxx) /
)xx/ 0
{yy 
ifzz 
(zz 
resultzz 
.zz 
	IsSucceedzz (
)zz( )
{{{ 
result|| 
=||  
await||! &
Lib||' *
.||* +

ViewModels||+ 5
.||5 6
MixTemplates||6 B
.||B C
UpdateViewModel||C R
.||R S

Repository||S ]
.||] ^
UpdateFieldsAsync||^ o
(||o p
c||p q
=>||r t
c||u v
.||v w
Id||w y
==||z |
id||} 
,	|| ï¿½
fields
||ï¿½ ï¿½
)
||ï¿½ ï¿½
.
||ï¿½ ï¿½
ConfigureAwait
||ï¿½ ï¿½
(
||ï¿½ ï¿½
false
||ï¿½ ï¿½
)
||ï¿½ ï¿½
;
||ï¿½ ï¿½
}}} 
else~~ 
{ 
break
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 
}
ï¿½ï¿½ 
return
ï¿½ï¿½ 
result
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 

return
ï¿½ï¿½ 
new
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ )
<
ï¿½ï¿½) *
MixTemplate
ï¿½ï¿½* 5
>
ï¿½ï¿½5 6
(
ï¿½ï¿½6 7
)
ï¿½ï¿½7 8
;
ï¿½ï¿½8 9
}
ï¿½ï¿½ 	
[
ï¿½ï¿½ 	
HttpPost
ï¿½ï¿½	 
,
ï¿½ï¿½ 
HttpOptions
ï¿½ï¿½ 
]
ï¿½ï¿½ 
[
ï¿½ï¿½ 	
Route
ï¿½ï¿½	 
(
ï¿½ï¿½ 
$str
ï¿½ï¿½ 
)
ï¿½ï¿½  
]
ï¿½ï¿½  !
public
ï¿½ï¿½ 
async
ï¿½ï¿½ 
Task
ï¿½ï¿½ 
<
ï¿½ï¿½  
RepositoryResponse
ï¿½ï¿½ ,
<
ï¿½ï¿½, -
PaginationModel
ï¿½ï¿½- <
<
ï¿½ï¿½< =
Lib
ï¿½ï¿½= @
.
ï¿½ï¿½@ A

ViewModels
ï¿½ï¿½A K
.
ï¿½ï¿½K L
MixTemplates
ï¿½ï¿½L X
.
ï¿½ï¿½X Y
UpdateViewModel
ï¿½ï¿½Y h
>
ï¿½ï¿½h i
>
ï¿½ï¿½i j
>
ï¿½ï¿½j k
GetList
ï¿½ï¿½l s
(
ï¿½ï¿½s t
int
ï¿½ï¿½ 
themeId
ï¿½ï¿½ 
,
ï¿½ï¿½ 
[
ï¿½ï¿½ 

FromBody
ï¿½ï¿½
 
]
ï¿½ï¿½ 

RequestPaging
ï¿½ï¿½ #
request
ï¿½ï¿½$ +
)
ï¿½ï¿½ 

{
ï¿½ï¿½ 	

Expression
ï¿½ï¿½ 
<
ï¿½ï¿½ 
Func
ï¿½ï¿½ 
<
ï¿½ï¿½ 
MixTemplate
ï¿½ï¿½ '
,
ï¿½ï¿½' (
bool
ï¿½ï¿½) -
>
ï¿½ï¿½- .
>
ï¿½ï¿½. /
	predicate
ï¿½ï¿½0 9
=
ï¿½ï¿½: ;
model
ï¿½ï¿½< A
=>
ï¿½ï¿½B D
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
ThemeId
ï¿½ï¿½ 
==
ï¿½ï¿½  
themeId
ï¿½ï¿½! (
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
string
ï¿½ï¿½ 
.
ï¿½ï¿½  
IsNullOrWhiteSpace
ï¿½ï¿½ .
(
ï¿½ï¿½. /
request
ï¿½ï¿½/ 6
.
ï¿½ï¿½6 7
Key
ï¿½ï¿½7 :
)
ï¿½ï¿½: ;
||
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 

FolderType
ï¿½ï¿½ (
==
ï¿½ï¿½) +
(
ï¿½ï¿½, -
request
ï¿½ï¿½- 4
.
ï¿½ï¿½4 5
Key
ï¿½ï¿½5 8
)
ï¿½ï¿½8 9
)
ï¿½ï¿½ 
)
ï¿½ï¿½ 
&&
ï¿½ï¿½ 
(
ï¿½ï¿½ 
string
ï¿½ï¿½ 
.
ï¿½ï¿½  
IsNullOrWhiteSpace
ï¿½ï¿½ -
(
ï¿½ï¿½- .
request
ï¿½ï¿½. 5
.
ï¿½ï¿½5 6
Keyword
ï¿½ï¿½6 =
)
ï¿½ï¿½= >
||
ï¿½ï¿½ 
(
ï¿½ï¿½ 
model
ï¿½ï¿½ 
.
ï¿½ï¿½ 
FileName
ï¿½ï¿½ '
.
ï¿½ï¿½' (
Contains
ï¿½ï¿½( 0
(
ï¿½ï¿½0 1
request
ï¿½ï¿½1 8
.
ï¿½ï¿½8 9
Keyword
ï¿½ï¿½9 @
)
ï¿½ï¿½@ A
||
ï¿½ï¿½ 
model
ï¿½ï¿½  
.
ï¿½ï¿½  !

FileFolder
ï¿½ï¿½! +
.
ï¿½ï¿½+ ,
Contains
ï¿½ï¿½, 4
(
ï¿½ï¿½4 5
request
ï¿½ï¿½5 <
.
ï¿½ï¿½< =
Keyword
ï¿½ï¿½= D
)
ï¿½ï¿½D E
||
ï¿½ï¿½ 
model
ï¿½ï¿½  
.
ï¿½ï¿½  !

FolderType
ï¿½ï¿½! +
==
ï¿½ï¿½, .
request
ï¿½ï¿½/ 6
.
ï¿½ï¿½6 7
Keyword
ï¿½ï¿½7 >
)
ï¿½ï¿½ 
)
ï¿½ï¿½ 
;
ï¿½ï¿½ 
var
ï¿½ï¿½ 
data
ï¿½ï¿½ 
=
ï¿½ï¿½ 
await
ï¿½ï¿½ 
Lib
ï¿½ï¿½  
.
ï¿½ï¿½  !

ViewModels
ï¿½ï¿½! +
.
ï¿½ï¿½+ ,
MixTemplates
ï¿½ï¿½, 8
.
ï¿½ï¿½8 9
UpdateViewModel
ï¿½ï¿½9 H
.
ï¿½ï¿½H I

Repository
ï¿½ï¿½I S
.
ï¿½ï¿½S T!
GetModelListByAsync
ï¿½ï¿½T g
(
ï¿½ï¿½g h
	predicate
ï¿½ï¿½h q
,
ï¿½ï¿½q r
request
ï¿½ï¿½s z
.
ï¿½ï¿½z {
OrderByï¿½ï¿½{ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	Directionï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
PageSizeï¿½ï¿½ï¿½ ï¿½
,ï¿½ï¿½ï¿½ ï¿½
requestï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
	PageIndexï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
.ï¿½ï¿½ï¿½ ï¿½
ConfigureAwaitï¿½ï¿½ï¿½ ï¿½
(ï¿½ï¿½ï¿½ ï¿½
falseï¿½ï¿½ï¿½ ï¿½
)ï¿½ï¿½ï¿½ ï¿½
;ï¿½ï¿½ï¿½ ï¿½
return
ï¿½ï¿½ 
data
ï¿½ï¿½ 
;
ï¿½ï¿½ 
}
ï¿½ï¿½ 	
}
ï¿½ï¿½ 
}ï¿½ï¿½ ï¿½2
YC:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\BaseApiControoler.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{

 
public 

class 
BaseApiController "
:" #

Controller$ .
{ 
	protected 
readonly 
IHubContext &
<& '
	PortalHub' 0
>0 1
_hubContext2 =
;= >
	protected 
readonly 
IMemoryCache '
_memoryCache( 4
;4 5
	protected 
string 
_lang 
; 
	protected 
string 
_domain  
;  !
public$$ 
BaseApiController$$  
($$  !
IHubContext$$! ,
<$$, -
	PortalHub$$- 6
>$$6 7

hubContext$$8 B
)$$B C
{%% 	
_hubContext&& 
=&& 

hubContext&& $
;&&$ %
}'' 	
public// 
override// 
void// 
OnActionExecuting// .
(//. /"
ActionExecutingContext/// E
context//F M
)//M N
{00 	
GetLanguage11 
(11 
)11 
;11 

AlertAsync22 
(22 
$str22 *
,22* +
$num22, /
)22/ 0
;220 1
base33 
.33 
OnActionExecuting33 "
(33" #
context33# *
)33* +
;33+ ,
}44 	
	protected:: 
void:: 

AlertAsync:: !
(::! "
string::" (
action::) /
,::/ 0
int::1 4
status::5 ;
,::; <
string::= C
message::D K
=::L M
null::N R
)::R S
{;; 	
var<< 
logMsg<< 
=<< 
new<< 
JObject<< $
(<<$ %
)<<% &
{== 
new>> 
	JProperty>> !
(>>! "
$str>>" .
,>>. /
DateTime>>0 8
.>>8 9
UtcNow>>9 ?
)>>? @
,>>@ A
new?? 
	JProperty?? !
(??! "
$str??" (
,??( )
User??* .
.??. /
Identity??/ 7
???7 8
.??8 9
Name??9 =
)??= >
,??> ?
new@@ 
	JProperty@@ !
(@@! "
$str@@" /
,@@/ 0
Request@@1 8
.@@8 9
Path@@9 =
.@@= >
Value@@> C
)@@C D
,@@D E
newAA 
	JPropertyAA !
(AA! "
$strAA" *
,AA* +
actionAA, 2
)AA2 3
,AA3 4
newBB 
	JPropertyBB !
(BB! "
$strBB" *
,BB* +
statusBB, 2
)BB2 3
,BB3 4
newCC 
	JPropertyCC !
(CC! "
$strCC" +
,CC+ ,
messageCC- 4
)CC4 5
}DD 
;DD 
_hubContextEE 
.EE 
ClientsEE 
.EE  
AllEE  #
.EE# $
	SendAsyncEE$ -
(EE- .
$strEE. >
,EE> ?
logMsgEE@ F
)EEF G
;EEG H
}FF 	
	protectedHH 
voidHH "
ParseRequestPagingDateHH -
(HH- .

RequestPagingHH. ;
requestHH< C
)HHC D
{II 	
requestJJ 
.JJ 
FromDateJJ 
=JJ 
requestJJ &
.JJ& '
FromDateJJ' /
.JJ/ 0
HasValueJJ0 8
?JJ9 :
newJJ; >
DateTimeJJ? G
(JJG H
requestJJH O
.JJO P
FromDateJJP X
.JJX Y
ValueJJY ^
.JJ^ _
YearJJ_ c
,JJc d
requestJJe l
.JJl m
FromDateJJm u
.JJu v
ValueJJv {
.JJ{ |
Month	JJ| ï¿½
,
JJï¿½ ï¿½
request
JJï¿½ ï¿½
.
JJï¿½ ï¿½
FromDate
JJï¿½ ï¿½
.
JJï¿½ ï¿½
Value
JJï¿½ ï¿½
.
JJï¿½ ï¿½
Day
JJï¿½ ï¿½
)
JJï¿½ ï¿½
.
JJï¿½ ï¿½
ToUniversalTime
JJï¿½ ï¿½
(
JJï¿½ ï¿½
)
JJï¿½ ï¿½
:KK 
defaultKK 
(KK 
DateTimeKK "
?KK" #
)KK# $
;KK$ %
requestLL 
.LL 
ToDateLL 
=LL 
requestLL $
.LL$ %
ToDateLL% +
.LL+ ,
HasValueLL, 4
?LL5 6
newLL7 :
DateTimeLL; C
(LLC D
requestLLD K
.LLK L
ToDateLLL R
.LLR S
ValueLLS X
.LLX Y
YearLLY ]
,LL] ^
requestLL_ f
.LLf g
ToDateLLg m
.LLm n
ValueLLn s
.LLs t
MonthLLt y
,LLy z
request	LL{ ï¿½
.
LLï¿½ ï¿½
ToDate
LLï¿½ ï¿½
.
LLï¿½ ï¿½
Value
LLï¿½ ï¿½
.
LLï¿½ ï¿½
Day
LLï¿½ ï¿½
)
LLï¿½ ï¿½
.
LLï¿½ ï¿½
ToUniversalTime
LLï¿½ ï¿½
(
LLï¿½ ï¿½
)
LLï¿½ ï¿½
.
LLï¿½ ï¿½
AddDays
LLï¿½ ï¿½
(
LLï¿½ ï¿½
$num
LLï¿½ ï¿½
)
LLï¿½ ï¿½
:MM 
defaultMM 
(MM 
DateTimeMM "
?MM" #
)MM# $
;MM$ %
}NN 	
	protectedSS 
voidSS 
GetLanguageSS "
(SS" #
)SS# $
{TT 	
_langUU 
=UU 
	RouteDataUU 
?UU 
.UU 
ValuesUU %
[UU% &
$strUU& /
]UU/ 0
!=UU1 3
nullUU4 8
?UU9 :
	RouteDataUU; D
.UUD E
ValuesUUE K
[UUK L
$strUUL U
]UUU V
.UUV W
ToStringUUW _
(UU_ `
)UU` a
:UUb c

MixServiceUUd n
.UUn o
	GetConfigUUo x
<UUx y
stringUUy 
>	UU ï¿½
(
UUï¿½ ï¿½
$str
UUï¿½ ï¿½
)
UUï¿½ ï¿½
;
UUï¿½ ï¿½
ViewBagVV 
.VV 
cultureVV 
=VV 
_langVV #
;VV# $
_domainXX 
=XX 
stringXX 
.XX 
FormatXX #
(XX# $
$strXX$ /
,XX/ 0
RequestXX1 8
.XX8 9
SchemeXX9 ?
,XX? @
RequestXXA H
.XXH I
HostXXI M
)XXM N
;XXN O
}YY 	
}ZZ 
}[[ ï¿½R
`C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Controllers\v1\BaseGenericApiControoler.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
. 
Controllers !
{ 
public 

class $
BaseGenericApiControoler )
<) *

TDbContext* 4
,4 5
TModel6 <
>< =
:> ?

Controller@ J
where 


TDbContext 
: 
	DbContext $
where 

TModel 
: 
class 
{ 
	protected 
readonly 
IHubContext &
<& '
	PortalHub' 0
>0 1
_hubContext2 =
;= >
	protected 
readonly 
IMemoryCache '
_memoryCache( 4
;4 5
	protected 
string 
_lang 
; 
	protected## 
string## 
_domain##  
;##  !
public++ $
BaseGenericApiControoler++ '
(++' (
IMemoryCache++( 4
memoryCache++5 @
,++@ A
IHubContext++B M
<++M N
	PortalHub++N W
>++W X

hubContext++Y c
)++c d
{,, 	
_hubContext-- 
=-- 

hubContext-- $
;--$ %
_memoryCache.. 
=.. 
memoryCache.. &
;..& '
}// 	
public77 
override77 
void77 
OnActionExecuting77 .
(77. /"
ActionExecutingContext77/ E
context77F M
)77M N
{88 	
GetLanguage99 
(99 
)99 
;99 

AlertAsync:: 
(:: 
$str:: *
,::* +
$num::, /
)::/ 0
;::0 1
base;; 
.;; 
OnActionExecuting;; "
(;;" #
context;;# *
);;* +
;;;+ ,
}<< 	
	protectedAA 
asyncAA 
TaskAA 
<AA 
RepositoryResponseAA /
<AA/ 0
TViewAA0 5
>AA5 6
>AA6 7
GetSingleAsyncAA8 F
<AAF G
TViewAAG L
>AAL M
(AAM N
stringAAN T
keyAAU X
,AAX Y

ExpressionAAZ d
<AAd e
FuncAAe i
<AAi j
TModelAAj p
,AAp q
boolAAr v
>AAv w
>AAw x
	predicate	AAy ï¿½
=
AAï¿½ ï¿½
null
AAï¿½ ï¿½
,
AAï¿½ ï¿½
TModel
AAï¿½ ï¿½
model
AAï¿½ ï¿½
=
AAï¿½ ï¿½
null
AAï¿½ ï¿½
)
AAï¿½ ï¿½
whereBB 
TViewBB 
:BB 

ViewModelBaseBB '
<BB' (

TDbContextBB( 2
,BB2 3
TModelBB4 :
,BB: ;
TViewBB< A
>BBA B
{CC 	
varDD 
getPageDD 
=DD 
newDD 
RepositoryResponseDD 0
<DD0 1
LibDD1 4
.DD4 5

ViewModelsDD5 ?
.DD? @
MixPagesDD@ H
.DDH I
ReadMvcViewModelDDI Y
>DDY Z
(DDZ [
)DD[ \
;DD\ ]
varFF 
cacheKeyFF 
=FF 
$"FF 
{FF 
typeofFF $
(FF$ %
TModelFF% +
)FF+ ,
.FF, -
NameFF- 1
}FF1 2
_FF2 3
{FF3 4
_langFF4 9
}FF9 :
_FF: ;
{FF; <
keyFF< ?
}FF? @
"FF@ A
;FFA B
varGG 
dataGG 
=GG 
_memoryCacheGG #
.GG# $
GetGG$ '
<GG' (
RepositoryResponseGG( :
<GG: ;
TViewGG; @
>GG@ A
>GGA B
(GGB C
cacheKeyGGC K
)GGK L
;GGL M
ifHH 
(HH 
dataHH 
==HH 
nullHH 
)HH 
{II 

ifJJ 
(JJ 
	predicateJJ 
!=JJ  
nullJJ! %
)JJ% &
{KK 
dataLL 
=LL 
awaitLL  
DefaultRepositoryLL! 2
<LL2 3

TDbContextLL3 =
,LL= >
TModelLL? E
,LLE F
TViewLLG L
>LLL M
.LLM N
InstanceLLN V
.LLV W
GetSingleModelAsyncLLW j
(LLj k
	predicateLLk t
)LLt u
;LLu v
_memoryCacheMM  
.MM  !
SetMM! $
<MM$ %
RepositoryResponseMM% 7
<MM7 8
TViewMM8 =
>MM= >
>MM> ?
(MM? @
cacheKeyMM@ H
,MMH I
dataMMJ N
)MMN O
;MMO P
}NN 
elseOO 
{PP 
dataQQ 
=QQ 
newQQ 
RepositoryResponseQQ 1
<QQ1 2
TViewQQ2 7
>QQ7 8
(QQ8 9
)QQ9 :
{RR 
	IsSucceedSS !
=SS" #
trueSS$ (
,SS( )
DataTT 
=TT 
DefaultRepositoryTT 0
<TT0 1

TDbContextTT1 ;
,TT; <
TModelTT= C
,TTC D
TViewTTE J
>TTJ K
.TTK L
InstanceTTL T
.TTT U
	ParseViewTTU ^
(TT^ _
modelTT_ d
)TTd e
}UU 
;UU 
_memoryCacheVV  
.VV  !
SetVV! $
<VV$ %
RepositoryResponseVV% 7
<VV7 8
TViewVV8 =
>VV= >
>VV> ?
(VV? @
cacheKeyVV@ H
,VVH I
dataVVJ N
)VVN O
;VVO P
}WW 
}XX 

returnYY 
dataYY 
;YY 
}ZZ 	
	protected\\ 
void\\ 

AlertAsync\\ !
(\\! "
string\\" (
action\\) /
,\\/ 0
int\\1 4
status\\5 ;
,\\; <
string\\= C
message\\D K
=\\L M
null\\N R
)\\R S
{]] 	
var^^ 
logMsg^^ 
=^^ 
new^^ 
JObject^^ $
(^^$ %
)^^% &
{__ 
new`` 
	JProperty`` !
(``! "
$str``" .
,``. /
DateTime``0 8
.``8 9
UtcNow``9 ?
)``? @
,``@ A
newaa 
	JPropertyaa !
(aa! "
$straa" (
,aa( )
Useraa* .
.aa. /
Identityaa/ 7
?aa7 8
.aa8 9
Nameaa9 =
)aa= >
,aa> ?
newbb 
	JPropertybb !
(bb! "
$strbb" /
,bb/ 0
Requestbb1 8
.bb8 9
Pathbb9 =
.bb= >
Valuebb> C
)bbC D
,bbD E
newcc 
	JPropertycc !
(cc! "
$strcc" *
,cc* +
actioncc, 2
)cc2 3
,cc3 4
newdd 
	JPropertydd !
(dd! "
$strdd" *
,dd* +
statusdd, 2
)dd2 3
,dd3 4
newee 
	JPropertyee !
(ee! "
$stree" +
,ee+ ,
messageee- 4
)ee4 5
}ff 
;ff 
_hubContextgg 
.gg 
Clientsgg 
.gg  
Allgg  #
.gg# $
	SendAsyncgg$ -
(gg- .
$strgg. >
,gg> ?
logMsggg@ F
)ggF G
;ggG H
}hh 	
	protectedjj 
voidjj "
ParseRequestPagingDatejj -
(jj- .

RequestPagingjj. ;
requestjj< C
)jjC D
{kk 	
requestll 
.ll 
FromDatell 
=ll 
requestll &
.ll& '
FromDatell' /
.ll/ 0
HasValuell0 8
?ll9 :
newll; >
DateTimell? G
(llG H
requestllH O
.llO P
FromDatellP X
.llX Y
ValuellY ^
.ll^ _
Yearll_ c
,llc d
requestlle l
.lll m
FromDatellm u
.llu v
Valuellv {
.ll{ |
Month	ll| ï¿½
,
llï¿½ ï¿½
request
llï¿½ ï¿½
.
llï¿½ ï¿½
FromDate
llï¿½ ï¿½
.
llï¿½ ï¿½
Value
llï¿½ ï¿½
.
llï¿½ ï¿½
Day
llï¿½ ï¿½
)
llï¿½ ï¿½
.
llï¿½ ï¿½
ToUniversalTime
llï¿½ ï¿½
(
llï¿½ ï¿½
)
llï¿½ ï¿½
:mm 
defaultmm 
(mm 
DateTimemm "
?mm" #
)mm# $
;mm$ %
requestnn 
.nn 
ToDatenn 
=nn 
requestnn $
.nn$ %
ToDatenn% +
.nn+ ,
HasValuenn, 4
?nn5 6
newnn7 :
DateTimenn; C
(nnC D
requestnnD K
.nnK L
ToDatennL R
.nnR S
ValuennS X
.nnX Y
YearnnY ]
,nn] ^
requestnn_ f
.nnf g
ToDatenng m
.nnm n
Valuennn s
.nns t
Monthnnt y
,nny z
request	nn{ ï¿½
.
nnï¿½ ï¿½
ToDate
nnï¿½ ï¿½
.
nnï¿½ ï¿½
Value
nnï¿½ ï¿½
.
nnï¿½ ï¿½
Day
nnï¿½ ï¿½
)
nnï¿½ ï¿½
.
nnï¿½ ï¿½
ToUniversalTime
nnï¿½ ï¿½
(
nnï¿½ ï¿½
)
nnï¿½ ï¿½
.
nnï¿½ ï¿½
AddDays
nnï¿½ ï¿½
(
nnï¿½ ï¿½
$num
nnï¿½ ï¿½
)
nnï¿½ ï¿½
:oo 
defaultoo 
(oo 
DateTimeoo "
?oo" #
)oo# $
;oo$ %
}pp 	
	protecteduu 
voiduu 
GetLanguageuu "
(uu" #
)uu# $
{vv 	
_langww 
=ww 
	RouteDataww 
?ww 
.ww 
Valuesww %
[ww% &
$strww& /
]ww/ 0
!=ww1 3
nullww4 8
?ww9 :
	RouteDataww; D
.wwD E
ValueswwE K
[wwK L
$strwwL U
]wwU V
.wwV W
ToStringwwW _
(ww_ `
)ww` a
:wwb c

MixServicewwd n
.wwn o
	GetConfigwwo x
<wwx y
stringwwy 
>	ww ï¿½
(
wwï¿½ ï¿½
$str
wwï¿½ ï¿½
)
wwï¿½ ï¿½
;
wwï¿½ ï¿½
ViewBagxx 
.xx 
culturexx 
=xx 
_langxx #
;xx# $
_domainzz 
=zz 
stringzz 
.zz 
Formatzz #
(zz# $
$strzz$ /
,zz/ 0
Requestzz1 8
.zz8 9
Schemezz9 ?
,zz? @
RequestzzA H
.zzH I
HostzzI M
)zzM N
;zzN O
}{{ 	
}|| 
}}} ï¿½	
@C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Program.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
{ 
public

 

class

 
Program

 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	 
CreateWebHostBuilder  
(  !
args! %
)% &
.& '
Build' ,
(, -
)- .
.. /
Run/ 2
(2 3
)3 4
;4 5
} 	
public 
static 
IWebHostBuilder % 
CreateWebHostBuilder& :
(: ;
string; A
[A B
]B C
argsD H
)H I
=>J L
WebHost 
.  
CreateDefaultBuilder (
(( )
args) -
)- .
. 

UseStartup 
< 
Startup #
># $
($ %
)% &
;& '
} 
} ï¿½
@C:\_workspace\github\mixcore\mix.core\src\Mix.Cms.Api\Startup.cs
	namespace 	
Mix
 

.
 
Cms 
. 
Api 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %

configuration& 3
)3 4
{ 	

Configuration 
= 

configuration )
;) *
} 	
public 
IConfiguration 

Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddMvc 
( 
) 
. #
SetCompatibilityVersion 5
(5 6 
CompatibilityVersion6 J
.J K
Version_2_1K V
)V W
;W X
} 	
public   
void   
	Configure   
(   
IApplicationBuilder   1
app  2 5
,  5 6
IHostingEnvironment  7 J
env  K N
)  N O
{!! 	
if"" 
("" 
env"" 
."" 

IsDevelopment"" !
(""! "
)""" #
)""# $
{## 

app$$ 
.$$ %
UseDeveloperExceptionPage$$ -
($$- .
)$$. /
;$$/ 0
}%% 

else&& 
{'' 

app(( 
.(( 
UseHsts(( 
((( 
)(( 
;(( 
})) 

app++ 
.++ 
UseHttpsRedirection++ #
(++# $
)++$ %
;++% &
app,, 
.,, 
UseMvc,, 
(,, 
),, 
;,, 
}-- 	
}.. 
}// 